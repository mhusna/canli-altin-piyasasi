/*! For license information please see livePrices.bundle.js.LICENSE.txt */
(()=>{"use strict";var e={34(e,t,r){var n=r(4901);e.exports=function(e){return"object"==typeof e?null!==e:n(e)}},81(e,t,r){var n=r(9565),s=r(9306),i=r(8551),o=r(6823),a=r(851),c=TypeError;e.exports=function(e,t){var r=arguments.length<2?a(e):t;if(s(r))return i(n(r,e));throw new c(o(e)+" is not iterable")}},113(e,t,r){var n=r(6518),s=r(9213).find,i=r(6469),o="find",a=!0;o in[]&&Array(1)[o](function(){a=!1}),n({target:"Array",proto:!0,forced:a},{find:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}}),i(o)},235(e,t,r){var n=r(9213).forEach,s=r(4598)("forEach");e.exports=s?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},280(e,t,r){var n=r(6518),s=r(7751),i=r(6395),o=r(550),a=r(916).CONSTRUCTOR,c=r(3438),u=s("Promise"),l=i&&!a;n({target:"Promise",stat:!0,forced:i||a},{resolve:function(e){return c(l&&this===u?o:this,e)}})},283(e,t,r){var n=r(9504),s=r(9039),i=r(4901),o=r(9297),a=r(3724),c=r(350).CONFIGURABLE,u=r(3706),l=r(1181),h=l.enforce,d=l.get,f=String,p=Object.defineProperty,g=n("".slice),m=n("".replace),y=n([].join),v=a&&!s(function(){return 8!==p(function(){},"length",{value:8}).length}),w=String(String).split("String"),b=e.exports=function(e,t,r){"Symbol("===g(f(t),0,7)&&(t="["+m(f(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!o(e,"name")||c&&e.name!==t)&&(a?p(e,"name",{value:t,configurable:!0}):e.name=t),v&&r&&o(r,"arity")&&e.length!==r.arity&&p(e,"length",{value:r.arity});try{r&&o(r,"constructor")&&r.constructor?a&&p(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var n=h(e);return o(n,"source")||(n.source=y(w,"string"==typeof t?t:"")),e};Function.prototype.toString=b(function(){return i(this)&&d(this).source||u(this)},"toString")},287(e,t,r){r(6518)({target:"Object",stat:!0},{setPrototypeOf:r(2967)})},298(e,t,r){var n=r(2195),s=r(5397),i=r(8480).f,o=r(7680),a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"Window"===n(e)?function(e){try{return i(e)}catch(e){return o(a)}}(e):i(s(e))}},350(e,t,r){var n=r(3724),s=r(9297),i=Function.prototype,o=n&&Object.getOwnPropertyDescriptor,a=s(i,"name"),c=a&&"something"===function(){}.name,u=a&&(!n||n&&o(i,"name").configurable);e.exports={EXISTS:a,PROPER:c,CONFIGURABLE:u}},397(e,t,r){var n=r(7751);e.exports=n("document","documentElement")},421(e){e.exports={}},436(e,t,r){var n,s,i,o,a=r(6518),c=r(6395),u=r(6193),l=r(4576),h=r(9167),d=r(9565),f=r(6840),p=r(2967),g=r(687),m=r(7633),y=r(9306),v=r(4901),w=r(34),b=r(679),_=r(2293),E=r(9225).set,T=r(1955),S=r(3138),I=r(1103),k=r(8265),A=r(1181),C=r(550),O=r(916),R=r(6043),N="Promise",P=O.CONSTRUCTOR,x=O.REJECTION_EVENT,D=O.SUBCLASSING,L=A.getterFor(N),j=A.set,M=C&&C.prototype,U=C,$=M,F=l.TypeError,V=l.document,B=l.process,q=R.f,K=q,H=!!(V&&V.createEvent&&l.dispatchEvent),z="unhandledrejection",G=function(e){var t;return!(!w(e)||!v(t=e.then))&&t},W=function(e,t){var r,n,s,i=t.value,o=1===t.state,a=o?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{a?(o||(2===t.rejection&&Z(t),t.rejection=1),!0===a?r=i:(l&&l.enter(),r=a(i),l&&(l.exit(),s=!0)),r===e.promise?u(new F("Promise-chain cycle")):(n=G(r))?d(n,r,c,u):c(r)):u(i)}catch(e){l&&!s&&l.exit(),u(e)}},J=function(e,t){e.notified||(e.notified=!0,T(function(){for(var r,n=e.reactions;r=n.get();)W(r,e);e.notified=!1,t&&!e.rejection&&Q(e)}))},Y=function(e,t,r){var n,s;H?((n=V.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),l.dispatchEvent(n)):n={promise:t,reason:r},!x&&(s=l["on"+e])?s(n):e===z&&S("Unhandled promise rejection",r)},Q=function(e){d(E,l,function(){var t,r=e.facade,n=e.value;if(X(e)&&(t=I(function(){u?B.emit("unhandledRejection",n,r):Y(z,r,n)}),e.rejection=u||X(e)?2:1,t.error))throw t.value})},X=function(e){return 1!==e.rejection&&!e.parent},Z=function(e){d(E,l,function(){var t=e.facade;u?B.emit("rejectionHandled",t):Y("rejectionhandled",t,e.value)})},ee=function(e,t,r){return function(n){e(t,n,r)}},te=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,J(e,!0))},re=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw new F("Promise can't be resolved itself");var n=G(t);n?T(function(){var r={done:!1};try{d(n,t,ee(re,r,e),ee(te,r,e))}catch(t){te(r,t,e)}}):(e.value=t,e.state=1,J(e,!1))}catch(t){te({done:!1},t,e)}}};if(P&&($=(U=function(e){b(this,$),y(e),d(n,this);var t=L(this);try{e(ee(re,t),ee(te,t))}catch(e){te(t,e)}}).prototype,(n=function(e){j(this,{type:N,done:!1,notified:!1,parent:!1,reactions:new k,rejection:!1,state:0,value:null})}).prototype=f($,"then",function(e,t){var r=L(this),n=q(_(this,U));return r.parent=!0,n.ok=!v(e)||e,n.fail=v(t)&&t,n.domain=u?B.domain:void 0,0===r.state?r.reactions.add(n):T(function(){W(n,r)}),n.promise}),s=function(){var e=new n,t=L(e);this.promise=e,this.resolve=ee(re,t),this.reject=ee(te,t)},R.f=q=function(e){return e===U||e===i?new s(e):K(e)},!c&&v(C)&&M!==Object.prototype)){o=M.then,D||f(M,"then",function(e,t){var r=this;return new U(function(e,t){d(o,r,e,t)}).then(e,t)},{unsafe:!0});try{delete M.constructor}catch(e){}p&&p(M,$)}a({global:!0,constructor:!0,wrap:!0,forced:P},{Promise:U}),i=h.Promise,g(U,N,!1,!0),m(N)},511(e,t,r){var n=r(9167),s=r(9297),i=r(1951),o=r(4913).f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});s(t,e)||o(t,e,{value:i.f(e)})}},533(e,t,r){var n=r(9504),s=r(8014),i=r(655),o=r(2333),a=r(7750),c=n(o),u=n("".slice),l=Math.ceil,h=function(e){return function(t,r,n){var o,h,d=i(a(t)),f=s(r),p=d.length,g=void 0===n?" ":i(n);return f<=p||""===g?d:((h=c(g,l((o=f-p)/g.length))).length>o&&(h=u(h,0,o)),e?d+h:h+d)}};e.exports={start:h(!1),end:h(!0)}},537(e,t,r){var n=r(550),s=r(4428),i=r(916).CONSTRUCTOR;e.exports=i||!s(function(e){n.all(e).then(void 0,function(){})})},550(e,t,r){var n=r(4576);e.exports=n.Promise},597(e,t,r){var n=r(9039),s=r(8227),i=r(9519),o=s("species");e.exports=function(e){return i>=51||!n(function(){var t=[];return(t.constructor={})[o]=function(){return{foo:1}},1!==t[e](Boolean).foo})}},616(e,t,r){var n=r(9039);e.exports=!n(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})},655(e,t,r){var n=r(6955),s=String;e.exports=function(e){if("Symbol"===n(e))throw new TypeError("Cannot convert a Symbol value to a string");return s(e)}},679(e,t,r){var n=r(1625),s=TypeError;e.exports=function(e,t){if(n(t,e))return e;throw new s("Incorrect invocation")}},687(e,t,r){var n=r(4913).f,s=r(9297),i=r(8227)("toStringTag");e.exports=function(e,t,r){e&&!r&&(e=e.prototype),e&&!s(e,i)&&n(e,i,{configurable:!0,value:t})}},741(e){var t=Math.ceil,r=Math.floor;e.exports=Math.trunc||function(e){var n=+e;return(n>0?r:t)(n)}},757(e,t,r){var n=r(7751),s=r(4901),i=r(1625),o=r(7040),a=Object;e.exports=o?function(e){return"symbol"==typeof e}:function(e){var t=n("Symbol");return s(t)&&i(t.prototype,a(e))}},788(e,t,r){var n=r(34),s=r(2195),i=r(8227)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[i])?!!t:"RegExp"===s(e))}},851(e,t,r){var n=r(6955),s=r(5966),i=r(4117),o=r(6269),a=r(8227)("iterator");e.exports=function(e){if(!i(e))return s(e,a)||s(e,"@@iterator")||o[n(e)]}},875(e,t,r){var n=r(6518),s=r(9039),i=r(8981),o=r(2787),a=r(2211);n({target:"Object",stat:!0,forced:s(function(){o(1)}),sham:!a},{getPrototypeOf:function(e){return o(i(e))}})},916(e,t,r){var n=r(4576),s=r(550),i=r(4901),o=r(2796),a=r(3706),c=r(8227),u=r(4215),l=r(6395),h=r(9519),d=s&&s.prototype,f=c("species"),p=!1,g=i(n.PromiseRejectionEvent),m=o("Promise",function(){var e=a(s),t=e!==String(s);if(!t&&66===h)return!0;if(l&&(!d.catch||!d.finally))return!0;if(!h||h<51||!/native code/.test(e)){var r=new s(function(e){e(1)}),n=function(e){e(function(){},function(){})};if((r.constructor={})[f]=n,!(p=r.then(function(){})instanceof n))return!0}return!(t||"BROWSER"!==u&&"DENO"!==u||g)});e.exports={CONSTRUCTOR:m,REJECTION_EVENT:g,SUBCLASSING:p}},1034(e,t,r){var n=r(9565),s=r(9297),i=r(1625),o=r(5213),a=r(7979),c=RegExp.prototype;e.exports=o.correct?function(e){return e.flags}:function(e){return o.correct||!i(c,e)||s(e,"flags")?e.flags:n(a,e)}},1072(e,t,r){var n=r(1828),s=r(8727);e.exports=Object.keys||function(e){return n(e,s)}},1088(e,t,r){var n=r(6518),s=r(9565),i=r(6395),o=r(350),a=r(4901),c=r(3994),u=r(2787),l=r(2967),h=r(687),d=r(6699),f=r(6840),p=r(8227),g=r(6269),m=r(7657),y=o.PROPER,v=o.CONFIGURABLE,w=m.IteratorPrototype,b=m.BUGGY_SAFARI_ITERATORS,_=p("iterator"),E="keys",T="values",S="entries",I=function(){return this};e.exports=function(e,t,r,o,p,m,k){c(r,t,o);var A,C,O,R=function(e){if(e===p&&L)return L;if(!b&&e&&e in x)return x[e];switch(e){case E:case T:case S:return function(){return new r(this,e)}}return function(){return new r(this)}},N=t+" Iterator",P=!1,x=e.prototype,D=x[_]||x["@@iterator"]||p&&x[p],L=!b&&D||R(p),j="Array"===t&&x.entries||D;if(j&&(A=u(j.call(new e)))!==Object.prototype&&A.next&&(i||u(A)===w||(l?l(A,w):a(A[_])||f(A,_,I)),h(A,N,!0,!0),i&&(g[N]=I)),y&&p===T&&D&&D.name!==T&&(!i&&v?d(x,"name",T):(P=!0,L=function(){return s(D,this)})),p)if(C={values:R(T),keys:m?L:R(E),entries:R(S)},k)for(O in C)(b||P||!(O in x))&&f(x,O,C[O]);else n({target:t,proto:!0,forced:b||P},C);return i&&!k||x[_]===L||f(x,_,L,{name:p}),g[t]=L,C}},1103(e){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},1181(e,t,r){var n,s,i,o=r(8622),a=r(4576),c=r(34),u=r(6699),l=r(9297),h=r(7629),d=r(6119),f=r(421),p="Object already initialized",g=a.TypeError,m=a.WeakMap;if(o||h.state){var y=h.state||(h.state=new m);y.get=y.get,y.has=y.has,y.set=y.set,n=function(e,t){if(y.has(e))throw new g(p);return t.facade=e,y.set(e,t),t},s=function(e){return y.get(e)||{}},i=function(e){return y.has(e)}}else{var v=d("state");f[v]=!0,n=function(e,t){if(l(e,v))throw new g(p);return t.facade=e,u(e,v,t),t},s=function(e){return l(e,v)?e[v]:{}},i=function(e){return l(e,v)}}e.exports={set:n,get:s,has:i,enforce:function(e){return i(e)?s(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!c(t)||(r=s(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return r}}}},1240(e,t,r){var n=r(9504);e.exports=n(1.1.valueOf)},1291(e,t,r){var n=r(741);e.exports=function(e){var t=+e;return t!=t||0===t?0:n(t)}},1296(e,t,r){var n=r(4495);e.exports=n&&!!Symbol.for&&!!Symbol.keyFor},1392(e,t,r){var n,s=r(6518),i=r(7476),o=r(7347).f,a=r(8014),c=r(655),u=r(5749),l=r(7750),h=r(1436),d=r(6395),f=i("".slice),p=Math.min,g=h("startsWith");s({target:"String",proto:!0,forced:!(!d&&!g&&(n=o(String.prototype,"startsWith"),n&&!n.writable)||g)},{startsWith:function(e){var t=c(l(this));u(e);var r=a(p(arguments.length>1?arguments[1]:void 0,t.length)),n=c(e);return f(t,r,r+n.length)===n}})},1436(e,t,r){var n=r(8227)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,"/./"[e](t)}catch(e){}}return!1}},1469(e,t,r){var n=r(7433);e.exports=function(e,t){return new(n(e))(0===t?0:t)}},1481(e,t,r){var n=r(6518),s=r(6043);n({target:"Promise",stat:!0,forced:r(916).CONSTRUCTOR},{reject:function(e){var t=s.f(this);return(0,t.reject)(e),t.promise}})},1510(e,t,r){var n=r(6518),s=r(7751),i=r(9297),o=r(655),a=r(5745),c=r(1296),u=a("string-to-symbol-registry"),l=a("symbol-to-string-registry");n({target:"Symbol",stat:!0,forced:!c},{for:function(e){var t=o(e);if(i(u,t))return u[t];var r=s("Symbol")(t);return u[t]=r,l[r]=t,r}})},1625(e,t,r){var n=r(9504);e.exports=n({}.isPrototypeOf)},1828(e,t,r){var n=r(9504),s=r(9297),i=r(5397),o=r(9617).indexOf,a=r(421),c=n([].push);e.exports=function(e,t){var r,n=i(e),u=0,l=[];for(r in n)!s(a,r)&&s(n,r)&&c(l,r);for(;t.length>u;)s(n,r=t[u++])&&(~o(l,r)||c(l,r));return l}},1951(e,t,r){var n=r(8227);t.f=n},1955(e,t,r){var n,s,i,o,a,c=r(4576),u=r(3389),l=r(6080),h=r(9225).set,d=r(8265),f=r(9544),p=r(4265),g=r(7860),m=r(6193),y=c.MutationObserver||c.WebKitMutationObserver,v=c.document,w=c.process,b=c.Promise,_=u("queueMicrotask");if(!_){var E=new d,T=function(){var e,t;for(m&&(e=w.domain)&&e.exit();t=E.get();)try{t()}catch(e){throw E.head&&n(),e}e&&e.enter()};f||m||g||!y||!v?!p&&b&&b.resolve?((o=b.resolve(void 0)).constructor=b,a=l(o.then,o),n=function(){a(T)}):m?n=function(){w.nextTick(T)}:(h=l(h,c),n=function(){h(T)}):(s=!0,i=v.createTextNode(""),new y(T).observe(i,{characterData:!0}),n=function(){i.data=s=!s}),_=function(e){E.head||n(),E.add(e)}}e.exports=_},2003(e,t,r){var n=r(6518),s=r(6395),i=r(916).CONSTRUCTOR,o=r(550),a=r(7751),c=r(4901),u=r(6840),l=o&&o.prototype;if(n({target:"Promise",proto:!0,forced:i,real:!0},{catch:function(e){return this.then(void 0,e)}}),!s&&c(o)){var h=a("Promise").prototype.catch;l.catch!==h&&u(l,"catch",h,{unsafe:!0})}},2010(e,t,r){var n=r(3724),s=r(350).EXISTS,i=r(9504),o=r(2106),a=Function.prototype,c=i(a.toString),u=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,l=i(u.exec);n&&!s&&o(a,"name",{configurable:!0,get:function(){try{return l(u,c(this))[1]}catch(e){return""}}})},2106(e,t,r){var n=r(283),s=r(4913);e.exports=function(e,t,r){return r.get&&n(r.get,t,{getter:!0}),r.set&&n(r.set,t,{setter:!0}),s.f(e,t,r)}},2140(e,t,r){var n={};n[r(8227)("toStringTag")]="z",e.exports="[object z]"===String(n)},2195(e,t,r){var n=r(9504),s=n({}.toString),i=n("".slice);e.exports=function(e){return i(s(e),8,-1)}},2211(e,t,r){var n=r(9039);e.exports=!n(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})},2259(e,t,r){r(511)("iterator")},2293(e,t,r){var n=r(8551),s=r(5548),i=r(4117),o=r(8227)("species");e.exports=function(e,t){var r,a=n(e).constructor;return void 0===a||i(r=n(a)[o])?t:s(r)}},2333(e,t,r){var n=r(1291),s=r(655),i=r(7750),o=RangeError;e.exports=function(e){var t=s(i(this)),r="",a=n(e);if(a<0||a===1/0)throw new o("Wrong number of repetitions");for(;a>0;(a>>>=1)&&(t+=t))1&a&&(r+=t);return r}},2357(e,t,r){var n=r(3724),s=r(9039),i=r(9504),o=r(2787),a=r(1072),c=r(5397),u=i(r(8773).f),l=i([].push),h=n&&s(function(){var e=Object.create(null);return e[2]=2,!u(e,2)}),d=function(e){return function(t){for(var r,s=c(t),i=a(s),d=h&&null===o(s),f=i.length,p=0,g=[];f>p;)r=i[p++],n&&!(d?r in s:u(s,r))||l(g,e?[r,s[r]]:s[r]);return g}};e.exports={entries:d(!0),values:d(!1)}},2360(e,t,r){var n,s=r(8551),i=r(6801),o=r(8727),a=r(421),c=r(397),u=r(4055),l=r(6119),h="prototype",d="script",f=l("IE_PROTO"),p=function(){},g=function(e){return"<"+d+">"+e+"</"+d+">"},m=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},y=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}var e,t,r;y="undefined"!=typeof document?document.domain&&n?m(n):(t=u("iframe"),r="java"+d+":",t.style.display="none",c.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(g("document.F=Object")),e.close(),e.F):m(n);for(var s=o.length;s--;)delete y[h][o[s]];return y()};a[f]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(p[h]=s(e),r=new p,p[h]=null,r[f]=e):r=y(),void 0===t?r:i.f(r,t)}},2478(e,t,r){var n=r(9504),s=r(8981),i=Math.floor,o=n("".charAt),a=n("".replace),c=n("".slice),u=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,l=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,r,n,h,d){var f=r+e.length,p=n.length,g=l;return void 0!==h&&(h=s(h),g=u),a(d,g,function(s,a){var u;switch(o(a,0)){case"$":return"$";case"&":return e;case"`":return c(t,0,r);case"'":return c(t,f);case"<":u=h[c(a,1,-1)];break;default:var l=+a;if(0===l)return s;if(l>p){var d=i(l/10);return 0===d?s:d<=p?void 0===n[d-1]?o(a,1):n[d-1]+o(a,1):s}u=n[l-1]}return void 0===u?"":u})}},2529(e){e.exports=function(e,t){return{value:e,done:t}}},2652(e,t,r){var n=r(6080),s=r(9565),i=r(8551),o=r(6823),a=r(4209),c=r(6198),u=r(1625),l=r(81),h=r(851),d=r(9539),f=TypeError,p=function(e,t){this.stopped=e,this.result=t},g=p.prototype;e.exports=function(e,t,r){var m,y,v,w,b,_,E,T=r&&r.that,S=!(!r||!r.AS_ENTRIES),I=!(!r||!r.IS_RECORD),k=!(!r||!r.IS_ITERATOR),A=!(!r||!r.INTERRUPTED),C=n(t,T),O=function(e){return m&&d(m,"normal"),new p(!0,e)},R=function(e){return S?(i(e),A?C(e[0],e[1],O):C(e[0],e[1])):A?C(e,O):C(e)};if(I)m=e.iterator;else if(k)m=e;else{if(!(y=h(e)))throw new f(o(e)+" is not iterable");if(a(y)){for(v=0,w=c(e);w>v;v++)if((b=R(e[v]))&&u(g,b))return b;return new p(!1)}m=l(e,y)}for(_=I?e.next:m.next;!(E=s(_,m)).done;){try{b=R(E.value)}catch(e){d(m,"throw",e)}if("object"==typeof b&&b&&u(g,b))return b}return new p(!1)}},2675(e,t,r){r(6761),r(1510),r(7812),r(3110),r(9773)},2777(e,t,r){var n=r(9565),s=r(34),i=r(757),o=r(5966),a=r(4270),c=r(8227),u=TypeError,l=c("toPrimitive");e.exports=function(e,t){if(!s(e)||i(e))return e;var r,c=o(e,l);if(c){if(void 0===t&&(t="default"),r=n(c,e,t),!s(r)||i(r))return r;throw new u("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},2787(e,t,r){var n=r(9297),s=r(4901),i=r(8981),o=r(6119),a=r(2211),c=o("IE_PROTO"),u=Object,l=u.prototype;e.exports=a?u.getPrototypeOf:function(e){var t=i(e);if(n(t,c))return t[c];var r=t.constructor;return s(r)&&t instanceof r?r.prototype:t instanceof u?l:null}},2796(e,t,r){var n=r(9039),s=r(4901),i=/#|\.prototype\./,o=function(e,t){var r=c[a(e)];return r===l||r!==u&&(s(t)?n(t):!!t)},a=o.normalize=function(e){return String(e).replace(i,".").toLowerCase()},c=o.data={},u=o.NATIVE="N",l=o.POLYFILL="P";e.exports=o},2812(e){var t=TypeError;e.exports=function(e,r){if(e<r)throw new t("Not enough arguments");return e}},2839(e,t,r){var n=r(4576).navigator,s=n&&n.userAgent;e.exports=s?String(s):""},2892(e,t,r){var n=r(6518),s=r(6395),i=r(3724),o=r(4576),a=r(9167),c=r(9504),u=r(2796),l=r(9297),h=r(3167),d=r(1625),f=r(757),p=r(2777),g=r(9039),m=r(8480).f,y=r(7347).f,v=r(4913).f,w=r(1240),b=r(3802).trim,_="Number",E=o[_],T=a[_],S=E.prototype,I=o.TypeError,k=c("".slice),A=c("".charCodeAt),C=u(_,!E(" 0o1")||!E("0b1")||E("+0x1")),O=function(e){var t,r=arguments.length<1?0:E(function(e){var t=p(e,"number");return"bigint"==typeof t?t:function(e){var t,r,n,s,i,o,a,c,u=p(e,"number");if(f(u))throw new I("Cannot convert a Symbol value to a number");if("string"==typeof u&&u.length>2)if(u=b(u),43===(t=A(u,0))||45===t){if(88===(r=A(u,2))||120===r)return NaN}else if(48===t){switch(A(u,1)){case 66:case 98:n=2,s=49;break;case 79:case 111:n=8,s=55;break;default:return+u}for(o=(i=k(u,2)).length,a=0;a<o;a++)if((c=A(i,a))<48||c>s)return NaN;return parseInt(i,n)}return+u}(t)}(e));return d(S,t=this)&&g(function(){w(t)})?h(Object(r),this,O):r};O.prototype=S,C&&!s&&(S.constructor=O),n({global:!0,constructor:!0,wrap:!0,forced:C},{Number:O});var R=function(e,t){for(var r,n=i?m(t):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),s=0;n.length>s;s++)l(t,r=n[s])&&!l(e,r)&&v(e,r,y(t,r))};s&&T&&R(a[_],T),(C||s)&&R(a[_],E)},2953(e,t,r){var n=r(4576),s=r(7400),i=r(9296),o=r(3792),a=r(6699),c=r(687),u=r(8227)("iterator"),l=o.values,h=function(e,t){if(e){if(e[u]!==l)try{a(e,u,l)}catch(t){e[u]=l}if(c(e,t,!0),s[t])for(var r in o)if(e[r]!==o[r])try{a(e,r,o[r])}catch(t){e[r]=o[r]}}};for(var d in s)h(n[d]&&n[d].prototype,d);h(i,"DOMTokenList")},2967(e,t,r){var n=r(6706),s=r(34),i=r(7750),o=r(3506);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=n(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return i(r),o(n),s(r)?(t?e(r,n):r.__proto__=n,r):r}}():void 0)},3063(e,t,r){var n=r(2839);e.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(n)},3110(e,t,r){var n=r(6518),s=r(7751),i=r(8745),o=r(9565),a=r(9504),c=r(9039),u=r(4376),l=r(4901),h=r(5810),d=r(757),f=r(2195),p=r(655),g=r(7680),m=r(8235),y=r(3392),v=r(4495),w=r(7819),b=String,_=s("JSON","stringify"),E=a(/./.exec),T=a("".charAt),S=a("".charCodeAt),I=a("".replace),k=a("".slice),A=a([].push),C=a(1.1.toString),O=/[\uD800-\uDFFF]/g,R=/^[\uD800-\uDBFF]$/,N=/^[\uDC00-\uDFFF]$/,P=y(),x=P.length,D=!v||c(function(){var e=s("Symbol")("stringify detection");return"[null]"!==_([e])||"{}"!==_({a:e})||"{}"!==_(Object(e))}),L=c(function(){return'"\\udf06\\ud834"'!==_("\udf06\ud834")||'"\\udead"'!==_("\udead")}),j=D?function(e,t){var r=g(arguments),n=U(t);if(l(n)||void 0!==e&&!d(e))return r[1]=function(e,t){if(l(n)&&(t=o(n,this,b(e),t)),!d(t))return t},i(_,null,r)}:_,M=function(e,t,r){var n=T(r,t-1),s=T(r,t+1);return E(R,e)&&!E(N,s)||E(N,e)&&!E(R,n)?"\\u"+C(S(e,0),16):e},U=function(e){if(l(e))return e;if(u(e)){for(var t=e.length,r=[],n=0;n<t;n++){var s=e[n];"string"==typeof s?A(r,s):"number"!=typeof s&&"Number"!==f(s)&&"String"!==f(s)||A(r,p(s))}var i=r.length,o=!0;return function(e,t){if(o)return o=!1,t;if(u(this))return t;for(var n=0;n<i;n++)if(r[n]===e)return t}}};_&&n({target:"JSON",stat:!0,arity:3,forced:D||L||!w},{stringify:function(e,t,r){var n=U(t),s=[],i=j(e,function(e,t){var r=l(n)?o(n,this,b(e),t):t;return!w&&h(r)?P+(A(s,r.rawJSON)-1):r},r);if("string"!=typeof i)return i;if(L&&(i=I(i,O,M)),w)return i;for(var a="",c=i.length,u=0;u<c;u++){var d=T(i,u);if('"'===d){var f=m(i,++u).end-1,p=k(i,u,f);a+=k(p,0,x)===P?s[k(p,x)]:'"'+p+'"',u=f}else a+=d}return a}})},3138(e){e.exports=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}}},3167(e,t,r){var n=r(4901),s=r(34),i=r(2967);e.exports=function(e,t,r){var o,a;return i&&n(o=t.constructor)&&o!==r&&s(a=o.prototype)&&a!==r.prototype&&i(e,a),e}},3179(e,t,r){var n=r(2140),s=r(6955);e.exports=n?{}.toString:function(){return"[object "+s(this)+"]"}},3362(e,t,r){r(436),r(6499),r(2003),r(7743),r(1481),r(280)},3389(e,t,r){var n=r(4576),s=r(3724),i=Object.getOwnPropertyDescriptor;e.exports=function(e){if(!s)return n[e];var t=i(n,e);return t&&t.value}},3392(e,t,r){var n=r(9504),s=0,i=Math.random(),o=n(1.1.toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+o(++s+i,36)}},3418(e,t,r){var n=r(6518),s=r(7916);n({target:"Array",stat:!0,forced:!r(4428)(function(e){Array.from(e)})},{from:s})},3438(e,t,r){var n=r(8551),s=r(34),i=r(6043);e.exports=function(e,t){if(n(e),s(t)&&t.constructor===e)return t;var r=i.f(e);return(0,r.resolve)(t),r.promise}},3500(e,t,r){var n=r(4576),s=r(7400),i=r(9296),o=r(235),a=r(6699),c=function(e){if(e&&e.forEach!==o)try{a(e,"forEach",o)}catch(t){e.forEach=o}};for(var u in s)s[u]&&c(n[u]&&n[u].prototype);c(i)},3506(e,t,r){var n=r(3925),s=String,i=TypeError;e.exports=function(e){if(n(e))return e;throw new i("Can't set "+s(e)+" as a prototype")}},3517(e,t,r){var n=r(9504),s=r(9039),i=r(4901),o=r(6955),a=r(7751),c=r(3706),u=function(){},l=a("Reflect","construct"),h=/^\s*(?:class|function)\b/,d=n(h.exec),f=!h.test(u),p=function(e){if(!i(e))return!1;try{return l(u,[],e),!0}catch(e){return!1}},g=function(e){if(!i(e))return!1;switch(o(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f||!!d(h,c(e))}catch(e){return!0}};g.sham=!0,e.exports=!l||s(function(){var e;return p(p.call)||!p(Object)||!p(function(){e=!0})||e})?g:p},3635(e,t,r){var n=r(9039),s=r(4576).RegExp;e.exports=n(function(){var e=s(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)})},3706(e,t,r){var n=r(9504),s=r(4901),i=r(7629),o=n(Function.toString);s(i.inspectSource)||(i.inspectSource=function(e){return o(e)}),e.exports=i.inspectSource},3717(e,t){t.f=Object.getOwnPropertySymbols},3724(e,t,r){var n=r(9039);e.exports=!n(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},3792(e,t,r){var n=r(5397),s=r(6469),i=r(6269),o=r(1181),a=r(4913).f,c=r(1088),u=r(2529),l=r(6395),h=r(3724),d="Array Iterator",f=o.set,p=o.getterFor(d);e.exports=c(Array,"Array",function(e,t){f(this,{type:d,target:n(e),index:0,kind:t})},function(){var e=p(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,u(void 0,!0);switch(e.kind){case"keys":return u(r,!1);case"values":return u(t[r],!1)}return u([r,t[r]],!1)},"values");var g=i.Arguments=i.Array;if(s("keys"),s("values"),s("entries"),!l&&h&&"values"!==g.name)try{a(g,"name",{value:"values"})}catch(e){}},3802(e,t,r){var n=r(9504),s=r(7750),i=r(655),o=r(7452),a=n("".replace),c=RegExp("^["+o+"]+"),u=RegExp("(^|[^"+o+"])["+o+"]+$"),l=function(e){return function(t){var r=i(s(t));return 1&e&&(r=a(r,c,"")),2&e&&(r=a(r,u,"$1")),r}};e.exports={start:l(1),end:l(2),trim:l(3)}},3925(e,t,r){var n=r(34);e.exports=function(e){return n(e)||null===e}},3994(e,t,r){var n=r(7657).IteratorPrototype,s=r(2360),i=r(6980),o=r(687),a=r(6269),c=function(){return this};e.exports=function(e,t,r,u){var l=t+" Iterator";return e.prototype=s(n,{next:i(+!u,r)}),o(e,l,!1,!0),a[l]=c,e}},4055(e,t,r){var n=r(4576),s=r(34),i=n.document,o=s(i)&&s(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},4117(e){e.exports=function(e){return null==e}},4209(e,t,r){var n=r(8227),s=r(6269),i=n("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(s.Array===e||o[i]===e)}},4215(e,t,r){var n=r(4576),s=r(2839),i=r(2195),o=function(e){return s.slice(0,e.length)===e};e.exports=o("Bun/")?"BUN":o("Cloudflare-Workers")?"CLOUDFLARE":o("Deno/")?"DENO":o("Node.js/")?"NODE":n.Bun&&"string"==typeof Bun.version?"BUN":n.Deno&&"object"==typeof Deno.version?"DENO":"process"===i(n.process)?"NODE":n.window&&n.document?"BROWSER":"REST"},4265(e,t,r){var n=r(2839);e.exports=/ipad|iphone|ipod/i.test(n)&&"undefined"!=typeof Pebble},4270(e,t,r){var n=r(9565),s=r(4901),i=r(34),o=TypeError;e.exports=function(e,t){var r,a;if("string"===t&&s(r=e.toString)&&!i(a=n(r,e)))return a;if(s(r=e.valueOf)&&!i(a=n(r,e)))return a;if("string"!==t&&s(r=e.toString)&&!i(a=n(r,e)))return a;throw new o("Can't convert object to primitive value")}},4376(e,t,r){var n=r(2195);e.exports=Array.isArray||function(e){return"Array"===n(e)}},4428(e,t,r){var n=r(8227)("iterator"),s=!1;try{var i=0,o={next:function(){return{done:!!i++}},return:function(){s=!0}};o[n]=function(){return this},Array.from(o,function(){throw 2})}catch(e){}e.exports=function(e,t){try{if(!t&&!s)return!1}catch(e){return!1}var r=!1;try{var i={};i[n]=function(){return{next:function(){return{done:r=!0}}}},e(i)}catch(e){}return r}},4495(e,t,r){var n=r(9519),s=r(9039),i=r(4576).String;e.exports=!!Object.getOwnPropertySymbols&&!s(function(){var e=Symbol("symbol detection");return!i(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41})},4576(e,t,r){var n=function(e){return e&&e.Math===Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof r.g&&r.g)||n("object"==typeof this&&this)||function(){return this}()||Function("return this")()},4598(e,t,r){var n=r(9039);e.exports=function(e,t){var r=[][e];return!!r&&n(function(){r.call(null,t||function(){return 1},1)})}},4599(e,t,r){var n=r(6518),s=r(4576),i=r(9472)(s.setTimeout,!0);n({global:!0,bind:!0,forced:s.setTimeout!==i},{setTimeout:i})},4659(e,t,r){var n=r(3724),s=r(4913),i=r(6980);e.exports=function(e,t,r){n?s.f(e,t,i(0,r)):e[t]=r}},4782(e,t,r){var n=r(6518),s=r(4376),i=r(3517),o=r(34),a=r(5610),c=r(6198),u=r(5397),l=r(4659),h=r(8227),d=r(597),f=r(7680),p=d("slice"),g=h("species"),m=Array,y=Math.max;n({target:"Array",proto:!0,forced:!p},{slice:function(e,t){var r,n,h,d=u(this),p=c(d),v=a(e,p),w=a(void 0===t?p:t,p);if(s(d)&&(r=d.constructor,(i(r)&&(r===m||s(r.prototype))||o(r)&&null===(r=r[g]))&&(r=void 0),r===m||void 0===r))return f(d,v,w);for(n=new(void 0===r?m:r)(y(w-v,0)),h=0;v<w;v++,h++)v in d&&l(n,h,d[v]);return n.length=h,n}})},4901(e){var t="object"==typeof document&&document.all;e.exports=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},4913(e,t,r){var n=r(3724),s=r(5917),i=r(8686),o=r(8551),a=r(6969),c=TypeError,u=Object.defineProperty,l=Object.getOwnPropertyDescriptor,h="enumerable",d="configurable",f="writable";t.f=n?i?function(e,t,r){if(o(e),t=a(t),o(r),"function"==typeof e&&"prototype"===t&&"value"in r&&f in r&&!r[f]){var n=l(e,t);n&&n[f]&&(e[t]=r.value,r={configurable:d in r?r[d]:n[d],enumerable:h in r?r[h]:n[h],writable:!1})}return u(e,t,r)}:u:function(e,t,r){if(o(e),t=a(t),o(r),s)try{return u(e,t,r)}catch(e){}if("get"in r||"set"in r)throw new c("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},5031(e,t,r){var n=r(7751),s=r(9504),i=r(8480),o=r(3717),a=r(8551),c=s([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=i.f(a(e)),r=o.f;return r?c(t,r(e)):t}},5213(e,t,r){var n=r(4576),s=r(9039),i=n.RegExp,o=!s(function(){var e=!0;try{i(".","d")}catch(t){e=!1}var t={},r="",n=e?"dgimsy":"gimsy",s=function(e,n){Object.defineProperty(t,e,{get:function(){return r+=n,!0}})},o={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var a in e&&(o.hasIndices="d"),o)s(a,o[a]);return Object.getOwnPropertyDescriptor(i.prototype,"flags").get.call(t)!==n||r!==n});e.exports={correct:o}},5397(e,t,r){var n=r(7055),s=r(7750);e.exports=function(e){return n(s(e))}},5440(e,t,r){var n=r(8745),s=r(9565),i=r(9504),o=r(9228),a=r(9039),c=r(8551),u=r(4901),l=r(34),h=r(1291),d=r(8014),f=r(655),p=r(7750),g=r(7829),m=r(5966),y=r(2478),v=r(1034),w=r(6682),b=r(8227)("replace"),_=Math.max,E=Math.min,T=i([].concat),S=i([].push),I=i("".indexOf),k=i("".slice),A=function(e){return void 0===e?e:String(e)},C="$0"==="a".replace(/./,"$0"),O=!!/./[b]&&""===/./[b]("a","$0");o("replace",function(e,t,r){var i=O?"$":"$0";return[function(e,r){var n=p(this),i=l(e)?m(e,b):void 0;return i?s(i,e,n,r):s(t,f(n),e,r)},function(e,s){var o=c(this),a=f(e);if("string"==typeof s&&-1===I(s,i)&&-1===I(s,"$<")){var l=r(t,o,a,s);if(l.done)return l.value}var p=u(s);p||(s=f(s));var m,b=f(v(o)),C=-1!==I(b,"g");C&&(m=-1!==I(b,"u"),o.lastIndex=0);for(var O,R=[];null!==(O=w(o,a))&&(S(R,O),C);)""===f(O[0])&&(o.lastIndex=g(a,d(o.lastIndex),m));for(var N="",P=0,x=0;x<R.length;x++){for(var D,L=f((O=R[x])[0]),j=_(E(h(O.index),a.length),0),M=[],U=1;U<O.length;U++)S(M,A(O[U]));var $=O.groups;if(p){var F=T([L],M,j,a);void 0!==$&&S(F,$),D=f(n(s,void 0,F))}else D=y(L,a,j,M,$,s);j>=P&&(N+=k(a,P,j)+D,P=j+L.length)}return N+k(a,P)}]},!!a(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})||!C||O)},5548(e,t,r){var n=r(3517),s=r(6823),i=TypeError;e.exports=function(e){if(n(e))return e;throw new i(s(e)+" is not a constructor")}},5575(e,t,r){var n=r(6518),s=r(4576),i=r(9472)(s.setInterval,!0);n({global:!0,bind:!0,forced:s.setInterval!==i},{setInterval:i})},5610(e,t,r){var n=r(1291),s=Math.max,i=Math.min;e.exports=function(e,t){var r=n(e);return r<0?s(r+t,0):i(r,t)}},5745(e,t,r){var n=r(7629);e.exports=function(e,t){return n[e]||(n[e]=t||{})}},5749(e,t,r){var n=r(788),s=TypeError;e.exports=function(e){if(n(e))throw new s("The method doesn't accept regular expressions");return e}},5810(e,t,r){var n=r(34),s=r(1181).get;e.exports=function(e){if(!n(e))return!1;var t=s(e);return!!t&&"RawJSON"===t.type}},5917(e,t,r){var n=r(3724),s=r(9039),i=r(4055);e.exports=!n&&!s(function(){return 7!==Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a})},5966(e,t,r){var n=r(9306),s=r(4117);e.exports=function(e,t){var r=e[t];return s(r)?void 0:n(r)}},6031(e,t,r){r(5575),r(4599)},6034(e,t,r){var n=r(6518),s=r(2357).values;n({target:"Object",stat:!0},{values:function(e){return s(e)}})},6043(e,t,r){var n=r(9306),s=TypeError,i=function(e){var t,r;this.promise=new e(function(e,n){if(void 0!==t||void 0!==r)throw new s("Bad Promise constructor");t=e,r=n}),this.resolve=n(t),this.reject=n(r)};e.exports.f=function(e){return new i(e)}},6080(e,t,r){var n=r(7476),s=r(9306),i=r(616),o=n(n.bind);e.exports=function(e,t){return s(e),void 0===t?e:i?o(e,t):function(){return e.apply(t,arguments)}}},6099(e,t,r){var n=r(2140),s=r(6840),i=r(3179);n||s(Object.prototype,"toString",i,{unsafe:!0})},6119(e,t,r){var n=r(5745),s=r(3392),i=n("keys");e.exports=function(e){return i[e]||(i[e]=s(e))}},6193(e,t,r){var n=r(4215);e.exports="NODE"===n},6198(e,t,r){var n=r(8014);e.exports=function(e){return n(e.length)}},6269(e){e.exports={}},6319(e,t,r){var n=r(8551),s=r(9539);e.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(t){s(e,"throw",t)}}},6395(e){e.exports=!1},6469(e,t,r){var n=r(8227),s=r(2360),i=r(4913).f,o=n("unscopables"),a=Array.prototype;void 0===a[o]&&i(a,o,{configurable:!0,value:s(null)}),e.exports=function(e){a[o][e]=!0}},6499(e,t,r){var n=r(6518),s=r(9565),i=r(9306),o=r(6043),a=r(1103),c=r(2652);n({target:"Promise",stat:!0,forced:r(537)},{all:function(e){var t=this,r=o.f(t),n=r.resolve,u=r.reject,l=a(function(){var r=i(t.resolve),o=[],a=0,l=1;c(e,function(e){var i=a++,c=!1;l++,s(r,t,e).then(function(e){c||(c=!0,o[i]=e,--l||n(o))},u)}),--l||n(o)});return l.error&&u(l.value),r.promise}})},6518(e,t,r){var n=r(4576),s=r(7347).f,i=r(6699),o=r(6840),a=r(9433),c=r(7740),u=r(2796);e.exports=function(e,t){var r,l,h,d,f,p=e.target,g=e.global,m=e.stat;if(r=g?n:m?n[p]||a(p,{}):n[p]&&n[p].prototype)for(l in t){if(d=t[l],h=e.dontCallGetSet?(f=s(r,l))&&f.value:r[l],!u(g?l:p+(m?".":"#")+l,e.forced)&&void 0!==h){if(typeof d==typeof h)continue;c(d,h)}(e.sham||h&&h.sham)&&i(d,"sham",!0),o(r,l,d,e)}}},6682(e,t,r){var n=r(9565),s=r(8551),i=r(4901),o=r(2195),a=r(7323),c=TypeError;e.exports=function(e,t){var r=e.exec;if(i(r)){var u=n(r,e,t);return null!==u&&s(u),u}if("RegExp"===o(e))return n(a,e,t);throw new c("RegExp#exec called on incompatible receiver")}},6699(e,t,r){var n=r(3724),s=r(4913),i=r(6980);e.exports=n?function(e,t,r){return s.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},6706(e,t,r){var n=r(9504),s=r(9306);e.exports=function(e,t,r){try{return n(s(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(e){}}},6761(e,t,r){var n=r(6518),s=r(4576),i=r(9565),o=r(9504),a=r(6395),c=r(3724),u=r(4495),l=r(9039),h=r(9297),d=r(1625),f=r(8551),p=r(5397),g=r(6969),m=r(655),y=r(6980),v=r(2360),w=r(1072),b=r(8480),_=r(298),E=r(3717),T=r(7347),S=r(4913),I=r(6801),k=r(8773),A=r(6840),C=r(2106),O=r(5745),R=r(6119),N=r(421),P=r(3392),x=r(8227),D=r(1951),L=r(511),j=r(8242),M=r(687),U=r(1181),$=r(9213).forEach,F=R("hidden"),V="Symbol",B="prototype",q=U.set,K=U.getterFor(V),H=Object[B],z=s.Symbol,G=z&&z[B],W=s.RangeError,J=s.TypeError,Y=s.QObject,Q=T.f,X=S.f,Z=_.f,ee=k.f,te=o([].push),re=O("symbols"),ne=O("op-symbols"),se=O("wks"),ie=!Y||!Y[B]||!Y[B].findChild,oe=function(e,t,r){var n=Q(H,t);n&&delete H[t],X(e,t,r),n&&e!==H&&X(H,t,n)},ae=c&&l(function(){return 7!==v(X({},"a",{get:function(){return X(this,"a",{value:7}).a}})).a})?oe:X,ce=function(e,t){var r=re[e]=v(G);return q(r,{type:V,tag:e,description:t}),c||(r.description=t),r},ue=function(e,t,r){e===H&&ue(ne,t,r),f(e);var n=g(t);return f(r),h(re,n)?(r.enumerable?(h(e,F)&&e[F][n]&&(e[F][n]=!1),r=v(r,{enumerable:y(0,!1)})):(h(e,F)||X(e,F,y(1,v(null))),e[F][n]=!0),ae(e,n,r)):X(e,n,r)},le=function(e,t){f(e);var r=p(t),n=w(r).concat(pe(r));return $(n,function(t){c&&!i(he,r,t)||ue(e,t,r[t])}),e},he=function(e){var t=g(e),r=i(ee,this,t);return!(this===H&&h(re,t)&&!h(ne,t))&&(!(r||!h(this,t)||!h(re,t)||h(this,F)&&this[F][t])||r)},de=function(e,t){var r=p(e),n=g(t);if(r!==H||!h(re,n)||h(ne,n)){var s=Q(r,n);return!s||!h(re,n)||h(r,F)&&r[F][n]||(s.enumerable=!0),s}},fe=function(e){var t=Z(p(e)),r=[];return $(t,function(e){h(re,e)||h(N,e)||te(r,e)}),r},pe=function(e){var t=e===H,r=Z(t?ne:p(e)),n=[];return $(r,function(e){!h(re,e)||t&&!h(H,e)||te(n,re[e])}),n};u||(z=function(){if(d(G,this))throw new J("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?m(arguments[0]):void 0,t=P(e),r=function(e){var n=void 0===this?s:this;n===H&&i(r,ne,e),h(n,F)&&h(n[F],t)&&(n[F][t]=!1);var o=y(1,e);try{ae(n,t,o)}catch(e){if(!(e instanceof W))throw e;oe(n,t,o)}};return c&&ie&&ae(H,t,{configurable:!0,set:r}),ce(t,e)},A(G=z[B],"toString",function(){return K(this).tag}),A(z,"withoutSetter",function(e){return ce(P(e),e)}),k.f=he,S.f=ue,I.f=le,T.f=de,b.f=_.f=fe,E.f=pe,D.f=function(e){return ce(x(e),e)},c&&(C(G,"description",{configurable:!0,get:function(){return K(this).description}}),a||A(H,"propertyIsEnumerable",he,{unsafe:!0}))),n({global:!0,constructor:!0,wrap:!0,forced:!u,sham:!u},{Symbol:z}),$(w(se),function(e){L(e)}),n({target:V,stat:!0,forced:!u},{useSetter:function(){ie=!0},useSimple:function(){ie=!1}}),n({target:"Object",stat:!0,forced:!u,sham:!c},{create:function(e,t){return void 0===t?v(e):le(v(e),t)},defineProperty:ue,defineProperties:le,getOwnPropertyDescriptor:de}),n({target:"Object",stat:!0,forced:!u},{getOwnPropertyNames:fe}),j(),M(z,V),N[F]=!0},6801(e,t,r){var n=r(3724),s=r(8686),i=r(4913),o=r(8551),a=r(5397),c=r(1072);t.f=n&&!s?Object.defineProperties:function(e,t){o(e);for(var r,n=a(t),s=c(t),u=s.length,l=0;u>l;)i.f(e,r=s[l++],n[r]);return e}},6823(e){var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},6837(e){var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},6840(e,t,r){var n=r(4901),s=r(4913),i=r(283),o=r(9433);e.exports=function(e,t,r,a){a||(a={});var c=a.enumerable,u=void 0!==a.name?a.name:t;if(n(r)&&i(r,u,a),a.global)c?e[t]=r:o(t,r);else{try{a.unsafe?e[t]&&(c=!0):delete e[t]}catch(e){}c?e[t]=r:s.f(e,t,{value:r,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e}},6955(e,t,r){var n=r(2140),s=r(4901),i=r(2195),o=r(8227)("toStringTag"),a=Object,c="Arguments"===i(function(){return arguments}());e.exports=n?i:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=a(e),o))?r:c?i(t):"Object"===(n=i(t))&&s(t.callee)?"Arguments":n}},6969(e,t,r){var n=r(2777),s=r(757);e.exports=function(e){var t=n(e,"string");return s(t)?t:t+""}},6980(e){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},7040(e,t,r){var n=r(4495);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},7055(e,t,r){var n=r(9504),s=r(9039),i=r(2195),o=Object,a=n("".split);e.exports=s(function(){return!o("z").propertyIsEnumerable(0)})?function(e){return"String"===i(e)?a(e,""):o(e)}:o},7323(e,t,r){var n,s,i=r(9565),o=r(9504),a=r(655),c=r(7979),u=r(8429),l=r(5745),h=r(2360),d=r(1181).get,f=r(3635),p=r(8814),g=l("native-string-replace",String.prototype.replace),m=RegExp.prototype.exec,y=m,v=o("".charAt),w=o("".indexOf),b=o("".replace),_=o("".slice),E=(s=/b*/g,i(m,n=/a/,"a"),i(m,s,"a"),0!==n.lastIndex||0!==s.lastIndex),T=u.BROKEN_CARET,S=void 0!==/()??/.exec("")[1];(E||S||T||f||p)&&(y=function(e){var t,r,n,s,o,u,l,f=this,p=d(f),I=a(e),k=p.raw;if(k)return k.lastIndex=f.lastIndex,t=i(y,k,I),f.lastIndex=k.lastIndex,t;var A=p.groups,C=T&&f.sticky,O=i(c,f),R=f.source,N=0,P=I;if(C&&(O=b(O,"y",""),-1===w(O,"g")&&(O+="g"),P=_(I,f.lastIndex),f.lastIndex>0&&(!f.multiline||f.multiline&&"\n"!==v(I,f.lastIndex-1))&&(R="(?: "+R+")",P=" "+P,N++),r=new RegExp("^(?:"+R+")",O)),S&&(r=new RegExp("^"+R+"$(?!\\s)",O)),E&&(n=f.lastIndex),s=i(m,C?r:f,P),C?s?(s.input=_(s.input,N),s[0]=_(s[0],N),s.index=f.lastIndex,f.lastIndex+=s[0].length):f.lastIndex=0:E&&s&&(f.lastIndex=f.global?s.index+s[0].length:n),S&&s&&s.length>1&&i(g,s[0],r,function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(s[o]=void 0)}),s&&A)for(s.groups=u=h(null),o=0;o<A.length;o++)u[(l=A[o])[0]]=s[l[1]];return s}),e.exports=y},7347(e,t,r){var n=r(3724),s=r(9565),i=r(8773),o=r(6980),a=r(5397),c=r(6969),u=r(9297),l=r(5917),h=Object.getOwnPropertyDescriptor;t.f=n?h:function(e,t){if(e=a(e),t=c(t),l)try{return h(e,t)}catch(e){}if(u(e,t))return o(!s(i.f,e,t),e[t])}},7400(e){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},7433(e,t,r){var n=r(4376),s=r(3517),i=r(34),o=r(8227)("species"),a=Array;e.exports=function(e){var t;return n(e)&&(t=e.constructor,(s(t)&&(t===a||n(t.prototype))||i(t)&&null===(t=t[o]))&&(t=void 0)),void 0===t?a:t}},7452(e){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},7476(e,t,r){var n=r(2195),s=r(9504);e.exports=function(e){if("Function"===n(e))return s(e)}},7495(e,t,r){var n=r(6518),s=r(7323);n({target:"RegExp",proto:!0,forced:/./.exec!==s},{exec:s})},7629(e,t,r){var n=r(6395),s=r(4576),i=r(9433),o="__core-js_shared__",a=e.exports=s[o]||i(o,{});(a.versions||(a.versions=[])).push({version:"3.47.0",mode:n?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.47.0/LICENSE",source:"https://github.com/zloirock/core-js"})},7633(e,t,r){var n=r(7751),s=r(2106),i=r(8227),o=r(3724),a=i("species");e.exports=function(e){var t=n(e);o&&t&&!t[a]&&s(t,a,{configurable:!0,get:function(){return this}})}},7657(e,t,r){var n,s,i,o=r(9039),a=r(4901),c=r(34),u=r(2360),l=r(2787),h=r(6840),d=r(8227),f=r(6395),p=d("iterator"),g=!1;[].keys&&("next"in(i=[].keys())?(s=l(l(i)))!==Object.prototype&&(n=s):g=!0),!c(n)||o(function(){var e={};return n[p].call(e)!==e})?n={}:f&&(n=u(n)),a(n[p])||h(n,p,function(){return this}),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:g}},7680(e,t,r){var n=r(9504);e.exports=n([].slice)},7740(e,t,r){var n=r(9297),s=r(5031),i=r(7347),o=r(4913);e.exports=function(e,t,r){for(var a=s(t),c=o.f,u=i.f,l=0;l<a.length;l++){var h=a[l];n(e,h)||r&&n(r,h)||c(e,h,u(t,h))}}},7743(e,t,r){var n=r(6518),s=r(9565),i=r(9306),o=r(6043),a=r(1103),c=r(2652);n({target:"Promise",stat:!0,forced:r(537)},{race:function(e){var t=this,r=o.f(t),n=r.reject,u=a(function(){var o=i(t.resolve);c(e,function(e){s(o,t,e).then(r.resolve,n)})});return u.error&&n(u.value),r.promise}})},7750(e,t,r){var n=r(4117),s=TypeError;e.exports=function(e){if(n(e))throw new s("Can't call method on "+e);return e}},7751(e,t,r){var n=r(4576),s=r(4901);e.exports=function(e,t){return arguments.length<2?(r=n[e],s(r)?r:void 0):n[e]&&n[e][t];var r}},7764(e,t,r){var n=r(8183).charAt,s=r(655),i=r(1181),o=r(1088),a=r(2529),c="String Iterator",u=i.set,l=i.getterFor(c);o(String,"String",function(e){u(this,{type:c,string:s(e),index:0})},function(){var e,t=l(this),r=t.string,s=t.index;return s>=r.length?a(void 0,!0):(e=n(r,s),t.index+=e.length,a(e,!1))})},7812(e,t,r){var n=r(6518),s=r(9297),i=r(757),o=r(6823),a=r(5745),c=r(1296),u=a("symbol-to-string-registry");n({target:"Symbol",stat:!0,forced:!c},{keyFor:function(e){if(!i(e))throw new TypeError(o(e)+" is not a symbol");if(s(u,e))return u[e]}})},7819(e,t,r){var n=r(9039);e.exports=!n(function(){var e="9007199254740993",t=JSON.rawJSON(e);return!JSON.isRawJSON(t)||JSON.stringify(t)!==e})},7829(e,t,r){var n=r(8183).charAt;e.exports=function(e,t,r){return t+(r?n(e,t).length:1)}},7860(e,t,r){var n=r(2839);e.exports=/web0s(?!.*chrome)/i.test(n)},7916(e,t,r){var n=r(6080),s=r(9565),i=r(8981),o=r(6319),a=r(4209),c=r(3517),u=r(6198),l=r(4659),h=r(81),d=r(851),f=Array;e.exports=function(e){var t=i(e),r=c(this),p=arguments.length,g=p>1?arguments[1]:void 0,m=void 0!==g;m&&(g=n(g,p>2?arguments[2]:void 0));var y,v,w,b,_,E,T=d(t),S=0;if(!T||this===f&&a(T))for(y=u(t),v=r?new this(y):f(y);y>S;S++)E=m?g(t[S],S):t[S],l(v,S,E);else for(v=r?new this:[],_=(b=h(t,T)).next;!(w=s(_,b)).done;S++)E=m?o(b,g,[w.value,S],!0):w.value,l(v,S,E);return v.length=S,v}},7979(e,t,r){var n=r(8551);e.exports=function(){var e=n(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},8014(e,t,r){var n=r(1291),s=Math.min;e.exports=function(e){var t=n(e);return t>0?s(t,9007199254740991):0}},8156(e,t,r){var n=r(6518),s=r(533).start;n({target:"String",proto:!0,forced:r(3063)},{padStart:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}})},8183(e,t,r){var n=r(9504),s=r(1291),i=r(655),o=r(7750),a=n("".charAt),c=n("".charCodeAt),u=n("".slice),l=function(e){return function(t,r){var n,l,h=i(o(t)),d=s(r),f=h.length;return d<0||d>=f?e?"":void 0:(n=c(h,d))<55296||n>56319||d+1===f||(l=c(h,d+1))<56320||l>57343?e?a(h,d):n:e?u(h,d,d+2):l-56320+(n-55296<<10)+65536}};e.exports={codeAt:l(!1),charAt:l(!0)}},8227(e,t,r){var n=r(4576),s=r(5745),i=r(9297),o=r(3392),a=r(4495),c=r(7040),u=n.Symbol,l=s("wks"),h=c?u.for||u:u&&u.withoutSetter||o;e.exports=function(e){return i(l,e)||(l[e]=a&&i(u,e)?u[e]:h("Symbol."+e)),l[e]}},8235(e,t,r){var n=r(9504),s=r(9297),i=SyntaxError,o=parseInt,a=String.fromCharCode,c=n("".charAt),u=n("".slice),l=n(/./.exec),h={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":"\n","\\r":"\r","\\t":"\t"},d=/^[\da-f]{4}$/i,f=/^[\u0000-\u001F]$/;e.exports=function(e,t){for(var r=!0,n="";t<e.length;){var p=c(e,t);if("\\"===p){var g=u(e,t,t+2);if(s(h,g))n+=h[g],t+=2;else{if("\\u"!==g)throw new i('Unknown escape sequence: "'+g+'"');var m=u(e,t+=2,t+4);if(!l(d,m))throw new i("Bad Unicode escape at: "+t);n+=a(o(m,16)),t+=4}}else{if('"'===p){r=!1,t++;break}if(l(f,p))throw new i("Bad control character in string literal at: "+t);n+=p,t++}}if(r)throw new i("Unterminated string at: "+t);return{value:n,end:t}}},8242(e,t,r){var n=r(9565),s=r(7751),i=r(8227),o=r(6840);e.exports=function(){var e=s("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,a=i("toPrimitive");t&&!t[a]&&o(t,a,function(e){return n(r,this)},{arity:1})}},8265(e){var t=function(){this.head=null,this.tail=null};t.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},e.exports=t},8429(e,t,r){var n=r(9039),s=r(4576).RegExp,i=n(function(){var e=s("a","y");return e.lastIndex=2,null!==e.exec("abcd")}),o=i||n(function(){return!s("a","y").sticky}),a=i||n(function(){var e=s("^r","gy");return e.lastIndex=2,null!==e.exec("str")});e.exports={BROKEN_CARET:a,MISSED_STICKY:o,UNSUPPORTED_Y:i}},8480(e,t,r){var n=r(1828),s=r(8727).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,s)}},8551(e,t,r){var n=r(34),s=String,i=TypeError;e.exports=function(e){if(n(e))return e;throw new i(s(e)+" is not an object")}},8622(e,t,r){var n=r(4576),s=r(4901),i=n.WeakMap;e.exports=s(i)&&/native code/.test(String(i))},8686(e,t,r){var n=r(3724),s=r(9039);e.exports=n&&s(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},8706(e,t,r){var n=r(6518),s=r(9039),i=r(4376),o=r(34),a=r(8981),c=r(6198),u=r(6837),l=r(4659),h=r(1469),d=r(597),f=r(8227),p=r(9519),g=f("isConcatSpreadable"),m=p>=51||!s(function(){var e=[];return e[g]=!1,e.concat()[0]!==e}),y=function(e){if(!o(e))return!1;var t=e[g];return void 0!==t?!!t:i(e)};n({target:"Array",proto:!0,arity:1,forced:!m||!d("concat")},{concat:function(e){var t,r,n,s,i,o=a(this),d=h(o,0),f=0;for(t=-1,n=arguments.length;t<n;t++)if(y(i=-1===t?o:arguments[t]))for(s=c(i),u(f+s),r=0;r<s;r++,f++)r in i&&l(d,f,i[r]);else u(f+1),l(d,f++,i);return d.length=f,d}})},8727(e){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},8745(e,t,r){var n=r(616),s=Function.prototype,i=s.apply,o=s.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?o.bind(i):function(){return o.apply(i,arguments)})},8773(e,t){var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,s=n&&!r.call({1:2},1);t.f=s?function(e){var t=n(this,e);return!!t&&t.enumerable}:r},8781(e,t,r){var n=r(350).PROPER,s=r(6840),i=r(8551),o=r(655),a=r(9039),c=r(1034),u="toString",l=RegExp.prototype,h=l[u],d=a(function(){return"/a/b"!==h.call({source:"a",flags:"b"})}),f=n&&h.name!==u;(d||f)&&s(l,u,function(){var e=i(this);return"/"+o(e.source)+"/"+o(c(e))},{unsafe:!0})},8814(e,t,r){var n=r(9039),s=r(4576).RegExp;e.exports=n(function(){var e=s("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})},8981(e,t,r){var n=r(7750),s=Object;e.exports=function(e){return s(n(e))}},9039(e){e.exports=function(e){try{return!!e()}catch(e){return!0}}},9167(e,t,r){var n=r(4576);e.exports=n},9213(e,t,r){var n=r(6080),s=r(9504),i=r(7055),o=r(8981),a=r(6198),c=r(1469),u=s([].push),l=function(e){var t=1===e,r=2===e,s=3===e,l=4===e,h=6===e,d=7===e,f=5===e||h;return function(p,g,m,y){for(var v,w,b=o(p),_=i(b),E=a(_),T=n(g,m),S=0,I=y||c,k=t?I(p,E):r||d?I(p,0):void 0;E>S;S++)if((f||S in _)&&(w=T(v=_[S],S,b),e))if(t)k[S]=w;else if(w)switch(e){case 3:return!0;case 5:return v;case 6:return S;case 2:u(k,v)}else switch(e){case 4:return!1;case 7:u(k,v)}return h?-1:s||l?l:k}};e.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6),filterReject:l(7)}},9225(e,t,r){var n,s,i,o,a=r(4576),c=r(8745),u=r(6080),l=r(4901),h=r(9297),d=r(9039),f=r(397),p=r(7680),g=r(4055),m=r(2812),y=r(9544),v=r(6193),w=a.setImmediate,b=a.clearImmediate,_=a.process,E=a.Dispatch,T=a.Function,S=a.MessageChannel,I=a.String,k=0,A={},C="onreadystatechange";d(function(){n=a.location});var O=function(e){if(h(A,e)){var t=A[e];delete A[e],t()}},R=function(e){return function(){O(e)}},N=function(e){O(e.data)},P=function(e){a.postMessage(I(e),n.protocol+"//"+n.host)};w&&b||(w=function(e){m(arguments.length,1);var t=l(e)?e:T(e),r=p(arguments,1);return A[++k]=function(){c(t,void 0,r)},s(k),k},b=function(e){delete A[e]},v?s=function(e){_.nextTick(R(e))}:E&&E.now?s=function(e){E.now(R(e))}:S&&!y?(o=(i=new S).port2,i.port1.onmessage=N,s=u(o.postMessage,o)):a.addEventListener&&l(a.postMessage)&&!a.importScripts&&n&&"file:"!==n.protocol&&!d(P)?(s=P,a.addEventListener("message",N,!1)):s=C in g("script")?function(e){f.appendChild(g("script"))[C]=function(){f.removeChild(this),O(e)}}:function(e){setTimeout(R(e),0)}),e.exports={set:w,clear:b}},9228(e,t,r){r(7495);var n=r(9565),s=r(6840),i=r(7323),o=r(9039),a=r(8227),c=r(6699),u=a("species"),l=RegExp.prototype;e.exports=function(e,t,r,h){var d=a(e),f=!o(function(){var t={};return t[d]=function(){return 7},7!==""[e](t)}),p=f&&!o(function(){var t=!1,r=/a/;if("split"===e){var n={};n[u]=function(){return r},(r={constructor:n,flags:""})[d]=/./[d]}return r.exec=function(){return t=!0,null},r[d](""),!t});if(!f||!p||r){var g=/./[d],m=t(d,""[e],function(e,t,r,s,o){var a=t.exec;return a===i||a===l.exec?f&&!o?{done:!0,value:n(g,t,r,s)}:{done:!0,value:n(e,r,t,s)}:{done:!1}});s(String.prototype,e,m[0]),s(l,d,m[1])}h&&c(l[d],"sham",!0)}},9296(e,t,r){var n=r(4055)("span").classList,s=n&&n.constructor&&n.constructor.prototype;e.exports=s===Object.prototype?void 0:s},9297(e,t,r){var n=r(9504),s=r(8981),i=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return i(s(e),t)}},9306(e,t,r){var n=r(4901),s=r(6823),i=TypeError;e.exports=function(e){if(n(e))return e;throw new i(s(e)+" is not a function")}},9433(e,t,r){var n=r(4576),s=Object.defineProperty;e.exports=function(e,t){try{s(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}},9463(e,t,r){var n=r(6518),s=r(3724),i=r(4576),o=r(9504),a=r(9297),c=r(4901),u=r(1625),l=r(655),h=r(2106),d=r(7740),f=i.Symbol,p=f&&f.prototype;if(s&&c(f)&&(!("description"in p)||void 0!==f().description)){var g={},m=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:l(arguments[0]),t=u(p,this)?new f(e):void 0===e?f():f(e);return""===e&&(g[t]=!0),t};d(m,f),m.prototype=p,p.constructor=m;var y="Symbol(description detection)"===String(f("description detection")),v=o(p.valueOf),w=o(p.toString),b=/^Symbol\((.*)\)[^)]+$/,_=o("".replace),E=o("".slice);h(p,"description",{configurable:!0,get:function(){var e=v(this);if(a(g,e))return"";var t=w(e),r=y?E(t,7,-1):_(t,b,"$1");return""===r?void 0:r}}),n({global:!0,constructor:!0,forced:!0},{Symbol:m})}},9472(e,t,r){var n,s=r(4576),i=r(8745),o=r(4901),a=r(4215),c=r(2839),u=r(7680),l=r(2812),h=s.Function,d=/MSIE .\./.test(c)||"BUN"===a&&((n=s.Bun.version.split(".")).length<3||"0"===n[0]&&(n[1]<3||"3"===n[1]&&"0"===n[2]));e.exports=function(e,t){var r=t?2:1;return d?function(n,s){var a=l(arguments.length,1)>r,c=o(n)?n:h(n),d=a?u(arguments,r):[],f=a?function(){i(c,this,d)}:c;return t?e(f,s):e(f)}:e}},9504(e,t,r){var n=r(616),s=Function.prototype,i=s.call,o=n&&s.bind.bind(i,i);e.exports=n?o:function(e){return function(){return i.apply(e,arguments)}}},9519(e,t,r){var n,s,i=r(4576),o=r(2839),a=i.process,c=i.Deno,u=a&&a.versions||c&&c.version,l=u&&u.v8;l&&(s=(n=l.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!s&&o&&(!(n=o.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=o.match(/Chrome\/(\d+)/))&&(s=+n[1]),e.exports=s},9539(e,t,r){var n=r(9565),s=r(8551),i=r(5966);e.exports=function(e,t,r){var o,a;s(e);try{if(!(o=i(e,"return"))){if("throw"===t)throw r;return r}o=n(o,e)}catch(e){a=!0,o=e}if("throw"===t)throw r;if(a)throw o;return s(o),r}},9544(e,t,r){var n=r(2839);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(n)},9565(e,t,r){var n=r(616),s=Function.prototype.call;e.exports=n?s.bind(s):function(){return s.apply(s,arguments)}},9617(e,t,r){var n=r(5397),s=r(5610),i=r(6198),o=function(e){return function(t,r,o){var a=n(t),c=i(a);if(0===c)return!e&&-1;var u,l=s(o,c);if(e&&r!=r){for(;c>l;)if((u=a[l++])!=u)return!0}else for(;c>l;l++)if((e||l in a)&&a[l]===r)return e||l||0;return!e&&-1}};e.exports={includes:o(!0),indexOf:o(!1)}},9773(e,t,r){var n=r(6518),s=r(4495),i=r(9039),o=r(3717),a=r(8981);n({target:"Object",stat:!0,forced:!s||i(function(){o.f(1)})},{getOwnPropertySymbols:function(e){var t=o.f;return t?t(a(e)):[]}})},9868(e,t,r){var n=r(6518),s=r(9504),i=r(1291),o=r(1240),a=r(2333),c=r(9039),u=RangeError,l=String,h=Math.floor,d=s(a),f=s("".slice),p=s(1.1.toFixed),g=function(e,t,r){return 0===t?r:t%2==1?g(e,t-1,r*e):g(e*e,t/2,r)},m=function(e,t,r){for(var n=-1,s=r;++n<6;)s+=t*e[n],e[n]=s%1e7,s=h(s/1e7)},y=function(e,t){for(var r=6,n=0;--r>=0;)n+=e[r],e[r]=h(n/t),n=n%t*1e7},v=function(e){for(var t=6,r="";--t>=0;)if(""!==r||0===t||0!==e[t]){var n=l(e[t]);r=""===r?n:r+d("0",7-n.length)+n}return r};n({target:"Number",proto:!0,forced:c(function(){return"0.000"!==p(8e-5,3)||"1"!==p(.9,0)||"1.25"!==p(1.255,2)||"1000000000000000128"!==p(0xde0b6b3a7640080,0)})||!c(function(){p({})})},{toFixed:function(e){var t,r,n,s,a=o(this),c=i(e),h=[0,0,0,0,0,0],p="",w="0";if(c<0||c>20)throw new u("Incorrect fraction digits");if(a!=a)return"NaN";if(a<=-1e21||a>=1e21)return l(a);if(a<0&&(p="-",a=-a),a>1e-21)if(t=function(e){for(var t=0,r=e;r>=4096;)t+=12,r/=4096;for(;r>=2;)t+=1,r/=2;return t}(a*g(2,69,1))-69,r=t<0?a*g(2,-t,1):a/g(2,t,1),r*=4503599627370496,(t=52-t)>0){for(m(h,0,r),n=c;n>=7;)m(h,1e7,0),n-=7;for(m(h,g(10,n,1),0),n=t-1;n>=23;)y(h,1<<23),n-=23;y(h,1<<n),m(h,1,1),y(h,2),w=v(h)}else m(h,0,r),m(h,1<<-t,0),w=v(h)+d("0",c);return c>0?p+((s=w.length)<=c?"0."+d("0",c-s)+w:f(w,0,s-c)+"."+f(w,s-c)):p+w}})}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r(2675),r(9463),r(875),r(287),r(6099),r(6034),r(3362),r(3500),r(6031);const n=function(e){const t=[];let r=0;for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=63&s|128):55296==(64512&s)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++n)),t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=63&s|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=63&s|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){const s=e[t],i=t+1<e.length,o=i?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=s>>2,l=(3&s)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(h=64)),n.push(r[u],r[l],r[h],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let r=0,n=0;for(;r<e.length;){const s=e[r++];if(s<128)t[n++]=String.fromCharCode(s);else if(s>191&&s<224){const i=e[r++];t[n++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(i>>10)),t[n++]=String.fromCharCode(56320+(1023&i))}else{const i=e[r++],o=e[r++];t[n++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){const s=r[e.charAt(t++)],o=t<e.length?r[e.charAt(t)]:0;++t;const a=t<e.length?r[e.charAt(t)]:64;++t;const c=t<e.length?r[e.charAt(t)]:64;if(++t,null==s||null==o||null==a||null==c)throw new i;const u=s<<2|o>>4;if(n.push(u),64!==a){const e=o<<4&240|a>>2;if(n.push(e),64!==c){const e=a<<6&192|c;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(e){return function(e){const t=n(e);return s.encodeByteArray(t,!0)}(e).replace(/\./g,"")},a=function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};const c=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&a(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},u=e=>{var t,r;return null===(r=null===(t=c())||void 0===t?void 0:t.emulatorHosts)||void 0===r?void 0:r[e]},l=()=>{var e;return null===(e=c())||void 0===e?void 0:e.config},h=e=>{var t;return null===(t=c())||void 0===t?void 0:t[`_${e}`]};class d{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function f(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(e){return!1}}async function p(e){return(await fetch(e,{credentials:"include"})).ok}const g={};let m=!1;function y(e,t){if("undefined"==typeof window||"undefined"==typeof document||!f(window.location.host)||g[e]===t||g[e]||m)return;function r(e){return`__firebase__banner__${e}`}g[e]=t;const n="__firebase__banner",s=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(g))g[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){const e=function(e){let t=document.getElementById(e),r=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),r=!0),{created:r,element:t}}(n),t=r("text"),i=document.getElementById(t)||document.createElement("span"),o=r("learnmore"),a=document.getElementById(o)||document.createElement("a"),c=r("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(a,o);const r=function(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{m=!0,function(){const e=document.getElementById(n);e&&e.remove()}()},e}();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(u,c),t.append(u,i,a,r),document.body.appendChild(t)}s?(i.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',i.innerText="Preview backend running in this workspace."),i.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",i):i()}function v(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function w(){return!function(){var e;const t=null===(e=c())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(r.g.process)}catch(e){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class b extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,b.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_.prototype.create)}}class _{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},n=`${this.service}/${e}`,s=this.errors[e],i=s?function(e,t){return e.replace(E,(e,r)=>{const n=t[r];return null!=n?String(n):`<${r}?>`})}(s,r):"Error",o=`${this.serviceName}: ${i} (${n}).`;return new b(n,o,r)}}const E=/\{\$([^}]+)}/g;function T(e,t){if(e===t)return!0;const r=Object.keys(e),n=Object.keys(t);for(const s of r){if(!n.includes(s))return!1;const r=e[s],i=t[s];if(S(r)&&S(i)){if(!T(r,i))return!1}else if(r!==i)return!1}for(const e of n)if(!r.includes(e))return!1;return!0}function S(e){return null!==e&&"object"==typeof e}function I(e){const t=[];for(const[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function k(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function A(e){const t=e.indexOf("?");if(!t)return"";const r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}class C{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw new Error("Missing Observer.");n=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:r},void 0===n.next&&(n.next=O),void 0===n.error&&(n.error=O),void 0===n.complete&&(n.complete=O);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function O(){}function R(e){return e&&e._delegate?e._delegate:e}class N{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const P="[DEFAULT]";class x{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new d;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(r)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:r})}catch(e){if(n)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:P})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=P){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=P){return this.instances.has(e)}getOptions(e=P){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){var r;const n=this.normalizeInstanceIdentifier(t),s=null!==(r=this.onInitCallbacks.get(n))&&void 0!==r?r:new Set;s.add(e),this.onInitCallbacks.set(n,s);const i=this.instances.get(n);return i&&e(i,n),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const n of r)try{n(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===P?void 0:n),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(e){}var n;return r||null}normalizeInstanceIdentifier(e=P){return this.component?this.component.multipleInstances?e:P:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class D{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new x(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const L=[];var j;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(j||(j={}));const M={debug:j.DEBUG,verbose:j.VERBOSE,info:j.INFO,warn:j.WARN,error:j.ERROR,silent:j.SILENT},U=j.INFO,$={[j.DEBUG]:"log",[j.VERBOSE]:"log",[j.INFO]:"info",[j.WARN]:"warn",[j.ERROR]:"error"},F=(e,t,...r)=>{if(t<e.logLevel)return;const n=(new Date).toISOString(),s=$[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${n}]  ${e.name}:`,...r)};class V{constructor(e){this.name=e,this._logLevel=U,this._logHandler=F,this._userLogHandler=null,L.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in j))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?M[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,j.DEBUG,...e),this._logHandler(this,j.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,j.VERBOSE,...e),this._logHandler(this,j.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,j.INFO,...e),this._logHandler(this,j.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,j.WARN,...e),this._logHandler(this,j.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,j.ERROR,...e),this._logHandler(this,j.ERROR,...e)}}let B,q;const K=new WeakMap,H=new WeakMap,z=new WeakMap,G=new WeakMap,W=new WeakMap;let J={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return H.get(e);if("objectStoreNames"===t)return e.objectStoreNames||z.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Q(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Y(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(q||(q=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(X(this),e),Q(K.get(this))}:function(...e){return Q(t.apply(X(this),e))}:function(e,...r){const n=t.call(X(this),e,...r);return z.set(n,e.sort?e.sort():[e]),Q(n)}:(e instanceof IDBTransaction&&function(e){if(H.has(e))return;const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{t(),n()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)});H.set(e,t)}(e),r=e,(B||(B=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>r instanceof e)?new Proxy(e,J):e);var t,r}function Q(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{t(Q(e.result)),n()},i=()=>{r(e.error),n()};e.addEventListener("success",s),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&K.set(t,e)}).catch(()=>{}),W.set(t,e),t}(e);if(G.has(e))return G.get(e);const t=Y(e);return t!==e&&(G.set(e,t),W.set(t,e)),t}const X=e=>W.get(e),Z=["get","getKey","getAll","getAllKeys","count"],ee=["put","add","delete","clear"],te=new Map;function re(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(te.get(t))return te.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,s=ee.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!s&&!Z.includes(r))return;const i=async function(e,...t){const i=this.transaction(e,s?"readwrite":"readonly");let o=i.store;return n&&(o=o.index(t.shift())),(await Promise.all([o[r](...t),s&&i.done]))[0]};return te.set(t,i),i}var ne;ne=J,J={...ne,get:(e,t,r)=>re(e,t)||ne.get(e,t,r),has:(e,t)=>!!re(e,t)||ne.has(e,t)};class se{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const ie="@firebase/app",oe="0.13.2",ae=new V("@firebase/app"),ce="@firebase/app-compat",ue="@firebase/analytics-compat",le="@firebase/analytics",he="@firebase/app-check-compat",de="@firebase/app-check",fe="@firebase/auth",pe="@firebase/auth-compat",ge="@firebase/database",me="@firebase/data-connect",ye="@firebase/database-compat",ve="@firebase/functions",we="@firebase/functions-compat",be="@firebase/installations",_e="@firebase/installations-compat",Ee="@firebase/messaging",Te="@firebase/messaging-compat",Se="@firebase/performance",Ie="@firebase/performance-compat",ke="@firebase/remote-config",Ae="@firebase/remote-config-compat",Ce="@firebase/storage",Oe="@firebase/storage-compat",Re="@firebase/firestore",Ne="@firebase/ai",Pe="@firebase/firestore-compat",xe="firebase",De="[DEFAULT]",Le={[ie]:"fire-core",[ce]:"fire-core-compat",[le]:"fire-analytics",[ue]:"fire-analytics-compat",[de]:"fire-app-check",[he]:"fire-app-check-compat",[fe]:"fire-auth",[pe]:"fire-auth-compat",[ge]:"fire-rtdb",[me]:"fire-data-connect",[ye]:"fire-rtdb-compat",[ve]:"fire-fn",[we]:"fire-fn-compat",[be]:"fire-iid",[_e]:"fire-iid-compat",[Ee]:"fire-fcm",[Te]:"fire-fcm-compat",[Se]:"fire-perf",[Ie]:"fire-perf-compat",[ke]:"fire-rc",[Ae]:"fire-rc-compat",[Ce]:"fire-gcs",[Oe]:"fire-gcs-compat",[Re]:"fire-fst",[Pe]:"fire-fst-compat",[Ne]:"fire-vertex","fire-js":"fire-js",[xe]:"fire-js-all"},je=new Map,Me=new Map,Ue=new Map;function $e(e,t){try{e.container.addComponent(t)}catch(r){ae.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function Fe(e){const t=e.name;if(Ue.has(t))return ae.debug(`There were multiple attempts to register component ${t}.`),!1;Ue.set(t,e);for(const t of je.values())$e(t,e);for(const t of Me.values())$e(t,e);return!0}function Ve(e,t){const r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function Be(e){return null!=e&&void 0!==e.settings}const qe=new _("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Ke{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new N("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw qe.create("app-deleted",{appName:this._name})}}const He="11.10.0";function ze(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});const n=Object.assign({name:De,automaticDataCollectionEnabled:!0},t),s=n.name;if("string"!=typeof s||!s)throw qe.create("bad-app-name",{appName:String(s)});if(r||(r=l()),!r)throw qe.create("no-options");const i=je.get(s);if(i){if(T(r,i.options)&&T(n,i.config))return i;throw qe.create("duplicate-app",{appName:s})}const o=new D(s);for(const e of Ue.values())o.addComponent(e);const a=new Ke(r,n,o);return je.set(s,a),a}function Ge(e=De){const t=je.get(e);if(!t&&e===De&&l())return ze();if(!t)throw qe.create("no-app",{appName:e});return t}function We(e,t,r){var n;let s=null!==(n=Le[e])&&void 0!==n?n:e;r&&(s+=`-${r}`);const i=s.match(/\s|\//),o=t.match(/\s|\//);if(i||o){const e=[`Unable to register library "${s}" with version "${t}":`];return i&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void ae.warn(e.join(" "))}Fe(new N(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}const Je="firebase-heartbeat-store";let Ye=null;function Qe(){return Ye||(Ye=function(e,t,{blocked:r,upgrade:n,blocking:s,terminated:i}={}){const o=indexedDB.open(e,t),a=Q(o);return n&&o.addEventListener("upgradeneeded",e=>{n(Q(o.result),e.oldVersion,e.newVersion,Q(o.transaction),e)}),r&&o.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),a.then(e=>{i&&e.addEventListener("close",()=>i()),s&&e.addEventListener("versionchange",e=>s(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Je)}catch(e){console.warn(e)}}}).catch(e=>{throw qe.create("idb-open",{originalErrorMessage:e.message})})),Ye}async function Xe(e,t){try{const r=(await Qe()).transaction(Je,"readwrite"),n=r.objectStore(Je);await n.put(t,Ze(e)),await r.done}catch(e){if(e instanceof b)ae.warn(e.message);else{const t=qe.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});ae.warn(t.message)}}}function Ze(e){return`${e.name}!${e.options.appId}`}class et{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new rt(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=tt();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:r}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ae.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=tt(),{heartbeatsToSend:r,unsentEntries:n}=function(e,t=1024){const r=[];let n=e.slice();for(const s of e){const e=r.find(e=>e.agent===s.agent);if(e){if(e.dates.push(s.date),nt(r)>t){e.dates.pop();break}}else if(r.push({agent:s.agent,dates:[s.date]}),nt(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),s=o(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return ae.warn(e),""}}}function tt(){return(new Date).toISOString().substring(0,10)}class rt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let r=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},s.onupgradeneeded=()=>{r=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Qe()).transaction(Je),r=await t.objectStore(Je).get(Ze(e));return await t.done,r}catch(e){if(e instanceof b)ae.warn(e.message);else{const t=qe.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});ae.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return Xe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return Xe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}}}function nt(e){return o(JSON.stringify({version:2,heartbeats:e})).length}Fe(new N("platform-logger",e=>new se(e),"PRIVATE")),Fe(new N("heartbeat",e=>new et(e),"PRIVATE")),We(ie,oe,""),We(ie,oe,"esm2017"),We("fire-js",""),We("firebase","11.10.0","app");var st,it,ot="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{},at={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function r(e,t,r){r||(r=0);var n=Array(16);if("string"==typeof t)for(var s=0;16>s;++s)n[s]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(s=0;16>s;++s)n[s]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],s=e.g[2];var i=e.g[3],o=t+(i^r&(s^i))+n[0]+3614090360&4294967295;o=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=r+(o<<7&4294967295|o>>>25))+((o=i+(s^t&(r^s))+n[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(r^i&(t^r))+n[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=r+(t^s&(i^t))+n[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^r&(s^i))+n[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(r^s))+n[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(r^i&(t^r))+n[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=r+(t^s&(i^t))+n[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^r&(s^i))+n[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(r^s))+n[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(r^i&(t^r))+n[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=r+(t^s&(i^t))+n[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^r&(s^i))+n[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(r^s))+n[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(r^i&(t^r))+n[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=r+(t^s&(i^t))+n[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^i&(r^s))+n[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(r^s&(t^r))+n[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^r&(i^t))+n[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=r+(i^t&(s^i))+n[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(r^s))+n[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(r^s&(t^r))+n[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^r&(i^t))+n[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=r+(i^t&(s^i))+n[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(r^s))+n[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(r^s&(t^r))+n[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^r&(i^t))+n[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=r+(i^t&(s^i))+n[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(r^s))+n[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(r^s&(t^r))+n[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^r&(i^t))+n[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=r+(i^t&(s^i))+n[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^s^i)+n[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^r^s)+n[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^r)+n[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=r+(s^i^t)+n[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(r^s^i)+n[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^r^s)+n[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^r)+n[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=r+(s^i^t)+n[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(r^s^i)+n[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^r^s)+n[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^r)+n[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=r+(s^i^t)+n[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(r^s^i)+n[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^r^s)+n[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^r)+n[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=r+(s^i^t)+n[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(s^(r|~i))+n[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(r^(t|~s))+n[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~r))+n[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=r+(i^(s|~t))+n[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(r|~i))+n[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(r^(t|~s))+n[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~r))+n[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=r+(i^(s|~t))+n[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(r|~i))+n[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(r^(t|~s))+n[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~r))+n[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=r+(i^(s|~t))+n[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(t=r+((o=t+(s^(r|~i))+n[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(r^(t|~s))+n[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=i+((o=s+(t^(i|~r))+n[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+n[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+i&4294967295}function n(e,t){this.h=t;for(var r=[],n=!0,s=e.length-1;0<=s;s--){var i=0|e[s];n&&i==t||(r[s]=i,n=!1)}this.g=r}!function(e,t){function r(){}r.prototype=t.prototype,e.D=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.C=function(e,r,n){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[r].apply(e,s)}}(t,function(){this.blockSize=-1}),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,s=this.B,i=this.h,o=0;o<t;){if(0==i)for(;o<=n;)r(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(s[i++]=e.charCodeAt(o++),i==this.blockSize){r(this,s),i=0;break}}else for(;o<t;)if(s[i++]=e[o++],i==this.blockSize){r(this,s),i=0;break}}this.h=i,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var r=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&r,r/=256;for(this.u(e),e=Array(16),t=r=0;4>t;++t)for(var n=0;32>n;n+=8)e[r++]=this.g[t]>>>n&255;return e};var s={};function i(e){return-128<=e&&128>e?function(e){var t=s;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new n([0|e],0>e?-1:0)}(e)}(e):new n([0|e],0>e?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(0>e)return d(o(-e));for(var t=[],r=1,s=0;e>=r;s++)t[s]=e/r|0,r*=4294967296;return new n(t,0)}var a=i(0),c=i(1),u=i(16777216);function l(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function h(e){return-1==e.h}function d(e){for(var t=e.g.length,r=[],s=0;s<t;s++)r[s]=~e.g[s];return new n(r,~e.h).add(c)}function f(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function g(e,t){this.g=e,this.h=t}function m(e,t){if(l(t))throw Error("division by zero");if(l(e))return new g(a,a);if(h(e))return t=m(d(e),t),new g(d(t.g),d(t.h));if(h(t))return t=m(e,d(t)),new g(d(t.g),t.h);if(30<e.g.length){if(h(e)||h(t))throw Error("slowDivide_ only works with positive integers.");for(var r=c,n=t;0>=n.l(e);)r=y(r),n=y(n);var s=v(r,1),i=v(n,1);for(n=v(n,2),r=v(r,2);!l(n);){var u=i.add(n);0>=u.l(e)&&(s=s.add(r),i=u),n=v(n,1),r=v(r,1)}return t=f(e,s.j(t)),new g(s,t)}for(s=a;0<=e.l(t);){for(r=Math.max(1,Math.floor(e.m()/t.m())),n=48>=(n=Math.ceil(Math.log(r)/Math.LN2))?1:Math.pow(2,n-48),u=(i=o(r)).j(t);h(u)||0<u.l(e);)u=(i=o(r-=n)).j(t);l(i)&&(i=c),s=s.add(i),e=f(e,u)}return new g(s,e)}function y(e){for(var t=e.g.length+1,r=[],s=0;s<t;s++)r[s]=e.i(s)<<1|e.i(s-1)>>>31;return new n(r,e.h)}function v(e,t){var r=t>>5;t%=32;for(var s=e.g.length-r,i=[],o=0;o<s;o++)i[o]=0<t?e.i(o+r)>>>t|e.i(o+r+1)<<32-t:e.i(o+r);return new n(i,e.h)}(e=n.prototype).m=function(){if(h(this))return-d(this).m();for(var e=0,t=1,r=0;r<this.g.length;r++){var n=this.i(r);e+=(0<=n?n:4294967296+n)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(l(this))return"0";if(h(this))return"-"+d(this).toString(e);for(var t=o(Math.pow(e,6)),r=this,n="";;){var s=m(r,t).g,i=((0<(r=f(r,s.j(t))).g.length?r.g[0]:r.h)>>>0).toString(e);if(l(r=s))return i+n;for(;6>i.length;)i="0"+i;n=i+n}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return h(e=f(this,e))?-1:l(e)?0:1},e.abs=function(){return h(this)?d(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],s=0,i=0;i<=t;i++){var o=s+(65535&this.i(i))+(65535&e.i(i)),a=(o>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);s=a>>>16,o&=65535,a&=65535,r[i]=a<<16|o}return new n(r,-2147483648&r[r.length-1]?-1:0)},e.j=function(e){if(l(this)||l(e))return a;if(h(this))return h(e)?d(this).j(d(e)):d(d(this).j(e));if(h(e))return d(this.j(d(e)));if(0>this.l(u)&&0>e.l(u))return o(this.m()*e.m());for(var t=this.g.length+e.g.length,r=[],s=0;s<2*t;s++)r[s]=0;for(s=0;s<this.g.length;s++)for(var i=0;i<e.g.length;i++){var c=this.i(s)>>>16,f=65535&this.i(s),g=e.i(i)>>>16,m=65535&e.i(i);r[2*s+2*i]+=f*m,p(r,2*s+2*i),r[2*s+2*i+1]+=c*m,p(r,2*s+2*i+1),r[2*s+2*i+1]+=f*g,p(r,2*s+2*i+1),r[2*s+2*i+2]+=c*g,p(r,2*s+2*i+2)}for(s=0;s<t;s++)r[s]=r[2*s+1]<<16|r[2*s];for(s=t;s<2*t;s++)r[s]=0;return new n(r,0)},e.A=function(e){return m(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],s=0;s<t;s++)r[s]=this.i(s)&e.i(s);return new n(r,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],s=0;s<t;s++)r[s]=this.i(s)|e.i(s);return new n(r,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],s=0;s<t;s++)r[s]=this.i(s)^e.i(s);return new n(r,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,it=at.Md5=t,n.prototype.add=n.prototype.add,n.prototype.multiply=n.prototype.j,n.prototype.modulo=n.prototype.A,n.prototype.compare=n.prototype.l,n.prototype.toNumber=n.prototype.m,n.prototype.toString=n.prototype.toString,n.prototype.getBits=n.prototype.i,n.fromNumber=o,n.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if(2>(r=r||10)||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return d(e(t.substring(1),r));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=o(Math.pow(r,8)),s=a,i=0;i<t.length;i+=8){var c=Math.min(8,t.length-i),u=parseInt(t.substring(i,i+c),r);8>c?(c=o(Math.pow(r,c)),s=s.j(c).add(o(u))):s=(s=s.j(n)).add(o(u))}return s},st=at.Integer=n}).apply(void 0!==ot?ot:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var ct,ut,lt,ht,dt,ft,pt,gt,mt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{},yt={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){return e==Array.prototype||e==Object.prototype||(e[t]=r.value),e},r=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof mt&&mt];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);!function(e,n){if(n)e:{var s=r;e=e.split(".");for(var i=0;i<e.length-1;i++){var o=e[i];if(!(o in s))break e;s=s[o]}(n=n(i=s[e=e[e.length-1]]))!=i&&null!=n&&t(s,e,{configurable:!0,writable:!0,value:n})}}("Array.prototype.values",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var r=0,n=!1,s={next:function(){if(!n&&r<e.length){var s=r++;return{value:t(0,e[s]),done:!1}}return n=!0,{done:!0,value:void 0}}};return s[Symbol.iterator]=function(){return s},s}(this,function(e,t){return t})}});var n=n||{},s=this||self;function i(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,r){return e.call.apply(e.bind,arguments)}function c(e,t,r){if(!e)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,n),e.apply(t,r)}}return function(){return e.apply(t,arguments)}}function u(e,t,r){return(u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function l(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function h(e,t){function r(){}r.prototype=t.prototype,e.aa=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Qb=function(e,r,n){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[r].apply(e,s)}}function d(e){const t=e.length;if(0<t){const r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function f(e,t){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(i(r)){const t=e.length||0,n=r.length||0;e.length=t+n;for(let s=0;s<n;s++)e[t+s]=r[s]}else e.push(r)}}function p(e){return/^[\s\xa0]*$/.test(e)}function g(){var e=s.navigator;return e&&(e=e.userAgent)?e:""}function m(e){return m[" "](e),e}m[" "]=function(){};var y=!(-1==g().indexOf("Gecko")||-1!=g().toLowerCase().indexOf("webkit")&&-1==g().indexOf("Edge")||-1!=g().indexOf("Trident")||-1!=g().indexOf("MSIE")||-1!=g().indexOf("Edge"));function v(e,t,r){for(const n in e)t.call(r,e[n],n,e)}function w(e){const t={};for(const r in e)t[r]=e[r];return t}const b="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t],n)e[r]=n[r];for(let t=0;t<b.length;t++)r=b[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}function E(e){var t=1;e=e.split(":");const r=[];for(;0<t&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}function T(e){s.setTimeout(()=>{throw e},0)}function S(){var e=O;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var I=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new k,e=>e.reset());class k{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let A,C=!1,O=new class{constructor(){this.h=this.g=null}add(e,t){const r=I.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},R=()=>{const e=s.Promise.resolve(void 0);A=()=>{e.then(N)}};var N=()=>{for(var e;e=S();){try{e.h.call(e.g)}catch(e){T(e)}var t=I;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}C=!1};function P(){this.s=this.s,this.C=this.C}function x(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}P.prototype.s=!1,P.prototype.ma=function(){this.s||(this.s=!0,this.N())},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},x.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};s.addEventListener("test",e,t),s.removeEventListener("test",e,t)}catch(e){}return e}();function L(e,t){if(x.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(y){e:{try{m(t.nodeName);var s=!0;break e}catch(e){}s=!1}s||(t=null)}}else"mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement);this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:j[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&L.aa.h.call(this)}}h(L,x);var j={2:"touch",3:"pen",4:"mouse"};L.prototype.h=function(){L.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var M="closure_listenable_"+(1e6*Math.random()|0),U=0;function $(e,t,r,n,s){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=s,this.key=++U,this.da=this.fa=!1}function F(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function V(e){this.src=e,this.g={},this.h=0}function B(e,t){var r=t.type;if(r in e.g){var n,s=e.g[r],i=Array.prototype.indexOf.call(s,t,void 0);(n=0<=i)&&Array.prototype.splice.call(s,i,1),n&&(F(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function q(e,t,r,n){for(var s=0;s<e.length;++s){var i=e[s];if(!i.da&&i.listener==t&&i.capture==!!r&&i.ha==n)return s}return-1}V.prototype.add=function(e,t,r,n,s){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var o=q(e,t,n,s);return-1<o?(t=e[o],r||(t.fa=!1)):((t=new $(t,this.src,i,!!n,s)).fa=r,e.push(t)),t};var K="closure_lm_"+(1e6*Math.random()|0),H={};function z(e,t,r,n,s){if(n&&n.once)return W(e,t,r,n,s);if(Array.isArray(t)){for(var i=0;i<t.length;i++)z(e,t[i],r,n,s);return null}return r=te(r),e&&e[M]?e.K(t,r,o(n)?!!n.capture:!!n,s):G(e,t,r,!1,n,s)}function G(e,t,r,n,s,i){if(!t)throw Error("Invalid event type");var a=o(s)?!!s.capture:!!s,c=Z(e);if(c||(e[K]=c=new V(e)),(r=c.add(t,r,n,a,i)).proxy)return r;if(n=function(){const e=X;return function t(r){return e.call(t.src,t.listener,r)}}(),r.proxy=n,n.src=e,n.listener=r,e.addEventListener)D||(s=a),void 0===s&&(s=!1),e.addEventListener(t.toString(),n,s);else if(e.attachEvent)e.attachEvent(Q(t.toString()),n);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(n)}return r}function W(e,t,r,n,s){if(Array.isArray(t)){for(var i=0;i<t.length;i++)W(e,t[i],r,n,s);return null}return r=te(r),e&&e[M]?e.L(t,r,o(n)?!!n.capture:!!n,s):G(e,t,r,!0,n,s)}function J(e,t,r,n,s){if(Array.isArray(t))for(var i=0;i<t.length;i++)J(e,t[i],r,n,s);else n=o(n)?!!n.capture:!!n,r=te(r),e&&e[M]?(e=e.i,(t=String(t).toString())in e.g&&-1<(r=q(i=e.g[t],r,n,s))&&(F(i[r]),Array.prototype.splice.call(i,r,1),0==i.length&&(delete e.g[t],e.h--))):e&&(e=Z(e))&&(t=e.g[t.toString()],e=-1,t&&(e=q(t,r,n,s)),(r=-1<e?t[e]:null)&&Y(r))}function Y(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[M])B(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(Q(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=Z(t))?(B(r,e),0==r.h&&(r.src=null,t[K]=null)):F(e)}}}function Q(e){return e in H?H[e]:H[e]="on"+e}function X(e,t){if(e.da)e=!0;else{t=new L(t,this);var r=e.listener,n=e.ha||e.src;e.fa&&Y(e),e=r.call(n,t)}return e}function Z(e){return(e=e[K])instanceof V?e:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(e){return"function"==typeof e?e:(e[ee]||(e[ee]=function(t){return e.handleEvent(t)}),e[ee])}function re(){P.call(this),this.i=new V(this),this.M=this,this.F=null}function ne(e,t){var r,n=e.F;if(n)for(r=[];n;n=n.F)r.push(n);if(e=e.M,n=t.type||t,"string"==typeof t)t=new x(t,e);else if(t instanceof x)t.target=t.target||e;else{var s=t;_(t=new x(n,e),s)}if(s=!0,r)for(var i=r.length-1;0<=i;i--){var o=t.g=r[i];s=se(o,n,!0,t)&&s}if(s=se(o=t.g=e,n,!0,t)&&s,s=se(o,n,!1,t)&&s,r)for(i=0;i<r.length;i++)s=se(o=t.g=r[i],n,!1,t)&&s}function se(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.da&&o.capture==r){var a=o.listener,c=o.ha||o.src;o.fa&&B(e.i,o),s=!1!==a.call(c,n)&&s}}return s&&!n.defaultPrevented}function ie(e,t,r){if("function"==typeof e)r&&(e=u(e,r));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=u(e.handleEvent,e)}return 2147483647<Number(t)?-1:s.setTimeout(e,t||0)}function oe(e){e.g=ie(()=>{e.g=null,e.i&&(e.i=!1,oe(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}h(re,P),re.prototype[M]=!0,re.prototype.removeEventListener=function(e,t,r,n){J(this,e,t,r,n)},re.prototype.N=function(){if(re.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var r=t.g[e],n=0;n<r.length;n++)F(r[n]);delete t.g[e],t.h--}}this.F=null},re.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},re.prototype.L=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class ae extends P{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:oe(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ce(e){P.call(this),this.h=e,this.g={}}h(ce,P);var ue=[];function le(e){v(e.g,function(e,t){this.g.hasOwnProperty(t)&&Y(e)},e),e.g={}}ce.prototype.N=function(){ce.aa.N.call(this),le(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var he=s.JSON.stringify,de=s.JSON.parse,fe=class{stringify(e){return s.JSON.stringify(e,void 0)}parse(e){return s.JSON.parse(e,void 0)}};function pe(){}function ge(e){return e.h||(e.h=e.i())}function me(){}pe.prototype.h=null;var ye={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ve(){x.call(this,"d")}function we(){x.call(this,"c")}h(ve,x),h(we,x);var be={},_e=null;function Ee(){return _e=_e||new re}function Te(e){x.call(this,be.La,e)}function Se(e){const t=Ee();ne(t,new Te(t))}function Ie(e,t){x.call(this,be.STAT_EVENT,e),this.stat=t}function ke(e){const t=Ee();ne(t,new Ie(t,e))}function Ae(e,t){x.call(this,be.Ma,e),this.size=t}function Ce(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){e()},t)}function Oe(){this.g=!0}function Re(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var r=JSON.parse(t);if(r)for(e=0;e<r.length;e++)if(Array.isArray(r[e])){var n=r[e];if(!(2>n.length)){var s=n[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return he(r)}catch(e){return t}}(e,r)+(n?" "+n:"")})}be.La="serverreachability",h(Te,x),be.STAT_EVENT="statevent",h(Ie,x),be.Ma="timingevent",h(Ae,x),Oe.prototype.xa=function(){this.g=!1},Oe.prototype.info=function(){};var Ne,Pe={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},xe={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function De(){}function Le(e,t,r,n){this.j=e,this.i=t,this.l=r,this.R=n||1,this.U=new ce(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new je}function je(){this.i=null,this.g="",this.h=!1}h(De,pe),De.prototype.g=function(){return new XMLHttpRequest},De.prototype.i=function(){return{}},Ne=new De;var Me={},Ue={};function $e(e,t,r){e.L=1,e.v=_t(ot(t)),e.m=r,e.P=!0,Fe(e,null)}function Fe(e,t){e.F=Date.now(),qe(e),e.A=ot(e.v);var r=e.A,n=e.R;Array.isArray(n)||(n=[String(n)]),Lt(r.i,"t",n),e.C=0,r=e.j.J,e.h=new je,e.g=Er(e.j,r?t:null,!e.m),0<e.O&&(e.M=new ae(u(e.Y,e,e.g),e.O)),t=e.U,r=e.g,n=e.ca;var s="readystatechange";Array.isArray(s)||(s&&(ue[0]=s.toString()),s=ue);for(var i=0;i<s.length;i++){var o=z(r,s[i],n||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?w(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Se(),function(e,t,r,n,s,i){e.info(function(){if(e.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+n+") [attempt "+s+"]: "+t+"\n"+r+"\n"+o})}(e.i,e.u,e.A,e.l,e.R,e.m)}function Ve(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function Be(e,t){var r=e.C,n=t.indexOf("\n",r);return-1==n?Ue:(r=Number(t.substring(r,n)),isNaN(r)?Me:(n+=1)+r>t.length?Ue:(t=t.slice(n,n+r),e.C=n+r,t))}function qe(e){e.S=Date.now()+e.I,Ke(e,e.I)}function Ke(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ce(u(e.ba,e),t)}function He(e){e.B&&(s.clearTimeout(e.B),e.B=null)}function ze(e){0==e.j.G||e.J||yr(e.j,e)}function Ge(e){He(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,le(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function We(e,t){try{var r=e.j;if(0!=r.G&&(r.g==e||Ze(r.h,e)))if(!e.K&&Ze(r.h,e)&&3==r.G){try{var n=r.Da.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var s=n;if(0==s[0]){e:if(!r.u){if(r.g){if(!(r.g.F+3e3<e.F))break e;mr(r),or(r)}fr(r),ke(18)}}else r.za=s[1],0<r.za-r.T&&37500>s[2]&&r.F&&0==r.v&&!r.C&&(r.C=Ce(u(r.Za,r),6e3));if(1>=Xe(r.h)&&r.ca){try{r.ca()}catch(e){}r.ca=void 0}}else wr(r,11)}else if((e.K||r.g==e)&&mr(r),!p(t))for(s=r.Da.g.parse(t),t=0;t<s.length;t++){let u=s[t];if(r.T=u[0],u=u[1],2==r.G)if("c"==u[0]){r.K=u[1],r.ia=u[2];const t=u[3];null!=t&&(r.la=t,r.j.info("VER="+r.la));const s=u[4];null!=s&&(r.Aa=s,r.j.info("SVER="+r.Aa));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(n=1.5*l,r.L=n,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=n.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(et(i,i.h),i.h=null))}if(n.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.ya=e,bt(n.I,n.D,e))}}r.G=3,r.l&&r.l.ua(),r.ba&&(r.R=Date.now()-e.F,r.j.info("Handshake RTT: "+r.R+"ms"));var o=e;if((n=r).qa=_r(n,n.J?n.ia:null,n.W),o.K){tt(n.h,o);var a=o,c=n.L;c&&(a.I=c),a.B&&(He(a),qe(a)),n.g=o}else dr(n);0<r.i.length&&cr(r)}else"stop"!=u[0]&&"close"!=u[0]||wr(r,7);else 3==r.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?wr(r,7):ir(r):"noop"!=u[0]&&r.l&&r.l.ta(u),r.v=0)}Se()}catch(e){}}Le.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==tr(e)?t.j():this.Y(e)},Le.prototype.Y=function(e){try{if(e==this.g)e:{const d=tr(this.g);var t=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||rr(this.g)))){this.J||4!=d||7==t||Se(),He(this);var r=this.g.Z();this.X=r;t:if(Ve(this)){var n=rr(this.g);e="";var i=n.length,o=4==tr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ge(this),ze(this);var a="";break t}this.h.i=new s.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(n[t],{stream:!(o&&t==i-1)});n.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==r,function(e,t,r,n,s,i,o){e.info(function(){return"XMLHTTP RESP ("+n+") [ attempt "+s+"]: "+t+"\n"+r+"\n"+i+" "+o})}(this.i,this.u,this.A,this.l,this.R,d,r),this.o){if(this.T&&!this.K){t:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(c)){var l=c;break t}}l=null}if(!(r=l)){this.o=!1,this.s=3,ke(12),Ge(this),ze(this);break e}Re(this.i,this.l,r,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,We(this,r)}if(this.P){let e;for(r=!0;!this.J&&this.C<a.length;){if(e=Be(this,a),e==Ue){4==d&&(this.s=4,ke(14),r=!1),Re(this.i,this.l,null,"[Incomplete Response]");break}if(e==Me){this.s=4,ke(15),Re(this.i,this.l,a,"[Invalid Chunk]"),r=!1;break}Re(this.i,this.l,e,null),We(this,e)}if(Ve(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,ke(16),r=!1),this.o=this.o&&r,r){if(0<a.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),pr(h),h.M=!0,ke(11))}}else Re(this.i,this.l,a,"[Invalid Chunked Response]"),Ge(this),ze(this)}else Re(this.i,this.l,a,null),We(this,a);4==d&&Ge(this),this.o&&!this.J&&(4==d?yr(this.j,this):(this.o=!1,qe(this)))}else(function(e){const t={};e=(e.g&&2<=tr(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(p(e[n]))continue;var r=E(e[n]);const s=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();const i=t[s]||[];t[s]=i,i.push(r)}!function(e,t){for(const r in e)t.call(void 0,e[r],r,e)}(t,function(e){return e.join(", ")})})(this.g),400==r&&0<a.indexOf("Unknown SID")?(this.s=3,ke(12)):(this.s=0,ke(13)),Ge(this),ze(this)}}}catch(e){}},Le.prototype.cancel=function(){this.J=!0,Ge(this)},Le.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(Se(),ke(17)),Ge(this),this.s=2,ze(this)):Ke(this,this.S-e)};var Je=class{constructor(e,t){this.g=e,this.map=t}};function Ye(e){this.l=e||10,e=s.PerformanceNavigationTiming?0<(e=s.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Qe(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Xe(e){return e.h?1:e.g?e.g.size:0}function Ze(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function et(e,t){e.g?e.g.add(t):e.h=t}function tt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function rt(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const r of e.g.values())t=t.concat(r.D);return t}return d(e.i)}function nt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(i(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var r=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(i(e)||"string"==typeof e){var t=[];e=e.length;for(var r=0;r<e;r++)t.push(r);return t}t=[],r=0;for(const n in e)t[r++]=n;return t}}}(e),n=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(i(e)){for(var t=[],r=e.length,n=0;n<r;n++)t.push(e[n]);return t}for(n in t=[],r=0,e)t[r++]=e[n];return t}(e),s=n.length,o=0;o<s;o++)t.call(void 0,n[o],r&&r[o],e)}Ye.prototype.cancel=function(){if(this.i=rt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var st=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function it(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof it){this.h=e.h,at(this,e.j),this.o=e.o,this.g=e.g,vt(this,e.s),this.l=e.l;var t=e.i,r=new Nt;r.i=t.i,t.g&&(r.g=new Map(t.g),r.h=t.h),wt(this,r),this.m=e.m}else e&&(t=String(e).match(st))?(this.h=!1,at(this,t[1]||"",!0),this.o=Et(t[2]||""),this.g=Et(t[3]||"",!0),vt(this,t[4]),this.l=Et(t[5]||"",!0),wt(this,t[6]||"",!0),this.m=Et(t[7]||"")):(this.h=!1,this.i=new Nt(null,this.h))}function ot(e){return new it(e)}function at(e,t,r){e.j=r?Et(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function vt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function wt(e,t,r){t instanceof Nt?(e.i=t,function(e,t){t&&!e.j&&(Pt(e),e.i=null,e.g.forEach(function(e,t){var r=t.toLowerCase();t!=r&&(xt(this,t),Lt(this,r,e))},e)),e.j=t}(e.i,e.h)):(r||(t=Tt(t,Ot)),e.i=new Nt(t,e.h))}function bt(e,t,r){e.i.set(t,r)}function _t(e){return bt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Et(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Tt(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,St),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function St(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}it.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Tt(t,kt,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(Tt(t,kt,!0),"@"),e.push(encodeURIComponent(String(r)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.s)&&e.push(":",String(r))),(r=this.l)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(Tt(r,"/"==r.charAt(0)?Ct:At,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",Tt(r,Rt)),e.join("")};var It,kt=/[#\/\?@]/g,At=/[#\?:]/g,Ct=/[#\?]/g,Ot=/[#\?@]/g,Rt=/#/g;function Nt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Pt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var r=0;r<e.length;r++){var n=e[r].indexOf("="),s=null;if(0<=n){var i=e[r].substring(0,n);s=e[r].substring(n+1)}else i=e[r];t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function xt(e,t){Pt(e),t=jt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Dt(e,t){return Pt(e),t=jt(e,t),e.g.has(t)}function Lt(e,t,r){xt(e,t),0<r.length&&(e.i=null,e.g.set(jt(e,t),d(r)),e.h+=r.length)}function jt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Mt(e,t,r,n,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),n(r)}catch(e){}}function Ut(){this.g=new fe}function $t(e,t,r){const n=r||"";try{nt(e,function(e,r){let s=e;o(e)&&(s=he(e)),t.push(n+r+"="+encodeURIComponent(s))})}catch(e){throw t.push(n+"type="+encodeURIComponent("_badmap")),e}}function Ft(e){this.l=e.Ub||null,this.j=e.eb||!1}function Vt(e,t){re.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Bt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function qt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Kt(e)}function Kt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Ht(e){let t="";return v(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function zt(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=Ht(r),"string"==typeof e?null!=r&&encodeURIComponent(String(r)):bt(e,t,r))}function Gt(e){re.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=Nt.prototype).add=function(e,t){Pt(this),this.i=null,e=jt(this,e);var r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},e.forEach=function(e,t){Pt(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},e.na=function(){Pt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),r=[];for(let n=0;n<t.length;n++){const s=e[n];for(let e=0;e<s.length;e++)r.push(t[n])}return r},e.V=function(e){Pt(this);let t=[];if("string"==typeof e)Dt(this,e)&&(t=t.concat(this.g.get(jt(this,e))));else{e=Array.from(this.g.values());for(let r=0;r<e.length;r++)t=t.concat(e[r])}return t},e.set=function(e,t){return Pt(this),this.i=null,Dt(this,e=jt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var r=0;r<t.length;r++){var n=t[r];const i=encodeURIComponent(String(n)),o=this.V(n);for(n=0;n<o.length;n++){var s=i;""!==o[n]&&(s+="="+encodeURIComponent(String(o[n]))),e.push(s)}}return this.i=e.join("&")},h(Ft,pe),Ft.prototype.g=function(){return new Vt(this.l,this.j)},Ft.prototype.i=(It={},function(){return It}),h(Vt,re),(e=Vt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Kt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||s).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,qt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Kt(this)),this.g&&(this.readyState=3,Kt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==s.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Bt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?qt(this):Kt(this),3==this.readyState&&Bt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,qt(this))},e.Qa=function(e){this.g&&(this.response=e,qt(this))},e.ga=function(){this.g&&qt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var r=t.next();!r.done;)r=r.value,e.push(r[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(Vt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),h(Gt,re);var Wt=/^https?$/i,Jt=["POST","PUT"];function Yt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Qt(e),Zt(e)}function Qt(e){e.A||(e.A=!0,ne(e,"complete"),ne(e,"error"))}function Xt(e){if(e.h&&void 0!==n&&(!e.v[1]||4!=tr(e)||2!=e.Z()))if(e.u&&4==tr(e))ie(e.Ea,0,e);else if(ne(e,"readystatechange"),4==tr(e)){e.h=!1;try{const n=e.Z();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var r;if(!(r=t)){var i;if(i=0===n){var o=String(e.D).match(st)[1]||null;!o&&s.self&&s.self.location&&(o=s.self.location.protocol.slice(0,-1)),i=!Wt.test(o?o.toLowerCase():"")}r=i}if(r)ne(e,"complete"),ne(e,"success");else{e.m=6;try{var a=2<tr(e)?e.g.statusText:""}catch(e){a=""}e.l=a+" ["+e.Z()+"]",Qt(e)}}finally{Zt(e)}}}function Zt(e,t){if(e.g){er(e);const r=e.g,n=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||ne(e,"ready");try{r.onreadystatechange=n}catch(e){}}}function er(e){e.I&&(s.clearTimeout(e.I),e.I=null)}function tr(e){return e.g?e.g.readyState:0}function rr(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function nr(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function sr(e){this.Aa=0,this.i=[],this.j=new Oe,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=nr("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=nr("baseRetryDelayMs",5e3,e),this.cb=nr("retryDelaySeedMs",1e4,e),this.Wa=nr("forwardChannelMaxRetries",2,e),this.wa=nr("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Ye(e&&e.concurrentRequestLimit),this.Da=new Ut,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function ir(e){if(ar(e),3==e.G){var t=e.U++,r=ot(e.I);if(bt(r,"SID",e.K),bt(r,"RID",t),bt(r,"TYPE","terminate"),lr(e,r),(t=new Le(e,e.j,t)).L=2,t.v=_t(ot(r)),r=!1,s.navigator&&s.navigator.sendBeacon)try{r=s.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!r&&s.Image&&((new Image).src=t.v,r=!0),r||(t.g=Er(t.j,null),t.g.ea(t.v)),t.F=Date.now(),qe(t)}br(e)}function or(e){e.g&&(pr(e),e.g.cancel(),e.g=null)}function ar(e){or(e),e.u&&(s.clearTimeout(e.u),e.u=null),mr(e),e.h.cancel(),e.s&&("number"==typeof e.s&&s.clearTimeout(e.s),e.s=null)}function cr(e){if(!Qe(e.h)&&!e.s){e.s=!0;var t=e.Ga;A||R(),C||(A(),C=!0),O.add(t,e),e.B=0}}function ur(e,t){var r;r=t?t.l:e.U++;const n=ot(e.I);bt(n,"SID",e.K),bt(n,"RID",r),bt(n,"AID",e.T),lr(e,n),e.m&&e.o&&zt(n,e.m,e.o),r=new Le(e,e.j,r,e.B+1),null===e.m&&(r.H=e.o),t&&(e.i=t.D.concat(e.i)),t=hr(e,r,1e3),r.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),et(e.h,r),$e(r,n,t)}function lr(e,t){e.H&&v(e.H,function(e,r){bt(t,r,e)}),e.l&&nt({},function(e,r){bt(t,r,e)})}function hr(e,t,r){r=Math.min(e.i.length,r);var n=e.l?u(e.l.Na,e.l,e):null;e:{var s=e.i;let t=-1;for(;;){const e=["count="+r];-1==t?0<r?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let i=!0;for(let o=0;o<r;o++){let r=s[o].g;const a=s[o].map;if(r-=t,0>r)t=Math.max(0,s[o].g-100),i=!1;else try{$t(a,e,"req"+r+"_")}catch(e){n&&n(a)}}if(i){n=e.join("&");break e}}}return e=e.i.splice(0,r),t.D=e,n}function dr(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;A||R(),C||(A(),C=!0),O.add(t,e),e.v=0}}function fr(e){return!(e.g||e.u||3<=e.v||(e.Y++,e.u=Ce(u(e.Fa,e),vr(e,e.v)),e.v++,0))}function pr(e){null!=e.A&&(s.clearTimeout(e.A),e.A=null)}function gr(e){e.g=new Le(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=ot(e.qa);bt(t,"RID","rpc"),bt(t,"SID",e.K),bt(t,"AID",e.T),bt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&bt(t,"TO",e.ja),bt(t,"TYPE","xmlhttp"),lr(e,t),e.m&&e.o&&zt(t,e.m,e.o),e.L&&(e.g.I=e.L);var r=e.g;e=e.ia,r.L=1,r.v=_t(ot(t)),r.m=null,r.P=!0,Fe(r,e)}function mr(e){null!=e.C&&(s.clearTimeout(e.C),e.C=null)}function yr(e,t){var r=null;if(e.g==t){mr(e),pr(e),e.g=null;var n=2}else{if(!Ze(e.h,t))return;r=t.D,tt(e.h,t),n=1}if(0!=e.G)if(t.o)if(1==n){r=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;ne(n=Ee(),new Ae(n,r)),cr(e)}else dr(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==n&&function(e,t){return!(Xe(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=Ce(u(e.Ga,e,t),vr(e,e.B)),e.B++,0)))}(e,t)||2==n&&fr(e)))switch(r&&0<r.length&&(t=e.h,t.i=t.i.concat(r)),s){case 1:wr(e,5);break;case 4:wr(e,10);break;case 3:wr(e,6);break;default:wr(e,2)}}function vr(e,t){let r=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(r*=2),r*t}function wr(e,t){if(e.j.info("Error code "+t),2==t){var r=u(e.fb,e),n=e.Xa;const t=!n;n=new it(n||"//www.google.com/images/cleardot.gif"),s.location&&"http"==s.location.protocol||at(n,"https"),_t(n),t?function(e,t){const r=new Oe;if(s.Image){const n=new Image;n.onload=l(Mt,r,"TestLoadImage: loaded",!0,t,n),n.onerror=l(Mt,r,"TestLoadImage: error",!1,t,n),n.onabort=l(Mt,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=l(Mt,r,"TestLoadImage: timeout",!1,t,n),s.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(n.toString(),r):function(e,t){new Oe;const r=new AbortController,n=setTimeout(()=>{r.abort(),Mt(0,0,!1,t)},1e4);fetch(e,{signal:r.signal}).then(e=>{clearTimeout(n),e.ok?Mt(0,0,!0,t):Mt(0,0,!1,t)}).catch(()=>{clearTimeout(n),Mt(0,0,!1,t)})}(n.toString(),r)}else ke(2);e.G=0,e.l&&e.l.sa(t),br(e),ar(e)}function br(e){if(e.G=0,e.ka=[],e.l){const t=rt(e.h);0==t.length&&0==e.i.length||(f(e.ka,t),f(e.ka,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.ra()}}function _r(e,t,r){var n=r instanceof it?ot(r):new it(r);if(""!=n.g)t&&(n.g=t+"."+n.g),vt(n,n.s);else{var i=s.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var o=new it(null);n&&at(o,n),t&&(o.g=t),i&&vt(o,i),r&&(o.l=r),n=o}return r=e.D,t=e.ya,r&&t&&bt(n,r,t),bt(n,"VER",e.la),lr(e,n),n}function Er(e,t,r){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Gt(new Ft({eb:r})):new Gt(e.pa)).Ha(e.J),t}function Tr(){}function Sr(){}function Ir(e,t){re.call(this),this.g=new sr(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!p(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!p(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Cr(this)}function kr(e){ve.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Ar(){we.call(this),this.status=1}function Cr(e){this.g=e}(e=Gt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,r,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ne.g(),this.v=this.o?ge(this.o):ge(Ne),this.g.onreadystatechange=u(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void Yt(this,e)}if(e=r||"",r=new Map(this.headers),n)if(Object.getPrototypeOf(n)===Object.prototype)for(var i in n)r.set(i,n[i]);else{if("function"!=typeof n.keys||"function"!=typeof n.get)throw Error("Unknown input type for opt_headers: "+String(n));for(const e of n.keys())r.set(e,n.get(e))}n=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),i=s.FormData&&e instanceof s.FormData,!(0<=Array.prototype.indexOf.call(Jt,t,void 0))||n||i||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of r)this.g.setRequestHeader(e,t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{er(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){Yt(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,ne(this,"complete"),ne(this,"abort"),Zt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Zt(this,!0)),Gt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Xt(this):this.bb())},e.bb=function(){Xt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<tr(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),de(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=sr.prototype).la=8,e.G=1,e.connect=function(e,t,r,n){ke(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.I=_r(this,null,this.W),cr(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const s=new Le(this,this.j,e);let i=this.o;if(this.S&&(i?(i=w(i),_(i,this.S)):i=this.S),null!==this.m||this.O||(s.H=i,i=null),this.P)e:{for(var t=0,r=0;r<this.i.length;r++){var n=this.i[r];if(void 0===(n="__data__"in n.map&&"string"==typeof(n=n.map.__data__)?n.length:void 0))break;if(4096<(t+=n)){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=hr(this,s,t),bt(r=ot(this.I),"RID",e),bt(r,"CVER",22),this.D&&bt(r,"X-HTTP-Session-Id",this.D),lr(this,r),i&&(this.O?t="headers="+encodeURIComponent(String(Ht(i)))+"&"+t:this.m&&zt(r,this.m,i)),et(this.h,s),this.Ua&&bt(r,"TYPE","init"),this.P?(bt(r,"$req",t),bt(r,"SID","null"),s.T=!0,$e(s,r,null)):$e(s,r,t),this.G=2}}else 3==this.G&&(e?ur(this,e):0==this.i.length||Qe(this.h)||ur(this))},e.Fa=function(){if(this.u=null,gr(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Ce(u(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ke(10),or(this),gr(this))},e.Za=function(){null!=this.C&&(this.C=null,or(this),fr(this),ke(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),ke(2)):(this.j.info("Failed to ping google.com"),ke(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=Tr.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},Sr.prototype.g=function(e,t){return new Ir(e,t)},h(Ir,re),Ir.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ir.prototype.close=function(){ir(this.g)},Ir.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.u&&((r={}).__data__=he(e),e=r);t.i.push(new Je(t.Ya++,e)),3==t.G&&cr(t)},Ir.prototype.N=function(){this.g.l=null,delete this.j,ir(this.g),delete this.g,Ir.aa.N.call(this)},h(kr,ve),h(Ar,we),h(Cr,Tr),Cr.prototype.ua=function(){ne(this.g,"a")},Cr.prototype.ta=function(e){ne(this.g,new kr(e))},Cr.prototype.sa=function(e){ne(this.g,new Ar)},Cr.prototype.ra=function(){ne(this.g,"b")},Sr.prototype.createWebChannel=Sr.prototype.g,Ir.prototype.send=Ir.prototype.o,Ir.prototype.open=Ir.prototype.m,Ir.prototype.close=Ir.prototype.close,gt=yt.createWebChannelTransport=function(){return new Sr},pt=yt.getStatEventTarget=function(){return Ee()},ft=yt.Event=be,dt=yt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Pe.NO_ERROR=0,Pe.TIMEOUT=8,Pe.HTTP_ERROR=6,ht=yt.ErrorCode=Pe,xe.COMPLETE="complete",lt=yt.EventType=xe,me.EventType=ye,ye.OPEN="a",ye.CLOSE="b",ye.ERROR="c",ye.MESSAGE="d",re.prototype.listen=re.prototype.K,ut=yt.WebChannel=me,yt.FetchXmlHttpFactory=Ft,Gt.prototype.listenOnce=Gt.prototype.L,Gt.prototype.getLastError=Gt.prototype.Ka,Gt.prototype.getLastErrorCode=Gt.prototype.Ba,Gt.prototype.getStatus=Gt.prototype.Z,Gt.prototype.getResponseJson=Gt.prototype.Oa,Gt.prototype.getResponseText=Gt.prototype.oa,Gt.prototype.send=Gt.prototype.ea,Gt.prototype.setWithCredentials=Gt.prototype.Ha,ct=yt.XhrIo=Gt}).apply(void 0!==mt?mt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const vt="@firebase/firestore",wt="4.8.0";class bt{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}bt.UNAUTHENTICATED=new bt(null),bt.GOOGLE_CREDENTIALS=new bt("google-credentials-uid"),bt.FIRST_PARTY=new bt("first-party-uid"),bt.MOCK_USER=new bt("mock-user");let _t="11.10.0";const Et=new V("@firebase/firestore");function Tt(){return Et.logLevel}function St(e,...t){if(Et.logLevel<=j.DEBUG){const r=t.map(At);Et.debug(`Firestore (${_t}): ${e}`,...r)}}function It(e,...t){if(Et.logLevel<=j.ERROR){const r=t.map(At);Et.error(`Firestore (${_t}): ${e}`,...r)}}function kt(e,...t){if(Et.logLevel<=j.WARN){const r=t.map(At);Et.warn(`Firestore (${_t}): ${e}`,...r)}}function At(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function Ct(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,Ot(e,n,r)}function Ot(e,t,r){let n=`FIRESTORE (${_t}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw It(n),new Error(n)}function Rt(e,t,r,n){let s="Unexpected state";"string"==typeof r?s=r:n=r,e||Ot(t,s,n)}function Nt(e,t){return e}const Pt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class xt extends b{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Dt{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Lt{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class jt{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(bt.UNAUTHENTICATED))}shutdown(){}}class Mt{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Ut{constructor(e){this.t=e,this.currentUser=bt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Rt(void 0===this.o,42304);let r=this.i;const n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve();let s=new Dt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Dt,e.enqueueRetryable(()=>n(this.currentUser))};const i=()=>{const t=s;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},o=e=>{St("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(St("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Dt)}},0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(St("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Rt("string"==typeof t.accessToken,31837,{l:t}),new Lt(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Rt(null===e||"string"==typeof e,2055,{h:e}),new bt(e)}}class $t{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=bt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Ft{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new $t(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(bt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Vt{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Bt{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Be(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Rt(void 0===this.o,3512);const r=e=>{null!=e.error&&St("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const r=e.token!==this.m;return this.m=e.token,St("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};const n=e=>{St("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?n(e):St("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Vt(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(Rt("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new Vt(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function qt(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let t=0;t<e;t++)r[t]=Math.floor(256*Math.random());return r}function Kt(){return new TextEncoder}class Ht{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const r=qt(40);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function zt(e,t){return e<t?-1:e>t?1:0}function Gt(e,t){let r=0;for(;r<e.length&&r<t.length;){const n=e.codePointAt(r),s=t.codePointAt(r);if(n!==s){if(n<128&&s<128)return zt(n,s);{const i=Kt(),o=Jt(i.encode(Wt(e,r)),i.encode(Wt(t,r)));return 0!==o?o:zt(n,s)}}r+=n>65535?2:1}return zt(e.length,t.length)}function Wt(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function Jt(e,t){for(let r=0;r<e.length&&r<t.length;++r)if(e[r]!==t[r])return zt(e[r],t[r]);return zt(e.length,t.length)}function Yt(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}const Qt="__name__";class Xt{constructor(e,t,r){void 0===t?t=0:t>e.length&&Ct(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&Ct(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Xt.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Xt?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let n=0;n<r;n++){const r=Xt.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return zt(e.length,t.length)}static compareSegments(e,t){const r=Xt.isNumericId(e),n=Xt.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?Xt.extractNumericId(e).compare(Xt.extractNumericId(t)):Gt(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return st.fromString(e.substring(4,e.length-2))}}class Zt extends Xt{construct(e,t,r){return new Zt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new xt(Pt.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new Zt(t)}static emptyPath(){return new Zt([])}}const er=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class tr extends Xt{construct(e,t,r){return new tr(e,t,r)}static isValidIdentifier(e){return er.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),tr.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Qt}static keyField(){return new tr([Qt])}static fromServerFormat(e){const t=[];let r="",n=0;const s=()=>{if(0===r.length)throw new xt(Pt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let i=!1;for(;n<e.length;){const t=e[n];if("\\"===t){if(n+1===e.length)throw new xt(Pt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new xt(Pt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?(i=!i,n++):"."!==t||i?(r+=t,n++):(s(),n++)}if(s(),i)throw new xt(Pt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new tr(t)}static emptyPath(){return new tr([])}}class rr{constructor(e){this.path=e}static fromPath(e){return new rr(Zt.fromString(e))}static fromName(e){return new rr(Zt.fromString(e).popFirst(5))}static empty(){return new rr(Zt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Zt.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Zt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new rr(new Zt(e.slice()))}}function nr(e,t,r){if(!r)throw new xt(Pt.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function sr(e){if(!rr.isDocumentKey(e))throw new xt(Pt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function ir(e){if(rr.isDocumentKey(e))throw new xt(Pt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function or(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new xt(Pt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=function(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Ct(12329,{type:typeof e})}(e);throw new xt(Pt.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function ar(e,t){const r={typeString:e};return t&&(r.value=t),r}function cr(e,t){if(!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(e))throw new xt(Pt.INVALID_ARGUMENT,"JSON must be an object");let r;for(const n in t)if(t[n]){const s=t[n].typeString,i="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}const o=e[n];if(s&&typeof o!==s){r=`JSON field '${n}' must be a ${s}.`;break}if(void 0!==i&&o!==i.value){r=`Expected '${n}' field to equal '${i.value}'`;break}}if(r)throw new xt(Pt.INVALID_ARGUMENT,r);return!0}const ur=-62135596800,lr=1e6;class hr{static now(){return hr.fromMillis(Date.now())}static fromDate(e){return hr.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*lr);return new hr(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new xt(Pt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new xt(Pt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ur)throw new xt(Pt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new xt(Pt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/lr}_compareTo(e){return this.seconds===e.seconds?zt(this.nanoseconds,e.nanoseconds):zt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:hr._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(cr(e,hr._jsonSchema))return new hr(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-ur;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}hr._jsonSchemaVersion="firestore/timestamp/1.0",hr._jsonSchema={type:ar("string",hr._jsonSchemaVersion),seconds:ar("number"),nanoseconds:ar("number")};class dr{static fromTimestamp(e){return new dr(e)}static min(){return new dr(new hr(0,0))}static max(){return new dr(new hr(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function fr(e){return new pr(e.readTime,e.key,-1)}class pr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new pr(dr.min(),rr.empty(),-1)}static max(){return new pr(dr.max(),rr.empty(),-1)}}function gr(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r?r:(r=rr.comparator(e.documentKey,t.documentKey),0!==r?r:zt(e.largestBatchId,t.largestBatchId))}class mr{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function yr(e){if(e.code!==Pt.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;St("LocalStore","Unexpectedly lost primary lease")}class vr{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ct(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new vr((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof vr?t:vr.resolve(t)}catch(e){return vr.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):vr.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):vr.reject(t)}static resolve(e){return new vr((t,r)=>{t(e)})}static reject(e){return new vr((t,r)=>{r(e)})}static waitFor(e){return new vr((t,r)=>{let n=0,s=0,i=!1;e.forEach(e=>{++n,e.next(()=>{++s,i&&s===n&&t()},e=>r(e))}),i=!0,s===n&&t()})}static or(e){let t=vr.resolve(!1);for(const r of e)t=t.next(e=>e?vr.resolve(e):r());return t}static forEach(e,t){const r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new vr((r,n)=>{const s=e.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;t(e[c]).next(e=>{i[c]=e,++o,o===s&&r(i)},e=>n(e))}})}static doWhile(e,t){return new vr((r,n)=>{const s=()=>{!0===e()?t().next(()=>{s()},n):r()};s()})}}function wr(e){return"IndexedDbTransactionError"===e.name}class br{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this._e(e),this.ae=e=>t.writeSequenceNumber(e))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ae&&this.ae(e),e}}br.ue=-1;function _r(e){return null==e}function Er(e){return 0===e&&1/e==-1/0}function Tr(e,t){let r=t;const n=e.length;for(let t=0;t<n;t++){const n=e.charAt(t);switch(n){case"\0":r+="";break;case"":r+="";break;default:r+=n}}return r}function Sr(e){return e+""}const Ir="owner",kr="mutationQueues",Ar="mutations",Cr="documentMutations",Or="remoteDocumentGlobal",Rr="targets",Nr="targetDocuments",Pr="targetGlobal",xr="collectionParents",Dr="clientMetadata",Lr="bundles",jr="namedQueries";function Mr(e){let t=0;for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function Ur(e,t){for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}class $r{constructor(e,t){this.comparator=e,this.root=t||Vr.EMPTY}insert(e,t){return new $r(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Vr.BLACK,null,null))}remove(e){return new $r(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Vr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Fr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Fr(this.root,e,this.comparator,!1)}getReverseIterator(){return new Fr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Fr(this.root,e,this.comparator,!0)}}class Fr{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&n&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Vr{constructor(e,t,r,n,s){this.key=e,this.value=t,this.color=null!=r?r:Vr.RED,this.left=null!=n?n:Vr.EMPTY,this.right=null!=s?s:Vr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,s){return new Vr(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this;const s=r(e,n.key);return n=s<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===s?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r)),n.fixUp()}removeMin(){if(this.left.isEmpty())return Vr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,n=this;if(t(e,n.key)<0)n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return Vr.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Vr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Vr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ct(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ct(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ct(27949);return e+(this.isRed()?0:1)}}Vr.EMPTY=null,Vr.RED=!0,Vr.BLACK=!1,Vr.EMPTY=new class{constructor(){this.size=0}get key(){throw Ct(57766)}get value(){throw Ct(16141)}get color(){throw Ct(16727)}get left(){throw Ct(29726)}get right(){throw Ct(36894)}copy(e,t,r,n,s){return this}insert(e,t,r){return new Vr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Br{constructor(e){this.comparator=e,this.data=new $r(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new qr(this.data.getIterator())}getIteratorFrom(e){return new qr(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Br))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Br(this.comparator);return t.data=e,t}}class qr{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Kr{constructor(e){this.fields=e,e.sort(tr.comparator)}static empty(){return new Kr([])}unionWith(e){let t=new Br(tr.comparator);for(const e of this.fields)t=t.add(e);for(const r of e)t=t.add(r);return new Kr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Yt(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Hr extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class zr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Hr("Invalid base64 string: "+e):e}}(e);return new zr(t)}static fromUint8Array(e){const t=function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e);return new zr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return zt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}zr.EMPTY_BYTE_STRING=new zr("");const Gr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Wr(e){if(Rt(!!e,39018),"string"==typeof e){let t=0;const r=Gr.exec(e);if(Rt(!!r,46558,{timestamp:e}),r[1]){let e=r[1];e=(e+"000000000").substr(0,9),t=Number(e)}const n=new Date(e);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:Jr(e.seconds),nanos:Jr(e.nanos)}}function Jr(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Yr(e){return"string"==typeof e?zr.fromBase64String(e):zr.fromUint8Array(e)}const Qr="server_timestamp",Xr="__type__",Zr="__previous_value__",en="__local_write_time__";function tn(e){var t,r;return(null===(r=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[Xr])||void 0===r?void 0:r.stringValue)===Qr}function rn(e){const t=e.mapValue.fields[Zr];return tn(t)?rn(t):t}function nn(e){const t=Wr(e.mapValue.fields[en].timestampValue);return new hr(t.seconds,t.nanos)}class sn{constructor(e,t,r,n,s,i,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=u}}const on="(default)";class an{constructor(e,t){this.projectId=e,this.database=t||on}static empty(){return new an("","")}get isDefaultDatabase(){return this.database===on}isEqual(e){return e instanceof an&&e.projectId===this.projectId&&e.database===this.database}}const cn="__max__",un={fields:{__type__:{stringValue:cn}}},ln="value";function hn(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?tn(e)?4:An(e)?9007199254740991:In(e)?10:11:Ct(28295,{value:e})}function dn(e,t){if(e===t)return!0;const r=hn(e);if(r!==hn(t))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return nn(e).isEqual(nn(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const r=Wr(e.timestampValue),n=Wr(t.timestampValue);return r.seconds===n.seconds&&r.nanos===n.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Yr(e.bytesValue).isEqual(Yr(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Jr(e.geoPointValue.latitude)===Jr(t.geoPointValue.latitude)&&Jr(e.geoPointValue.longitude)===Jr(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Jr(e.integerValue)===Jr(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const r=Jr(e.doubleValue),n=Jr(t.doubleValue);return r===n?Er(r)===Er(n):isNaN(r)&&isNaN(n)}return!1}(e,t);case 9:return Yt(e.arrayValue.values||[],t.arrayValue.values||[],dn);case 10:case 11:return function(e,t){const r=e.mapValue.fields||{},n=t.mapValue.fields||{};if(Mr(r)!==Mr(n))return!1;for(const e in r)if(r.hasOwnProperty(e)&&(void 0===n[e]||!dn(r[e],n[e])))return!1;return!0}(e,t);default:return Ct(52216,{left:e})}}function fn(e,t){return void 0!==(e.values||[]).find(e=>dn(e,t))}function pn(e,t){if(e===t)return 0;const r=hn(e),n=hn(t);if(r!==n)return zt(r,n);switch(r){case 0:case 9007199254740991:return 0;case 1:return zt(e.booleanValue,t.booleanValue);case 2:return function(e,t){const r=Jr(e.integerValue||e.doubleValue),n=Jr(t.integerValue||t.doubleValue);return r<n?-1:r>n?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1}(e,t);case 3:return gn(e.timestampValue,t.timestampValue);case 4:return gn(nn(e),nn(t));case 5:return Gt(e.stringValue,t.stringValue);case 6:return function(e,t){const r=Yr(e),n=Yr(t);return r.compareTo(n)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){const t=zt(r[e],n[e]);if(0!==t)return t}return zt(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const r=zt(Jr(e.latitude),Jr(t.latitude));return 0!==r?r:zt(Jr(e.longitude),Jr(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return mn(e.arrayValue,t.arrayValue);case 10:return function(e,t){var r,n,s,i;const o=e.fields||{},a=t.fields||{},c=null===(r=o[ln])||void 0===r?void 0:r.arrayValue,u=null===(n=a[ln])||void 0===n?void 0:n.arrayValue,l=zt((null===(s=null==c?void 0:c.values)||void 0===s?void 0:s.length)||0,(null===(i=null==u?void 0:u.values)||void 0===i?void 0:i.length)||0);return 0!==l?l:mn(c,u)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===un&&t===un)return 0;if(e===un)return 1;if(t===un)return-1;const r=e.fields||{},n=Object.keys(r),s=t.fields||{},i=Object.keys(s);n.sort(),i.sort();for(let e=0;e<n.length&&e<i.length;++e){const t=Gt(n[e],i[e]);if(0!==t)return t;const o=pn(r[n[e]],s[i[e]]);if(0!==o)return o}return zt(n.length,i.length)}(e.mapValue,t.mapValue);default:throw Ct(23264,{le:r})}}function gn(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return zt(e,t);const r=Wr(e),n=Wr(t),s=zt(r.seconds,n.seconds);return 0!==s?s:zt(r.nanos,n.nanos)}function mn(e,t){const r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){const t=pn(r[e],n[e]);if(t)return t}return zt(r.length,n.length)}function yn(e){return vn(e)}function vn(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Wr(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Yr(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return rr.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",r=!0;for(const n of e.values||[])r?r=!1:t+=",",t+=vn(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let r="{",n=!0;for(const s of t)n?n=!1:r+=",",r+=`${s}:${vn(e.fields[s])}`;return r+"}"}(e.mapValue):Ct(61005,{value:e})}function wn(e){switch(hn(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=rn(e);return t?16+wn(t):16;case 5:return 2*e.stringValue.length;case 6:return Yr(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce((e,t)=>e+wn(t),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return Ur(e.fields,(e,r)=>{t+=e.length+wn(r)}),t}(e.mapValue);default:throw Ct(13486,{value:e})}}function bn(e){return!!e&&"integerValue"in e}function _n(e){return!!e&&"arrayValue"in e}function En(e){return!!e&&"nullValue"in e}function Tn(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Sn(e){return!!e&&"mapValue"in e}function In(e){var t,r;return"__vector__"===(null===(r=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===r?void 0:r.stringValue)}function kn(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Ur(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=kn(r)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=kn(e.arrayValue.values[r]);return t}return Object.assign({},e)}function An(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===cn}class Cn{constructor(e){this.value=e}static empty(){return new Cn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Sn(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=kn(t)}setAll(e){let t=tr.emptyPath(),r={},n=[];e.forEach((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=s.popLast()}e?r[s.lastSegment()]=kn(e):n.push(s.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,n)}delete(e){const t=this.field(e.popLast());Sn(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return dn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];Sn(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){Ur(t,(t,r)=>e[t]=r);for(const t of r)delete e[t]}clone(){return new Cn(kn(this.value))}}class On{constructor(e,t,r,n,s,i,o){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(e){return new On(e,0,dr.min(),dr.min(),dr.min(),Cn.empty(),0)}static newFoundDocument(e,t,r,n){return new On(e,1,t,dr.min(),r,n,0)}static newNoDocument(e,t){return new On(e,2,t,dr.min(),dr.min(),Cn.empty(),0)}static newUnknownDocument(e,t){return new On(e,3,t,dr.min(),dr.min(),Cn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(dr.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Cn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Cn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=dr.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof On&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new On(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Rn{constructor(e,t){this.position=e,this.inclusive=t}}function Nn(e,t,r){let n=0;for(let s=0;s<e.position.length;s++){const i=t[s],o=e.position[s];if(n=i.field.isKeyField()?rr.comparator(rr.fromName(o.referenceValue),r.key):pn(o,r.data.field(i.field)),"desc"===i.dir&&(n*=-1),0!==n)break}return n}function Pn(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!dn(e.position[r],t.position[r]))return!1;return!0}class xn{constructor(e,t="asc"){this.field=e,this.dir=t}}function Dn(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Ln{}class jn extends Ln{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new qn(e,t,r):"array-contains"===t?new Gn(e,r):"in"===t?new Wn(e,r):"not-in"===t?new Jn(e,r):"array-contains-any"===t?new Yn(e,r):new jn(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new Kn(e,r):new Hn(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(pn(t,this.value)):null!==t&&hn(this.value)===hn(t)&&this.matchesComparison(pn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Ct(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Mn extends Ln{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new Mn(e,t)}matches(e){return Un(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.he||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function Un(e){return"and"===e.op}function $n(e){return function(e){for(const t of e.filters)if(t instanceof Mn)return!1;return!0}(e)&&Un(e)}function Fn(e){if(e instanceof jn)return e.field.canonicalString()+e.op.toString()+yn(e.value);if($n(e))return e.filters.map(e=>Fn(e)).join(",");{const t=e.filters.map(e=>Fn(e)).join(",");return`${e.op}(${t})`}}function Vn(e,t){return e instanceof jn?function(e,t){return t instanceof jn&&e.op===t.op&&e.field.isEqual(t.field)&&dn(e.value,t.value)}(e,t):e instanceof Mn?function(e,t){return t instanceof Mn&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,r,n)=>e&&Vn(r,t.filters[n]),!0)}(e,t):void Ct(19439)}function Bn(e){return e instanceof jn?function(e){return`${e.field.canonicalString()} ${e.op} ${yn(e.value)}`}(e):e instanceof Mn?function(e){return e.op.toString()+" {"+e.getFilters().map(Bn).join(" ,")+"}"}(e):"Filter"}class qn extends jn{constructor(e,t,r){super(e,t,r),this.key=rr.fromName(r.referenceValue)}matches(e){const t=rr.comparator(e.key,this.key);return this.matchesComparison(t)}}class Kn extends jn{constructor(e,t){super(e,"in",t),this.keys=zn(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Hn extends jn{constructor(e,t){super(e,"not-in",t),this.keys=zn(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function zn(e,t){var r;return((null===(r=t.arrayValue)||void 0===r?void 0:r.values)||[]).map(e=>rr.fromName(e.referenceValue))}class Gn extends jn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return _n(t)&&fn(t.arrayValue,this.value)}}class Wn extends jn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&fn(this.value.arrayValue,t)}}class Jn extends jn{constructor(e,t){super(e,"not-in",t)}matches(e){if(fn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!fn(this.value.arrayValue,t)}}class Yn extends jn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!_n(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>fn(this.value.arrayValue,e))}}class Qn{constructor(e,t=null,r=[],n=[],s=null,i=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=s,this.startAt=i,this.endAt=o,this.Pe=null}}function Xn(e,t=null,r=[],n=[],s=null,i=null,o=null){return new Qn(e,t,r,n,s,i,o)}function Zn(e){const t=Nt(e);if(null===t.Pe){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Fn(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),_r(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>yn(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>yn(e)).join(",")),t.Pe=e}return t.Pe}function es(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++)if(!Dn(e.orderBy[r],t.orderBy[r]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!Vn(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Pn(e.startAt,t.startAt)&&Pn(e.endAt,t.endAt)}function ts(e){return rr.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class rs{constructor(e,t=null,r=[],n=[],s=null,i="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function ns(e){return new rs(e)}function ss(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function is(e){const t=Nt(e);if(null===t.Te){t.Te=[];const e=new Set;for(const r of t.explicitOrderBy)t.Te.push(r),e.add(r.field.canonicalString());const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",n=function(e){let t=new Br(tr.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);n.forEach(n=>{e.has(n.canonicalString())||n.isKeyField()||t.Te.push(new xn(n,r))}),e.has(tr.keyField().canonicalString())||t.Te.push(new xn(tr.keyField(),r))}return t.Te}function os(e){const t=Nt(e);return t.Ie||(t.Ie=function(e,t){if("F"===e.limitType)return Xn(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new xn(e.field,t)});const r=e.endAt?new Rn(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new Rn(e.startAt.position,e.startAt.inclusive):null;return Xn(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}(t,is(e))),t.Ie}function as(e,t,r){return new rs(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function cs(e,t){return es(os(e),os(t))&&e.limitType===t.limitType}function us(e){return`${Zn(os(e))}|lt:${e.limitType}`}function ls(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>Bn(e)).join(", ")}]`),_r(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>yn(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>yn(e)).join(",")),`Target(${t})`}(os(e))}; limitType=${e.limitType})`}function hs(e,t){return t.isFoundDocument()&&function(e,t){const r=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):rr.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r)}(e,t)&&function(e,t){for(const r of is(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(const r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,r){const n=Nn(e,t,r);return e.inclusive?n<=0:n<0}(e.startAt,is(e),t)||e.endAt&&!function(e,t,r){const n=Nn(e,t,r);return e.inclusive?n>=0:n>0}(e.endAt,is(e),t))}(e,t)}function ds(e){return(t,r)=>{let n=!1;for(const s of is(e)){const e=fs(s,t,r);if(0!==e)return e;n=n||s.field.isKeyField()}return 0}}function fs(e,t,r){const n=e.field.isKeyField()?rr.comparator(t.key,r.key):function(e,t,r){const n=t.data.field(e),s=r.data.field(e);return null!==n&&null!==s?pn(n,s):Ct(42886)}(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return Ct(19790,{direction:e.dir})}}class ps{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[t,n]of r)if(this.equalsFn(t,e))return n}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){Ur(this.inner,(t,r)=>{for(const[t,n]of r)e(t,n)})}isEmpty(){return function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(this.inner)}size(){return this.innerSize}}const gs=new $r(rr.comparator);function ms(){return gs}const ys=new $r(rr.comparator);function vs(...e){let t=ys;for(const r of e)t=t.insert(r.key,r);return t}function ws(e){let t=ys;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function bs(){return Es()}function _s(){return Es()}function Es(){return new ps(e=>e.toString(),(e,t)=>e.isEqual(t))}new $r(rr.comparator);const Ts=new Br(rr.comparator);function Ss(...e){let t=Ts;for(const r of e)t=t.add(r);return t}const Is=new Br(zt);class ks{constructor(){this._=void 0}}function As(e,t,r){return e instanceof Os?function(e,t){const r={fields:{[Xr]:{stringValue:Qr},[en]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&tn(t)&&(t=rn(t)),t&&(r.fields[Zr]=t),{mapValue:r}}(r,t):e instanceof Rs?Ns(e,t):e instanceof Ps?xs(e,t):function(e,t){const r=function(e,t){return e instanceof Ds?function(e){return bn(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}(e,t),n=Ls(r)+Ls(e.Ee);return bn(r)&&bn(e.Ee)?function(e){return{integerValue:""+e}}(n):function(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Er(t)?"-0":t}}(e.serializer,n)}(e,t)}function Cs(e,t,r){return e instanceof Rs?Ns(e,t):e instanceof Ps?xs(e,t):r}class Os extends ks{}class Rs extends ks{constructor(e){super(),this.elements=e}}function Ns(e,t){const r=js(t);for(const t of e.elements)r.some(e=>dn(e,t))||r.push(t);return{arrayValue:{values:r}}}class Ps extends ks{constructor(e){super(),this.elements=e}}function xs(e,t){let r=js(t);for(const t of e.elements)r=r.filter(e=>!dn(e,t));return{arrayValue:{values:r}}}class Ds extends ks{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function Ls(e){return Jr(e.integerValue||e.doubleValue)}function js(e){return _n(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Ms{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ms}static exists(e){return new Ms(void 0,e)}static updateTime(e){return new Ms(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Us(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class $s{}function Fs(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Js(e.key,Ms.none()):new Ks(e.key,e.data,Ms.none());{const r=e.data,n=Cn.empty();let s=new Br(tr.comparator);for(let e of t.fields)if(!s.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),s=s.add(e)}return new Hs(e.key,n,new Kr(s.toArray()),Ms.none())}}function Vs(e,t,r){e instanceof Ks?function(e,t,r){const n=e.value.clone(),s=Gs(e.fieldTransforms,t,r.transformResults);n.setAll(s),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()}(e,t,r):e instanceof Hs?function(e,t,r){if(!Us(e.precondition,t))return void t.convertToUnknownDocument(r.version);const n=Gs(e.fieldTransforms,t,r.transformResults),s=t.data;s.setAll(zs(e)),s.setAll(n),t.convertToFoundDocument(r.version,s).setHasCommittedMutations()}(e,t,r):function(e,t,r){t.convertToNoDocument(r.version).setHasCommittedMutations()}(0,t,r)}function Bs(e,t,r,n){return e instanceof Ks?function(e,t,r,n){if(!Us(e.precondition,t))return r;const s=e.value.clone(),i=Ws(e.fieldTransforms,n,t);return s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,r,n):e instanceof Hs?function(e,t,r,n){if(!Us(e.precondition,t))return r;const s=Ws(e.fieldTransforms,n,t),i=t.data;return i.setAll(zs(e)),i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===r?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):function(e,t,r){return Us(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}(e,t,r)}function qs(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Yt(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Rs&&t instanceof Rs||e instanceof Ps&&t instanceof Ps?Yt(e.elements,t.elements,dn):e instanceof Ds&&t instanceof Ds?dn(e.Ee,t.Ee):e instanceof Os&&t instanceof Os}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Ks extends $s{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class Hs extends $s{constructor(e,t,r,n,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function zs(e){const t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const n=e.data.field(r);t.set(r,n)}}),t}function Gs(e,t,r){const n=new Map;Rt(e.length===r.length,32656,{Ae:r.length,Re:e.length});for(let s=0;s<r.length;s++){const i=e[s],o=i.transform,a=t.data.field(i.field);n.set(i.field,Cs(o,a,r[s]))}return n}function Ws(e,t,r){const n=new Map;for(const s of e){const e=s.transform,i=r.data.field(s.field);n.set(s.field,As(e,i,t))}return n}class Js extends $s{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ys{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const n=this.mutations[t];n.key.isEqual(e.key)&&Vs(n,e,r[t])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Bs(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Bs(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=_s();return this.mutations.forEach(n=>{const s=e.get(n.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=t.has(n.key)?null:o;const a=Fs(i,o);null!==a&&r.set(n.key,a),i.isValidDocument()||i.convertToNoDocument(dr.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ss())}isEqual(e){return this.batchId===e.batchId&&Yt(this.mutations,e.mutations,(e,t)=>qs(e,t))&&Yt(this.baseMutations,e.baseMutations,(e,t)=>qs(e,t))}}class Qs{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Xs{constructor(e,t){this.count=e,this.unchangedNames=t}}var Zs,ei;function ti(e){if(void 0===e)return It("GRPC error has no .code"),Pt.UNKNOWN;switch(e){case Zs.OK:return Pt.OK;case Zs.CANCELLED:return Pt.CANCELLED;case Zs.UNKNOWN:return Pt.UNKNOWN;case Zs.DEADLINE_EXCEEDED:return Pt.DEADLINE_EXCEEDED;case Zs.RESOURCE_EXHAUSTED:return Pt.RESOURCE_EXHAUSTED;case Zs.INTERNAL:return Pt.INTERNAL;case Zs.UNAVAILABLE:return Pt.UNAVAILABLE;case Zs.UNAUTHENTICATED:return Pt.UNAUTHENTICATED;case Zs.INVALID_ARGUMENT:return Pt.INVALID_ARGUMENT;case Zs.NOT_FOUND:return Pt.NOT_FOUND;case Zs.ALREADY_EXISTS:return Pt.ALREADY_EXISTS;case Zs.PERMISSION_DENIED:return Pt.PERMISSION_DENIED;case Zs.FAILED_PRECONDITION:return Pt.FAILED_PRECONDITION;case Zs.ABORTED:return Pt.ABORTED;case Zs.OUT_OF_RANGE:return Pt.OUT_OF_RANGE;case Zs.UNIMPLEMENTED:return Pt.UNIMPLEMENTED;case Zs.DATA_LOSS:return Pt.DATA_LOSS;default:return Ct(39323,{code:e})}}(ei=Zs||(Zs={}))[ei.OK=0]="OK",ei[ei.CANCELLED=1]="CANCELLED",ei[ei.UNKNOWN=2]="UNKNOWN",ei[ei.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ei[ei.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ei[ei.NOT_FOUND=5]="NOT_FOUND",ei[ei.ALREADY_EXISTS=6]="ALREADY_EXISTS",ei[ei.PERMISSION_DENIED=7]="PERMISSION_DENIED",ei[ei.UNAUTHENTICATED=16]="UNAUTHENTICATED",ei[ei.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ei[ei.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ei[ei.ABORTED=10]="ABORTED",ei[ei.OUT_OF_RANGE=11]="OUT_OF_RANGE",ei[ei.UNIMPLEMENTED=12]="UNIMPLEMENTED",ei[ei.INTERNAL=13]="INTERNAL",ei[ei.UNAVAILABLE=14]="UNAVAILABLE",ei[ei.DATA_LOSS=15]="DATA_LOSS";const ri=new st([4294967295,4294967295],0);function ni(e){const t=Kt().encode(e),r=new it;return r.update(t),new Uint8Array(r.digest())}function si(e){const t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new st([r,n],0),new st([s,i],0)]}class ii{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new oi(`Invalid padding: ${t}`);if(r<0)throw new oi(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new oi(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new oi(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=st.fromNumber(this.fe)}pe(e,t,r){let n=e.add(t.multiply(st.fromNumber(r)));return 1===n.compare(ri)&&(n=new st([n.getBits(0),n.getBits(1)],0)),n.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.fe)return!1;const t=ni(e),[r,n]=si(t);for(let e=0;e<this.hashCount;e++){const t=this.pe(r,n,e);if(!this.ye(t))return!1}return!0}static create(e,t,r){const n=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),i=new ii(s,n,t);return r.forEach(e=>i.insert(e)),i}insert(e){if(0===this.fe)return;const t=ni(e),[r,n]=si(t);for(let e=0;e<this.hashCount;e++){const t=this.pe(r,n,e);this.we(t)}}we(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class oi extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ai{constructor(e,t,r,n,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const n=new Map;return n.set(e,ci.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new ai(dr.min(),n,new $r(zt),ms(),Ss())}}class ci{constructor(e,t,r,n,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new ci(r,t,Ss(),Ss(),Ss())}}class ui{constructor(e,t,r,n){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=n}}class li{constructor(e,t){this.targetId=e,this.De=t}}class hi{constructor(e,t,r=zr.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class di{constructor(){this.ve=0,this.Ce=gi(),this.Fe=zr.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return 0!==this.ve}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=Ss(),t=Ss(),r=Ss();return this.Ce.forEach((n,s)=>{switch(s){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:Ct(38017,{changeType:s})}}),new ci(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=gi()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,Rt(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class fi{constructor(e){this.We=e,this.Ge=new Map,this.ze=ms(),this.je=pi(),this.Je=pi(),this.He=new $r(zt)}Ye(e){for(const t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(const t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{const r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:Ct(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((e,r)=>{this.nt(r)&&t(r)})}it(e){const t=e.targetId,r=e.De.count,n=this.st(t);if(n){const s=n.target;if(ts(s))if(0===r){const e=new rr(s.path);this.Xe(t,e,On.newNoDocument(e,dr.min()))}else Rt(1===r,20013,{expectedCount:r});else{const n=this.ot(t);if(n!==r){const r=this._t(e),s=r?this.ut(r,e,n):1;if(0!==s){this.rt(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,e)}}}}}_t(e){const t=e.De.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:n=0},hashCount:s=0}=t;let i,o;try{i=Yr(r).toUint8Array()}catch(e){if(e instanceof Hr)return kt("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new ii(i,n,s)}catch(e){return kt(e instanceof oi?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.fe?null:o}ut(e,t,r){return t.De.count===r-this.ht(e,t.targetId)?0:2}ht(e,t){const r=this.We.getRemoteKeysForTarget(t);let n=0;return r.forEach(r=>{const s=this.We.lt(),i=`projects/${s.projectId}/databases/${s.database}/documents/${r.path.canonicalString()}`;e.mightContain(i)||(this.Xe(t,r,null),n++)}),n}Pt(e){const t=new Map;this.Ge.forEach((r,n)=>{const s=this.st(n);if(s){if(r.current&&ts(s.target)){const t=new rr(s.target.path);this.Tt(t).has(n)||this.It(n,t)||this.Xe(n,t,On.newNoDocument(t,e))}r.Ne&&(t.set(n,r.Le()),r.ke())}});let r=Ss();this.Je.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{const t=this.st(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.ze.forEach((t,r)=>r.setReadTime(e));const n=new ai(e,t,this.He,this.ze,r);return this.ze=ms(),this.je=pi(),this.Je=pi(),this.He=new $r(zt),n}Ze(e,t){if(!this.nt(e))return;const r=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;const n=this.tt(e);this.It(e,t)?n.qe(t,1):n.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){const t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new di,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new Br(zt),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new Br(zt),this.je=this.je.insert(e,t)),t}nt(e){const t=null!==this.st(e);return t||St("WatchChangeAggregator","Detected inactive target",e),t}st(e){const t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new di),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}}function pi(){return new $r(rr.comparator)}function gi(){return new $r(rr.comparator)}const mi={asc:"ASCENDING",desc:"DESCENDING"},yi={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},vi={and:"AND",or:"OR"};class wi{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function bi(e,t){return e.useProto3Json||_r(t)?t:{value:t}}function _i(e){return Rt(!!e,49232),dr.fromTimestamp(function(e){const t=Wr(e);return new hr(t.seconds,t.nanos)}(e))}function Ei(e,t){const r=function(e){return new Zt(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?r:r.child(t)}function Ti(e){const t=Zt.fromString(e);return Rt(Ui(t),10190,{key:t.toString()}),t}function Si(e,t){const r=Ti(t);if(r.get(1)!==e.databaseId.projectId)throw new xt(Pt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new xt(Pt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new rr(Ai(r))}function Ii(e,t){return function(e,t){return Ei(e,t).canonicalString()}(e.databaseId,t)}function ki(e){return new Zt(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ai(e){return Rt(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function Ci(e,t){return{documents:[Ii(e,t.path)]}}function Oi(e,t){const r={structuredQuery:{}},n=t.path;let s;null!==t.collectionGroup?(s=n,r.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=n.popLast(),r.structuredQuery.from=[{collectionId:n.lastSegment()}]),r.parent=Ii(e,s);const i=function(e){if(0!==e.length)return Mi(Mn.create(e,"and"))}(t.filters);i&&(r.structuredQuery.where=i);const o=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:Li(e.field),direction:Pi(e.dir)}}(e))}(t.orderBy);o&&(r.structuredQuery.orderBy=o);const a=bi(e,t.limit);return null!==a&&(r.structuredQuery.limit=a),t.startAt&&(r.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(r.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{Vt:r,parent:s}}function Ri(e){let t=function(e){const t=Ti(e);return 4===t.length?Zt.emptyPath():Ai(t)}(e.parent);const r=e.structuredQuery,n=r.from?r.from.length:0;let s=null;if(n>0){Rt(1===n,65062);const e=r.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let i=[];r.where&&(i=function(e){const t=Ni(e);return t instanceof Mn&&$n(t)?t.getFilters():[t]}(r.where));let o=[];r.orderBy&&(o=function(e){return e.map(e=>function(e){return new xn(ji(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(r.orderBy));let a=null;r.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,_r(t)?null:t}(r.limit));let c=null;r.startAt&&(c=function(e){const t=!!e.before,r=e.values||[];return new Rn(r,t)}(r.startAt));let u=null;return r.endAt&&(u=function(e){const t=!e.before,r=e.values||[];return new Rn(r,t)}(r.endAt)),function(e,t,r,n,s,i,o,a){return new rs(e,t,r,n,s,i,o,a)}(t,s,o,i,a,"F",c,u)}function Ni(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=ji(e.unaryFilter.field);return jn.create(t,"==",{doubleValue:NaN});case"IS_NULL":const r=ji(e.unaryFilter.field);return jn.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const n=ji(e.unaryFilter.field);return jn.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=ji(e.unaryFilter.field);return jn.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ct(61313);default:return Ct(60726)}}(e):void 0!==e.fieldFilter?function(e){return jn.create(ji(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ct(58110);default:return Ct(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Mn.create(e.compositeFilter.filters.map(e=>Ni(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Ct(1026)}}(e.compositeFilter.op))}(e):Ct(30097,{filter:e})}function Pi(e){return mi[e]}function xi(e){return yi[e]}function Di(e){return vi[e]}function Li(e){return{fieldPath:e.canonicalString()}}function ji(e){return tr.fromServerFormat(e.fieldPath)}function Mi(e){return e instanceof jn?function(e){if("=="===e.op){if(Tn(e.value))return{unaryFilter:{field:Li(e.field),op:"IS_NAN"}};if(En(e.value))return{unaryFilter:{field:Li(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Tn(e.value))return{unaryFilter:{field:Li(e.field),op:"IS_NOT_NAN"}};if(En(e.value))return{unaryFilter:{field:Li(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Li(e.field),op:xi(e.op),value:e.value}}}(e):e instanceof Mn?function(e){const t=e.getFilters().map(e=>Mi(e));return 1===t.length?t[0]:{compositeFilter:{op:Di(e.op),filters:t}}}(e):Ct(54877,{filter:e})}function Ui(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class $i{constructor(e,t,r,n,s=dr.min(),i=dr.min(),o=zr.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new $i(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new $i(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new $i(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new $i(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Fi{constructor(e){this.gt=e}}function Vi(e){const t=Ri({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?as(t,t.limit,"L"):t}class Bi{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(Jr(e.integerValue));else if("doubleValue"in e){const r=Jr(e.doubleValue);isNaN(r)?this.Ct(t,13):(this.Ct(t,15),Er(r)?t.Ft(0):t.Ft(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ct(t,20),"string"==typeof r&&(r=Wr(r)),t.Mt(`${r.seconds||""}`),t.Ft(r.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(Yr(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ct(t,45),t.Ft(r.latitude||0),t.Ft(r.longitude||0)}else"mapValue"in e?An(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):In(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):Ct(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){const r=e.fields||{};this.Ct(t,55);for(const e of Object.keys(r))this.xt(e,t),this.Dt(r[e],t)}Lt(e,t){var r,n;const s=e.fields||{};this.Ct(t,53);const i=ln,o=(null===(n=null===(r=s[i].arrayValue)||void 0===r?void 0:r.values)||void 0===n?void 0:n.length)||0;this.Ct(t,15),t.Ft(Jr(o)),this.xt(i,t),this.Dt(s[i],t)}qt(e,t){const r=e.values||[];this.Ct(t,50);for(const e of r)this.Dt(e,t)}Bt(e,t){this.Ct(t,37),rr.fromName(e).path.forEach(e=>{this.Ct(t,60),this.$t(e,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}}Bi.Ut=new Bi;class qi{constructor(){this.Dn=new Ki}addToCollectionParentIndex(e,t){return this.Dn.add(t),vr.resolve()}getCollectionParents(e,t){return vr.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return vr.resolve()}deleteFieldIndex(e,t){return vr.resolve()}deleteAllFieldIndexes(e){return vr.resolve()}createTargetIndexes(e,t){return vr.resolve()}getDocumentsMatchingTarget(e,t){return vr.resolve(null)}getIndexType(e,t){return vr.resolve(0)}getFieldIndexes(e,t){return vr.resolve([])}getNextCollectionGroupToUpdate(e){return vr.resolve(null)}getMinOffset(e,t){return vr.resolve(pr.min())}getMinOffsetFromCollectionGroup(e,t){return vr.resolve(pr.min())}updateCollectionGroup(e,t,r){return vr.resolve()}updateIndexEntries(e,t){return vr.resolve()}}class Ki{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new Br(Zt.comparator),s=!n.has(r);return this.index[t]=n.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new Br(Zt.comparator)).toArray()}}new Uint8Array(0);const Hi={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},zi=41943040;class Gi{static withCacheSize(e){return new Gi(e,Gi.DEFAULT_COLLECTION_PERCENTILE,Gi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}Gi.DEFAULT_COLLECTION_PERCENTILE=10,Gi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Gi.DEFAULT=new Gi(zi,Gi.DEFAULT_COLLECTION_PERCENTILE,Gi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Gi.DISABLED=new Gi(-1,0,0);class Wi{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new Wi(0)}static ur(){return new Wi(-1)}}const Ji="LruGarbageCollector";function Yi([e,t],[r,n]){const s=zt(e,r);return 0===s?zt(t,n):s}class Qi{constructor(e){this.Tr=e,this.buffer=new Br(Yi),this.Ir=0}dr(){return++this.Ir}Er(e){const t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Yi(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Xi{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return null!==this.Ar}Rr(e){St(Ji,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){wr(e)?St(Ji,"Ignoring IndexedDB error during garbage collection: ",e):await yr(e)}await this.Rr(3e5)})}}class Zi{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return vr.resolve(br.ue);const r=new Qi(t);return this.Vr.forEachTarget(e,e=>r.Er(e.sequenceNumber)).next(()=>this.Vr.gr(e,e=>r.Er(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(St("LruGarbageCollector","Garbage collection skipped; disabled"),vr.resolve(Hi)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(St("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Hi):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,n,s,i,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(St("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,i=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,o=Date.now(),this.removeTargets(e,r,t))).next(t=>(s=t,a=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(c=Date.now(),Tt()<=j.DEBUG&&St("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-u}ms\n\tDetermined least recently used ${n} in `+(o-i)+"ms\n"+`\tRemoved ${s} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),vr.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:s,documentsRemoved:e})))}}class eo{constructor(){this.changes=new ps(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,On.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?vr.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class to{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ro{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&Bs(r.mutation,e,Kr.empty(),hr.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,Ss()).next(()=>t))}getLocalViewOfDocuments(e,t,r=Ss()){const n=bs();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=vs();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const r=bs();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Ss()))}populateOverlays(e,t,r){const n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let s=ms();const i=Es(),o=Es();return t.forEach((e,t)=>{const o=r.get(t.key);n.has(t.key)&&(void 0===o||o.mutation instanceof Hs)?s=s.insert(t.key,t):void 0!==o?(i.set(t.key,o.mutation.getFieldMask()),Bs(o.mutation,t,o.mutation.getFieldMask(),hr.now())):i.set(t.key,Kr.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>{var r;return o.set(e,new to(t,null!==(r=i.get(e))&&void 0!==r?r:null))}),o))}recalculateAndSaveOverlays(e,t){const r=Es();let n=new $r((e,t)=>e-t),s=Ss();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const s of e)s.keys().forEach(e=>{const i=t.get(e);if(null===i)return;let o=r.get(e)||Kr.empty();o=s.applyToLocalView(i,o),r.set(e,o);const a=(n.get(s.batchId)||Ss()).add(e);n=n.insert(s.batchId,a)})}).next(()=>{const i=[],o=n.getReverseIterator();for(;o.hasNext();){const n=o.getNext(),a=n.key,c=n.value,u=_s();c.forEach(e=>{if(!s.has(e)){const n=Fs(t.get(e),r.get(e));null!==n&&u.set(e,n),s=s.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,a,u))}return vr.waitFor(i)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return function(e){return rr.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):function(e){return null!==e.collectionGroup}(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(s=>{const i=n-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-s.size):vr.resolve(bs());let o=-1,a=s;return i.next(t=>vr.forEach(t,(t,r)=>(o<r.largestBatchId&&(o=r.largestBatchId),s.get(t)?vr.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,s)).next(()=>this.computeViews(e,a,t,Ss())).next(e=>({batchId:o,changes:ws(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new rr(t)).next(e=>{let t=vs();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){const s=t.collectionGroup;let i=vs();return this.indexManager.getCollectionParents(e,s).next(o=>vr.forEach(o,o=>{const a=function(e,t){return new rs(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(s));return this.getDocumentsMatchingCollectionQuery(e,a,r,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,r,n){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,n))).next(e=>{s.forEach((t,r)=>{const n=r.getKey();null===e.get(n)&&(e=e.insert(n,On.newInvalidDocument(n)))});let r=vs();return e.forEach((e,n)=>{const i=s.get(e);void 0!==i&&Bs(i.mutation,n,Kr.empty(),hr.now()),hs(t,n)&&(r=r.insert(e,n))}),r})}}class no{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return vr.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,function(e){return{id:e.id,version:e.version,createTime:_i(e.createTime)}}(t)),vr.resolve()}getNamedQuery(e,t){return vr.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,function(e){return{name:e.name,query:Vi(e.bundledQuery),readTime:_i(e.readTime)}}(t)),vr.resolve()}}class so{constructor(){this.overlays=new $r(rr.comparator),this.kr=new Map}getOverlay(e,t){return vr.resolve(this.overlays.get(t))}getOverlays(e,t){const r=bs();return vr.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.wt(e,t,n)}),vr.resolve()}removeOverlaysForBatchId(e,t,r){const n=this.kr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.kr.delete(r)),vr.resolve()}getOverlaysForCollection(e,t,r){const n=bs(),s=t.length+1,i=new rr(t.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const e=o.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===s&&e.largestBatchId>r&&n.set(e.getKey(),e)}return vr.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let s=new $r((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=s.get(e.largestBatchId);null===t&&(t=bs(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=bs(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=n)););return vr.resolve(o)}wt(e,t,r){const n=this.overlays.get(r.key);if(null!==n){const e=this.kr.get(n.largestBatchId).delete(r.key);this.kr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new Qs(t,r));let s=this.kr.get(t);void 0===s&&(s=Ss(),this.kr.set(t,s)),this.kr.set(t,s.add(r.key))}}class oo{constructor(){this.sessionToken=zr.EMPTY_BYTE_STRING}getSessionToken(e){return vr.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,vr.resolve()}}class ao{constructor(){this.qr=new Br(co.Qr),this.$r=new Br(co.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){const r=new co(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new co(e,t))}Gr(e,t){e.forEach(e=>this.removeReference(e,t))}zr(e){const t=new rr(new Zt([])),r=new co(t,e),n=new co(t,e+1),s=[];return this.$r.forEachInRange([r,n],e=>{this.Wr(e),s.push(e.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const t=new rr(new Zt([])),r=new co(t,e),n=new co(t,e+1);let s=Ss();return this.$r.forEachInRange([r,n],e=>{s=s.add(e.key)}),s}containsKey(e){const t=new co(e,0),r=this.qr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class co{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return rr.comparator(e.key,t.key)||zt(e.Hr,t.Hr)}static Ur(e,t){return zt(e.Hr,t.Hr)||rr.comparator(e.key,t.key)}}class uo{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new Br(co.Qr)}checkEmpty(e){return vr.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){const s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Ys(s,t,r,n);this.mutationQueue.push(i);for(const t of n)this.Yr=this.Yr.add(new co(t.key,s)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return vr.resolve(i)}lookupMutationBatch(e,t){return vr.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=this.Xr(r),s=n<0?0:n;return vr.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return vr.resolve(0===this.mutationQueue.length?-1:this.er-1)}getAllMutationBatches(e){return vr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new co(t,0),n=new co(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([r,n],e=>{const t=this.Zr(e.Hr);s.push(t)}),vr.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Br(zt);return t.forEach(e=>{const t=new co(e,0),n=new co(e,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([t,n],e=>{r=r.add(e.Hr)})}),vr.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,n=r.length+1;let s=r;rr.isDocumentKey(s)||(s=s.child(""));const i=new co(new rr(s),0);let o=new Br(zt);return this.Yr.forEachWhile(e=>{const t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(o=o.add(e.Hr)),!0)},i),vr.resolve(this.ei(o))}ei(e){const t=[];return e.forEach(e=>{const r=this.Zr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){Rt(0===this.ti(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Yr;return vr.forEach(t.mutations,n=>{const s=new co(n.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Yr=r})}rr(e){}containsKey(e,t){const r=new co(t,0),n=this.Yr.firstAfterOrEqual(r);return vr.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,vr.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class lo{constructor(e){this.ni=e,this.docs=new $r(rr.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,n=this.docs.get(r),s=n?n.size:0,i=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return vr.resolve(r?r.document.mutableCopy():On.newInvalidDocument(t))}getEntries(e,t){let r=ms();return t.forEach(e=>{const t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():On.newInvalidDocument(e))}),vr.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let s=ms();const i=t.path,o=new rr(i.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||gr(fr(o),r)<=0||(n.has(o.key)||hs(t,o))&&(s=s.insert(o.key,o.mutableCopy()))}return vr.resolve(s)}getAllFromCollectionGroup(e,t,r,n){Ct(9500)}ri(e,t){return vr.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new ho(this)}getSize(e){return vr.resolve(this.size)}}class ho extends eo{constructor(e){super(),this.Or=e}applyChanges(e){const t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Or.addEntry(e,n)):this.Or.removeEntry(r)}),vr.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}}class fo{constructor(e){this.persistence=e,this.ii=new ps(e=>Zn(e),es),this.lastRemoteSnapshotVersion=dr.min(),this.highestTargetId=0,this.si=0,this.oi=new ao,this.targetCount=0,this._i=Wi.ar()}forEachTarget(e,t){return this.ii.forEach((e,r)=>t(r)),vr.resolve()}getLastRemoteSnapshotVersion(e){return vr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return vr.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),vr.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),vr.resolve()}hr(e){this.ii.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this._i=new Wi(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,vr.resolve()}updateTargetData(e,t){return this.hr(t),vr.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,vr.resolve()}removeTargets(e,t,r){let n=0;const s=[];return this.ii.forEach((i,o)=>{o.sequenceNumber<=t&&null===r.get(o.targetId)&&(this.ii.delete(i),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),n++)}),vr.waitFor(s).next(()=>n)}getTargetCount(e){return vr.resolve(this.targetCount)}getTargetData(e,t){const r=this.ii.get(t)||null;return vr.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),vr.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);const n=this.persistence.referenceDelegate,s=[];return n&&t.forEach(t=>{s.push(n.markPotentiallyOrphaned(e,t))}),vr.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),vr.resolve()}getMatchingKeysForTargetId(e,t){const r=this.oi.Jr(t);return vr.resolve(r)}containsKey(e,t){return vr.resolve(this.oi.containsKey(t))}}class po{constructor(e,t){this.ai={},this.overlays={},this.ui=new br(0),this.ci=!1,this.ci=!0,this.li=new oo,this.referenceDelegate=e(this),this.hi=new fo(this),this.indexManager=new qi,this.remoteDocumentCache=function(e){return new lo(e)}(e=>this.referenceDelegate.Pi(e)),this.serializer=new Fi(t),this.Ti=new no(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new so,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new uo(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){St("MemoryPersistence","Starting transaction:",e);const n=new go(this.ui.next());return this.referenceDelegate.Ii(),r(n).next(e=>this.referenceDelegate.di(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ei(e,t){return vr.or(Object.values(this.ai).map(r=>()=>r.containsKey(e,t)))}}class go extends mr{constructor(e){super(),this.currentSequenceNumber=e}}class mo{constructor(e){this.persistence=e,this.Ai=new ao,this.Ri=null}static Vi(e){return new mo(e)}get mi(){if(this.Ri)return this.Ri;throw Ct(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),vr.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),vr.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),vr.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(e=>this.mi.add(e.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.mi.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return vr.forEach(this.mi,r=>{const n=rr.fromPath(r);return this.fi(e,n).next(e=>{e||t.removeEntry(n,dr.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(e=>{e?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return vr.or([()=>vr.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class yo{constructor(e,t){this.persistence=e,this.gi=new ps(e=>function(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t=Sr(t)),t=Tr(e.get(r),t);return Sr(t)}(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=function(e,t){return new Zi(e,t)}(this,t)}static Vi(e,t){return new yo(e,t)}Ii(){}di(e){return vr.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){const t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}yr(e){let t=0;return this.gr(e,e=>{t++}).next(()=>t)}gr(e,t){return vr.forEach(this.gi,(r,n)=>this.Sr(e,r,n).next(e=>e?vr.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const n=this.persistence.getRemoteDocumentCache(),s=n.newChangeBuffer();return n.ri(e,n=>this.Sr(e,n,t).next(e=>{e||(r++,s.removeEntry(n,dr.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),vr.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),vr.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),vr.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),vr.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=wn(e.data.value)),t}Sr(e,t,r){return vr.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.gi.get(t);return vr.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class vo{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=n}static Es(e,t){let r=Ss(),n=Ss();for(const e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new vo(e,t.fromCache,r,n)}}class wo{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class bo{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=w()?8:function(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}(v())>0?6:4}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,n){const s={result:null};return this.ps(e,t).next(e=>{s.result=e}).next(()=>{if(!s.result)return this.ys(e,t,n,r).next(e=>{s.result=e})}).next(()=>{if(s.result)return;const r=new wo;return this.ws(e,t,r).next(n=>{if(s.result=n,this.Rs)return this.Ss(e,t,r,n.size)})}).next(()=>s.result)}Ss(e,t,r,n){return r.documentReadCount<this.Vs?(Tt()<=j.DEBUG&&St("QueryEngine","SDK will not create cache indexes for query:",ls(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),vr.resolve()):(Tt()<=j.DEBUG&&St("QueryEngine","Query:",ls(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.fs*n?(Tt()<=j.DEBUG&&St("QueryEngine","The SDK decides to create cache indexes for query:",ls(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,os(t))):vr.resolve())}ps(e,t){if(ss(t))return vr.resolve(null);let r=os(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(t=as(t,null,"F"),r=os(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{const s=Ss(...n);return this.gs.getDocuments(e,s).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{const i=this.bs(t,n);return this.Ds(t,i,s,r.readTime)?this.ps(e,as(t,null,"F")):this.vs(e,i,t,r)}))})))}ys(e,t,r,n){return ss(t)||n.isEqual(dr.min())?vr.resolve(null):this.gs.getDocuments(e,r).next(s=>{const i=this.bs(t,s);return this.Ds(t,i,r,n)?vr.resolve(null):(Tt()<=j.DEBUG&&St("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),ls(t)),this.vs(e,i,t,function(e,t){const r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1,s=dr.fromTimestamp(1e9===n?new hr(r+1,0):new hr(r,n));return new pr(s,rr.empty(),t)}(n,-1)).next(e=>e))})}bs(e,t){let r=new Br(ds(e));return t.forEach((t,n)=>{hs(e,n)&&(r=r.add(n))}),r}Ds(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(n)>0)}ws(e,t,r){return Tt()<=j.DEBUG&&St("QueryEngine","Using full collection scan to execute query:",ls(t)),this.gs.getDocumentsMatchingQuery(e,t,pr.min(),r)}vs(e,t,r,n){return this.gs.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const _o="LocalStore";class Eo{constructor(e,t,r,n){this.persistence=e,this.Cs=t,this.serializer=n,this.Fs=new $r(zt),this.Ms=new ps(e=>Zn(e),es),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ro(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}}async function To(e,t){const r=Nt(e);return await r.persistence.runTransaction("Handle user change","readonly",e=>{let n;return r.mutationQueue.getAllMutationBatches(e).next(s=>(n=s,r.Ns(t),r.mutationQueue.getAllMutationBatches(e))).next(t=>{const s=[],i=[];let o=Ss();for(const e of n){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return r.localDocuments.getDocuments(e,o).next(e=>({Bs:e,removedBatchIds:s,addedBatchIds:i}))})})}function So(e){const t=Nt(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.hi.getLastRemoteSnapshotVersion(e))}async function Io(e,t,r){const n=Nt(e),s=n.Fs.get(t),i=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",i,e=>n.persistence.referenceDelegate.removeTarget(e,s))}catch(e){if(!wr(e))throw e;St(_o,`Failed to update sequence numbers for target ${t}: ${e}`)}n.Fs=n.Fs.remove(t),n.Ms.delete(s.target)}function ko(e,t,r){const n=Nt(e);let s=dr.min(),i=Ss();return n.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,r){const n=Nt(e),s=n.Ms.get(r);return void 0!==s?vr.resolve(n.Fs.get(s)):n.hi.getTargetData(t,r)}(n,e,os(t)).next(t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,n.hi.getMatchingKeysForTargetId(e,t.targetId).next(e=>{i=e})}).next(()=>n.Cs.getDocumentsMatchingQuery(e,t,r?s:dr.min(),r?i:Ss())).next(e=>(function(e,t,r){let n=e.xs.get(t)||dr.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.xs.set(t,n)}(n,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,qs:i})))}class Ao{constructor(){this.activeTargetIds=Is}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Co{constructor(){this.Fo=new Ao,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new Ao,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Oo{xo(e){}shutdown(){}}const Ro="ConnectivityMonitor";class No{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){St(Ro,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){St(Ro,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Po=null;function xo(){return null===Po?Po=268435456+Math.round(2147483648*Math.random()):Po++,"0x"+Po.toString(16)}const Do="RestConnection",Lo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class jo{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${n}`,this.Ko=this.databaseId.database===on?`project_id=${r}`:`project_id=${r}&database_id=${n}`}Wo(e,t,r,n,s){const i=xo(),o=this.Go(e,t.toUriEncodedString());St(Do,`Sending RPC '${e}' ${i}:`,o,r);const a={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(a,n,s);const{host:c}=new URL(o),u=f(c);return this.jo(e,o,a,r,u).then(t=>(St(Do,`Received RPC '${e}' ${i}: `,t),t),t=>{throw kt(Do,`RPC '${e}' ${i} failed with error: `,t,"url: ",o,"request:",r),t})}Jo(e,t,r,n,s,i){return this.Wo(e,t,r,n,s)}zo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+_t,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}Go(e,t){const r=Lo[e];return`${this.$o}/v1/${t}:${r}`}terminate(){}}class Mo{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}const Uo="WebChannelConnection";class $o extends jo{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,n,s){const i=xo();return new Promise((s,o)=>{const a=new ct;a.setWithCredentials(!0),a.listenOnce(lt.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case ht.NO_ERROR:const t=a.getResponseJson();St(Uo,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case ht.TIMEOUT:St(Uo,`RPC '${e}' ${i} timed out`),o(new xt(Pt.DEADLINE_EXCEEDED,"Request time out"));break;case ht.HTTP_ERROR:const r=a.getStatus();if(St(Uo,`RPC '${e}' ${i} failed with status:`,r,"response text:",a.getResponseText()),r>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Pt).indexOf(t)>=0?t:Pt.UNKNOWN}(t.status);o(new xt(e,t.message))}else o(new xt(Pt.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new xt(Pt.UNAVAILABLE,"Connection failed."));break;default:Ct(9055,{c_:e,streamId:i,l_:a.getLastErrorCode(),h_:a.getLastError()})}}finally{St(Uo,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(n);St(Uo,`RPC '${e}' ${i} sending request:`,n),a.send(t,"POST",c,r,15)})}P_(e,t,r){const n=xo(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=gt(),o=pt(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.zo(a.initMessageHeaders,t,r),a.encodeInitMessageHeaders=!0;const u=s.join("");St(Uo,`Creating RPC '${e}' stream ${n}: ${u}`,a);const l=i.createWebChannel(u,a);this.T_(l);let h=!1,d=!1;const f=new Mo({Ho:t=>{d?St(Uo,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(h||(St(Uo,`Opening RPC '${e}' stream ${n} transport.`),l.open(),h=!0),St(Uo,`RPC '${e}' stream ${n} sending:`,t),l.send(t))},Yo:()=>l.close()}),p=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(l,ut.EventType.OPEN,()=>{d||(St(Uo,`RPC '${e}' stream ${n} transport opened.`),f.s_())}),p(l,ut.EventType.CLOSE,()=>{d||(d=!0,St(Uo,`RPC '${e}' stream ${n} transport closed`),f.__(),this.I_(l))}),p(l,ut.EventType.ERROR,t=>{d||(d=!0,kt(Uo,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),f.__(new xt(Pt.UNAVAILABLE,"The operation could not be completed")))}),p(l,ut.EventType.MESSAGE,t=>{var r;if(!d){const s=t.data[0];Rt(!!s,16349);const i=s,o=(null==i?void 0:i.error)||(null===(r=i[0])||void 0===r?void 0:r.error);if(o){St(Uo,`RPC '${e}' stream ${n} received error:`,o);const t=o.status;let r=function(e){const t=Zs[e];if(void 0!==t)return ti(t)}(t),s=o.message;void 0===r&&(r=Pt.INTERNAL,s="Unknown error status: "+t+" with message "+o.message),d=!0,f.__(new xt(r,s)),l.close()}else St(Uo,`RPC '${e}' stream ${n} received:`,s),f.a_(s)}}),p(o,ft.STAT_EVENT,t=>{t.stat===dt.PROXY?St(Uo,`RPC '${e}' stream ${n} detected buffering proxy`):t.stat===dt.NOPROXY&&St(Uo,`RPC '${e}' stream ${n} detected no buffering proxy`)}),setTimeout(()=>{f.o_()},0),f}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}}function Fo(){return"undefined"!=typeof document?document:null}function Vo(e){return new wi(e,!0)}class Bo{constructor(e,t,r=1e3,n=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=n,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),n=Math.max(0,t-r);n>0&&St("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,n,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){null!==this.V_&&(this.V_.skipDelay(),this.V_=null)}cancel(){null!==this.V_&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}const qo="PersistentStream";class Ko{constructor(e,t,r,n,s,i,o,a){this.Fi=e,this.w_=r,this.S_=n,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Bo(e,t)}M_(){return 1===this.state||5===this.state||this.x_()}x_(){return 2===this.state||3===this.state}start(){this.C_=0,4!==this.state?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&null===this.D_&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,4!==e?this.F_.reset():t&&t.code===Pt.RESOURCE_EXHAUSTED?(It(t.toString()),It("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===Pt.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(t)}U_(){}auth(){this.state=1;const e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.b_===t&&this.W_(e,r)},t=>{e(()=>{const e=new xt(Pt.UNKNOWN,"Fetching auth token failed: "+t.message);return this.G_(e)})})}W_(e,t){const r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(e=>{r(()=>this.G_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.C_?this.j_(e):this.onNext(e))})}O_(){this.state=5,this.F_.g_(async()=>{this.state=0,this.start()})}G_(e){return St(qo,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(St(qo,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Ho extends Ko{constructor(e,t,r,n,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,i),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();const t=function(e,t){let r;if("targetChange"in t){t.targetChange;const n=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Ct(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(e,t){return e.useProto3Json?(Rt(void 0===t||"string"==typeof t,58123),zr.fromBase64String(t||"")):(Rt(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),zr.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Pt.UNKNOWN:ti(e.code);return new xt(t,e.message||"")}(o);r=new hi(n,s,i,a||null)}else if("documentChange"in t){t.documentChange;const n=t.documentChange;n.document,n.document.name,n.document.updateTime;const s=Si(e,n.document.name),i=_i(n.document.updateTime),o=n.document.createTime?_i(n.document.createTime):dr.min(),a=new Cn({mapValue:{fields:n.document.fields}}),c=On.newFoundDocument(s,i,o,a),u=n.targetIds||[],l=n.removedTargetIds||[];r=new ui(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const n=t.documentDelete;n.document;const s=Si(e,n.document),i=n.readTime?_i(n.readTime):dr.min(),o=On.newNoDocument(s,i),a=n.removedTargetIds||[];r=new ui([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const n=t.documentRemove;n.document;const s=Si(e,n.document),i=n.removedTargetIds||[];r=new ui([],i,s,null)}else{if(!("filter"in t))return Ct(11601,{At:t});{t.filter;const e=t.filter;e.targetId;const{count:n=0,unchangedNames:s}=e,i=new Xs(n,s),o=e.targetId;r=new li(o,i)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return dr.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?dr.min():t.readTime?_i(t.readTime):dr.min()}(e);return this.listener.J_(t,r)}H_(e){const t={};t.database=ki(this.serializer),t.addTarget=function(e,t){let r;const n=t.target;if(r=ts(n)?{documents:Ci(e,n)}:{query:Oi(e,n).Vt},r.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=function(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}(e,t.resumeToken);const n=bi(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(dr.min())>0){r.readTime=function(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}(e,t.snapshotVersion.toTimestamp());const n=bi(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);const r=function(e,t){const r=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ct(28987,{purpose:e})}}(t.purpose);return null==r?null:{"goog-listen-tags":r}}(this.serializer,e);r&&(t.labels=r),this.k_(t)}Y_(e){const t={};t.database=ki(this.serializer),t.removeTarget=e,this.k_(t)}}class zo{}class Go extends zo{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ra=!1}ia(){if(this.ra)throw new xt(Pt.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,n){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.connection.Wo(e,Ei(t,r),n,s,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Pt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new xt(Pt.UNKNOWN,e.toString())})}Jo(e,t,r,n,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Jo(e,Ei(t,r),n,i,o,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Pt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new xt(Pt.UNKNOWN,e.toString())})}terminate(){this.ra=!0,this.connection.terminate()}}class Wo{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){0===this.sa&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){"Online"===this.state?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,"Online"===e&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(It(t),this._a=!1):St("OnlineStateTracker",t)}ha(){null!==this.oa&&(this.oa.cancel(),this.oa=null)}}const Jo="RemoteStore";class Yo{constructor(e,t,r,n,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(e=>{r.enqueueAndForget(async()=>{ia(this)&&(St(Jo,"Restarting streams for network reachability change."),await async function(e){const t=Nt(e);t.Ia.add(4),await Xo(t),t.Aa.set("Unknown"),t.Ia.delete(4),await Qo(t)}(this))})}),this.Aa=new Wo(r,n)}}async function Qo(e){if(ia(e))for(const t of e.da)await t(!0)}async function Xo(e){for(const t of e.da)await t(!1)}function Zo(e,t){const r=Nt(e);r.Ta.has(t.targetId)||(r.Ta.set(t.targetId,t),sa(r)?na(r):fa(r).x_()&&ta(r,t))}function ea(e,t){const r=Nt(e),n=fa(r);r.Ta.delete(t),n.x_()&&ra(r,t),0===r.Ta.size&&(n.x_()?n.B_():ia(r)&&r.Aa.set("Unknown"))}function ta(e,t){if(e.Ra.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(dr.min())>0){const r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}fa(e).H_(t)}function ra(e,t){e.Ra.$e(t),fa(e).Y_(t)}function na(e){e.Ra=new fi({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.Ta.get(t)||null,lt:()=>e.datastore.serializer.databaseId}),fa(e).start(),e.Aa.aa()}function sa(e){return ia(e)&&!fa(e).M_()&&e.Ta.size>0}function ia(e){return 0===Nt(e).Ia.size}function oa(e){e.Ra=void 0}async function aa(e){e.Aa.set("Online")}async function ca(e){e.Ta.forEach((t,r)=>{ta(e,t)})}async function ua(e,t){oa(e),sa(e)?(e.Aa.la(t),na(e)):e.Aa.set("Unknown")}async function la(e,t,r){if(e.Aa.set("Online"),t instanceof hi&&2===t.state&&t.cause)try{await async function(e,t){const r=t.cause;for(const n of t.targetIds)e.Ta.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ta.delete(n),e.Ra.removeTarget(n))}(e,t)}catch(r){St(Jo,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await ha(e,r)}else if(t instanceof ui?e.Ra.Ye(t):t instanceof li?e.Ra.it(t):e.Ra.et(t),!r.isEqual(dr.min()))try{const t=await So(e.localStore);r.compareTo(t)>=0&&await function(e,t){const r=e.Ra.Pt(t);return r.targetChanges.forEach((r,n)=>{if(r.resumeToken.approximateByteSize()>0){const s=e.Ta.get(n);s&&e.Ta.set(n,s.withResumeToken(r.resumeToken,t))}}),r.targetMismatches.forEach((t,r)=>{const n=e.Ta.get(t);if(!n)return;e.Ta.set(t,n.withResumeToken(zr.EMPTY_BYTE_STRING,n.snapshotVersion)),ra(e,t);const s=new $i(n.target,t,r,n.sequenceNumber);ta(e,s)}),e.remoteSyncer.applyRemoteEvent(r)}(e,r)}catch(t){St(Jo,"Failed to raise snapshot:",t),await ha(e,t)}}async function ha(e,t,r){if(!wr(t))throw t;e.Ia.add(1),await Xo(e),e.Aa.set("Offline"),r||(r=()=>So(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{St(Jo,"Retrying IndexedDB access"),await r(),e.Ia.delete(1),await Qo(e)})}async function da(e,t){const r=Nt(e);r.asyncQueue.verifyOperationInProgress(),St(Jo,"RemoteStore received new credentials");const n=ia(r);r.Ia.add(3),await Xo(r),n&&r.Aa.set("Unknown"),await r.remoteSyncer.handleCredentialChange(t),r.Ia.delete(3),await Qo(r)}function fa(e){return e.Va||(e.Va=function(e,t,r){const n=Nt(e);return n.ia(),new Ho(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}(e.datastore,e.asyncQueue,{Zo:aa.bind(null,e),e_:ca.bind(null,e),n_:ua.bind(null,e),J_:la.bind(null,e)}),e.da.push(async t=>{t?(e.Va.N_(),sa(e)?na(e):e.Aa.set("Unknown")):(await e.Va.stop(),oa(e))})),e.Va}class pa{constructor(e,t,r,n,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=s,this.deferred=new Dt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,s){const i=Date.now()+r,o=new pa(e,t,i,n,s);return o.start(r),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new xt(Pt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ga(e,t){if(It("AsyncQueue",`${t}: ${e}`),wr(e))return new xt(Pt.UNAVAILABLE,`${t}: ${e}`);throw e}class ma{static emptySet(e){return new ma(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||rr.comparator(t.key,r.key):(e,t)=>rr.comparator(e.key,t.key),this.keyedMap=vs(),this.sortedSet=new $r(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ma))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new ma;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class ya{constructor(){this.fa=new $r(rr.comparator)}track(e){const t=e.doc.key,r=this.fa.get(t);r?0!==e.type&&3===r.type?this.fa=this.fa.insert(t,e):3===e.type&&1!==r.type?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.fa=this.fa.remove(t):1===e.type&&2===r.type?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):Ct(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){const e=[];return this.fa.inorderTraversal((t,r)=>{e.push(r)}),e}}class va{constructor(e,t,r,n,s,i,o,a,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,n,s){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new va(e,t,ma.emptySet(t),i,r,n,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&cs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class wa{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}}class ba{constructor(){this.queries=_a(),this.onlineState="Unknown",this.Da=new Set}terminate(){!function(e,t){const r=Nt(e),n=r.queries;r.queries=_a(),n.forEach((e,r)=>{for(const e of r.wa)e.onError(t)})}(this,new xt(Pt.ABORTED,"Firestore shutting down"))}}function _a(){return new ps(e=>us(e),cs)}async function Ea(e,t){const r=Nt(e);let n=3;const s=t.query;let i=r.queries.get(s);i?!i.Sa()&&t.ba()&&(n=2):(i=new wa,n=t.ba()?0:1);try{switch(n){case 0:i.ya=await r.onListen(s,!0);break;case 1:i.ya=await r.onListen(s,!1);break;case 2:await r.onFirstRemoteStoreListen(s)}}catch(e){const r=ga(e,`Initialization of query '${ls(t.query)}' failed`);return void t.onError(r)}r.queries.set(s,i),i.wa.push(t),t.va(r.onlineState),i.ya&&t.Ca(i.ya)&&ka(r)}async function Ta(e,t){const r=Nt(e),n=t.query;let s=3;const i=r.queries.get(n);if(i){const e=i.wa.indexOf(t);e>=0&&(i.wa.splice(e,1),0===i.wa.length?s=t.ba()?0:1:!i.Sa()&&t.ba()&&(s=2))}switch(s){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}function Sa(e,t){const r=Nt(e);let n=!1;for(const e of t){const t=e.query,s=r.queries.get(t);if(s){for(const t of s.wa)t.Ca(e)&&(n=!0);s.ya=e}}n&&ka(r)}function Ia(e,t,r){const n=Nt(e),s=n.queries.get(t);if(s)for(const e of s.wa)e.onError(r);n.queries.delete(t)}function ka(e){e.Da.forEach(e=>{e.next()})}var Aa,Ca;(Ca=Aa||(Aa={})).Fa="default",Ca.Cache="cache";class Oa{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){const t=[];for(const r of e.docChanges)3!==r.type&&t.push(r);e=new va(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache)return!0;if(!this.ba())return!0;const r="Offline"!==t;return(!this.options.ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Na(e){if(e.docChanges.length>0)return!0;const t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}La(e){e=va.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==Aa.Cache}}class Ra{constructor(e){this.key=e}}class Na{constructor(e){this.key=e}}class Pa{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=Ss(),this.mutatedKeys=Ss(),this.Xa=ds(e),this.eu=new ma(this.Xa)}get tu(){return this.Ha}nu(e,t){const r=t?t.ru:new ya,n=t?t.eu:this.eu;let s=t?t.mutatedKeys:this.mutatedKeys,i=n,o=!1;const a="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,c="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{const u=n.get(e),l=hs(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(r.track({type:3,doc:l}),f=!0):this.iu(u,l)||(r.track({type:2,doc:l}),f=!0,(a&&this.Xa(l,a)>0||c&&this.Xa(l,c)<0)&&(o=!0)):!u&&l?(r.track({type:0,doc:l}),f=!0):u&&!l&&(r.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(i=i.add(l),s=d?s.add(e):s.delete(e)):(i=i.delete(e),s=s.delete(e)))}),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),s=s.delete(e.key),r.track({type:1,doc:e})}return{eu:i,ru:r,Ds:o,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){const s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;const i=e.ru.pa();i.sort((e,t)=>function(e,t){const r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ct(20277,{At:e})}};return r(e)-r(t)}(e.type,t.type)||this.Xa(e.doc,t.doc)),this.su(r),n=null!=n&&n;const o=t&&!n?this.ou():[],a=0===this.Za.size&&this.current&&!n?1:0,c=a!==this.Ya;return this.Ya=a,0!==i.length||c?{snapshot:new va(this.query,e.eu,s,i,e.mutatedKeys,0===a,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:o}:{_u:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({eu:this.eu,ru:new ya,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=e.current)}ou(){if(!this.current)return[];const e=this.Za;this.Za=Ss(),this.eu.forEach(e=>{this.au(e.key)&&(this.Za=this.Za.add(e.key))});const t=[];return e.forEach(e=>{this.Za.has(e)||t.push(new Na(e))}),this.Za.forEach(r=>{e.has(r)||t.push(new Ra(r))}),t}uu(e){this.Ha=e.qs,this.Za=Ss();const t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return va.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,0===this.Ya,this.hasCachedResults)}}const xa="SyncEngine";class Da{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class La{constructor(e){this.key=e,this.lu=!1}}class ja{constructor(e,t,r,n,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.hu={},this.Pu=new ps(e=>us(e),cs),this.Tu=new Map,this.Iu=new Set,this.du=new $r(rr.comparator),this.Eu=new Map,this.Au=new ao,this.Ru={},this.Vu=new Map,this.mu=Wi.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return!0===this.fu}}async function Ma(e,t,r=!0){const n=Za(e);let s;const i=n.Pu.get(t);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.cu()):s=await $a(n,t,r,!0),s}async function Ua(e,t){const r=Za(e);await $a(r,t,!0,!1)}async function $a(e,t,r,n){const s=await function(e,t){const r=Nt(e);return r.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return r.hi.getTargetData(e,t).next(s=>s?(n=s,vr.resolve(n)):r.hi.allocateTargetId(e).next(s=>(n=new $i(t,s,"TargetPurposeListen",e.currentSequenceNumber),r.hi.addTargetData(e,n).next(()=>n))))}).then(e=>{const n=r.Fs.get(e.targetId);return(null===n||e.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(r.Fs=r.Fs.insert(e.targetId,e),r.Ms.set(t,e.targetId)),e})}(e.localStore,os(t)),i=s.targetId,o=e.sharedClientState.addLocalQueryTarget(i,r);let a;return n&&(a=await async function(e,t,r,n,s){e.gu=(t,r,n)=>async function(e,t,r,n){let s=t.view.nu(r);s.Ds&&(s=await ko(e.localStore,t.query,!1).then(({documents:e})=>t.view.nu(e,s)));const i=n&&n.targetChanges.get(t.targetId),o=n&&null!=n.targetMismatches.get(t.targetId),a=t.view.applyChanges(s,e.isPrimaryClient,i,o);return Ga(e,t.targetId,a._u),a.snapshot}(e,t,r,n);const i=await ko(e.localStore,t,!0),o=new Pa(t,i.qs),a=o.nu(i.documents),c=ci.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,s),u=o.applyChanges(a,e.isPrimaryClient,c);Ga(e,r,u._u);const l=new Da(t,r,o);return e.Pu.set(t,l),e.Tu.has(r)?e.Tu.get(r).push(t):e.Tu.set(r,[t]),u.snapshot}(e,t,i,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&Zo(e.remoteStore,s),a}async function Fa(e,t,r){const n=Nt(e),s=n.Pu.get(t),i=n.Tu.get(s.targetId);if(i.length>1)return n.Tu.set(s.targetId,i.filter(e=>!cs(e,t))),void n.Pu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Io(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),r&&ea(n.remoteStore,s.targetId),Ha(n,s.targetId)}).catch(yr)):(Ha(n,s.targetId),await Io(n.localStore,s.targetId,!0))}async function Va(e,t){const r=Nt(e),n=r.Pu.get(t),s=r.Tu.get(n.targetId);r.isPrimaryClient&&1===s.length&&(r.sharedClientState.removeLocalQueryTarget(n.targetId),ea(r.remoteStore,n.targetId))}async function Ba(e,t){const r=Nt(e);try{const e=await function(e,t){const r=Nt(e),n=t.snapshotVersion;let s=r.Fs;return r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const i=r.Os.newChangeBuffer({trackRemovals:!0});s=r.Fs;const o=[];t.targetChanges.forEach((i,a)=>{const c=s.get(a);if(!c)return;o.push(r.hi.removeMatchingKeys(e,i.removedDocuments,a).next(()=>r.hi.addMatchingKeys(e,i.addedDocuments,a)));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(zr.EMPTY_BYTE_STRING,dr.min()).withLastLimboFreeSnapshotVersion(dr.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,n)),s=s.insert(a,u),function(e,t,r){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size>0}(c,u,i)&&o.push(r.hi.updateTargetData(e,u))});let a=ms(),c=Ss();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&o.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),o.push(function(e,t,r){let n=Ss(),s=Ss();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=ms();return r.forEach((r,i)=>{const o=e.get(r);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(r)),i.isNoDocument()&&i.version.isEqual(dr.min())?(t.removeEntry(r,i.readTime),n=n.insert(r,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(i),n=n.insert(r,i)):St(_o,"Ignoring outdated watch update for ",r,". Current version:",o.version," Watch version:",i.version)}),{Ls:n,ks:s}})}(e,i,t.documentUpdates).next(e=>{a=e.Ls,c=e.ks})),!n.isEqual(dr.min())){const t=r.hi.getLastRemoteSnapshotVersion(e).next(t=>r.hi.setTargetsMetadata(e,e.currentSequenceNumber,n));o.push(t)}return vr.waitFor(o).next(()=>i.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,a,c)).next(()=>a)}).then(e=>(r.Fs=s,e))}(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.Eu.get(t);n&&(Rt(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?n.lu=!0:e.modifiedDocuments.size>0?Rt(n.lu,14607):e.removedDocuments.size>0&&(Rt(n.lu,42227),n.lu=!1))}),await Ya(r,e,t)}catch(e){await yr(e)}}function qa(e,t,r){const n=Nt(e);if(n.isPrimaryClient&&0===r||!n.isPrimaryClient&&1===r){const e=[];n.Pu.forEach((r,n)=>{const s=n.view.va(t);s.snapshot&&e.push(s.snapshot)}),function(e,t){const r=Nt(e);r.onlineState=t;let n=!1;r.queries.forEach((e,r)=>{for(const e of r.wa)e.va(t)&&(n=!0)}),n&&ka(r)}(n.eventManager,t),e.length&&n.hu.J_(e),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function Ka(e,t,r){const n=Nt(e);n.sharedClientState.updateQueryState(t,"rejected",r);const s=n.Eu.get(t),i=s&&s.key;if(i){let e=new $r(rr.comparator);e=e.insert(i,On.newNoDocument(i,dr.min()));const r=Ss().add(i),s=new ai(dr.min(),new Map,new $r(zt),e,r);await Ba(n,s),n.du=n.du.remove(i),n.Eu.delete(t),Ja(n)}else await Io(n.localStore,t,!1).then(()=>Ha(n,t,r)).catch(yr)}function Ha(e,t,r=null){e.sharedClientState.removeLocalQueryTarget(t);for(const n of e.Tu.get(t))e.Pu.delete(n),r&&e.hu.pu(n,r);e.Tu.delete(t),e.isPrimaryClient&&e.Au.zr(t).forEach(t=>{e.Au.containsKey(t)||za(e,t)})}function za(e,t){e.Iu.delete(t.path.canonicalString());const r=e.du.get(t);null!==r&&(ea(e.remoteStore,r),e.du=e.du.remove(t),e.Eu.delete(r),Ja(e))}function Ga(e,t,r){for(const n of r)n instanceof Ra?(e.Au.addReference(n.key,t),Wa(e,n)):n instanceof Na?(St(xa,"Document no longer in limbo: "+n.key),e.Au.removeReference(n.key,t),e.Au.containsKey(n.key)||za(e,n.key)):Ct(19791,{yu:n})}function Wa(e,t){const r=t.key,n=r.path.canonicalString();e.du.get(r)||e.Iu.has(n)||(St(xa,"New document in limbo: "+r),e.Iu.add(n),Ja(e))}function Ja(e){for(;e.Iu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Iu.values().next().value;e.Iu.delete(t);const r=new rr(Zt.fromString(t)),n=e.mu.next();e.Eu.set(n,new La(r)),e.du=e.du.insert(r,n),Zo(e.remoteStore,new $i(os(ns(r.path)),n,"TargetPurposeLimboResolution",br.ue))}}async function Ya(e,t,r){const n=Nt(e),s=[],i=[],o=[];n.Pu.isEmpty()||(n.Pu.forEach((e,a)=>{o.push(n.gu(a,t,r).then(e=>{var t;if((e||r)&&n.isPrimaryClient){const s=e?!e.fromCache:null===(t=null==r?void 0:r.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;n.sharedClientState.updateQueryState(a.targetId,s?"current":"not-current")}if(e){s.push(e);const t=vo.Es(a.targetId,e);i.push(t)}}))}),await Promise.all(o),n.hu.J_(s),await async function(e,t){const r=Nt(e);try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>vr.forEach(t,t=>vr.forEach(t.Is,n=>r.persistence.referenceDelegate.addReference(e,t.targetId,n)).next(()=>vr.forEach(t.ds,n=>r.persistence.referenceDelegate.removeReference(e,t.targetId,n)))))}catch(e){if(!wr(e))throw e;St(_o,"Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.Fs.get(t),n=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(n);r.Fs=r.Fs.insert(t,s)}}}(n.localStore,i))}async function Qa(e,t){const r=Nt(e);if(!r.currentUser.isEqual(t)){St(xa,"User change. New user:",t.toKey());const e=await To(r.localStore,t);r.currentUser=t,function(e){e.Vu.forEach(e=>{e.forEach(e=>{e.reject(new xt(Pt.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Vu.clear()}(r),r.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Ya(r,e.Bs)}}function Xa(e,t){const r=Nt(e),n=r.Eu.get(t);if(n&&n.lu)return Ss().add(n.key);{let e=Ss();const n=r.Tu.get(t);if(!n)return e;for(const t of n){const n=r.Pu.get(t);e=e.unionWith(n.view.tu)}return e}}function Za(e){const t=Nt(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ba.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Xa.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Ka.bind(null,t),t.hu.J_=Sa.bind(null,t.eventManager),t.hu.pu=Ia.bind(null,t.eventManager),t}class ec{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Vo(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,t){return null}Fu(e,t){return null}vu(e){return function(e,t,r,n){return new Eo(e,t,r,n)}(this.persistence,new bo,e.initialUser,this.serializer)}Du(e){return new po(mo.Vi,this.serializer)}bu(e){return new Co}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ec.provider={build:()=>new ec};class tc extends ec{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){Rt(this.persistence.referenceDelegate instanceof yo,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Xi(r,e.asyncQueue,t)}Du(e){const t=void 0!==this.cacheSizeBytes?Gi.withCacheSize(this.cacheSizeBytes):Gi.DEFAULT;return new po(e=>yo.Vi(e,t),this.serializer)}}class rc{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>qa(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Qa.bind(null,this.syncEngine),await async function(e,t){const r=Nt(e);t?(r.Ia.delete(2),await Qo(r)):t||(r.Ia.add(2),await Xo(r),r.Aa.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new ba}createDatastore(e){const t=Vo(e.databaseInfo.databaseId),r=function(e){return new $o(e)}(e.databaseInfo);return function(e,t,r,n){return new Go(e,t,r,n)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(e,t,r,n,s){return new Yo(e,t,r,n,s)}(this.localStore,this.datastore,e.asyncQueue,e=>qa(this.syncEngine,e,0),No.C()?new No:new Oo)}createSyncEngine(e,t){return function(e,t,r,n,s,i,o){const a=new ja(e,t,r,n,s,i);return o&&(a.fu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=Nt(e);St(Jo,"RemoteStore shutting down."),t.Ia.add(5),await Xo(t),t.Ea.shutdown(),t.Aa.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}rc.provider={build:()=>new rc};class nc{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):It("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const sc="FirestoreClient";class ic{constructor(e,t,r,n,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=bt.UNAUTHENTICATED,this.clientId=Ht.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async e=>{St(sc,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(St(sc,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Dt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=ga(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function oc(e,t){e.asyncQueue.verifyOperationInProgress(),St(sc,"Initializing OfflineComponentProvider");const r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await To(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>{kt("Terminating Firestore due to IndexedDb database deletion"),e.terminate().then(()=>{St("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(e=>{kt("Terminating Firestore due to IndexedDb database deletion failed",e)})}),e._offlineComponents=t}async function ac(e,t){e.asyncQueue.verifyOperationInProgress();const r=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){St(sc,"Using user provided OfflineComponentProvider");try{await oc(e,e._uninitializedComponentsProvider._offline)}catch(t){const r=t;if(!function(e){return"FirebaseError"===e.name?e.code===Pt.FAILED_PRECONDITION||e.code===Pt.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(r))throw r;kt("Error using user provided cache. Falling back to memory cache: "+r),await oc(e,new ec)}}else St(sc,"Using default OfflineComponentProvider"),await oc(e,new tc(void 0));return e._offlineComponents}(e);St(sc,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>da(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>da(t.remoteStore,r)),e._onlineComponents=t}async function cc(e){const t=await async function(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(St(sc,"Using user provided OnlineComponentProvider"),await ac(e,e._uninitializedComponentsProvider._online)):(St(sc,"Using default OnlineComponentProvider"),await ac(e,new rc))),e._onlineComponents}(e),r=t.eventManager;return r.onListen=Ma.bind(null,t.syncEngine),r.onUnlisten=Fa.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=Ua.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=Va.bind(null,t.syncEngine),r}function uc(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const lc=new Map,hc="firestore.googleapis.com",dc=!0;class fc{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new xt(Pt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=hc,this.ssl=dc}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:dc;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=zi;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new xt(Pt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,r,n){if(!0===t&&!0===n)throw new xt(Pt.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=uc(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new xt(Pt.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new xt(Pt.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new xt(Pt.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class pc{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new fc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new xt(Pt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new xt(Pt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new fc(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new jt;switch(e.type){case"firstParty":return new Ft(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new xt(Pt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=lc.get(e);t&&(St("ComponentProvider","Removing Datastore"),lc.delete(e),t.terminate())}(this),Promise.resolve()}}class gc{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new gc(this.firestore,e,this._query)}}class mc{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yc(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new mc(this.firestore,e,this._key)}toJSON(){return{type:mc._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(cr(t,mc._jsonSchema))return new mc(e,r||null,new rr(Zt.fromString(t.referencePath)))}}mc._jsonSchemaVersion="firestore/documentReference/1.0",mc._jsonSchema={type:ar("string",mc._jsonSchemaVersion),referencePath:ar("string")};class yc extends gc{constructor(e,t,r){super(e,t,ns(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new mc(this.firestore,null,new rr(e))}withConverter(e){return new yc(this.firestore,e,this._path)}}function vc(e,t,...r){if(e=R(e),nr("collection","path",t),e instanceof pc){const n=Zt.fromString(t,...r);return ir(n),new yc(e,null,n)}{if(!(e instanceof mc||e instanceof yc))throw new xt(Pt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Zt.fromString(t,...r));return ir(n),new yc(e.firestore,null,n)}}function wc(e,t,...r){if(e=R(e),1===arguments.length&&(t=Ht.newId()),nr("doc","path",t),e instanceof pc){const n=Zt.fromString(t,...r);return sr(n),new mc(e,null,new rr(n))}{if(!(e instanceof mc||e instanceof yc))throw new xt(Pt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Zt.fromString(t,...r));return sr(n),new mc(e.firestore,e instanceof yc?e.converter:null,new rr(n))}}const bc="AsyncQueue";class _c{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Bo(this,"async_queue_retry"),this.oc=()=>{const e=Fo();e&&St(bc,"Visibility state changed to "+e.visibilityState),this.F_.y_()},this._c=e;const t=Fo();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const t=Fo();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});const t=new Dt;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}async cc(){if(0!==this.Zu.length){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!wr(e))throw e;St(bc,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}}uc(e){const t=this._c.then(()=>(this.nc=!0,e().catch(e=>{throw this.tc=e,this.nc=!1,It("INTERNAL UNHANDLED ERROR: ",Ec(e)),e}).then(e=>(this.nc=!1,e))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);const n=pa.createAndSchedule(this,e,t,r,e=>this.lc(e));return this.ec.push(n),n}ac(){this.tc&&Ct(47125,{hc:Ec(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do{e=this._c,await e}while(e!==this._c)}Tc(e){for(const t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.ec)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){const t=this.ec.indexOf(e);this.ec.splice(t,1)}}function Ec(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function Tc(e){return function(e){if("object"!=typeof e||null===e)return!1;const t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return!0;return!1}(e)}class Sc extends pc{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new _c,this._persistenceKey=(null==n?void 0:n.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new _c(e),this._firestoreClient=void 0,await e}}}function Ic(e){if(e._terminated)throw new xt(Pt.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,r,n;const s=e._freezeSettings(),i=function(e,t,r,n){return new sn(e,t,r,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling,uc(n.experimentalLongPollingOptions),n.useFetchStreams,n.isUsingEmulator)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,s);e._componentsProvider||(null===(r=s.localCache)||void 0===r?void 0:r._offlineComponentProvider)&&(null===(n=s.localCache)||void 0===n?void 0:n._onlineComponentProvider)&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new ic(e._authCredentials,e._appCheckCredentials,e._queue,i,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class kc{constructor(e){this._byteString=e}static fromBase64String(e){try{return new kc(zr.fromBase64String(e))}catch(e){throw new xt(Pt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new kc(zr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:kc._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(cr(e,kc._jsonSchema))return kc.fromBase64String(e.bytes)}}kc._jsonSchemaVersion="firestore/bytes/1.0",kc._jsonSchema={type:ar("string",kc._jsonSchemaVersion),bytes:ar("string")};class Ac{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new xt(Pt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new tr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Cc{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new xt(Pt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new xt(Pt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return zt(this._lat,e._lat)||zt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Cc._jsonSchemaVersion}}static fromJSON(e){if(cr(e,Cc._jsonSchema))return new Cc(e.latitude,e.longitude)}}Cc._jsonSchemaVersion="firestore/geoPoint/1.0",Cc._jsonSchema={type:ar("string",Cc._jsonSchemaVersion),latitude:ar("number"),longitude:ar("number")};class Oc{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Oc._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(cr(e,Oc._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new Oc(e.vectorValues);throw new xt(Pt.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Oc._jsonSchemaVersion="firestore/vectorValue/1.0",Oc._jsonSchema={type:ar("string",Oc._jsonSchemaVersion),vectorValues:ar("object")};const Rc=new RegExp("[~\\*/\\[\\]]");function Nc(e,t,r,n,s){const i=n&&!n.isEmpty(),o=void 0!==s;let a=`Function ${t}() called with invalid data`;r&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${n}`),o&&(c+=` in document ${s}`),c+=")"),new xt(Pt.INVALID_ARGUMENT,a+e+c)}class Pc{constructor(e,t,r,n,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new mc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new xc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Dc("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class xc extends Pc{data(){return super.data()}}function Dc(e,t){return"string"==typeof t?function(e,t,r){if(t.search(Rc)>=0)throw Nc(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new Ac(...t.split("."))._internalPath}catch(n){throw Nc(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}(e,t):t instanceof Ac?t._internalPath:t._delegate._internalPath}function Lc(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new xt(Pt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class jc{convertValue(e,t="none"){switch(hn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Jr(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Yr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ct(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Ur(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){var t,r,n;const s=null===(n=null===(r=null===(t=e.fields)||void 0===t?void 0:t[ln].arrayValue)||void 0===r?void 0:r.values)||void 0===n?void 0:n.map(e=>Jr(e.doubleValue));return new Oc(s)}convertGeoPoint(e){return new Cc(Jr(e.latitude),Jr(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=rn(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(nn(e));default:return null}}convertTimestamp(e){const t=Wr(e);return new hr(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Zt.fromString(e);Rt(Ui(r),9688,{name:e});const n=new an(r.get(1),r.get(3)),s=new rr(r.popFirst(5));return n.isEqual(t)||It(`Document ${s} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}class Mc{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Uc extends Pc{constructor(e,t,r,n,s,i){super(e,t,r,n,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new $c(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Dc("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new xt(Pt.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Uc._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}Uc._jsonSchemaVersion="firestore/documentSnapshot/1.0",Uc._jsonSchema={type:ar("string",Uc._jsonSchemaVersion),bundleSource:ar("string","DocumentSnapshot"),bundleName:ar("string"),bundle:ar("string")};class $c extends Uc{data(e={}){return super.data(e)}}class Fc{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new Mc(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new $c(this._firestore,this._userDataWriter,r.key,r,new Mc(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new xt(Pt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{const n=new $c(e._firestore,e._userDataWriter,r.doc.key,r.doc,new Mc(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const n=new $c(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Mc(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,i=-1;return 0!==t.type&&(s=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(r=r.add(t.doc),i=r.indexOf(t.doc.key)),{type:Vc(t.type),doc:n,oldIndex:s,newIndex:i}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new xt(Pt.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Fc._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ht.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Vc(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ct(61501,{type:e})}}function Bc(e){e=or(e,mc);const t=or(e.firestore,Sc);return function(e,t,r={}){const n=new Dt;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,r,n,s){const i=new nc({next:a=>{i.Ou(),t.enqueueAndForget(()=>Ta(e,o));const c=a.docs.has(r);!c&&a.fromCache?s.reject(new xt(Pt.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&n&&"server"===n.source?s.reject(new xt(Pt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(a)},error:e=>s.reject(e)}),o=new Oa(ns(r.path),i,{includeMetadataChanges:!0,ka:!0});return Ea(e,o)}(await cc(e),e.asyncQueue,t,r,n)),n.promise}(Ic(t),e._key).then(r=>Hc(t,e,r))}Fc._jsonSchemaVersion="firestore/querySnapshot/1.0",Fc._jsonSchema={type:ar("string",Fc._jsonSchemaVersion),bundleSource:ar("string","QuerySnapshot"),bundleName:ar("string"),bundle:ar("string")};class qc extends jc{constructor(e){super(),this.firestore=e}convertBytes(e){return new kc(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new mc(this.firestore,null,t)}}function Kc(e){e=or(e,gc);const t=or(e.firestore,Sc),r=Ic(t),n=new qc(t);return Lc(e._query),function(e,t,r={}){const n=new Dt;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,r,n,s){const i=new nc({next:r=>{i.Ou(),t.enqueueAndForget(()=>Ta(e,o)),r.fromCache&&"server"===n.source?s.reject(new xt(Pt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(r)},error:e=>s.reject(e)}),o=new Oa(r,i,{includeMetadataChanges:!0,ka:!0});return Ea(e,o)}(await cc(e),e.asyncQueue,t,r,n)),n.promise}(r,e._query).then(r=>new Fc(t,n,e,r))}function Hc(e,t,r){const n=r.docs.get(t._key),s=new qc(e);return new Uc(e,s,t._key,n,new Mc(r.hasPendingWrites,r.fromCache),t.converter)}function zc(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]])}return r}new WeakMap,function(e,t=!0){!function(e){_t=e}(He),Fe(new N("firestore",(e,{instanceIdentifier:r,options:n})=>{const s=e.getProvider("app").getImmediate(),i=new Sc(new Ut(e.getProvider("auth-internal")),new Bt(s,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new xt(Pt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new an(e.options.projectId,t)}(s,r),s);return n=Object.assign({useFetchStreams:t},n),i._setSettings(n),i},"PUBLIC").setMultipleInstances(!0)),We(vt,wt,e),We(vt,wt,"esm2017")}(),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const Gc=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Wc=new _("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Jc=new V("@firebase/auth");function Yc(e,...t){Jc.logLevel<=j.ERROR&&Jc.error(`Auth (${He}): ${e}`,...t)}function Qc(e,...t){throw tu(e,...t)}function Xc(e,...t){return tu(e,...t)}function Zc(e,t,r){const n=Object.assign(Object.assign({},Gc()),{[t]:r});return new _("auth","Firebase",n).create(t,{appName:e.name})}function eu(e){return Zc(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function tu(e,...t){if("string"!=typeof e){const r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return Wc.create(e,...t)}function ru(e,t,...r){if(!e)throw tu(t,...r)}function nu(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Yc(t),new Error(t)}function su(e,t){e||nu(t)}function iu(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function ou(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function au(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===ou()||"https:"===ou()||function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class cu{constructor(e,t){this.shortDelay=e,this.longDelay=t,su(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return au()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function uu(e,t){su(e.emulator,"Emulator should always be set here");const{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}class lu{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void nu("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void nu("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void nu("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const hu={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},du=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],fu=new cu(3e4,6e4);function pu(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function gu(e,t,r,n,s={}){return mu(e,s,async()=>{let s={},i={};n&&("GET"===t?i=n:s={body:JSON.stringify(n)});const o=I(Object.assign({key:e.config.apiKey},i)).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:a},s);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),e.emulatorConfig&&f(e.emulatorConfig.host)&&(c.credentials="include"),lu.fetch()(await vu(e,e.config.apiHost,r,o),c)})}async function mu(e,t,r){e._canInitEmulator=!1;const n=Object.assign(Object.assign({},hu),t);try{const t=new bu(e),s=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();const i=await s.json();if("needConfirmation"in i)throw _u(e,"account-exists-with-different-credential",i);if(s.ok&&!("errorMessage"in i))return i;{const t=s.ok?i.errorMessage:i.error.message,[r,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===r)throw _u(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===r)throw _u(e,"email-already-in-use",i);if("USER_DISABLED"===r)throw _u(e,"user-disabled",i);const a=n[r]||r.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Zc(e,a,o);Qc(e,a)}}catch(t){if(t instanceof b)throw t;Qc(e,"network-request-failed",{message:String(t)})}}async function yu(e,t,r,n,s={}){const i=await gu(e,t,r,n,s);return"mfaPendingCredential"in i&&Qc(e,"multi-factor-auth-required",{_serverResponse:i}),i}async function vu(e,t,r,n){const s=`${t}${r}?${n}`,i=e,o=i.config.emulator?uu(e.config,s):`${e.config.apiScheme}://${s}`;return du.includes(r)&&(await i._persistenceManagerAvailable,"COOKIE"===i._getPersistenceType())?i._getPersistence()._getFinalTarget(o).toString():o}function wu(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class bu{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Xc(this.auth,"network-request-failed")),fu.get())})}}function _u(e,t,r){const n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);const s=Xc(e,t,n);return s.customData._tokenResponse=r,s}function Eu(e){return void 0!==e&&void 0!==e.enterprise}class Tu{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return wu(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Su(e,t){return gu(e,"GET","/v2/recaptchaConfig",pu(e,t))}async function Iu(e,t){return gu(e,"POST","/v1/accounts:lookup",t)}function ku(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Au(e){return 1e3*Number(e)}function Cu(e){const[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return Yc("JWT malformed, contained fewer than 3 sections"),null;try{const e=a(r);return e?JSON.parse(e):(Yc("Failed to decode base64 JWT payload"),null)}catch(e){return Yc("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function Ou(e){const t=Cu(e);return ru(t,"internal-error"),ru(void 0!==t.exp,"internal-error"),ru(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Ru(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof b&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class Nu{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Pu{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ku(this.lastLoginAt),this.creationTime=ku(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function xu(e){var t;const r=e.auth,n=await e.getIdToken(),s=await Ru(e,Iu(r,{idToken:n}));ru(null==s?void 0:s.users.length,r,"internal-error");const i=s.users[0];e._notifyReloadListener(i);const o=(null===(t=i.providerUserInfo)||void 0===t?void 0:t.length)?Du(i.providerUserInfo):[],a=(c=e.providerData,u=o,[...c.filter(e=>!u.some(t=>t.providerId===e.providerId)),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&i.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Pu(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(e,f)}function Du(e){return e.map(e=>{var{providerId:t}=e,r=zc(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}class Lu{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ru(e.idToken,"internal-error"),ru(void 0!==e.idToken,"internal-error"),ru(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):Ou(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ru(0!==e.length,"internal-error");const t=Ou(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(ru(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:n,expiresIn:s}=await async function(e,t){const r=await mu(e,{},async()=>{const r=I({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:s}=e.config,i=await vu(e,n,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const a={method:"POST",headers:o,body:r};return e.emulatorConfig&&f(e.emulatorConfig.host)&&(a.credentials="include"),lu.fetch()(i,a)});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}(e,t);this.updateTokensAndExpiration(r,n,Number(s))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){const{refreshToken:r,accessToken:n,expirationTime:s}=t,i=new Lu;return r&&(ru("string"==typeof r,"internal-error",{appName:e}),i.refreshToken=r),n&&(ru("string"==typeof n,"internal-error",{appName:e}),i.accessToken=n),s&&(ru("number"==typeof s,"internal-error",{appName:e}),i.expirationTime=s),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Lu,this.toJSON())}_performRefresh(){return nu("not implemented")}}function ju(e,t){ru("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Mu{constructor(e){var{uid:t,auth:r,stsTokenManager:n}=e,s=zc(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Nu(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Pu(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Ru(this,this.stsTokenManager.getToken(this.auth,e));return ru(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const r=R(e),n=await r.getIdToken(t),s=Cu(n);ru(s&&s.exp&&s.auth_time&&s.iat,r.auth,"internal-error");const i="object"==typeof s.firebase?s.firebase:void 0,o=null==i?void 0:i.sign_in_provider;return{claims:s,token:n,authTime:ku(Au(s.auth_time)),issuedAtTime:ku(Au(s.iat)),expirationTime:ku(Au(s.exp)),signInProvider:o||null,signInSecondFactor:(null==i?void 0:i.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=R(e);await xu(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(ru(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Mu(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){ru(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await xu(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Be(this.auth.app))return Promise.reject(eu(this.auth));const e=await this.getIdToken();return await Ru(this,async function(e,t){return gu(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,n,s,i,o,a,c,u;const l=null!==(r=t.displayName)&&void 0!==r?r:void 0,h=null!==(n=t.email)&&void 0!==n?n:void 0,d=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,f=null!==(i=t.photoURL)&&void 0!==i?i:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:b,providerData:_,stsTokenManager:E}=t;ru(v&&E,e,"internal-error");const T=Lu.fromJSON(this.name,E);ru("string"==typeof v,e,"internal-error"),ju(l,e.name),ju(h,e.name),ru("boolean"==typeof w,e,"internal-error"),ru("boolean"==typeof b,e,"internal-error"),ju(d,e.name),ju(f,e.name),ju(p,e.name),ju(g,e.name),ju(m,e.name),ju(y,e.name);const S=new Mu({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:b,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:m,lastLoginAt:y});return _&&Array.isArray(_)&&(S.providerData=_.map(e=>Object.assign({},e))),g&&(S._redirectEventId=g),S}static async _fromIdTokenResponse(e,t,r=!1){const n=new Lu;n.updateFromServerResponse(t);const s=new Mu({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r});return await xu(s),s}static async _fromGetAccountInfoResponse(e,t,r){const n=t.users[0];ru(void 0!==n.localId,"internal-error");const s=void 0!==n.providerUserInfo?Du(n.providerUserInfo):[],i=!(n.email&&n.passwordHash||(null==s?void 0:s.length)),o=new Lu;o.updateFromIdToken(r);const a=new Mu({uid:n.localId,auth:e,stsTokenManager:o,isAnonymous:i}),c={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:s,metadata:new Pu(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash||(null==s?void 0:s.length))};return Object.assign(a,c),a}}const Uu=new Map;function $u(e){su(e instanceof Function,"Expected a class definition");let t=Uu.get(e);return t?(su(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Uu.set(e,t),t)}class Fu{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Fu.type="NONE";const Vu=Fu;function Bu(e,t,r){return`firebase:${e}:${t}:${r}`}class qu{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:n,name:s}=this.auth;this.fullUserKey=Bu(this.userKey,n.apiKey,s),this.fullPersistenceKey=Bu("persistence",n.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await Iu(this.auth,{idToken:e}).catch(()=>{});return t?Mu._fromGetAccountInfoResponse(this.auth,t,e):null}return Mu._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new qu($u(Vu),e,r);const n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let s=n[0]||$u(Vu);const i=Bu(r,e.config.apiKey,e.name);let o=null;for(const r of t)try{const t=await r._get(i);if(t){let n;if("string"==typeof t){const r=await Iu(e,{idToken:t}).catch(()=>{});if(!r)break;n=await Mu._fromGetAccountInfoResponse(e,r,t)}else n=Mu._fromJSON(e,t);r!==s&&(o=n),s=r;break}}catch(e){}const a=n.filter(e=>e._shouldAllowMigration);return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(i,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==s)try{await e._remove(i)}catch(e){}})),new qu(s,e,r)):new qu(s,e,r)}}function Ku(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Wu(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Hu(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Yu(t))return"Blackberry";if(Qu(t))return"Webos";if(zu(t))return"Safari";if((t.includes("chrome/")||Gu(t))&&!t.includes("edge/"))return"Chrome";if(Ju(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=e.match(t);if(2===(null==r?void 0:r.length))return r[1]}return"Other"}function Hu(e=v()){return/firefox\//i.test(e)}function zu(e=v()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Gu(e=v()){return/crios\//i.test(e)}function Wu(e=v()){return/iemobile/i.test(e)}function Ju(e=v()){return/android/i.test(e)}function Yu(e=v()){return/blackberry/i.test(e)}function Qu(e=v()){return/webos/i.test(e)}function Xu(e=v()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Zu(e=v()){return Xu(e)||Ju(e)||Qu(e)||Yu(e)||/windows phone/i.test(e)||Wu(e)}function el(e,t=[]){let r;switch(e){case"Browser":r=Ku(v());break;case"Worker":r=`${Ku(v())}-${e}`;break;default:r=e}const n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${He}/${n}`}class tl{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=t=>new Promise((r,n)=>{try{r(e(t))}catch(e){n(e)}});r.onAbort=t,this.queue.push(r);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class rl{constructor(e){var t,r,n,s;const i=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=i.minPasswordLength)&&void 0!==t?t:6,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),void 0!==i.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),void 0!==i.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),void 0!==i.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),void 0!==i.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(n=null===(r=e.allowedNonAlphanumericCharacters)||void 0===r?void 0:r.join(""))&&void 0!==n?n:"",this.forceUpgradeOnSignin=null!==(s=e.forceUpgradeOnSignin)&&void 0!==s&&s,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,n,s,i,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(r=a.meetsMaxPasswordLength)||void 0===r||r),a.isValid&&(a.isValid=null===(n=a.containsLowercaseLetter)||void 0===n||n),a.isValid&&(a.isValid=null===(s=a.containsUppercaseLetter)||void 0===s||s),a.isValid&&(a.isValid=null===(i=a.containsNumericCharacter)||void 0===i||i),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class nl{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new il(this),this.idTokenSubscription=new il(this),this.beforeStateQueue=new tl(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Wc,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=$u(t)),this._initializationPromise=this.queue(async()=>{var r,n,s;if(!this._deleted&&(this.persistenceManager=await qu.create(this,e),null===(r=this._resolvePersistenceManagerAvailable)||void 0===r||r.call(this),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(s=this.currentUser)||void 0===s?void 0:s.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Iu(this,{idToken:e}),r=await Mu._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Be(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let n=r,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,i=null==n?void 0:n._redirectEventId,o=await this.tryRedirectSignIn(e);r&&r!==i||!(null==o?void 0:o.user)||(n=o.user,s=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return ru(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await xu(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Be(this.app))return Promise.reject(eu(this));const t=e?R(e):null;return t&&ru(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ru(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Be(this.app)?Promise.reject(eu(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Be(this.app)?Promise.reject(eu(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence($u(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return gu(e,"GET","/v2/passwordPolicy",pu(e,t))}(this),t=new rl(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new _("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return gu(e,"POST","/v2/accounts:revokeToken",pu(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&$u(e)||this._popupRedirectResolver;ru(t,this,"argument-error"),this.redirectPersistenceManager=await qu.create(this,[$u(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(r=this.redirectUser)||void 0===r?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,n){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t);let i=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(ru(o,this,"internal-error"),o.then(()=>{i||s(this.currentUser)}),"function"==typeof t){const s=e.addObserver(t,r,n);return()=>{i=!0,s()}}{const r=e.addObserver(t);return()=>{i=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ru(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=el(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const n=await this._getAppCheckToken();return n&&(t["X-Firebase-AppCheck"]=n),t}async _getAppCheckToken(){var e;if(Be(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){Jc.logLevel<=j.WARN&&Jc.warn(`Auth (${He}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function sl(e){return R(e)}class il{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e){const t=new C(e,void 0);return t.subscribe.bind(t)}(e=>this.observer=e)}get next(){return ru(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ol={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function al(e){return ol.loadJS(e)}function cl(e){return`__${e}${Math.floor(1e6*Math.random())}`}class ul{constructor(){this.enterprise=new ll}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class ll{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const hl="NO_RECAPTCHA";class dl{constructor(e){this.type="recaptcha-enterprise",this.auth=sl(e)}async verify(e="verify",t=!1){function r(t,r,n){const s=window.grecaptcha;Eu(s)?s.enterprise.ready(()=>{s.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(hl)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new ul).execute("siteKey",{action:"verify"}):new Promise((e,n)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{Su(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0!==n.recaptchaKey){const r=new Tu(n);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}r(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{r(e)})})})(this.auth).then(s=>{if(!t&&Eu(window.grecaptcha))r(s,e,n);else{if("undefined"==typeof window)return void n(new Error("RecaptchaVerifier is only supported in browser"));let t=ol.recaptchaEnterpriseScript;0!==t.length&&(t+=s),al(t).then(()=>{r(s,e,n)}).catch(e=>{n(e)})}}).catch(e=>{n(e)})})}}async function fl(e,t,r,n=!1,s=!1){const i=new dl(e);let o;if(s)o=hl;else try{o=await i.verify(r)}catch(e){o=await i.verify(r,!0)}const a=Object.assign({},t);if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return n?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function pl(e,t,r,n,s){var i,o;if("EMAIL_PASSWORD_PROVIDER"===s){if(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await fl(e,t,r,"getOobCode"===r);return n(e,s)}return n(e,t).catch(async s=>{if("auth/missing-recaptcha-token"===s.code){console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const s=await fl(e,t,r,"getOobCode"===r);return n(e,s)}return Promise.reject(s)})}if("PHONE_PROVIDER"===s){if(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("PHONE_PROVIDER")){const s=await fl(e,t,r);return n(e,s).catch(async s=>{var i;if("AUDIT"===(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.getProviderEnforcementState("PHONE_PROVIDER"))&&("auth/missing-recaptcha-token"===s.code||"auth/invalid-app-credential"===s.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);const s=await fl(e,t,r,!1,!0);return n(e,s)}return Promise.reject(s)})}{const s=await fl(e,t,r,!1,!0);return n(e,s)}}return Promise.reject(s+" provider is not supported.")}function gl(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function ml(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class yl{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return nu("not implemented")}_getIdTokenResponse(e){return nu("not implemented")}_linkToIdToken(e,t){return nu("not implemented")}_getReauthenticationResolver(e){return nu("not implemented")}}async function vl(e,t){return gu(e,"POST","/v1/accounts:signUp",t)}async function wl(e,t){return yu(e,"POST","/v1/accounts:signInWithPassword",pu(e,t))}class bl extends yl{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new bl(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new bl(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return pl(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",wl,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return yu(e,"POST","/v1/accounts:signInWithEmailLink",pu(e,t))}(e,{email:this._email,oobCode:this._password});default:Qc(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return pl(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",vl,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return yu(e,"POST","/v1/accounts:signInWithEmailLink",pu(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Qc(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function _l(e,t){return yu(e,"POST","/v1/accounts:signInWithIdp",pu(e,t))}class El extends yl{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new El(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Qc("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:r,signInMethod:n}=t,s=zc(t,["providerId","signInMethod"]);if(!r||!n)return null;const i=new El(r,n);return i.idToken=s.idToken||void 0,i.accessToken=s.accessToken||void 0,i.secret=s.secret,i.nonce=s.nonce,i.pendingToken=s.pendingToken||null,i}_getIdTokenResponse(e){return _l(e,this.buildRequest())}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,_l(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,_l(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=I(t)}return e}}async function Tl(e,t){return gu(e,"POST","/v1/accounts:sendVerificationCode",pu(e,t))}const Sl={USER_NOT_FOUND:"user-not-found"};class Il extends yl{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Il({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Il({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return yu(e,"POST","/v1/accounts:signInWithPhoneNumber",pu(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const r=await yu(e,"POST","/v1/accounts:signInWithPhoneNumber",pu(e,t));if(r.temporaryProof)throw _u(e,"account-exists-with-different-credential",r);return r}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return yu(e,"POST","/v1/accounts:signInWithPhoneNumber",pu(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Sl)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:n}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:n}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:s}=e;return r||t||n||s?new Il({verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:s}):null}}class kl{constructor(e){var t,r,n,s,i,o;const a=k(A(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(r=a.oobCode)&&void 0!==r?r:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(n=a.mode)&&void 0!==n?n:null);ru(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(s=a.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(i=a.lang)&&void 0!==i?i:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=k(A(e)).link,r=t?k(A(t)).deep_link_id:null,n=k(A(e)).deep_link_id;return(n?k(A(n)).link:null)||n||r||t||e}(e);try{return new kl(t)}catch(e){return null}}}class Al{constructor(){this.providerId=Al.PROVIDER_ID}static credential(e,t){return bl._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=kl.parseLink(t);return ru(r,"argument-error"),bl._fromEmailAndCode(e,r.code,r.tenantId)}}Al.PROVIDER_ID="password",Al.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Al.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Cl{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Ol extends Cl{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Rl extends Ol{constructor(){super("facebook.com")}static credential(e){return El._fromParams({providerId:Rl.PROVIDER_ID,signInMethod:Rl.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Rl.credentialFromTaggedObject(e)}static credentialFromError(e){return Rl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Rl.credential(e.oauthAccessToken)}catch(e){return null}}}Rl.FACEBOOK_SIGN_IN_METHOD="facebook.com",Rl.PROVIDER_ID="facebook.com";class Nl extends Ol{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return El._fromParams({providerId:Nl.PROVIDER_ID,signInMethod:Nl.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Nl.credentialFromTaggedObject(e)}static credentialFromError(e){return Nl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Nl.credential(t,r)}catch(e){return null}}}Nl.GOOGLE_SIGN_IN_METHOD="google.com",Nl.PROVIDER_ID="google.com";class Pl extends Ol{constructor(){super("github.com")}static credential(e){return El._fromParams({providerId:Pl.PROVIDER_ID,signInMethod:Pl.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Pl.credentialFromTaggedObject(e)}static credentialFromError(e){return Pl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Pl.credential(e.oauthAccessToken)}catch(e){return null}}}Pl.GITHUB_SIGN_IN_METHOD="github.com",Pl.PROVIDER_ID="github.com";class xl extends Ol{constructor(){super("twitter.com")}static credential(e,t){return El._fromParams({providerId:xl.PROVIDER_ID,signInMethod:xl.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return xl.credentialFromTaggedObject(e)}static credentialFromError(e){return xl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return xl.credential(t,r)}catch(e){return null}}}xl.TWITTER_SIGN_IN_METHOD="twitter.com",xl.PROVIDER_ID="twitter.com";class Dl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,n=!1){const s=await Mu._fromIdTokenResponse(e,r,n),i=Ll(r);return new Dl({user:s,providerId:i,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const n=Ll(r);return new Dl({user:e,providerId:n,_tokenResponse:r,operationType:t})}}function Ll(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class jl extends b{constructor(e,t,r,n){var s;super(t.code,t.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,jl.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,n){return new jl(e,t,r,n)}}function Ml(e,t,r,n){return("reauthenticate"===t?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(r=>{if("auth/multi-factor-auth-required"===r.code)throw jl._fromErrorAndOperation(e,r,t,n);throw r})}function Ul(e){return R(e).signOut()}function $l(e,t){return gu(e,"POST","/v2/accounts/mfaEnrollment:start",pu(e,t))}new WeakMap;const Fl="__sak";class Vl{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Fl,"1"),this.storage.removeItem(Fl),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Bl extends Vl{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Zu(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),n=this.localCache[t];r!==n&&e(t,n,r)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,r)=>{this.notifyListeners(e,r)});const r=e.key;t?this.detachListener():this.stopPolling();const n=()=>{const e=this.storage.getItem(r);(t||this.localCache[r]!==e)&&this.notifyListeners(r,e)},s=this.storage.getItem(r);!function(){const e=v();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||s===e.newValue||e.newValue===e.oldValue?n():setTimeout(n,10)}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const e of Array.from(r))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Bl.type="LOCAL";const ql=Bl;class Kl extends Vl{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Kl.type="SESSION";const Hl=Kl;class zl{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const r=new zl(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:n,data:s}=t.data,i=this.handlersMap[n];if(!(null==i?void 0:i.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:n});const o=Array.from(i).map(async e=>e(t.origin,s)),a=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}}))}(o);t.ports[0].postMessage({status:"done",eventId:r,eventType:n,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Gl(e="",t=10){let r="";for(let e=0;e<t;e++)r+=Math.floor(10*Math.random());return e+r}zl.receivers=[];class Wl{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const n="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let s,i;return new Promise((o,a)=>{const c=Gl("",20);n.port1.start();const u=setTimeout(()=>{a(new Error("unsupported_event"))},r);i={messageChannel:n,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),o(t.data.response);break;default:clearTimeout(u),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(i),n.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[n.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function Jl(){return window}function Yl(){return void 0!==Jl().WorkerGlobalScope&&"function"==typeof Jl().importScripts}const Ql="firebaseLocalStorageDb",Xl="firebaseLocalStorage",Zl="fbase_key";class eh{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function th(e,t){return e.transaction([Xl],t?"readwrite":"readonly").objectStore(Xl)}function rh(){const e=indexedDB.open(Ql,1);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(Xl,{keyPath:Zl})}catch(e){r(e)}}),e.addEventListener("success",async()=>{const r=e.result;r.objectStoreNames.contains(Xl)?t(r):(r.close(),await function(){const e=indexedDB.deleteDatabase(Ql);return new eh(e).toPromise()}(),t(await rh()))})})}async function nh(e,t,r){const n=th(e,!0).put({[Zl]:t,value:r});return new eh(n).toPromise()}function sh(e,t){const r=th(e,!0).delete(t);return new eh(r).toPromise()}class ih{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await rh()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Yl()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=zl._getInstance(Yl()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Wl(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&(null===(e=r[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=r[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await rh();return await nh(e,Fl,"1"),await sh(e,Fl),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>nh(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const r=th(e,!1).get(t),n=await new eh(r).toPromise();return void 0===n?null:n.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>sh(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=th(e,!1).getAll();return new eh(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],r=new Set;if(0!==e.length)for(const{fbase_key:n,value:s}of e)r.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(s)&&(this.notifyListeners(n,s),t.push(n));for(const e of Object.keys(this.localCache))this.localCache[e]&&!r.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const e of Array.from(r))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}ih.type="LOCAL";const oh=ih;function ah(e,t){return gu(e,"POST","/v2/accounts/mfaSignIn:start",pu(e,t))}cl("rcb"),new cu(3e4,6e4);const ch="recaptcha";async function uh(e,t,r){var n;if(!e._getRecaptchaConfig())try{await async function(e){const t=sl(e),r=await Su(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),n=new Tu(r);null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,n.isAnyProviderEnabled()&&new dl(t).verify()}(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){ru("enroll"===t.type,e,"internal-error");const n=pl(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},"mfaSmsEnrollment",async(e,t)=>t.phoneEnrollmentInfo.captchaResponse===hl?(ru((null==r?void 0:r.type)===ch,e,"argument-error"),$l(e,await lh(e,t,r))):$l(e,t),"PHONE_PROVIDER");return(await n.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{ru("signin"===t.type,e,"internal-error");const i=(null===(n=s.multiFactorHint)||void 0===n?void 0:n.uid)||s.multiFactorUid;ru(i,e,"missing-multi-factor-info");const o=pl(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},"mfaSmsSignIn",async(e,t)=>t.phoneSignInInfo.captchaResponse===hl?(ru((null==r?void 0:r.type)===ch,e,"argument-error"),ah(e,await lh(e,t,r))):ah(e,t),"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{const t=pl(e,{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"},"sendVerificationCode",async(e,t)=>t.captchaResponse===hl?(ru((null==r?void 0:r.type)===ch,e,"argument-error"),Tl(e,await lh(e,t,r))):Tl(e,t),"PHONE_PROVIDER");return(await t.catch(e=>Promise.reject(e))).sessionInfo}}finally{null==r||r._reset()}}async function lh(e,t,r){ru(r.type===ch,e,"argument-error");const n=await r.verify();ru("string"==typeof n,e,"argument-error");const s=Object.assign({},t);if("phoneEnrollmentInfo"in s){const e=s.phoneEnrollmentInfo.phoneNumber,t=s.phoneEnrollmentInfo.captchaResponse,r=s.phoneEnrollmentInfo.clientType,i=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:n,captchaResponse:t,clientType:r,recaptchaVersion:i}}),s}if("phoneSignInInfo"in s){const e=s.phoneSignInInfo.captchaResponse,t=s.phoneSignInInfo.clientType,r=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:n,captchaResponse:e,clientType:t,recaptchaVersion:r}}),s}return Object.assign(s,{recaptchaToken:n}),s}class hh{constructor(e){this.providerId=hh.PROVIDER_ID,this.auth=sl(e)}verifyPhoneNumber(e,t){return uh(this.auth,e,R(t))}static credential(e,t){return Il._fromVerification(e,t)}static credentialFromResult(e){const t=e;return hh.credentialFromTaggedObject(t)}static credentialFromError(e){return hh.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Il._fromTokenResponse(t,r):null}}hh.PROVIDER_ID="phone",hh.PHONE_SIGN_IN_METHOD="phone";class dh extends yl{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return _l(e,this._buildIdpRequest())}_linkToIdToken(e,t){return _l(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return _l(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function fh(e){return async function(e,t,r=!1){if(Be(e.app))return Promise.reject(eu(e));const n="signIn",s=await Ml(e,n,t),i=await Dl._fromIdTokenResponse(e,n,s);return r||await e._updateCurrentUser(i.user),i}(e.auth,new dh(e),e.bypassAuthState)}function ph(e){const{auth:t,user:r}=e;return ru(r,t,"internal-error"),async function(e,t,r=!1){const{auth:n}=e;if(Be(n.app))return Promise.reject(eu(n));const s="reauthenticate";try{const i=await Ru(e,Ml(n,s,t,e),r);ru(i.idToken,n,"internal-error");const o=Cu(i.idToken);ru(o,n,"internal-error");const{sub:a}=o;return ru(e.uid===a,n,"user-mismatch"),Dl._forOperation(e,s,i)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Qc(n,"user-mismatch"),e}}(r,new dh(e),e.bypassAuthState)}async function gh(e){const{auth:t,user:r}=e;return ru(r,t,"internal-error"),async function(e,t,r=!1){const n=await Ru(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return Dl._forOperation(e,"link",n)}(r,new dh(e),e.bypassAuthState)}class mh{constructor(e,t,r,n,s=!1){this.auth=e,this.resolver=r,this.user=n,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:n,tenantId:s,error:i,type:o}=e;if(i)return void this.reject(i);const a={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return fh;case"linkViaPopup":case"linkViaRedirect":return gh;case"reauthViaPopup":case"reauthViaRedirect":return ph;default:Qc(this.auth,"internal-error")}}resolve(e){su(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){su(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const yh=new cu(2e3,1e4);class vh extends mh{constructor(e,t,r,n,s){super(e,t,n,s),this.provider=r,this.authWindow=null,this.pollId=null,vh.currentPopupAction&&vh.currentPopupAction.cancel(),vh.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ru(e,this.auth,"internal-error"),e}async onExecution(){su(1===this.filter.length,"Popup operations only handle one event");const e=Gl();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Xc(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Xc(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,vh.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;(null===(r=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===r?void 0:r.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Xc(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,yh.get())};e()}}vh.currentPopupAction=null;const wh=new Map;class bh extends mh{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=wh.get(this.auth._key());if(!e){try{const t=await async function(e,t){const r=function(e){return Bu("pendingRedirect",e.config.apiKey,e.name)}(t),n=function(e){return $u(e._redirectPersistence)}(e);if(!await n._isAvailable())return!1;const s="true"===await n._get(r);return await n._remove(r),s}(this.resolver,this.auth),r=t?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}wh.set(this.auth._key(),e)}return this.bypassAuthState||wh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function _h(e,t){wh.set(e._key(),t)}async function Eh(e,t,r=!1){if(Be(e.app))return Promise.reject(eu(e));const n=sl(e),s=function(e,t){return t?$u(t):(ru(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(n,t),i=new bh(n,s,r),o=await i.execute();return o&&!r&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,t)),o}class Th{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ih(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!Ih(e)){const n=(null===(r=e.error.code)||void 0===r?void 0:r.split("auth/")[1])||"internal-error";t.onError(Xc(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Sh(e))}saveEventToCache(e){this.cachedEventUids.add(Sh(e)),this.lastProcessedEventTime=Date.now()}}function Sh(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Ih({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const kh=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ah=/^https?/;function Ch(e){const t=iu(),{protocol:r,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===n?"chrome-extension:"===r&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===r&&s.hostname===n}if(!Ah.test(r))return!1;if(kh.test(e))return n===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(n)}const Oh=new cu(3e4,6e4);function Rh(){const e=Jl().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}function Nh(e){return new Promise((t,r)=>{var n,s,i;function o(){Rh(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Rh(),r(Xc(e,"network-request-failed"))},timeout:Oh.get()})}if(null===(s=null===(n=Jl().gapi)||void 0===n?void 0:n.iframes)||void 0===s?void 0:s.Iframe)t(gapi.iframes.getContext());else{if(!(null===(i=Jl().gapi)||void 0===i?void 0:i.load)){const t=cl("iframefcb");return Jl()[t]=()=>{gapi.load?o():r(Xc(e,"network-request-failed"))},al(`${ol.gapiScript}?onload=${t}`).catch(e=>r(e))}o()}}).catch(e=>{throw Ph=null,e})}let Ph=null;const xh=new cu(5e3,15e3),Dh={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Lh=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function jh(e){const t=e.config;ru(t.authDomain,e,"auth-domain-config-required");const r=t.emulator?uu(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,n={apiKey:t.apiKey,appName:e.name,v:He},s=Lh.get(e.config.apiHost);s&&(n.eid=s);const i=e._getFrameworks();return i.length&&(n.fw=i.join(",")),`${r}?${I(n).slice(1)}`}const Mh={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Uh{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const $h=encodeURIComponent("fac");async function Fh(e,t,r,n,s,i){ru(e.config.authDomain,e,"auth-domain-config-required"),ru(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:n,v:He,eventId:s};if(t instanceof Cl){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(i||{}))o[e]=t}if(t instanceof Ol){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),u=c?`#${$h}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?uu(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${I(a).slice(1)}${u}`}const Vh="webStorageSupport",Bh=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Hl,this._completeRedirectFn=Eh,this._overrideRedirectResult=_h}async _openPopup(e,t,r,n){var s;return su(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()"),function(e,t,r,n=500,s=600){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let a="";const c=Object.assign(Object.assign({},Mh),{width:n.toString(),height:s.toString(),top:i,left:o}),u=v().toLowerCase();r&&(a=Gu(u)?"_blank":r),Hu(u)&&(t=t||"http://localhost",c.scrollbars="yes");const l=Object.entries(c).reduce((e,[t,r])=>`${e}${t}=${r},`,"");if(function(e=v()){var t;return Xu(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==a)return function(e,t){const r=document.createElement("a");r.href=e,r.target=t;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(n)}(t||"",a),new Uh(null);const h=window.open(t||"",a,l);ru(h,e,"popup-blocked");try{h.focus()}catch(e){}return new Uh(h)}(e,await Fh(e,t,r,iu(),n),Gl())}async _openRedirect(e,t,r,n){return await this._originValidation(e),s=await Fh(e,t,r,iu(),n),Jl().location.href=s,new Promise(()=>{});var s}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:r}=this.eventManagers[t];return e?Promise.resolve(e):(su(r,"If manager is not set, promise should be"),r)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return Ph=Ph||Nh(e),Ph}(e),r=Jl().gapi;return ru(r,e,"internal-error"),t.open({where:document.body,url:jh(e),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Dh,dontclear:!0},t=>new Promise(async(r,n)=>{await t.restyle({setHideOnLeave:!1});const s=Xc(e,"network-request-failed"),i=Jl().setTimeout(()=>{n(s)},xh.get());function o(){Jl().clearTimeout(i),r(t)}t.ping(o).then(o,()=>{n(s)})}))}(e),r=new Th(e);return t.register("authEvent",t=>(ru(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Vh,{type:Vh},r=>{var n;const s=null===(n=null==r?void 0:r[0])||void 0===n?void 0:n[Vh];void 0!==s&&t(!!s),Qc(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return gu(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(Ch(e))return}catch(e){}Qc(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Zu()||zu()||Xu()}};var qh="@firebase/auth",Kh="1.10.8";class Hh{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ru(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const zh=h("authIdTokenMaxAge")||300;let Gh=null;var Wh,Jh;ol={loadJS:e=>new Promise((t,r)=>{const n=document.createElement("script");var s,i;n.setAttribute("src",e),n.onload=t,n.onerror=e=>{const t=Xc("internal-error");t.customData=e,r(t)},n.type="text/javascript",n.charset="UTF-8",(null!==(i=null===(s=document.getElementsByTagName("head"))||void 0===s?void 0:s[0])&&void 0!==i?i:document).appendChild(n)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Wh="Browser",Fe(new N("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:i,authDomain:o}=r.options;ru(i&&!i.includes(":"),"invalid-api-key",{appName:r.name});const a={apiKey:i,authDomain:o,clientPlatform:Wh,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:el(Wh)},c=new nl(r,n,s,a);return function(e,t){const r=(null==t?void 0:t.persistence)||[],n=(Array.isArray(r)?r:[r]).map($u);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,null==t?void 0:t.popupRedirectResolver)}(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Fe(new N("auth-internal",e=>(e=>new Hh(e))(sl(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),We(qh,Kh,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Wh)),We(qh,Kh,"esm2017");class Yh extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Qh extends Yh{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Xh extends Yh{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Zh extends Yh{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(Jh||(Jh={}));class ed{constructor(e,{headers:t={},customFetch:r,region:n=Jh.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=(e=>e?(...t)=>e(...t):(...e)=>fetch(...e))(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return t=this,r=arguments,s=function*(e,t={}){var r;let n,s;try{const{headers:i,method:o,body:a,signal:c,timeout:u}=t;let l={},{region:h}=t;h||(h=this.region);const d=new URL(`${this.url}/${e}`);let f;h&&"any"!==h&&(l["x-region"]=h,d.searchParams.set("forceFunctionRegion",h)),a&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?"undefined"!=typeof Blob&&a instanceof Blob||a instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",f=a):"string"==typeof a?(l["Content-Type"]="text/plain",f=a):"undefined"!=typeof FormData&&a instanceof FormData?f=a:(l["Content-Type"]="application/json",f=JSON.stringify(a)):f=!a||"string"==typeof a||"undefined"!=typeof Blob&&a instanceof Blob||a instanceof ArrayBuffer||"undefined"!=typeof FormData&&a instanceof FormData?a:JSON.stringify(a);let p=c;u&&(s=new AbortController,n=setTimeout(()=>s.abort(),u),c?(p=s.signal,c.addEventListener("abort",()=>s.abort())):p=s.signal);const g=yield this.fetch(d.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),i),body:f,signal:p}).catch(e=>{throw new Qh(e)}),m=g.headers.get("x-relay-error");if(m&&"true"===m)throw new Xh(g);if(!g.ok)throw new Zh(g);let y,v=(null!==(r=g.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return y="application/json"===v?yield g.json():"application/octet-stream"===v||"application/pdf"===v?yield g.blob():"text/event-stream"===v?g:"multipart/form-data"===v?yield g.formData():yield g.text(),{data:y,error:null,response:g}}catch(e){return{data:null,error:e,response:e instanceof Zh||e instanceof Xh?e.context:void 0}}finally{n&&clearTimeout(n)}},new((n=void 0)||(n=Promise))(function(e,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n(function(e){e(r)})).then(o,a)}c((s=s.apply(t,r||[])).next())});var t,r,n,s}}var td=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},rd=class{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(r=e.isMaybeSingle)&&void 0!==r&&r,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var r=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let n=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{let t=null,n=null,s=null,i=e.status,o=e.statusText;if(e.ok){var a,c;if("HEAD"!==r.method){var u;const t=await e.text();""===t||(n="text/csv"===r.headers.get("Accept")||r.headers.get("Accept")&&(null===(u=r.headers.get("Accept"))||void 0===u?void 0:u.includes("application/vnd.pgrst.plan+text"))?t:JSON.parse(t))}const l=null===(a=r.headers.get("Prefer"))||void 0===a?void 0:a.match(/count=(exact|planned|estimated)/),h=null===(c=e.headers.get("content-range"))||void 0===c?void 0:c.split("/");l&&h&&h.length>1&&(s=parseInt(h[1])),r.isMaybeSingle&&"GET"===r.method&&Array.isArray(n)&&(n.length>1?(t={code:"PGRST116",details:`Results contain ${n.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},n=null,s=null,i=406,o="Not Acceptable"):n=1===n.length?n[0]:null)}else{var l;const s=await e.text();try{t=JSON.parse(s),Array.isArray(t)&&404===e.status&&(n=[],t=null,i=200,o="OK")}catch(r){404===e.status&&""===s?(i=204,o="No Content"):t={message:s}}if(t&&r.isMaybeSingle&&(null==t||null===(l=t.details)||void 0===l?void 0:l.includes("0 rows"))&&(t=null,i=200,o="OK"),t&&r.shouldThrowOnError)throw new td(t)}return{error:t,data:n,count:s,status:i,statusText:o}});return this.shouldThrowOnError||(n=n.catch(e=>{var t;let r="";const n=null==e?void 0:e.cause;if(n){var s,i,o,a;const t=null!==(s=null==n?void 0:n.message)&&void 0!==s?s:"",c=null!==(i=null==n?void 0:n.code)&&void 0!==i?i:"";r=`${null!==(o=null==e?void 0:e.name)&&void 0!==o?o:"FetchError"}: ${null==e?void 0:e.message}`,r+=`\n\nCaused by: ${null!==(a=null==n?void 0:n.name)&&void 0!==a?a:"Error"}: ${t}`,c&&(r+=` (${c})`),(null==n?void 0:n.stack)&&(r+=`\n${n.stack}`)}else{var c;r=null!==(c=null==e?void 0:e.stack)&&void 0!==c?c:""}return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:r,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}},nd=class extends rd{select(e){let t=!1;const r=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:n,referencedTable:s=n}={}){const i=s?`${s}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const n=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:n=r}={}){const s=void 0===n?"offset":`${n}.offset`,i=void 0===n?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:s=!1,format:i="text"}={}){var o;const a=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,s?"wal":null].filter(Boolean).join("|"),c=null!==(o=this.headers.get("Accept"))&&void 0!==o?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${c}"; options=${a};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};const sd=new RegExp("[,()]");var id=class extends nd{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(e=>"string"==typeof e&&sd.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}notIn(e,t){const r=Array.from(new Set(t)).map(e=>"string"==typeof e&&sd.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`not.in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:n}={}){let s="";"plain"===n?s="pl":"phrase"===n?s="ph":"websearch"===n&&(s="w");const i=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${s}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}},od=class{constructor(e,{headers:t={},schema:r,fetch:n}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=n}select(e,t){const{head:r=!1,count:n}=null!=t?t:{},s=r?"HEAD":"GET";let i=!1;const o=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!i?"":('"'===e&&(i=!i),e)).join("");return this.url.searchParams.set("select",o),n&&this.headers.append("Prefer",`count=${n}`),new id({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:r=!0}={}){var n;if(t&&this.headers.append("Prefer",`count=${t}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new id({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:s=!0}={}){var i;if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),void 0!==t&&this.url.searchParams.set("on_conflict",t),n&&this.headers.append("Prefer",`count=${n}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new id({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}update(e,{count:t}={}){var r;return t&&this.headers.append("Prefer",`count=${t}`),new id({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}delete({count:e}={}){var t;return e&&this.headers.append("Prefer",`count=${e}`),new id({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}},ad=class e{constructor(e,{headers:t={},schema:r,fetch:n}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.fetch=n}from(e){if(!e||"string"!=typeof e||""===e.trim())throw new Error("Invalid relation name: relation must be a non-empty string.");return new od(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:n=!1,count:s}={}){var i;let o;const a=new URL(`${this.url}/rpc/${e}`);let c;const u=e=>null!==e&&"object"==typeof e&&(!Array.isArray(e)||e.some(u)),l=r&&Object.values(t).some(u);l?(o="POST",c=t):r||n?(o=r?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{a.searchParams.append(e,t)})):(o="POST",c=t);const h=new Headers(this.headers);return l?h.set("Prefer",s?`count=${s},return=minimal`:"return=minimal"):s&&h.set("Prefer",`count=${s}`),new id({method:o,url:a,headers:h,schema:this.schemaName,body:c,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}};const cd=class{constructor(){}static detectEnvironment(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if(void 0!==r.g&&void 0!==r.g.WebSocket)return{type:"native",constructor:r.g.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const t=globalThis.process;if(t){const e=t.versions;if(e&&e.node){const t=e.node,r=parseInt(t.replace(/^v/,"").split(".")[0]);return r>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`\n\nSuggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}},ud="1.0.0",ld=ud;var hd,dd,fd,pd,gd,md,yd;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(hd||(hd={})),(yd=dd||(dd={})).closed="closed",yd.errored="errored",yd.joined="joined",yd.joining="joining",yd.leaving="leaving",function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(fd||(fd={})),function(e){e.websocket="websocket"}(pd||(pd={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(gd||(gd={}));class vd{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=null!=e?e:[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&"string"==typeof e.payload.event)return t(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer(null===(t=e.payload)||void 0===t?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,r;const n=null!==(r=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==r?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,n)}_encodeJsonUserBroadcastPush(e){var t,r;const n=null!==(r=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==r?r:{},s=(new TextEncoder).encode(JSON.stringify(n)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,s)}_encodeUserBroadcastPush(e,t,r){var n,s;const i=e.topic,o=null!==(n=e.ref)&&void 0!==n?n:"",a=null!==(s=e.join_ref)&&void 0!==s?s:"",c=e.payload.event,u=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},l=0===Object.keys(u).length?"":JSON.stringify(u);if(a.length>255)throw new Error(`joinRef length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`ref length ${o.length} exceeds maximum of 255`);if(i.length>255)throw new Error(`topic length ${i.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`userEvent length ${c.length} exceeds maximum of 255`);if(l.length>255)throw new Error(`metadata length ${l.length} exceeds maximum of 255`);const h=this.USER_BROADCAST_PUSH_META_LENGTH+a.length+o.length+i.length+c.length+l.length,d=new ArrayBuffer(this.HEADER_LENGTH+h);let f=new DataView(d),p=0;f.setUint8(p++,this.KINDS.userBroadcastPush),f.setUint8(p++,a.length),f.setUint8(p++,o.length),f.setUint8(p++,i.length),f.setUint8(p++,c.length),f.setUint8(p++,l.length),f.setUint8(p++,t),Array.from(a,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(o,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(i,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(c,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(l,e=>f.setUint8(p++,e.charCodeAt(0)));var g=new Uint8Array(d.byteLength+r.byteLength);return g.set(new Uint8Array(d),0),g.set(new Uint8Array(r),d.byteLength),g.buffer}decode(e,t){if(this._isArrayBuffer(e))return t(this._binaryDecode(e));if("string"==typeof e){const r=JSON.parse(e),[n,s,i,o,a]=r;return t({join_ref:n,ref:s,topic:i,event:o,payload:a})}return t({})}_binaryDecode(e){const t=new DataView(e),r=t.getUint8(0),n=new TextDecoder;if(r===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,t,n)}_decodeUserBroadcast(e,t,r){const n=t.getUint8(1),s=t.getUint8(2),i=t.getUint8(3),o=t.getUint8(4);let a=this.HEADER_LENGTH+4;const c=r.decode(e.slice(a,a+n));a+=n;const u=r.decode(e.slice(a,a+s));a+=s;const l=r.decode(e.slice(a,a+i));a+=i;const h=e.slice(a,e.byteLength),d=o===this.JSON_ENCODING?JSON.parse(r.decode(h)):h,f={type:this.BROADCAST_EVENT,event:u,payload:d};return i>0&&(f.meta=JSON.parse(l)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:f}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||"ArrayBuffer"===(null===(t=null==e?void 0:e.constructor)||void 0===t?void 0:t.name)}_pick(e,t){return e&&"object"==typeof e?Object.fromEntries(Object.entries(e).filter(([e])=>t.includes(e))):{}}}class wd{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(md||(md={}));const bd=(e,t,r={})=>{var n;const s=null!==(n=r.skipTypes)&&void 0!==n?n:[];return t?Object.keys(t).reduce((r,n)=>(r[n]=_d(n,e,t,s),r),{}):{}},_d=(e,t,r,n)=>{const s=t.find(t=>t.name===e),i=null==s?void 0:s.type,o=r[e];return i&&!n.includes(i)?Ed(i,o):Td(o)},Ed=(e,t)=>{if("_"===e.charAt(0)){const r=e.slice(1,e.length);return Ad(t,r)}switch(e){case md.bool:return Sd(t);case md.float4:case md.float8:case md.int2:case md.int4:case md.int8:case md.numeric:case md.oid:return Id(t);case md.json:case md.jsonb:return kd(t);case md.timestamp:return Cd(t);case md.abstime:case md.date:case md.daterange:case md.int4range:case md.int8range:case md.money:case md.reltime:case md.text:case md.time:case md.timestamptz:case md.timetz:case md.tsrange:case md.tstzrange:default:return Td(t)}},Td=e=>e,Sd=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Id=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},kd=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}return e},Ad=(e,t)=>{if("string"!=typeof e)return e;const r=e.length-1,n=e[r];if("{"===e[0]&&"}"===n){let n;const s=e.slice(1,r);try{n=JSON.parse("["+s+"]")}catch(e){n=s?s.split(","):[]}return n.map(e=>Ed(t,e))}return e},Cd=e=>"string"==typeof e?e.replace(" ","T"):e,Od=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===t.pathname||"/"===t.pathname?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class Rd{constructor(e,t,r={},n=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Nd,Pd,xd,Dd;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(Nd||(Nd={}));class Ld{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{const{onJoin:t,onLeave:r,onSync:n}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ld.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=Ld.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],n()}),this.channel._on(r.diff,{},e=>{const{onJoin:t,onLeave:r,onSync:n}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=Ld.syncDiff(this.state,e,t,r),n())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const s=this.cloneDeep(e),i=this.transformState(t),o={},a={};return this.map(s,(e,t)=>{i[e]||(a[e]=t)}),this.map(i,(e,t)=>{const r=s[e];if(r){const n=t.map(e=>e.presence_ref),s=r.map(e=>e.presence_ref),i=t.filter(e=>s.indexOf(e.presence_ref)<0),c=r.filter(e=>n.indexOf(e.presence_ref)<0);i.length>0&&(o[e]=i),c.length>0&&(a[e]=c)}else o[e]=t}),this.syncDiff(s,{joins:o,leaves:a},r,n)}static syncDiff(e,t,r,n){const{joins:s,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(s,(t,n)=>{var s;const i=null!==(s=e[t])&&void 0!==s?s:[];if(e[t]=this.cloneDeep(n),i.length>0){const r=e[t].map(e=>e.presence_ref),n=i.filter(e=>r.indexOf(e.presence_ref)<0);e[t].unshift(...n)}r(t,i,n)}),this.map(i,(t,r)=>{let s=e[t];if(!s)return;const i=r.map(e=>e.presence_ref);s=s.filter(e=>i.indexOf(e.presence_ref)<0),e[t]=s,n(t,s,r),0===s.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return t[r]="metas"in n?n.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(Pd||(Pd={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(xd||(xd={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(Dd||(Dd={}));class jd{constructor(e,t={config:{}},r){var n,s;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=dd.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Rd(this,fd.join,this.params,this.timeout),this.rejoinTimer=new wd(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=dd.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=dd.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=dd.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=dd.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=dd.errored,this.rejoinTimer.scheduleTimeout())}),this._on(fd.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new Ld(this),this.broadcastEndpointURL=Od(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(s=null===(n=this.params.config)||void 0===n?void 0:n.broadcast)||void 0===s?void 0:s.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,n,s;if(this.socket.isConnected()||this.socket.connect(),this.state==dd.closed){const{config:{broadcast:i,presence:o,private:a}}=this.params,c=null!==(n=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(e=>e.filter))&&void 0!==n?n:[],u=!!this.bindings[xd.PRESENCE]&&this.bindings[xd.PRESENCE].length>0||!0===(null===(s=this.params.config.presence)||void 0===s?void 0:s.enabled),l={},h={broadcast:i,presence:Object.assign(Object.assign({},o),{enabled:u}),postgres_changes:c,private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(Dd.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(Dd.CLOSED)),this.updateJoinPayload(Object.assign({config:h},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var r;if(this.socket._isManualToken()||this.socket.setAuth(),void 0!==t){const n=this.bindings.postgres_changes,s=null!==(r=null==n?void 0:n.length)&&void 0!==r?r:0,i=[];for(let r=0;r<s;r++){const s=n[r],{filter:{event:o,schema:a,table:c,filter:u}}=s,l=t&&t[r];if(!(l&&l.event===o&&jd.isFilterValueEqual(l.schema,a)&&jd.isFilterValueEqual(l.table,c)&&jd.isFilterValueEqual(l.filter,u)))return this.unsubscribe(),this.state=dd.errored,void(null==e||e(Dd.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));i.push(Object.assign(Object.assign({},s),{id:l.id}))}return this.bindings.postgres_changes=i,void(e&&e(Dd.SUBSCRIBED))}null==e||e(Dd.SUBSCRIBED)}).receive("error",t=>{this.state=dd.errored,null==e||e(Dd.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(Dd.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===dd.joined&&e===xd.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,r)}async httpSend(e,t,r={}){var n;if(null==t)return Promise.reject("Payload is required for httpSend()");const s={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(s.Authorization=`Bearer ${this.socket.accessTokenValue}`);const i={method:"POST",headers:s,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,i,null!==(n=r.timeout)&&void 0!==n?n:this.timeout);if(202===o.status)return{success:!0};let a=o.statusText;try{const e=await o.json();a=e.error||e.message||a}catch(e){}return Promise.reject(new Error(a))}async send(e,t={}){var r,n;if(this._canPush()||"broadcast"!==e.type)return new Promise(r=>{var n,s,i;const o=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(i=null===(s=null===(n=this.params)||void 0===n?void 0:n.config)||void 0===s?void 0:s.broadcast)||void 0===i?void 0:i.ack)||r("ok"),o.receive("ok",()=>r("ok")),o.receive("error",()=>r("error")),o.receive("timeout",()=>r("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:s,payload:i}=e,o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization=`Bearer ${this.socket.accessTokenValue}`);const a={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:i,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,a,null!==(r=t.timeout)&&void 0!==r?r:this.timeout);return await(null===(n=e.body)||void 0===n?void 0:n.cancel()),e.ok?"ok":"error"}catch(e){return"AbortError"===e.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=dd.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(fd.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new Rd(this,fd.leave,{},e),r.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{null==r||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=dd.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const n=new AbortController,s=setTimeout(()=>n.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(s),i}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Rd(this,e,t,r);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,s;const i=e.toLocaleLowerCase(),{close:o,error:a,leave:c,join:u}=fd;if(r&&[o,a,c,u].indexOf(i)>=0&&r!==this._joinRef())return;let l=this._onMessage(i,t,r);if(t&&!l)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null===(n=this.bindings.postgres_changes)||void 0===n||n.filter(e=>{var t,r,n;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(n=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===n?void 0:n.toLocaleLowerCase())===i}).map(e=>e.callback(l,r)):null===(s=this.bindings[i])||void 0===s||s.filter(e=>{var r,n,s,o,a,c;if(["broadcast","presence","postgres_changes"].includes(i)){if("id"in e){const i=e.id,o=null===(r=e.filter)||void 0===r?void 0:r.event;return i&&(null===(n=t.ids)||void 0===n?void 0:n.includes(i))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(s=t.data)||void 0===s?void 0:s.type.toLocaleLowerCase()))}{const r=null===(a=null===(o=null==e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===r||r===(null===(c=null==t?void 0:t.event)||void 0===c?void 0:c.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===i}).map(e=>{if("object"==typeof l&&"ids"in l){const e=l.data,{schema:t,table:r,commit_timestamp:n,type:s,errors:i}=e,o={schema:t,table:r,commit_timestamp:n,eventType:s,new:{},old:{},errors:i};l=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(l,r)})}_isClosed(){return this.state===dd.closed}_isJoined(){return this.state===dd.joined}_isJoining(){return this.state===dd.joining}_isLeaving(){return this.state===dd.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const n=e.toLocaleLowerCase(),s={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(s):this.bindings[n]=[s],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(e=>{var n;return!((null===(n=e.type)||void 0===n?void 0:n.toLocaleLowerCase())===r&&jd.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}static isFilterValueEqual(e,t){return(null!=e?e:void 0)===(null!=t?t:void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(fd.close,{},e)}_onError(e){this._on(fd.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=dd.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=bd(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=bd(e.columns,e.old_record)),t}}const Md=()=>{},Ud=[1e3,2e3,5e3,1e4];class $d{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.transport=null,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Md,this.ref=0,this.reconnectTimer=null,this.vsn=ld,this.logger=Md,this.conn=null,this.sendBuffer=[],this.serializer=new vd,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),!(null===(r=null==t?void 0:t.params)||void 0===r?void 0:r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${pd.websocket}`,this.httpEndpoint=Od(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=cd.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error(`${t}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},"function"==typeof this.conn.close&&(e?this.conn.close(e,null!=t?t:""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case hd.connecting:return gd.Connecting;case hd.open:return gd.Open;case hd.closing:return gd.Closing;default:return gd.Closed}}isConnected(){return this.connectionState()===gd.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){const r=`realtime:${e}`,n=this.getChannels().find(e=>e.topic===r);if(n)return n;{const r=new jd(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){const{topic:t,event:r,payload:n,ref:s}=e,i=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${r} (${s})`,n),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},100)}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event&&e.ref&&e.ref===this.pendingHeartbeatRef){const t=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error",t)}catch(e){this.log("error","error in heartbeat callback",e)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:t,event:r,payload:n,ref:s}=e,i=s?`(${s})`:"",o=n.status||"";this.log("receive",`${o} ${t} ${r} ${i}`.trim(),n),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,n,s)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===hd.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===hd.open||this.conn.readyState===hd.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this._terminateWorker()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(fd.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const r=e.match(/\?/)?"&":"?";return`${e}${r}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,r=!1;if(e)t=e,r=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(e){this.log("error","Error fetching access token from callback",e),t=this.accessTokenValue}else t=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const r={access_token:t,version:"realtime-js/2.90.0"};t&&e.updateJoinPayload(r),e.joinedOnce&&e._isJoined()&&e._push(fd.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(t){this.log("error",`error in ${e} callback`,t)}})}catch(t){this.log("error",`error triggering ${e} callbacks`,t)}}_setupReconnectionTimer(){this.reconnectTimer=new wd(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},10)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,n,s,i,o,a,c,u,l,h,d;switch(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(r=null==e?void 0:e.timeout)&&void 0!==r?r:1e4,this.heartbeatIntervalMs=null!==(n=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==n?n:25e3,this.worker=null!==(s=null==e?void 0:e.worker)&&void 0!==s&&s,this.accessToken=null!==(i=null==e?void 0:e.accessToken)&&void 0!==i?i:null,this.heartbeatCallback=null!==(o=null==e?void 0:e.heartbeatCallback)&&void 0!==o?o:Md,this.vsn=null!==(a=null==e?void 0:e.vsn)&&void 0!==a?a:ld,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(c=null==e?void 0:e.reconnectAfterMs)&&void 0!==c?c:e=>Ud[e-1]||1e4,this.vsn){case ud:this.encode=null!==(u=null==e?void 0:e.encode)&&void 0!==u?u:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(l=null==e?void 0:e.decode)&&void 0!==l?l:(e,t)=>t(JSON.parse(e));break;case"2.0.0":this.encode=null!==(h=null==e?void 0:e.encode)&&void 0!==h?h:this.serializer.encode.bind(this.serializer),this.decode=null!==(d=null==e?void 0:e.decode)&&void 0!==d?d:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}var Fd=class extends Error{constructor(e,t){super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown="CommitStateUnknownException"===t.icebergType||[500,502,504].includes(t.status)&&!0===t.icebergType?.includes("CommitState")}isNotFound(){return 404===this.status}isConflict(){return 409===this.status}isAuthenticationTimeout(){return 419===this.status}};function Vd(e){return e.join("")}var Bd=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:Vd(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(e=>({namespace:e}))}async createNamespace(e,t){const r={namespace:e.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Vd(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Vd(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Vd(e.namespace)}`}),!0}catch(e){if(e instanceof Fd&&404===e.status)return!1;throw e}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(e){if(e instanceof Fd&&409===e.status)return;throw e}}};function qd(e){return e.join("")}var Kd=class{constructor(e,t="",r){this.client=e,this.prefix=t,this.accessDelegation=r}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${qd(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${qd(e.namespace)}/tables`,body:t,headers:r})).data.metadata}async updateTable(e,t){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${qd(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${qd(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${qd(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${qd(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(e){if(e instanceof Fd&&404===e.status)return!1;throw e}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(r){if(r instanceof Fd&&409===r.status)return await this.loadTable({namespace:e.namespace,name:t.name});throw r}}},Hd=class{constructor(e){let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const r=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=function(e){const t=e.fetchImpl??globalThis.fetch;return{async request({method:r,path:n,query:s,body:i,headers:o}){const a=function(e,t,r){const n=new URL(t,e);if(r)for(const[e,t]of Object.entries(r))void 0!==t&&n.searchParams.set(e,t);return n.toString()}(e.baseUrl,n,s),c=await async function(e){return e&&"none"!==e.type?"bearer"===e.type?{Authorization:`Bearer ${e.token}`}:"header"===e.type?{[e.name]:e.value}:"custom"===e.type?await e.getHeaders():{}:{}}(e.auth),u=await t(a,{method:r,headers:{...i?{"Content-Type":"application/json"}:{},...c,...o},body:i?JSON.stringify(i):void 0}),l=await u.text(),h=(u.headers.get("content-type")||"").includes("application/json"),d=h&&l?JSON.parse(l):l;if(!u.ok){const e=h?d:void 0,t=e?.error;throw new Fd(t?.message??`Request failed with status ${u.status}`,{status:u.status,icebergType:t?.type,icebergCode:t?.code,details:e})}return{status:u.status,headers:u.headers,data:d}}}}({baseUrl:r,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=e.accessDelegation?.join(","),this.namespaceOps=new Bd(this.client,t),this.tableOps=new Kd(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},zd=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function Gd(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}var Wd=class extends zd{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Jd=class extends zd{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};const Yd=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),Qd=e=>{if(Array.isArray(e))return e.map(e=>Qd(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,r])=>{const n=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[n]=Qd(r)}),t};function Xd(e){return(Xd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zd(e,t,r){return(t=function(e){var t=function(e){if("object"!=Xd(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Xd(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Xd(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ef(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function tf(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ef(Object(r),!0).forEach(function(t){Zd(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ef(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const rf=e=>{var t;return e.msg||e.message||e.error_description||("string"==typeof e.error?e.error:null===(t=e.error)||void 0===t?void 0:t.message)||JSON.stringify(e)};async function nf(e,t,r,n,s,i){return new Promise((o,a)=>{e(r,((e,t,r,n)=>{const s={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&n?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(n)?(s.headers=tf({"Content-Type":"application/json"},null==t?void 0:t.headers),s.body=JSON.stringify(n)):s.body=n,(null==t?void 0:t.duplex)&&(s.duplex=t.duplex),tf(tf({},s),r)):s})(t,n,s,i)).then(e=>{if(!e.ok)throw e;return(null==n?void 0:n.noResolveJson)?e:e.json()}).then(e=>o(e)).catch(e=>(async(e,t,r)=>{e instanceof await Response&&!(null==r?void 0:r.noResolveJson)?e.json().then(r=>{const n=e.status||500,s=(null==r?void 0:r.statusCode)||n+"";t(new Wd(rf(r),n,s))}).catch(e=>{t(new Jd(rf(e),e))}):t(new Jd(rf(e),e))})(e,a,n))})}async function sf(e,t,r,n){return nf(e,"GET",t,r,n)}async function of(e,t,r,n,s){return nf(e,"POST",t,n,s,r)}async function af(e,t,r,n,s){return nf(e,"PUT",t,n,s,r)}async function cf(e,t,r,n,s){return nf(e,"DELETE",t,n,s,r)}var uf=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){try{return{data:(await this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}};let lf;lf=Symbol.toStringTag;var hf=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[lf]="BlobDownloadBuilder",this.promise=null}asStream(){return new uf(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){try{return{data:await(await this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}};const df={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ff={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var pf=class{constructor(e,t={},r,n){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=Yd(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(e,t,r,n){var s=this;try{let i;const o=tf(tf({},ff),n);let a=tf(tf({},s.headers),"POST"===e&&{"x-upsert":String(o.upsert)});const c=o.metadata;"undefined"!=typeof Blob&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",s.encodeMetadata(c)),i.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(i=r,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),c&&!i.has("metadata")&&i.append("metadata",s.encodeMetadata(c))):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,c&&(a["x-metadata"]=s.toBase64(s.encodeMetadata(c))),("undefined"!=typeof ReadableStream&&i instanceof ReadableStream||i&&"object"==typeof i&&"pipe"in i&&"function"==typeof i.pipe)&&!o.duplex&&(o.duplex="half")),(null==n?void 0:n.headers)&&(a=tf(tf({},a),n.headers));const u=s._removeEmptyFolders(t),l=s._getFinalPath(u),h=await("PUT"==e?af:of)(s.fetch,`${s.url}/object/${l}`,i,tf({headers:a},(null==o?void 0:o.duplex)?{duplex:o.duplex}:{}));return{data:{path:u,id:h.Id,fullPath:h.Key},error:null}}catch(e){if(s.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}async upload(e,t,r){return this.uploadOrUpdate("POST",e,t,r)}async uploadToSignedUrl(e,t,r,n){var s=this;const i=s._removeEmptyFolders(e),o=s._getFinalPath(i),a=new URL(s.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let e;const t=tf({upsert:ff.upsert},n),o=tf(tf({},s.headers),{"x-upsert":String(t.upsert)});return"undefined"!=typeof Blob&&r instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r,e.append("cacheControl",t.cacheControl)):(e=r,o["cache-control"]=`max-age=${t.cacheControl}`,o["content-type"]=t.contentType),{data:{path:i,fullPath:(await af(s.fetch,a.toString(),e,{headers:o})).Key},error:null}}catch(e){if(s.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}async createSignedUploadUrl(e,t){var r=this;try{let n=r._getFinalPath(e);const s=tf({},r.headers);(null==t?void 0:t.upsert)&&(s["x-upsert"]="true");const i=await of(r.fetch,`${r.url}/object/upload/sign/${n}`,{},{headers:s}),o=new URL(r.url+i.url),a=o.searchParams.get("token");if(!a)throw new zd("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}async update(e,t,r){return this.uploadOrUpdate("PUT",e,t,r)}async move(e,t,r){var n=this;try{return{data:await of(n.fetch,`${n.url}/object/move`,{bucketId:n.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:n.headers}),error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}async copy(e,t,r){var n=this;try{return{data:{path:(await of(n.fetch,`${n.url}/object/copy`,{bucketId:n.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:n.headers})).Key},error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}async createSignedUrl(e,t,r){var n=this;try{let s=n._getFinalPath(e),i=await of(n.fetch,`${n.url}/object/sign/${s}`,tf({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:n.headers});const o=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return i={signedUrl:encodeURI(`${n.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}async createSignedUrls(e,t,r){var n=this;try{const s=await of(n.fetch,`${n.url}/object/sign/${n.bucketId}`,{expiresIn:t,paths:e},{headers:n.headers}),i=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:s.map(e=>tf(tf({},e),{},{signedUrl:e.signedURL?encodeURI(`${n.url}${e.signedURL}${i}`):null})),error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}download(e,t){const r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",n=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),s=n?`?${n}`:"",i=this._getFinalPath(e);return new hf(()=>sf(this.fetch,`${this.url}/${r}/${i}${s}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}async info(e){var t=this;const r=t._getFinalPath(e);try{return{data:Qd(await sf(t.fetch,`${t.url}/object/info/${r}`,{headers:t.headers})),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}async exists(e){var t=this;const r=t._getFinalPath(e);try{return await async function(e,t,r){return nf(e,"HEAD",t,tf(tf({},r),{},{noResolveJson:!0}),void 0)}(t.fetch,`${t.url}/object/${r}`,{headers:t.headers}),{data:!0,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Gd(e)&&e instanceof Jd){const t=e.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:e}}throw e}}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],s=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==s&&n.push(s);const i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==o&&n.push(o);let a=n.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${r}${a}`)}}}async remove(e){var t=this;try{return{data:await cf(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:e},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}async list(e,t,r){var n=this;try{const s=tf(tf(tf({},df),t),{},{prefix:e||""});return{data:await of(n.fetch,`${n.url}/object/list/${n.bucketId}`,s,{headers:n.headers},r),error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}async listV2(e,t){var r=this;try{const n=tf({},e);return{data:await of(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,n,{headers:r.headers},t),error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};const gf="2.90.0",mf={"X-Client-Info":`storage-js/${gf}`};var yf=class{constructor(e,t={},r,n){this.shouldThrowOnError=!1;const s=new URL(e);(null==n?void 0:n.useNewHostname)&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href.replace(/\/$/,""),this.headers=tf(tf({},mf),t),this.fetch=Yd(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(e){var t=this;try{const r=t.listBucketOptionsToQueryString(e);return{data:await sf(t.fetch,`${t.url}/bucket${r}`,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}async getBucket(e){var t=this;try{return{data:await sf(t.fetch,`${t.url}/bucket/${e}`,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}async createBucket(e,t={public:!1}){var r=this;try{return{data:await of(r.fetch,`${r.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}),error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}async updateBucket(e,t){var r=this;try{return{data:await af(r.fetch,`${r.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}),error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}async emptyBucket(e){var t=this;try{return{data:await of(t.fetch,`${t.url}/bucket/${e}/empty`,{},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}async deleteBucket(e){var t=this;try{return{data:await cf(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},vf=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=tf(tf({},mf),t),this.fetch=Yd(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await of(t.fetch,`${t.url}/bucket`,{name:e},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}async listBuckets(e){var t=this;try{const r=new URLSearchParams;void 0!==(null==e?void 0:e.limit)&&r.set("limit",e.limit.toString()),void 0!==(null==e?void 0:e.offset)&&r.set("offset",e.offset.toString()),(null==e?void 0:e.sortColumn)&&r.set("sortColumn",e.sortColumn),(null==e?void 0:e.sortOrder)&&r.set("sortOrder",e.sortOrder),(null==e?void 0:e.search)&&r.set("search",e.search);const n=r.toString(),s=n?`${t.url}/bucket?${n}`:`${t.url}/bucket`;return{data:await sf(t.fetch,s,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}async deleteBucket(e){var t=this;try{return{data:await cf(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Gd(e))return{data:null,error:e};throw e}}from(e){var t=this;if(!(e=>!(!e||"string"!=typeof e)&&!(0===e.length||e.length>100)&&e.trim()===e&&!e.includes("/")&&!e.includes("\\")&&/^[\w!.\*'() &$@=;:+,?-]+$/.test(e))(e))throw new zd("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new Hd({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(r,{get(e,t){const r=e[t];return"function"!=typeof r?r:async(...t)=>{try{return{data:await r.apply(e,t),error:null}}catch(e){if(n)throw e;return{data:null,error:e}}}}})}};const wf={"X-Client-Info":`storage-js/${gf}`,"Content-Type":"application/json"};var bf=class extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function _f(e){return"object"==typeof e&&null!==e&&"__isStorageVectorsError"in e}var Ef=class extends bf{constructor(e,t,r){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Tf=class extends bf{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}};const Sf=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),If=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e);async function kf(e,t,r,n,s,i){return new Promise((o,a)=>{e(r,((e,t,r,n)=>{const s={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&n?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(n)?(s.headers=tf({"Content-Type":"application/json"},null==t?void 0:t.headers),s.body=JSON.stringify(n)):s.body=n,tf(tf({},s),r)):s})(t,n,s,i)).then(e=>{if(!e.ok)throw e;if(null==n?void 0:n.noResolveJson)return e;const t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():{}}).then(e=>o(e)).catch(e=>(async(e,t,r)=>{if(e&&"object"==typeof e&&"status"in e&&"ok"in e&&"number"==typeof e.status&&!(null==r?void 0:r.noResolveJson)){const r=e.status||500,n=e;if("function"==typeof n.json)n.json().then(e=>{const n=(null==e?void 0:e.statusCode)||(null==e?void 0:e.code)||r+"";t(new Ef(If(e),r,n))}).catch(()=>{const e=r+"";t(new Ef(n.statusText||`HTTP ${r} error`,r,e))});else{const e=r+"";t(new Ef(n.statusText||`HTTP ${r} error`,r,e))}}else t(new Tf(If(e),e))})(e,a,n))})}async function Af(e,t,r,n,s){return kf(e,"POST",t,n,s,r)}var Cf=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=tf(tf({},wf),t),this.fetch=Sf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(e){var t=this;try{return{data:await Af(t.fetch,`${t.url}/CreateIndex`,e,{headers:t.headers})||{},error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(_f(e))return{data:null,error:e};throw e}}async getIndex(e,t){var r=this;try{return{data:await Af(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers}),error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(_f(e))return{data:null,error:e};throw e}}async listIndexes(e){var t=this;try{return{data:await Af(t.fetch,`${t.url}/ListIndexes`,e,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(_f(e))return{data:null,error:e};throw e}}async deleteIndex(e,t){var r=this;try{return{data:await Af(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers})||{},error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(_f(e))return{data:null,error:e};throw e}}},Of=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=tf(tf({},wf),t),this.fetch=Sf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(e){var t=this;try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await Af(t.fetch,`${t.url}/PutVectors`,e,{headers:t.headers})||{},error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(_f(e))return{data:null,error:e};throw e}}async getVectors(e){var t=this;try{return{data:await Af(t.fetch,`${t.url}/GetVectors`,e,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(_f(e))return{data:null,error:e};throw e}}async listVectors(e){var t=this;try{if(void 0!==e.segmentCount){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(void 0!==e.segmentIndex&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error("segmentIndex must be between 0 and "+(e.segmentCount-1))}return{data:await Af(t.fetch,`${t.url}/ListVectors`,e,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(_f(e))return{data:null,error:e};throw e}}async queryVectors(e){var t=this;try{return{data:await Af(t.fetch,`${t.url}/QueryVectors`,e,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(_f(e))return{data:null,error:e};throw e}}async deleteVectors(e){var t=this;try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await Af(t.fetch,`${t.url}/DeleteVectors`,e,{headers:t.headers})||{},error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(_f(e))return{data:null,error:e};throw e}}},Rf=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=tf(tf({},wf),t),this.fetch=Sf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await Af(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(_f(e))return{data:null,error:e};throw e}}async getBucket(e){var t=this;try{return{data:await Af(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:e},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(_f(e))return{data:null,error:e};throw e}}async listBuckets(e={}){var t=this;try{return{data:await Af(t.fetch,`${t.url}/ListVectorBuckets`,e,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(_f(e))return{data:null,error:e};throw e}}async deleteBucket(e){var t=this;try{return{data:await Af(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(_f(e))return{data:null,error:e};throw e}}},Nf=class extends Rf{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new Pf(this.url,this.headers,e,this.fetch)}async createBucket(e){return(()=>super.createBucket)().call(this,e)}async getBucket(e){return(()=>super.getBucket)().call(this,e)}async listBuckets(e={}){return(()=>super.listBuckets)().call(this,e)}async deleteBucket(e){return(()=>super.deleteBucket)().call(this,e)}},Pf=class extends Cf{constructor(e,t,r,n){super(e,t,n),this.vectorBucketName=r}async createIndex(e){return(()=>super.createIndex)().call(this,tf(tf({},e),{},{vectorBucketName:this.vectorBucketName}))}async listIndexes(e={}){return(()=>super.listIndexes)().call(this,tf(tf({},e),{},{vectorBucketName:this.vectorBucketName}))}async getIndex(e){return(()=>super.getIndex)().call(this,this.vectorBucketName,e)}async deleteIndex(e){return(()=>super.deleteIndex)().call(this,this.vectorBucketName,e)}index(e){return new xf(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},xf=class extends Of{constructor(e,t,r,n,s){super(e,t,s),this.vectorBucketName=r,this.indexName=n}async putVectors(e){var t=this;return(()=>super.putVectors)().call(t,tf(tf({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async getVectors(e){var t=this;return(()=>super.getVectors)().call(t,tf(tf({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async listVectors(e={}){var t=this;return(()=>super.listVectors)().call(t,tf(tf({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async queryVectors(e){var t=this;return(()=>super.queryVectors)().call(t,tf(tf({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async deleteVectors(e){var t=this;return(()=>super.deleteVectors)().call(t,tf(tf({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}},Df=class extends yf{constructor(e,t={},r,n){super(e,t,r,n)}from(e){return new pf(this.url,this.headers,e,this.fetch)}get vectors(){return new Nf(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new vf(this.url+"/iceberg",this.headers,this.fetch)}};const Lf="2.90.0",jf=3e4,Mf={"X-Client-Info":`gotrue-js/${Lf}`},Uf="X-Supabase-Api-Version",$f=Date.parse("2024-01-01T00:00:00.0Z"),Ff="2024-01-01",Vf=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class Bf extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function qf(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Kf extends Bf{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}class Hf extends Bf{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class zf extends Bf{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class Gf extends zf{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Wf extends zf{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Jf extends zf{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Yf extends zf{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Qf extends zf{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Xf extends zf{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Zf extends zf{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ep(e){return qf(e)&&"AuthRetryableFetchError"===e.name}class tp extends zf{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class rp extends zf{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const np="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),sp=" \t\n\r=".split(""),ip=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<sp.length;t+=1)e[sp[t].charCodeAt(0)]=-2;for(let t=0;t<np.length;t+=1)e[np[t].charCodeAt(0)]=t;return e})();function op(e,t,r){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(np[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(np[e]),t.queuedBits-=6}}function ap(e,t,r){const n=ip[e];if(!(n>-1)){if(-2===n)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function cp(e){const t=[],r=e=>{t.push(String.fromCodePoint(e))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=e=>{!function(e,t,r){if(0===t.utf8seq){if(e<=127)return void r(e);for(let r=1;r<6;r+=1)if(!(e>>7-r&1)){t.utf8seq=r;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&r(t.codepoint)}}(e,n,r)};for(let t=0;t<e.length;t+=1)ap(e.charCodeAt(t),s,i);return t.join("")}function up(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function lp(e){const t=[],r={queue:0,queuedBits:0},n=e=>{t.push(e)};for(let t=0;t<e.length;t+=1)ap(e.charCodeAt(t),r,n);return new Uint8Array(t)}function hp(e){const t=[],r={queue:0,queuedBits:0},n=e=>{t.push(e)};return e.forEach(e=>op(e,r,n)),op(null,r,n),t.join("")}const dp=()=>"undefined"!=typeof window&&"undefined"!=typeof document,fp={tested:!1,writable:!1},pp=()=>{if(!dp())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(fp.tested)return fp.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),fp.tested=!0,fp.writable=!0}catch(e){fp.tested=!0,fp.writable=!1}return fp.writable},gp=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),mp=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},yp=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(e){return r}},vp=async(e,t)=>{await e.removeItem(t)};class wp{constructor(){this.promise=new wp.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function bp(e){const t=e.split(".");if(3!==t.length)throw new rp("Invalid JWT structure");for(let e=0;e<t.length;e++)if(!Vf.test(t[e]))throw new rp("JWT not in base64url format");return{header:JSON.parse(cp(t[0])),payload:JSON.parse(cp(t[1])),signature:lp(t[2]),raw:{header:t[0],payload:t[1]}}}function _p(e){return("0"+e.toString(16)).substr(-2)}async function Ep(e,t,r=!1){const n=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let r="";for(let n=0;n<56;n++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,_p).join("")}();let s=n;r&&(s+="/PASSWORD_RECOVERY"),await mp(e,`${t}-code-verifier`,s);const i=await async function(e){if("undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder)return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(n);return[i,n===i?"plain":"s256"]}wp.promiseConstructor=Promise;const Tp=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,Sp=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ip(e){if(!Sp.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function kp(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Ap(e){return JSON.parse(JSON.stringify(e))}const Cp=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Op=[502,503,504];async function Rp(e){var t,r;if(!("object"==typeof(r=e)&&null!==r&&"status"in r&&"ok"in r&&"json"in r&&"function"==typeof r.json))throw new Zf(Cp(e),0);if(Op.includes(e.status))throw new Zf(Cp(e),e.status);let n,s;try{n=await e.json()}catch(e){throw new Hf(Cp(e),e)}const i=function(e){const t=e.headers.get(Uf);if(!t)return null;if(!t.match(Tp))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(e){return null}}(e);if(i&&i.getTime()>=$f&&"object"==typeof n&&n&&"string"==typeof n.code?s=n.code:"object"==typeof n&&n&&"string"==typeof n.error_code&&(s=n.error_code),s){if("weak_password"===s)throw new tp(Cp(n),e.status,(null===(t=n.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===s)throw new Gf}else if("object"==typeof n&&n&&"object"==typeof n.weak_password&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new tp(Cp(n),e.status,n.weak_password.reasons);throw new Kf(Cp(n),e.status||500,s)}async function Np(e,t,r,n){var s;const i=Object.assign({},null==n?void 0:n.headers);i[Uf]||(i[Uf]=Ff),(null==n?void 0:n.jwt)&&(i.Authorization=`Bearer ${n.jwt}`);const o=null!==(s=null==n?void 0:n.query)&&void 0!==s?s:{};(null==n?void 0:n.redirectTo)&&(o.redirect_to=n.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await async function(e,t,r,n,s,i){const o=((e,t,r,n)=>{const s={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))})(t,n,{},i);let a;try{a=await e(r,Object.assign({},o))}catch(e){throw console.error(e),new Zf(Cp(e),0)}if(a.ok||await Rp(a),null==n?void 0:n.noResolveJson)return a;try{return await a.json()}catch(e){await Rp(e)}}(e,t,r+a,{headers:i,noResolveJson:null==n?void 0:n.noResolveJson},0,null==n?void 0:n.body);return(null==n?void 0:n.xform)?null==n?void 0:n.xform(c):{data:Object.assign({},c),error:null}}function Pp(e){var t;let r=null;var n;return function(e){return e.access_token&&e.refresh_token&&e.expires_in}(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=(n=e.expires_in,Math.round(Date.now()/1e3)+n))),{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function xp(e){const t=Pp(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function Dp(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Lp(e){return{data:e,error:null}}function jp(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:i}=e,o=zc(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:i},user:Object.assign({},o)},error:null}}function Mp(e){return e}const Up=["global","local","others"];class $p{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=gp(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Up[0]){if(Up.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Up.join(", ")}`);try{return await Np(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(e){if(qf(e))return{data:null,error:e};throw e}}async inviteUserByEmail(e,t={}){try{return await Np(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Dp})}catch(e){if(qf(e))return{data:{user:null},error:e};throw e}}async generateLink(e){try{const{options:t}=e,r=zc(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=null==r?void 0:r.newEmail,delete n.newEmail),await Np(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:jp,redirectTo:null==t?void 0:t.redirectTo})}catch(e){if(qf(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(e){try{return await Np(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Dp})}catch(e){if(qf(e))return{data:{user:null},error:e};throw e}}async listUsers(e){var t,r,n,s,i,o,a;try{const c={nextPage:null,lastPage:0,total:0},u=await Np(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(s=null===(n=null==e?void 0:e.perPage)||void 0===n?void 0:n.toString())&&void 0!==s?s:""},xform:Mp});if(u.error)throw u.error;const l=await u.json(),h=null!==(i=u.headers.get("x-total-count"))&&void 0!==i?i:0,d=null!==(a=null===(o=u.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);c[`${r}Page`]=t}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},l),c),error:null}}catch(e){if(qf(e))return{data:{users:[]},error:e};throw e}}async getUserById(e){Ip(e);try{return await Np(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Dp})}catch(e){if(qf(e))return{data:{user:null},error:e};throw e}}async updateUserById(e,t){Ip(e);try{return await Np(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Dp})}catch(e){if(qf(e))return{data:{user:null},error:e};throw e}}async deleteUser(e,t=!1){Ip(e);try{return await Np(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Dp})}catch(e){if(qf(e))return{data:{user:null},error:e};throw e}}async _listFactors(e){Ip(e.userId);try{const{data:t,error:r}=await Np(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(e){if(qf(e))return{data:null,error:e};throw e}}async _deleteFactor(e){Ip(e.userId),Ip(e.id);try{return{data:await Np(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(e){if(qf(e))return{data:null,error:e};throw e}}async _listOAuthClients(e){var t,r,n,s,i,o,a;try{const c={nextPage:null,lastPage:0,total:0},u=await Np(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(s=null===(n=null==e?void 0:e.perPage)||void 0===n?void 0:n.toString())&&void 0!==s?s:""},xform:Mp});if(u.error)throw u.error;const l=await u.json(),h=null!==(i=u.headers.get("x-total-count"))&&void 0!==i?i:0,d=null!==(a=null===(o=u.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);c[`${r}Page`]=t}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},l),c),error:null}}catch(e){if(qf(e))return{data:{clients:[]},error:e};throw e}}async _createOAuthClient(e){try{return await Np(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(qf(e))return{data:null,error:e};throw e}}async _getOAuthClient(e){try{return await Np(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(qf(e))return{data:null,error:e};throw e}}async _updateOAuthClient(e,t){try{return await Np(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(qf(e))return{data:null,error:e};throw e}}async _deleteOAuthClient(e){try{return await Np(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(qf(e))return{data:null,error:e};throw e}}async _regenerateOAuthClientSecret(e){try{return await Np(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(qf(e))return{data:null,error:e};throw e}}}function Fp(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const Vp=!!(globalThis&&pp()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Bp extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class qp extends Bp{}async function Kp(e,t,r){Vp&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),Vp&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async n=>{if(!n){if(0===t)throw Vp&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new qp(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Vp)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(e){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",e)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}Vp&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,n.name);try{return await r()}finally{Vp&&console.log("@supabase/gotrue-js: navigatorLock: released",e,n.name)}}))}function Hp(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function zp(e){const t=(new TextEncoder).encode(e);return"0x"+Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}class Gp extends Error{constructor({message:e,code:t,cause:r,name:n}){var s;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=null!==(s=null!=n?n:r instanceof Error?r.name:void 0)&&void 0!==s?s:"Unknown Error",this.code=t}}class Wp extends Gp{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Jp({error:e,options:t}){var r,n,s;const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new Gp({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("ConstraintError"===e.name){if(!0===(null===(r=i.authenticatorSelection)||void 0===r?void 0:r.requireResidentKey))return new Gp({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if("conditional"===t.mediation&&"required"===(null===(n=i.authenticatorSelection)||void 0===n?void 0:n.userVerification))return new Gp({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if("required"===(null===(s=i.authenticatorSelection)||void 0===s?void 0:s.userVerification))return new Gp({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if("InvalidStateError"===e.name)return new Gp({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if("NotAllowedError"===e.name)return new Gp({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("NotSupportedError"===e.name)return 0===i.pubKeyCredParams.filter(e=>"public-key"===e.type).length?new Gp({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Gp({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if("SecurityError"===e.name){const t=window.location.hostname;if(!rg(t))return new Gp({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(i.rp.id!==t)return new Gp({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("TypeError"===e.name){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Gp({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if("UnknownError"===e.name)return new Gp({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Gp({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function Yp({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new Gp({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if("NotAllowedError"===e.name)return new Gp({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("SecurityError"===e.name){const t=window.location.hostname;if(!rg(t))return new Gp({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(r.rpId!==t)return new Gp({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("UnknownError"===e.name)return new Gp({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Gp({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}const Qp=new class{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};function Xp(e){if(!e)throw new Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:n}=e,s=zc(e,["challenge","user","excludeCredentials"]),i=lp(t).buffer,o=Object.assign(Object.assign({},r),{id:lp(r.id).buffer}),a=Object.assign(Object.assign({},s),{challenge:i,user:o});if(n&&n.length>0){a.excludeCredentials=new Array(n.length);for(let e=0;e<n.length;e++){const t=n[e];a.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:lp(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return a}function Zp(e){if(!e)throw new Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,n=zc(e,["challenge","allowCredentials"]),s=lp(t).buffer,i=Object.assign(Object.assign({},n),{challenge:s});if(r&&r.length>0){i.allowCredentials=new Array(r.length);for(let e=0;e<r.length;e++){const t=r[e];i.allowCredentials[e]=Object.assign(Object.assign({},t),{id:lp(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return i}function eg(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:hp(new Uint8Array(e.response.attestationObject)),clientDataJSON:hp(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:null!==(t=r.authenticatorAttachment)&&void 0!==t?t:void 0}}function tg(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const r=e,n=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:hp(new Uint8Array(s.authenticatorData)),clientDataJSON:hp(new Uint8Array(s.clientDataJSON)),signature:hp(new Uint8Array(s.signature)),userHandle:s.userHandle?hp(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:null!==(t=r.authenticatorAttachment)&&void 0!==t?t:void 0}}function rg(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function ng(){var e,t;return!!(dp()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.create)&&"function"==typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.get))}const sg={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},ig={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function og(...e){const t=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),r=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),n={};for(const s of e)if(s)for(const e in s){const i=s[e];if(void 0!==i)if(Array.isArray(i))n[e]=i;else if(r(i))n[e]=i;else if(t(i)){const r=n[e];t(r)?n[e]=og(r,i):n[e]=og(i)}else n[e]=i}return n}class ag{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:r,signal:n},s){try{const{data:i,error:o}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!i)return{data:null,error:o};const a=null!=n?n:Qp.createNewAbortSignal();if("create"===i.webauthn.type){const{user:e}=i.webauthn.credential_options.publicKey;e.name||(e.name=`${e.id}:${r}`),e.displayName||(e.displayName=e.name)}switch(i.webauthn.type){case"create":{const t=function(e,t){return og(sg,e,t||{})}(i.webauthn.credential_options.publicKey,null==s?void 0:s.create),{data:r,error:n}=await async function(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Wp("Browser returned unexpected credential type",t)}:{data:null,error:new Wp("Empty credential response",t)}}catch(t){return{data:null,error:Jp({error:t,options:e})}}}({publicKey:t,signal:a});return r?{data:{factorId:e,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:r}},error:null}:{data:null,error:n}}case"request":{const t=function(e,t){return og(ig,e,t||{})}(i.webauthn.credential_options.publicKey,null==s?void 0:s.request),{data:r,error:n}=await async function(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Wp("Browser returned unexpected credential type",t)}:{data:null,error:new Wp("Empty credential response",t)}}catch(t){return{data:null,error:Yp({error:t,options:e})}}}(Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:t,signal:a}));return r?{data:{factorId:e,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:r}},error:null}:{data:null,error:n}}}}catch(e){return qf(e)?{data:null,error:e}:{data:null,error:new Hf("Unexpected error in challenge",e)}}}async _verify({challengeId:e,factorId:t,webauthn:r}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:r=("undefined"!=typeof window?[window.location.origin]:void 0),signal:n}={}},s){if(!t)return{data:null,error:new Bf("rpId is required for WebAuthn authentication")};try{if(!ng())return{data:null,error:new Hf("Browser does not support WebAuthn",null)};const{data:i,error:o}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:r},signal:n},{request:s});if(!i)return{data:null,error:o};const{webauthn:a}=i;return this._verify({factorId:e,challengeId:i.challengeId,webauthn:{type:a.type,rpId:t,rpOrigins:r,credential_response:a.credential_response}})}catch(e){return qf(e)?{data:null,error:e}:{data:null,error:new Hf("Unexpected error in authenticate",e)}}}async _register({friendlyName:e,webauthn:{rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:r=("undefined"!=typeof window?[window.location.origin]:void 0),signal:n}={}},s){if(!t)return{data:null,error:new Bf("rpId is required for WebAuthn registration")};try{if(!ng())return{data:null,error:new Hf("Browser does not support WebAuthn",null)};const{data:i,error:o}=await this._enroll({friendlyName:e});if(!i)return await this.client.mfa.listFactors().then(t=>{var r;return null===(r=t.data)||void 0===r?void 0:r.all.find(t=>"webauthn"===t.factor_type&&t.friendly_name===e&&"unverified"!==t.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null==e?void 0:e.id}):void 0),{data:null,error:o};const{data:a,error:c}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:t,rpOrigins:r},signal:n},{create:s});return a?this._verify({factorId:i.id,challengeId:a.challengeId,webauthn:{rpId:t,rpOrigins:r,type:a.webauthn.type,credential_response:a.webauthn.credential_response}}):{data:null,error:c}}catch(e){return qf(e)?{data:null,error:e}:{data:null,error:new Hf("Unexpected error in register",e)}}}}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const cg={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Mf,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function ug(e,t,r){return await r()}const lg={};class hg{get jwks(){var e,t;return null!==(t=null===(e=lg[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){lg[this.storageKey]=Object.assign(Object.assign({},lg[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=lg[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){lg[this.storageKey]=Object.assign(Object.assign({},lg[this.storageKey]),{cachedAt:e})}constructor(e){var t,r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const s=Object.assign(Object.assign({},cg),e);if(this.storageKey=s.storageKey,this.instanceID=null!==(t=hg.nextInstanceID[this.storageKey])&&void 0!==t?t:0,hg.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.instanceID>0&&dp()){const e=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(e),this.logDebugMessages&&console.trace(e)}if(this.persistSession=s.persistSession,this.autoRefreshToken=s.autoRefreshToken,this.admin=new $p({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=gp(s.fetch),this.lock=s.lock||ug,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,this.throwOnError=s.throwOnError,this.lockAcquireTimeout=s.lockAcquireTimeout,s.lock?this.lock=s.lock:this.persistSession&&dp()&&(null===(r=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===r?void 0:r.locks)?this.lock=Kp:this.lock=ug,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new ag(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:pp()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Fp(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=Fp(this.memoryStorage)),dp()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(e){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",e)}null===(n=this.broadcastChannel)||void 0===n||n.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Lf}) ${(new Date).toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t={},r="none";if(dp()&&(t=function(e){const t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((e,r)=>{t[r]=e})}catch(e){}return r.searchParams.forEach((e,r)=>{t[r]=e}),t}(window.location.href),this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce")),dp()&&this.detectSessionInUrl&&"none"!==r){const{data:n,error:s}=await this._getSessionFromURL(t,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),function(e){return qf(e)&&"AuthImplicitGrantRedirectError"===e.name}(s)){const t=null===(e=s.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:s}}return{error:s}}const{session:i,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",i,"redirect type",o),await this._saveSession(i),setTimeout(async()=>{"recovery"===o?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return qf(e)?this._returnResult({error:e}):this._returnResult({error:new Hf("Unexpected error during initialization",e)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,n;try{const s=await Np(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(r=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==r?r:{},gotrue_meta_security:{captcha_token:null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.captchaToken}},xform:Pp}),{data:i,error:o}=s;if(o||!i)return this._returnResult({data:{user:null,session:null},error:o});const a=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),this._returnResult({data:{user:c,session:a},error:null})}catch(e){if(qf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signUp(e){var t,r,n;try{let s;if("email"in e){const{email:r,password:n,options:i}=e;let o=null,a=null;"pkce"===this.flowType&&([o,a]=await Ep(this.storage,this.storageKey)),s=await Np(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:r,password:n,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:o,code_challenge_method:a},xform:Pp})}else{if(!("phone"in e))throw new Jf("You must provide either an email or phone number and a password");{const{phone:t,password:i,options:o}=e;s=await Np(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!==(r=null==o?void 0:o.data)&&void 0!==r?r:{},channel:null!==(n=null==o?void 0:o.channel)&&void 0!==n?n:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:Pp})}}const{data:i,error:o}=s;if(o||!i)return await vp(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:o});const a=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),this._returnResult({data:{user:c,session:a},error:null})}catch(e){if(await vp(this.storage,`${this.storageKey}-code-verifier`),qf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:n,options:s}=e;t=await Np(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},xform:xp})}else{if(!("phone"in e))throw new Jf("You must provide either an email or phone number and a password");{const{phone:r,password:n,options:s}=e;t=await Np(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},xform:xp})}}const{data:r,error:n}=t;if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!r||!r.session||!r.user){const e=new Wf;return this._returnResult({data:{user:null,session:null},error:e})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(e){if(qf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOAuth(e){var t,r,n,s;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:null===(s=e.options)||void 0===s?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,r,n,s,i,o,a,c,u,l,h;let d,f;if("message"in e)d=e.message,f=e.signature;else{const{chain:l,wallet:h,statement:p,options:g}=e;let m;if(dp())if("object"==typeof h)m=h;else{const e=window;if(!("ethereum"in e)||"object"!=typeof e.ethereum||!("request"in e.ethereum)||"function"!=typeof e.ethereum.request)throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.");m=e.ethereum}else{if("object"!=typeof h||!(null==g?void 0:g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");m=h}const y=new URL(null!==(t=null==g?void 0:g.url)&&void 0!==t?t:window.location.href),v=await m.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!v||0===v.length)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const w=Hp(v[0]);let b=null===(r=null==g?void 0:g.signInWithEthereum)||void 0===r?void 0:r.chainId;if(!b){const e=await m.request({method:"eth_chainId"});b=parseInt(e,16)}d=function(e){var t;const{chainId:r,domain:n,expirationTime:s,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:c,resources:u,scheme:l,uri:h,version:d}=e;if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==d)throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${d}`);if(null===(t=e.statement)||void 0===t?void 0:t.includes("\n"))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`);const f=`${l?`${l}://${n}`:n} wants you to sign in with your Ethereum account:\n${Hp(e.address)}\n\n${e.statement?`${e.statement}\n`:""}`;let p=`URI: ${h}\nVersion: ${d}\nChain ID: ${r}${o?`\nNonce: ${o}`:""}\nIssued At: ${i.toISOString()}`;if(s&&(p+=`\nExpiration Time: ${s.toISOString()}`),a&&(p+=`\nNot Before: ${a.toISOString()}`),c&&(p+=`\nRequest ID: ${c}`),u){let e="\nResources:";for(const t of u){if(!t||"string"!=typeof t)throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${t}`);e+=`\n- ${t}`}p+=e}return`${f}\n${p}`}({domain:y.host,address:w,statement:p,uri:y.href,version:"1",chainId:b,nonce:null===(n=null==g?void 0:g.signInWithEthereum)||void 0===n?void 0:n.nonce,issuedAt:null!==(i=null===(s=null==g?void 0:g.signInWithEthereum)||void 0===s?void 0:s.issuedAt)&&void 0!==i?i:new Date,expirationTime:null===(o=null==g?void 0:g.signInWithEthereum)||void 0===o?void 0:o.expirationTime,notBefore:null===(a=null==g?void 0:g.signInWithEthereum)||void 0===a?void 0:a.notBefore,requestId:null===(c=null==g?void 0:g.signInWithEthereum)||void 0===c?void 0:c.requestId,resources:null===(u=null==g?void 0:g.signInWithEthereum)||void 0===u?void 0:u.resources}),f=await m.request({method:"personal_sign",params:[zp(d),w]})}try{const{data:t,error:r}=await Np(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:d,signature:f},(null===(l=e.options)||void 0===l?void 0:l.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:Pp});if(r)throw r;if(!t||!t.session||!t.user){const e=new Wf;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:r})}catch(e){if(qf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithSolana(e){var t,r,n,s,i,o,a,c,u,l,h,d;let f,p;if("message"in e)f=e.message,p=e.signature;else{const{chain:h,wallet:d,statement:g,options:m}=e;let y;if(dp())if("object"==typeof d)y=d;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");y=e.solana}else{if("object"!=typeof d||!(null==m?void 0:m.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=d}const v=new URL(null!==(t=null==m?void 0:m.url)&&void 0!==t?t:window.location.href);if("signIn"in y&&y.signIn){const e=await y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==m?void 0:m.signInWithSolana),{version:"1",domain:v.host,uri:v.href}),g?{statement:g}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");f="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in y&&"function"==typeof y.signMessage&&"publicKey"in y&&"object"==typeof y&&y.publicKey&&"toBase58"in y.publicKey&&"function"==typeof y.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${v.host} wants you to sign in with your Solana account:`,y.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${v.href}`,`Issued At: ${null!==(n=null===(r=null==m?void 0:m.signInWithSolana)||void 0===r?void 0:r.issuedAt)&&void 0!==n?n:(new Date).toISOString()}`,...(null===(s=null==m?void 0:m.signInWithSolana)||void 0===s?void 0:s.notBefore)?[`Not Before: ${m.signInWithSolana.notBefore}`]:[],...(null===(i=null==m?void 0:m.signInWithSolana)||void 0===i?void 0:i.expirationTime)?[`Expiration Time: ${m.signInWithSolana.expirationTime}`]:[],...(null===(o=null==m?void 0:m.signInWithSolana)||void 0===o?void 0:o.chainId)?[`Chain ID: ${m.signInWithSolana.chainId}`]:[],...(null===(a=null==m?void 0:m.signInWithSolana)||void 0===a?void 0:a.nonce)?[`Nonce: ${m.signInWithSolana.nonce}`]:[],...(null===(c=null==m?void 0:m.signInWithSolana)||void 0===c?void 0:c.requestId)?[`Request ID: ${m.signInWithSolana.requestId}`]:[],...(null===(l=null===(u=null==m?void 0:m.signInWithSolana)||void 0===u?void 0:u.resources)||void 0===l?void 0:l.length)?["Resources",...m.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=await y.signMessage((new TextEncoder).encode(f),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:r}=await Np(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:hp(p)},(null===(h=e.options)||void 0===h?void 0:h.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=e.options)||void 0===d?void 0:d.captchaToken}}:null),xform:Pp});if(r)throw r;if(!t||!t.session||!t.user){const e=new Wf;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:r})}catch(e){if(qf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _exchangeCodeForSession(e){const t=await yp(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(null!=t?t:"").split("/");try{if(!r&&"pkce"===this.flowType)throw new Xf;const{data:t,error:s}=await Np(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Pp});if(await vp(this.storage,`${this.storageKey}-code-verifier`),s)throw s;if(!t||!t.session||!t.user){const e=new Wf;return this._returnResult({data:{user:null,session:null,redirectType:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign(Object.assign({},t),{redirectType:null!=n?n:null}),error:s})}catch(e){if(await vp(this.storage,`${this.storageKey}-code-verifier`),qf(e))return this._returnResult({data:{user:null,session:null,redirectType:null},error:e});throw e}}async signInWithIdToken(e){try{const{options:t,provider:r,token:n,access_token:s,nonce:i}=e,o=await Np(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:s,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:Pp}),{data:a,error:c}=o;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!a||!a.session||!a.user){const e=new Wf;return this._returnResult({data:{user:null,session:null},error:e})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:a,error:c})}catch(e){if(qf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOtp(e){var t,r,n,s,i;try{if("email"in e){const{email:n,options:s}=e;let i=null,o=null;"pkce"===this.flowType&&([i,o]=await Ep(this.storage,this.storageKey));const{error:a}=await Np(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:n,data:null!==(t=null==s?void 0:s.data)&&void 0!==t?t:{},create_user:null===(r=null==s?void 0:s.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},code_challenge:i,code_challenge_method:o},redirectTo:null==s?void 0:s.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:a})}if("phone"in e){const{phone:t,options:r}=e,{data:o,error:a}=await Np(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(n=null==r?void 0:r.data)&&void 0!==n?n:{},create_user:null===(s=null==r?void 0:r.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(i=null==r?void 0:r.channel)&&void 0!==i?i:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a})}throw new Jf("You must provide either an email or phone number.")}catch(e){if(await vp(this.storage,`${this.storageKey}-code-verifier`),qf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async verifyOtp(e){var t,r;try{let n,s;"options"in e&&(n=null===(t=e.options)||void 0===t?void 0:t.redirectTo,s=null===(r=e.options)||void 0===r?void 0:r.captchaToken);const{data:i,error:o}=await Np(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:n,xform:Pp});if(o)throw o;if(!i)throw new Error("An error occurred on token verification.");const a=i.session,c=i.user;return(null==a?void 0:a.access_token)&&(await this._saveSession(a),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),this._returnResult({data:{user:c,session:a},error:null})}catch(e){if(qf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithSSO(e){var t,r,n,s,i;try{let o=null,a=null;"pkce"===this.flowType&&([o,a]=await Ep(this.storage,this.storageKey));const c=await Np(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:a}),headers:this.headers,xform:Lp});return(null===(s=c.data)||void 0===s?void 0:s.url)&&dp()&&!(null===(i=e.options)||void 0===i?void 0:i.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(e){if(await vp(this.storage,`${this.storageKey}-code-verifier`),qf(e))return this._returnResult({data:null,error:e});throw e}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Gf;const{error:n}=await Np(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:n})})}catch(e){if(qf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:s}=e,{error:i}=await Np(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},redirectTo:null==s?void 0:s.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:i})}if("phone"in e){const{phone:r,type:n,options:s}=e,{data:i,error:o}=await Np(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o})}throw new Jf("You must provide either an email or phone number and a type")}catch(e){if(qf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(e){}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(e){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await yp(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=!!e.expires_at&&1e3*e.expires_at-Date.now()<9e4;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const t=await yp(this.userStorage,this.storageKey+"-user");(null==t?void 0:t.user)?e.user=t.user:e.user=kp()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const t={value:this.suppressGetSessionWarning};e.user=function(e,t){return new Proxy(e,{get:(e,r,n)=>{if("__isInsecureUserWarningProxy"===r)return!0;if("symbol"==typeof r){const t=r.toString();if("Symbol(Symbol.toPrimitive)"===t||"Symbol(Symbol.toStringTag)"===t||"Symbol(util.inspect.custom)"===t||"Symbol(nodejs.util.inspect.custom)"===t)return Reflect.get(e,r,n)}return t.value||"string"!=typeof r||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(e,r,n)}})}(e.user,t),t.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:n,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{session:null},error:s}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await Np(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Dp}):await this._useSession(async e=>{var t,r,n;const{data:s,error:i}=e;if(i)throw i;return(null===(t=s.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Np(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(n=null===(r=s.session)||void 0===r?void 0:r.access_token)&&void 0!==n?n:void 0,xform:Dp}):{data:{user:null},error:new Gf}})}catch(e){if(qf(e))return function(e){return qf(e)&&"AuthSessionMissingError"===e.name}(e)&&(await this._removeSession(),await vp(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:e});throw e}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:n,error:s}=r;if(s)throw s;if(!n.session)throw new Gf;const i=n.session;let o=null,a=null;"pkce"===this.flowType&&null!=e.email&&([o,a]=await Ep(this.storage,this.storageKey));const{data:c,error:u}=await Np(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:a}),jwt:i.access_token,xform:Dp});if(u)throw u;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),this._returnResult({data:{user:i.user},error:null})})}catch(e){if(await vp(this.storage,`${this.storageKey}-code-verifier`),qf(e))return this._returnResult({data:{user:null},error:e});throw e}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Gf;const t=Date.now()/1e3;let r=t,n=!0,s=null;const{payload:i}=bp(e.access_token);if(i.exp&&(r=i.exp,n=r<=t),n){const{data:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!t)return{data:{user:null,session:null},error:null};s=t}else{const{data:n,error:i}=await this._getUser(e.access_token);if(i)throw i;s={access_token:e.access_token,refresh_token:e.refresh_token,user:n.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return this._returnResult({data:{user:s.user,session:s},error:null})}catch(e){if(qf(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:n,error:s}=t;if(s)throw s;e=null!==(r=n.session)&&void 0!==r?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new Gf;const{data:n,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{user:null,session:null},error:s}):n?this._returnResult({data:{user:n.user,session:n},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(e){if(qf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _getSessionFromURL(e,t){try{if(!dp())throw new Yf("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Yf(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Qf("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Yf("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Qf("No code detected.");const{data:t,error:r}=await this._exchangeCodeForSession(e.code);if(r)throw r;const n=new URL(window.location.href);return n.searchParams.delete("code"),window.history.replaceState(window.history.state,"",n.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:s,refresh_token:i,expires_in:o,expires_at:a,token_type:c}=e;if(!(s&&o&&i&&c))throw new Yf("No session defined in URL");const u=Math.round(Date.now()/1e3),l=parseInt(o);let h=u+l;a&&(h=parseInt(a));const d=h-u;1e3*d<=jf&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${l}s`);const f=h-l;u-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,h,u):u-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,h,u);const{data:p,error:g}=await this._getUser(s);if(g)throw g;const m={provider_token:r,provider_refresh_token:n,access_token:s,expires_in:l,expires_at:h,refresh_token:i,token_type:c,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:m,redirectType:e.type},error:null})}catch(e){if(qf(e))return this._returnResult({data:{session:null,redirectType:null},error:e});throw e}}_isImplicitGrantCallback(e){return"function"==typeof this.detectSessionInUrl?this.detectSessionInUrl(new URL(window.location.href),e):Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await yp(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:n,error:s}=t;if(s)return this._returnResult({error:s});const i=null===(r=n.session)||void 0===r?void 0:r.access_token;if(i){const{error:t}=await this.admin.signOut(i,e);if(t&&(!function(e){return qf(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return this._returnResult({error:t})}return"others"!==e&&(await this._removeSession(),await vp(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=Symbol("auth-callback"),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,n;try{const{data:{session:n},error:s}=t;if(s)throw s;await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(t){await(null===(n=this.stateChangeEmitters.get(e))||void 0===n?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",t),console.error(t)}})}async resetPasswordForEmail(e,t={}){let r=null,n=null;"pkce"===this.flowType&&([r,n]=await Ep(this.storage,this.storageKey,!0));try{return await Np(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(e){if(await vp(this.storage,`${this.storageKey}-code-verifier`),qf(e))return this._returnResult({data:null,error:e});throw e}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null})}catch(e){if(qf(e))return this._returnResult({data:null,error:e});throw e}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:r,error:n}=await this._useSession(async t=>{var r,n,s,i,o;const{data:a,error:c}=t;if(c)throw c;const u=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(r=e.options)||void 0===r?void 0:r.redirectTo,scopes:null===(n=e.options)||void 0===n?void 0:n.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:!0});return await Np(this.fetch,"GET",u,{headers:this.headers,jwt:null!==(o=null===(i=a.session)||void 0===i?void 0:i.access_token)&&void 0!==o?o:void 0})});if(n)throw n;return dp()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==r?void 0:r.url),this._returnResult({data:{provider:e.provider,url:null==r?void 0:r.url},error:null})}catch(t){if(qf(t))return this._returnResult({data:{provider:e.provider,url:null},error:t});throw t}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var r;try{const{error:n,data:{session:s}}=t;if(n)throw n;const{options:i,provider:o,token:a,access_token:c,nonce:u}=e,l=await Np(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!==(r=null==s?void 0:s.access_token)&&void 0!==r?r:void 0,body:{provider:o,id_token:a,access_token:c,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:Pp}),{data:h,error:d}=l;return d?this._returnResult({data:{user:null,session:null},error:d}):h&&h.session&&h.user?(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:d})):this._returnResult({data:{user:null,session:null},error:new Wf})}catch(e){if(await vp(this.storage,`${this.storageKey}-code-verifier`),qf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,n;const{data:s,error:i}=t;if(i)throw i;return await Np(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(n=null===(r=s.session)||void 0===r?void 0:r.access_token)&&void 0!==n?n:void 0})})}catch(e){if(qf(e))return this._returnResult({data:null,error:e});throw e}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await(r=async r=>(r>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await Np(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Pp})),n=(e,t)=>{const r=200*Math.pow(2,e);return t&&ep(t)&&Date.now()+r-s<jf},new Promise((e,t)=>{(async()=>{for(let s=0;s<1/0;s++)try{const t=await r(s);if(!n(s,null))return void e(t)}catch(e){if(!n(s,e))return void t(e)}})()}))}catch(e){if(this._debug(t,"error",e),qf(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}finally{this._debug(t,"end")}var r,n}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),dp()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=await yp(this.storage,this.storageKey);if(n&&this.userStorage){let t=await yp(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:n.user},await mp(this.userStorage,this.storageKey+"-user",t)),n.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:kp()}else if(n&&!n.user&&!n.user){const e=await yp(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(n.user=e.user,await vp(this.storage,this.storageKey+"-user"),await mp(this.storage,this.storageKey,n)):n.user=kp()}if(this._debug(r,"session from storage",n),!this._isValidSession(n))return this._debug(r,"session is not valid"),void(null!==n&&await this._removeSession());const s=1e3*(null!==(t=n.expires_at)&&void 0!==t?t:1/0)-Date.now()<9e4;if(this._debug(r,`session has${s?"":" not"} expired with margin of 90000s`),s){if(this.autoRefreshToken&&n.refresh_token){const{error:e}=await this._callRefreshToken(n.refresh_token);e&&(console.error(e),ep(e)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(n.user&&!0===n.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(n.access_token);!t&&(null==e?void 0:e.user)?(n.user=e.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(e){console.error("Error getting user data:",e),this._debug(r,"error getting user data, skipping SIGNED_IN notification",e)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(e){return this._debug(r,"error",e),void console.error(e)}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Gf;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new wp;const{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new Gf;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const n={data:t.session,error:null};return this.refreshingDeferred.resolve(n),n}catch(e){if(this._debug(n,"error",e),qf(e)){const r={data:null,error:e};return ep(e)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(r),r}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(e),e}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,r=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],s=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(e){n.push(e)}});if(await Promise.all(s),n.length>0){for(let e=0;e<n.length;e+=1)console.error(n[e]);throw n[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await vp(this.storage,`${this.storageKey}-code-verifier`);const t=Object.assign({},e),r=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!r&&t.user&&await mp(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const n=Ap(e);await mp(this.storage,this.storageKey,n)}else{const e=Ap(t);await mp(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await vp(this.storage,this.storageKey),await vp(this.storage,this.storageKey+"-code-verifier"),await vp(this.storage,this.storageKey+"-user"),this.userStorage&&await vp(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&dp()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),jf);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e);const t=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const t=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,t&&clearTimeout(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const n=Math.floor((1e3*r.expires_at-e)/jf);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),n<=3&&await this._callRefreshToken(r.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(!(e.isAcquireTimeout||e instanceof Bp))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!dp()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const n=[`provider=${encodeURIComponent(t)}`];if((null==r?void 0:r.redirectTo)&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),(null==r?void 0:r.scopes)&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),"pkce"===this.flowType){const[e,t]=await Ep(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});n.push(r.toString())}if(null==r?void 0:r.queryParams){const e=new URLSearchParams(r.queryParams);n.push(e.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:n,error:s}=t;return s?this._returnResult({data:null,error:s}):await Np(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token})})}catch(e){if(qf(e))return this._returnResult({data:null,error:e});throw e}}async _enroll(e){try{return await this._useSession(async t=>{var r,n;const{data:s,error:i}=t;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:a,error:c}=await Np(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});return c?this._returnResult({data:null,error:c}):("totp"===e.factorType&&"totp"===a.type&&(null===(n=null==a?void 0:a.totp)||void 0===n?void 0:n.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),this._returnResult({data:a,error:null}))})}catch(e){if(qf(e))return this._returnResult({data:null,error:e});throw e}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:s}=t;if(s)return this._returnResult({data:null,error:s});const i=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?eg(e.webauthn.credential_response):tg(e.webauthn.credential_response)})}:{code:e.code}),{data:o,error:a}=await Np(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:i,headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});return a?this._returnResult({data:null,error:a}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),this._returnResult({data:o,error:a}))})}catch(e){if(qf(e))return this._returnResult({data:null,error:e});throw e}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:s}=t;if(s)return this._returnResult({data:null,error:s});const i=await Np(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});if(i.error)return i;const{data:o}=i;if("webauthn"!==o.type)return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Xp(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Zp(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(qf(e))return this._returnResult({data:null,error:e});throw e}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};const n={all:[],phone:[],totp:[],webauthn:[]};for(const r of null!==(e=null==t?void 0:t.factors)&&void 0!==e?e:[])n.all.push(r),"verified"===r.status&&n[r.factor_type].push(r);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:r},error:n}=await this.getSession();if(n)return this._returnResult({data:null,error:n});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:s}=bp(r.access_token);let i=null;s.aal&&(i=s.aal);let o=i;return(null!==(t=null===(e=r.user.factors)||void 0===e?void 0:e.filter(e=>"verified"===e.status))&&void 0!==t?t:[]).length>0&&(o="aal2"),{data:{currentLevel:i,nextLevel:o,currentAuthenticationMethods:s.amr||[]},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;return n?this._returnResult({data:null,error:n}):r?await Np(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new Gf})})}catch(e){if(qf(e))return this._returnResult({data:null,error:e});throw e}}async _approveAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;if(s)return this._returnResult({data:null,error:s});if(!n)return this._returnResult({data:null,error:new Gf});const i=await Np(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"approve"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&dp()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(e){if(qf(e))return this._returnResult({data:null,error:e});throw e}}async _denyAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;if(s)return this._returnResult({data:null,error:s});if(!n)return this._returnResult({data:null,error:new Gf});const i=await Np(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"deny"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&dp()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(e){if(qf(e))return this._returnResult({data:null,error:e});throw e}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;return r?this._returnResult({data:null,error:r}):t?await Np(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new Gf})})}catch(e){if(qf(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;return n?this._returnResult({data:null,error:n}):r?(await Np(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Gf})})}catch(e){if(qf(e))return this._returnResult({data:null,error:e});throw e}}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(t=>t.kid===e);if(r)return r;const n=Date.now();if(r=this.jwks.keys.find(t=>t.kid===e),r&&this.jwks_cached_at+6e5>n)return r;const{data:s,error:i}=await Np(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return s.keys&&0!==s.keys.length?(this.jwks=s,this.jwks_cached_at=n,r=s.keys.find(t=>t.kid===e),r||null):null}async getClaims(e,t={}){try{let r=e;if(!r){const{data:e,error:t}=await this.getSession();if(t||!e.session)return this._returnResult({data:null,error:t});r=e.session.access_token}const{header:n,payload:s,signature:i,raw:{header:o,payload:a}}=bp(r);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(s.exp);const c=n.alg&&!n.alg.startsWith("HS")&&n.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(n.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks):null;if(!c){const{error:e}=await this.getUser(r);if(e)throw e;return{data:{claims:s,header:n,signature:i},error:null}}const u=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(n.alg),l=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,l,i,function(e){const t=[];return function(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const t=1024*(n-55296)&65535;n=65536+(e.charCodeAt(r+1)-56320&65535|t),r+=1}up(n,t)}}(e,e=>t.push(e)),new Uint8Array(t)}(`${o}.${a}`)))throw new rp("Invalid JWT signature");return{data:{claims:s,header:n,signature:i},error:null}}catch(e){if(qf(e))return this._returnResult({data:null,error:e});throw e}}}hg.nextInstanceID={};const dg=hg;let fg="";fg="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const pg={headers:{"X-Client-Info":`supabase-js-${fg}/2.90.0`}},gg={schema:"public"},mg={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},yg={};function vg(e){return(vg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wg(e,t,r){return(t=function(e){var t=function(e){if("object"!=vg(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=vg(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==vg(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bg(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?bg(Object(r),!0).forEach(function(t){wg(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bg(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var Eg=class extends dg{constructor(e){super(e)}},Tg=class{constructor(e,t,r){var n,s;this.supabaseUrl=e,this.supabaseKey=t;const i=function(e){const t=null==e?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((r=t).endsWith("/")?r:r+"/")}catch(e){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var r}(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,a=function(e,t){var r,n;const{db:s,auth:i,realtime:o,global:a}=e,{db:c,auth:u,realtime:l,global:h}=t,d={db:_g(_g({},c),s),auth:_g(_g({},u),i),realtime:_g(_g({},l),o),storage:{},global:_g(_g(_g({},h),a),{},{headers:_g(_g({},null!==(r=null==h?void 0:h.headers)&&void 0!==r?r:{}),null!==(n=null==a?void 0:a.headers)&&void 0!==n?n:{})}),accessToken:async()=>""};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}(null!=r?r:{},{db:gg,realtime:yg,auth:_g(_g({},mg),{},{storageKey:o}),global:pg});var c;this.storageKey=null!==(n=a.auth.storageKey)&&void 0!==n?n:"",this.headers=null!==(s=a.global.headers)&&void 0!==s?s:{},a.accessToken?(this.accessToken=a.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(c=a.auth)&&void 0!==c?c:{},this.headers,a.global.fetch),this.fetch=((e,t,r)=>{const n=(e=>e?(...t)=>e(...t):(...e)=>fetch(...e))(r),s=Headers;return async(r,i)=>{var o;const a=null!==(o=await t())&&void 0!==o?o:e;let c=new s(null==i?void 0:i.headers);return c.has("apikey")||c.set("apikey",e),c.has("Authorization")||c.set("Authorization",`Bearer ${a}`),n(r,_g(_g({},i),{},{headers:c}))}})(t,this._getAccessToken.bind(this),a.global.fetch),this.realtime=this._initRealtimeClient(_g({headers:this.headers,accessToken:this._getAccessToken.bind(this)},a.realtime)),this.accessToken&&this.accessToken().then(e=>this.realtime.setAuth(e)).catch(e=>console.warn("Failed to set initial Realtime auth token:",e)),this.rest=new ad(new URL("rest/v1",i).href,{headers:this.headers,schema:a.db.schema,fetch:this.fetch}),this.storage=new Df(this.storageUrl.href,this.headers,this.fetch,null==r?void 0:r.storage),a.accessToken||this._listenForAuthEvents()}get functions(){return new ed(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t,r=this;if(r.accessToken)return await r.accessToken();const{data:n}=await r.auth.getSession();return null!==(e=null===(t=n.session)||void 0===t?void 0:t.access_token)&&void 0!==e?e:r.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:s,storageKey:i,flowType:o,lock:a,debug:c,throwOnError:u},l,h){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Eg({url:this.authUrl.href,headers:_g(_g({},d),l),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:s,flowType:o,lock:a,debug:c,throwOnError:u,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new $d(this.realtimeUrl.href,_g(_g({},e),{},{params:_g(_g({},{apikey:this.supabaseKey}),null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===r?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=r,this.realtime.setAuth(r))}};const Sg=(e,t,r)=>new Tg(e,t,r);function Ig(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",s=r.toStringTag||"@@toStringTag";function i(r,n,s,i){var c=n&&n.prototype instanceof a?n:a,u=Object.create(c.prototype);return kg(u,"_invoke",function(r,n,s){var i,a,c,u=0,l=s||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return i=t,a=0,c=e,d.n=r,o}};function f(r,n){for(a=r,c=n,t=0;!h&&u&&!s&&t<l.length;t++){var s,i=l[t],f=d.p,p=i[2];r>3?(s=p===n)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=f&&((s=r<2&&f<i[1])?(a=0,d.v=n,d.n=i[1]):f<p&&(s=r<3||i[0]>n||n>p)&&(i[4]=r,i[5]=n,d.n=p,a=0))}if(s||r>1)return o;throw h=!0,n}return function(s,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(t=a<2?e:c)||!h;){i||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,i){if(a||(s="next"),t=i[s]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+s+"' method"),a=1);i=e}else if((t=(h=d.n<0)?c:r.call(n,d))!==o)break}catch(t){i=e,a=1,c=t}finally{u=1}}return{value:t,done:h}}}(r,s,i),!0),u}var o={};function a(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(kg(t={},n,function(){return this}),t),h=u.prototype=a.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,kg(e,s,"GeneratorFunction")),e.prototype=Object.create(h),e}return c.prototype=u,kg(h,"constructor",u),kg(u,"constructor",c),c.displayName="GeneratorFunction",kg(u,s,"GeneratorFunction"),kg(h),kg(h,s,"Generator"),kg(h,n,function(){return this}),kg(h,"toString",function(){return"[object Generator]"}),(Ig=function(){return{w:i,m:d}})()}function kg(e,t,r,n){var s=Object.defineProperty;try{s({},"",{})}catch(e){s=0}kg=function(e,t,r,n){function i(t,r){kg(e,t,function(e){return this._invoke(t,r,e)})}t?s?s(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},kg(e,t,r,n)}function Ag(e,t,r,n,s,i,o){try{var a=e[i](o),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,s)}function Cg(e){return function(){var t=this,r=arguments;return new Promise(function(n,s){var i=e.apply(t,r);function o(e){Ag(i,n,s,o,a,"next",e)}function a(e){Ag(i,n,s,o,a,"throw",e)}o(void 0)})}}(function(){if("undefined"!=typeof window)return!1;const e=globalThis.process;if(!e)return!1;const t=e.version;if(null==t)return!1;const r=t.match(/^v(\d+)\./);return!!r&&parseInt(r[1],10)<=18})()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");var Og=function(){var e=Cg(Ig().m(function e(t,r,n){var s,i,o,a,c;return Ig().w(function(e){for(;;)switch(e.n){case 0:return i=wc(r,"users",t),e.n=1,Bc(i);case 1:if((o=e.v).exists()||alert("Kullanıcı bilgileri bulunamadı!"),a=o.data(),c=null!==(s=a.expireDate)&&void 0!==s&&s.toDate?a.expireDate.toDate():new Date(a.expireDate),!(new Date>c)){e.n=2;break}return alert("Hesabınızın süresi dolmuş. Lütfen yönetici ile iletişime geçin."),e.n=2,Ul(n);case 2:return e.a(2)}},e)}));return function(t,r,n){return e.apply(this,arguments)}}(),Rg=function(){var e=Cg(Ig().m(function e(t){var r,n,s,i,o,a,c,u,l;return Ig().w(function(e){for(;;)switch(e.n){case 0:return r=Sg("https://oybvsqonvawnkztnhwec.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im95YnZzcW9udmF3bmt6dG5od2VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMjMwMDIsImV4cCI6MjA3NzY5OTAwMn0.OPa9rGvmFVAocrzlNPLx-8AJ7IF-Wcm58jlS4zXEYW0"),e.n=1,r.from("profiles").select("logo_url, ad_url").eq("id",t).single();case 1:return n=e.v,s=n.data,i=n.error,e.n=2,r.from("ads").select("ad_url").single();case 2:o=e.v,a=o.data,c=o.error;try{u=document.getElementById("logo"),s&&s.logo_url&&u&&(u.src=s.logo_url),l=document.getElementById("reklam"),a&&a.ad_url&&l&&(l.src=a.ad_url)}catch(e){console.error("Resim DOM'a yüklenirken hata meydana geldi:",e)}i&&console.error("Logo yüklenirken hata meydana geldi:",i),c&&console.error("Reklam yüklenirken hata meydana geldi:",c);case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}();function Ng(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",s=r.toStringTag||"@@toStringTag";function i(r,n,s,i){var c=n&&n.prototype instanceof a?n:a,u=Object.create(c.prototype);return Pg(u,"_invoke",function(r,n,s){var i,a,c,u=0,l=s||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return i=t,a=0,c=e,d.n=r,o}};function f(r,n){for(a=r,c=n,t=0;!h&&u&&!s&&t<l.length;t++){var s,i=l[t],f=d.p,p=i[2];r>3?(s=p===n)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=f&&((s=r<2&&f<i[1])?(a=0,d.v=n,d.n=i[1]):f<p&&(s=r<3||i[0]>n||n>p)&&(i[4]=r,i[5]=n,d.n=p,a=0))}if(s||r>1)return o;throw h=!0,n}return function(s,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(t=a<2?e:c)||!h;){i||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,i){if(a||(s="next"),t=i[s]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+s+"' method"),a=1);i=e}else if((t=(h=d.n<0)?c:r.call(n,d))!==o)break}catch(t){i=e,a=1,c=t}finally{u=1}}return{value:t,done:h}}}(r,s,i),!0),u}var o={};function a(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(Pg(t={},n,function(){return this}),t),h=u.prototype=a.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Pg(e,s,"GeneratorFunction")),e.prototype=Object.create(h),e}return c.prototype=u,Pg(h,"constructor",u),Pg(u,"constructor",c),c.displayName="GeneratorFunction",Pg(u,s,"GeneratorFunction"),Pg(h),Pg(h,s,"Generator"),Pg(h,n,function(){return this}),Pg(h,"toString",function(){return"[object Generator]"}),(Ng=function(){return{w:i,m:d}})()}function Pg(e,t,r,n){var s=Object.defineProperty;try{s({},"",{})}catch(e){s=0}Pg=function(e,t,r,n){function i(t,r){Pg(e,t,function(e){return this._invoke(t,r,e)})}t?s?s(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},Pg(e,t,r,n)}function xg(e,t,r,n,s,i,o){try{var a=e[i](o),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,s)}r(2259),r(8706),r(113),r(3418),r(3792),r(4782),r(2010),r(9868),r(7495),r(8781),r(7764),r(5440),r(1392),r(2953);var Dg=function(){var e,t=(e=Ng().m(function e(t,r,n){var s;return Ng().w(function(e){for(;;)switch(e.n){case 0:return s=vc(r,"users",t,"prices"),e.n=1,Kc(s);case 1:e.v.forEach(function(e){var t=e.data(),r=e.id;n.find(function(e){e.id===r&&(e.satisKar=t.satis.toFixed(2),e.alisKar=t.alis.toFixed(2))})});case 2:return e.a(2)}},e)}),function(){var t=this,r=arguments;return new Promise(function(n,s){var i=e.apply(t,r);function o(e){xg(i,n,s,o,a,"next",e)}function a(e){xg(i,n,s,o,a,"throw",e)}o(void 0)})});return function(e,r,n){return t.apply(this,arguments)}}(),Lg=function(e,t){e.forEach(function(e){t.forEach(function(t){e.code===t.haremId&&(t.haremAlis=e.alis,t.haremSatis=e.satis)})})},jg=function(e,t,r){try{!function(e,...t){var r,n,s;e=R(e);let i={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof t[o]||Tc(t[o])||(i=t[o++]);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Tc(t[o])){const e=t[o];t[o]=null===(r=e.next)||void 0===r?void 0:r.bind(e),t[o+1]=null===(n=e.error)||void 0===n?void 0:n.bind(e),t[o+2]=null===(s=e.complete)||void 0===s?void 0:s.bind(e)}let c,u,l;if(e instanceof mc)u=or(e.firestore,Sc),l=ns(e._key.path),c={next:r=>{t[o]&&t[o](Hc(u,e,r))},error:t[o+1],complete:t[o+2]};else{const r=or(e,gc);u=or(r.firestore,Sc),l=r._query;const n=new qc(u);c={next:e=>{t[o]&&t[o](new Fc(u,n,r,e))},error:t[o+1],complete:t[o+2]},Lc(e._query)}(function(e,t,r,n){const s=new nc(n),i=new Oa(t,s,r);e.asyncQueue.enqueueAndForget(async()=>Ea(await cc(e),i))})(Ic(u),l,a,c)}(vc(t,"users",e,"prices"),function(e){var t={};e.forEach(function(e){t[e.id]=e.data()}),r.forEach(function(e){t[e.id]||(t[e.id]={alis:0,satis:0})}),e.docChanges().forEach(function(e){"modified"===e.type&&(window.location.href=window.location.href)})},function(e){console.error("❌ Fiyat dinleyici hatası:",e),alert("Fiyatlar dinlenemiyor: "+e.message)})}catch(e){console.error("❌ Fiyat dinleyici kurulurken hata:",e),alert("Fiyat dinleyici kurulamadı: "+e.message)}},Mg=(r(2892),r(8156),function(e){if("number"==typeof e)return e;if(!e)return 0;var t=String(e).replace(/\s/g,"").replace(/\./g,"").replace(",","."),r=Number(t);return isNaN(r)?0:r}),Ug=function(e,t){return e>t?"down":e<t?"up":"equal"},$g=function(e,t,r,n){0===t||isNaN(t)||(e.classList.contains("footer")||(e.style.transition="background 0.5s ease-in-out","down"===r?e.style.background="#ffd6d6ff":"up"===r&&(e.style.background="#e1ffd6ff"),setTimeout(function(){e.style.background="#fff"},500)),e.innerText=Fg(t,n?2:0))},Fg=function(e,t){var r=Number(e);return isNaN(r)?"-":r.toLocaleString("tr-TR",{minimumFractionDigits:t,maximumFractionDigits:t})};setInterval(function(){var e,t,r,n,s=document.querySelector(".timeContainer");s&&(s.textContent="".concat((e=new Date,t=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0"),n=String(e.getSeconds()).padStart(2,"0"),"".concat(t,":").concat(r,":").concat(n))))},1e3),document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("goToUpdateBtn");e&&e.addEventListener("click",function(){window.location.href="../updatePrices/updatePrices.html"})});var Vg=[{id:"HAS",haremId:"ALTIN",haremAlis:0,haremSatis:0,alisMilyem:1,satisMilyem:1,alisKar:0,satisKar:0,format:!0,alisHesap:function(){return Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"BILEZIK22",haremId:"ALTIN",haremAlis:0,haremSatis:0,alisMilyem:.912,satisMilyem:.93,alisKar:0,satisKar:0,format:!1,alisHesap:function(){return Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"AYAR8",haremId:"ALTIN",haremAlis:0,haremSatis:0,alisMilyem:.32,satisMilyem:0,alisKar:0,satisKar:0,format:!1,alisHesap:function(){return Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"AYAR14",haremId:"ALTIN",haremAlis:0,haremSatis:0,alisMilyem:.575,satisMilyem:0,alisKar:0,satisKar:0,format:!1,alisHesap:function(){return Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"AYAR18",haremId:"ALTIN",haremAlis:0,haremSatis:0,alisMilyem:.7,satisMilyem:0,alisKar:0,satisKar:0,format:!1,alisHesap:function(){return Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"AYAR22",haremId:"ALTIN",haremAlis:0,haremSatis:0,alisMilyem:.912,satisMilyem:.93,alisKar:0,satisKar:0,format:!1,alisHesap:function(){return Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"AYAR24",haremId:"ALTIN",haremAlis:0,haremSatis:0,alisMilyem:.995,satisMilyem:1,alisKar:0,satisKar:0,format:!1,alisHesap:function(){return Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"CEYREK_YENI",haremId:"CEYREK_YENI",haremAlis:0,haremSatis:0,alisMilyem:1,satisMilyem:1,alisKar:0,satisKar:0,format:!1,alisHesap:function(){return Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"CEYREK_ESKI",haremId:"CEYREK_ESKI",haremAlis:0,haremSatis:0,alisMilyem:1,satisMilyem:1,alisKar:0,satisKar:0,format:!1,alisHesap:function(){return Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"YARIM_YENI",haremId:"YARIM_YENI",haremAlis:0,haremSatis:0,alisMilyem:1,satisMilyem:1,alisKar:0,satisKar:0,format:!1,alisHesap:function(){return Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"YARIM_ESKI",haremId:"YARIM_ESKI",haremAlis:0,haremSatis:0,alisMilyem:1,satisMilyem:1,alisKar:0,satisKar:0,format:!1,alisHesap:function(){return Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"TEK_ESKI",haremId:"TEK_ESKI",haremAlis:0,haremSatis:0,alisMilyem:1,satisMilyem:1,alisKar:0,satisKar:0,format:!1,alisHesap:function(){return Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"TEK_YENI",haremId:"TEK_YENI",haremAlis:0,haremSatis:0,alisMilyem:1,satisMilyem:1,alisKar:0,satisKar:0,format:!1,alisHesap:function(){return Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"ATA_YENI",haremId:"ATA_YENI",haremAlis:0,haremSatis:0,alisMilyem:1,satisMilyem:1,alisKar:0,satisKar:0,format:!1,alisHesap:function(){return Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"RESAT",haremId:"ATA_YENI",haremAlis:0,haremSatis:0,alisMilyem:1,satisMilyem:1,alisKar:0,satisKar:0,format:!1,alisHesap:function(){return Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"GRAMESE_YENI",haremId:"CEYREK_YENI",haremAlis:0,haremSatis:0,alisMilyem:1,satisMilyem:1,alisKar:0,satisKar:0,format:!1,alisHesap:function(){return 10*Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return 10*Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"GRAMESE_ESKI",haremId:"CEYREK_ESKI",haremAlis:0,haremSatis:0,alisMilyem:1,satisMilyem:1,alisKar:0,satisKar:0,format:!1,alisHesap:function(){return 10*Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return 10*Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"USDTRY",haremId:"USDTRY",haremAlis:0,haremSatis:0,alisMilyem:1,satisMilyem:1,alisKar:0,satisKar:0,format:!0,alisHesap:function(){return Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"EURTRY",haremId:"EURTRY",haremAlis:0,haremSatis:0,alisMilyem:1,satisMilyem:1,alisKar:0,satisKar:0,format:!0,alisHesap:function(){return Number(this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(this.haremSatis)*this.satisMilyem+Number(this.satisKar)}},{id:"GUMUSTRY",haremId:"GUMUSTRY",haremAlis:0,haremSatis:0,alisMilyem:1,satisMilyem:1,alisKar:0,satisKar:0,alisHesap:function(){return Number(1e3*this.haremAlis)*this.alisMilyem+Number(this.alisKar)},satisHesap:function(){return Number(1e3*this.haremSatis)*this.satisMilyem+Number(this.satisKar)}}];function Bg(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",s=r.toStringTag||"@@toStringTag";function i(r,n,s,i){var c=n&&n.prototype instanceof a?n:a,u=Object.create(c.prototype);return qg(u,"_invoke",function(r,n,s){var i,a,c,u=0,l=s||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return i=t,a=0,c=e,d.n=r,o}};function f(r,n){for(a=r,c=n,t=0;!h&&u&&!s&&t<l.length;t++){var s,i=l[t],f=d.p,p=i[2];r>3?(s=p===n)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=f&&((s=r<2&&f<i[1])?(a=0,d.v=n,d.n=i[1]):f<p&&(s=r<3||i[0]>n||n>p)&&(i[4]=r,i[5]=n,d.n=p,a=0))}if(s||r>1)return o;throw h=!0,n}return function(s,l,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),a=l,c=p;(t=a<2?e:c)||!h;){i||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,i){if(a||(s="next"),t=i[s]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+s+"' method"),a=1);i=e}else if((t=(h=d.n<0)?c:r.call(n,d))!==o)break}catch(t){i=e,a=1,c=t}finally{u=1}}return{value:t,done:h}}}(r,s,i),!0),u}var o={};function a(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(qg(t={},n,function(){return this}),t),h=u.prototype=a.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,qg(e,s,"GeneratorFunction")),e.prototype=Object.create(h),e}return c.prototype=u,qg(h,"constructor",u),qg(u,"constructor",c),c.displayName="GeneratorFunction",qg(u,s,"GeneratorFunction"),qg(h),qg(h,s,"Generator"),qg(h,n,function(){return this}),qg(h,"toString",function(){return"[object Generator]"}),(Bg=function(){return{w:i,m:d}})()}function qg(e,t,r,n){var s=Object.defineProperty;try{s({},"",{})}catch(e){s=0}qg=function(e,t,r,n){function i(t,r){qg(e,t,function(e){return this._invoke(t,r,e)})}t?s?s(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},qg(e,t,r,n)}function Kg(e,t,r,n,s,i,o){try{var a=e[i](o),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,s)}function Hg(e){return function(){var t=this,r=arguments;return new Promise(function(n,s){var i=e.apply(t,r);function o(e){Kg(i,n,s,o,a,"next",e)}function a(e){Kg(i,n,s,o,a,"throw",e)}o(void 0)})}}var zg=ze({apiKey:"AIzaSyDIGME8_6gN9bI1SCadrsx93QhQRCfC-dM",authDomain:"canli-altin-app.firebaseapp.com",databaseURL:"https://canli-altin-app-default-rtdb.europe-west1.firebasedatabase.app",projectId:"canli-altin-app",storageBucket:"canli-altin-app.firebasestorage.app",messagingSenderId:"675863034125",appId:"1:675863034125:web:301006180c35a5f0549844",measurementId:"G-V3YHGPSB8M"}),Gg=function(e){const t="object"==typeof e?e:Ge(),r="string"==typeof e?e:on,n=Ve(t,"firestore").getImmediate({identifier:r});if(!n._initialized){const e=(()=>{const e=u("firestore");if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return"["===e[0]?[e.substring(1,t-1),r]:[e.substring(0,t),r]})();e&&function(e,t,r,n={}){var s;e=or(e,pc);const i=f(t),a=e._getSettings(),c=Object.assign(Object.assign({},a),{emulatorOptions:e._getEmulatorOptions()}),u=`${t}:${r}`;i&&(p(`https://${u}`),y("Firestore",!0)),a.host!==hc&&a.host!==u&&kt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l=Object.assign(Object.assign({},a),{host:u,ssl:i,emulatorOptions:n});if(!T(l,c)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=bt.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r=t||"demo-project",n=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:n,exp:n+3600,auth_time:n,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(i)),""].join(".")}(n.mockUserToken,null===(s=e._app)||void 0===s?void 0:s.options.projectId);const i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new xt(Pt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new bt(i)}e._authCredentials=new Mt(new Lt(t,r))}}(n,...e)}return n}(zg),Wg=function(e=Ge()){const t=Ve(e,"auth");if(t.isInitialized())return t.getImmediate();const r=function(e,t){const r=Ve(e,"auth");if(r.isInitialized()){const e=r.getImmediate();if(T(r.getOptions(),null!=t?t:{}))return e;Qc(e,"already-initialized")}return r.initialize({options:t})}(e,{popupRedirectResolver:Bh,persistence:[oh,ql,Hl]}),n=h("authTokenSyncURL");if(n&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(n,location.origin);if(location.origin===e.origin){const t=(s=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),r=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>zh)return;const n=null==t?void 0:t.token;Gh!==n&&(Gh=n,await fetch(s,{method:n?"POST":"DELETE",headers:n?{Authorization:`Bearer ${n}`}:{}}))});!function(e,t,r){R(e).beforeAuthStateChanged(t,r)}(r,t,()=>t(r.currentUser)),function(e){R(e).onIdTokenChanged(e=>t(e),void 0,void 0)}(r)}}var s;const i=u("auth");return i&&function(e,t,r){const n=sl(e);ru(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const s=!!(null==r?void 0:r.disableWarnings),i=gl(t),{host:o,port:a}=function(e){const t=gl(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};const n=r[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(n);if(s){const e=s[1];return{host:e,port:ml(n.substr(e.length+1))}}{const[e,t]=n.split(":");return{host:e,port:ml(t)}}}(t),c=null===a?"":`:${a}`,u={url:`${i}//${o}${c}/`},l=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!n._canInitEmulator)return ru(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),void ru(T(u,n.config.emulator)&&T(l,n.emulatorConfig),n,"emulator-config-failed");n.config.emulator=u,n.emulatorConfig=l,n.settings.appVerificationDisabledForTesting=!0,f(o)?(p(`${i}//${o}${c}`),y("Auth",!0)):s||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(r,`http://${i}`),r}(zg),Jg=io("https://hrmsocketonly.haremaltin.com",{transports:["websocket"]}),Yg=Date.now();function Qg(){var e;(e=document.getElementById("staleWarning"),e||((e=document.createElement("div")).id="staleWarning",e.innerText="GÜNCEL FİYAT OKUNAMADI !",e.style.position="fixed",e.style.right="10px",e.style.zIndex="9999",e.style.background="#f00",e.style.color="#fff",e.style.padding="10px 10px",e.style.borderRadius="6px",e.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",e.style.fontWeight="600",e.style.opacity="0.9",e.style.display="none",document.body.appendChild(e)),e).style.display="block"}function Xg(){var e=document.getElementById("staleWarning");e&&(e.style.display="none")}var Zg=function(){Vg.forEach(function(e){var t=e.alisHesap(),r=e.satisHesap();!function(e,t,r,n){var s=document.getElementById(e);if(s){var i=s.querySelector(".alis"),o=s.querySelector(".satis"),a=Mg(i.innerText),c=Mg(o.innerText),u=Ug(a,Number(t)),l=Ug(c,Number(r));$g(i,t,u,n),$g(o,r,l,n)}}(e.id,t,r,e.format)})};!function(e,t){R(e).onAuthStateChanged(t,void 0,void 0)}(Wg,function(){var e=Hg(Bg().m(function e(t){return Bg().w(function(e){for(;;)switch(e.n){case 0:if(t){e.n=1;break}return window.location.href="../index.html",e.a(2);case 1:return e.n=2,Og(t.uid,Gg,Wg);case 2:return e.n=3,Rg(t.uid);case 3:return e.n=4,jg(t.uid,Gg,Vg);case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()),Jg.on("price_changed",function(){var e=Hg(Bg().m(function e(t){var r,n;return Bg().w(function(e){for(;;)switch(e.n){case 0:return r=Object.values(t),n=Object.values(r[1]),Lg(n,Vg),e.n=1,Dg(Wg.currentUser.uid,Gg,Vg);case 1:Zg(),document.getElementById("has-alis").innerText=Fg(Vg[0].haremAlis,2),document.getElementById("has-satis").innerText=Fg(Vg[0].haremSatis,2),Yg=Date.now(),Xg();case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()),Jg.on("connect",function(){Date.now()-Yg<=3e3&&Xg()}),Jg.on("disconnect",function(e){console.warn("Socket disconnected:",e),Qg()}),Jg.on("connect_error",function(e){console.error("Socket connect_error:",e),Qg()}),Jg.on("reconnect",function(e){console.log("Socket reconnected, attempt:",e),Xg()}),setInterval(function(){var e=(new Date).getHours();e>=0&&e<6?Jg.connected&&(Jg.disconnect(),console.log("Socket bağlantısı kapatıldı (Gece 12 - Sabah 6 arası).")):Jg.connected||(Jg.connect(),console.log("Socket bağlantısı tekrar açıldı (Sabah 6 sonrası)."))},3e3),setInterval(function(){var e=Date.now();!Jg.connected||e-Yg>3e3?Qg():Xg()},1e3),setInterval(Hg(Bg().m(function e(){return Bg().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Og(uid,Gg,Wg);case 1:return e.a(2)}},e)})),3e5)})();