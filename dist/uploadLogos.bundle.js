/*! For license information please see uploadLogos.bundle.js.LICENSE.txt */
(()=>{var e={58(e){e.exports=function(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports},100(e,t,r){"use strict";var n=r(9131);e.exports=function(e){return n(e)||null===e}},260(e,t,r){"use strict";var n=r(9140),s=r(942),i=r(8793).String;e.exports=!!Object.getOwnPropertySymbols&&!s(function(){var e=Symbol("symbol detection");return!i(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41})},335(e,t,r){"use strict";var n=r(6857),s=r(942);e.exports=n&&s(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},460(e,t,r){"use strict";var n=r(848),s=r(9200),i=r(2430),o=r(6253),a=Object;e.exports=o?function(e){return"symbol"==typeof e}:function(e){var t=n("Symbol");return s(t)&&i(t.prototype,a(e))}},492(e,t,r){"use strict";var n=r(7315),s=Function.prototype.call;e.exports=n?s.bind(s):function(){return s.apply(s,arguments)}},640(e){"use strict";e.exports={}},685(e,t,r){"use strict";var n=r(7133),s=0,i=Math.random(),o=n(1.1.toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+o(++s+i,36)}},824(e,t,r){"use strict";var n=r(8793).navigator,s=n&&n.userAgent;e.exports=s?String(s):""},848(e,t,r){"use strict";var n=r(8793),s=r(9200);e.exports=function(e,t){return arguments.length<2?(r=n[e],s(r)?r:void 0):n[e]&&n[e][t];var r}},890(e,t,r){"use strict";var n=r(7315),s=Function.prototype,i=s.apply,o=s.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?o.bind(i):function(){return o.apply(i,arguments)})},917(e,t,r){"use strict";var n={};n[r(4702)("toStringTag")]="z",e.exports="[object z]"===String(n)},942(e){"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},957(e,t,r){"use strict";var n=r(492),s=r(4398),i=r(9200),o=r(5589),a=r(4762),c=TypeError;e.exports=function(e,t){var r=e.exec;if(i(r)){var u=n(r,e,t);return null!==u&&s(u),u}if("RegExp"===o(e))return n(a,e,t);throw new c("RegExp#exec called on incompatible receiver")}},1150(e,t,r){"use strict";var n=r(8793),s=r(942),i=n.RegExp,o=!s(function(){var e=!0;try{i(".","d")}catch(t){e=!1}var t={},r="",n=e?"dgimsy":"gimsy",s=function(e,n){Object.defineProperty(t,e,{get:function(){return r+=n,!0}})},o={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var a in e&&(o.hasIndices="d"),o)s(a,o[a]);return Object.getOwnPropertyDescriptor(i.prototype,"flags").get.call(t)!==n||r!==n});e.exports={correct:o}},1264(e,t){"use strict";t.f=Object.getOwnPropertySymbols},1427(e,t,r){"use strict";var n=r(492),s=r(9200),i=r(9131),o=TypeError;e.exports=function(e,t){var r,a;if("string"===t&&s(r=e.toString)&&!i(a=n(r,e)))return a;if(s(r=e.valueOf)&&!i(a=n(r,e)))return a;if("string"!==t&&s(r=e.toString)&&!i(a=n(r,e)))return a;throw new o("Can't convert object to primitive value")}},1466(e,t,r){"use strict";var n=r(8793),s=r(9131),i=n.document,o=s(i)&&s(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},1514(e,t,r){"use strict";var n,s,i,o=r(3125),a=r(8793),c=r(9131),u=r(5044),l=r(9158),h=r(5210),d=r(2316),f=r(640),p="Object already initialized",g=a.TypeError,m=a.WeakMap;if(o||h.state){var y=h.state||(h.state=new m);y.get=y.get,y.has=y.has,y.set=y.set,n=function(e,t){if(y.has(e))throw new g(p);return t.facade=e,y.set(e,t),t},s=function(e){return y.get(e)||{}},i=function(e){return y.has(e)}}else{var v=d("state");f[v]=!0,n=function(e,t){if(l(e,v))throw new g(p);return t.facade=e,u(e,v,t),t},s=function(e){return l(e,v)?e[v]:{}},i=function(e){return l(e,v)}}e.exports={set:n,get:s,has:i,enforce:function(e){return i(e)?s(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!c(t)||(r=s(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return r}}}},1818(e){"use strict";e.exports=!1},2007(e){"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},2030(e){"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},2066(e,t,r){"use strict";var n=r(6857),s=r(335),i=r(4446),o=r(4398),a=r(4360),c=r(3733);t.f=n&&!s?Object.defineProperties:function(e,t){o(e);for(var r,n=a(t),s=c(t),u=s.length,l=0;u>l;)i.f(e,r=s[l++],n[r]);return e}},2178(e){"use strict";e.exports=function(e){return null==e}},2210(e,t,r){"use strict";var n=r(9200),s=r(9131),i=r(8018);e.exports=function(e,t,r){var o,a;return i&&n(o=t.constructor)&&o!==r&&s(a=o.prototype)&&a!==r.prototype&&i(e,a),e}},2316(e,t,r){"use strict";var n=r(6014),s=r(685),i=n("keys");e.exports=function(e){return i[e]||(i[e]=s(e))}},2365(e,t,r){"use strict";var n=r(9200),s=r(7938),i=TypeError;e.exports=function(e){if(n(e))return e;throw new i(s(e)+" is not a function")}},2428(e,t,r){"use strict";var n=r(6857),s=r(492),i=r(6732),o=r(2007),a=r(4360),c=r(2548),u=r(9158),l=r(5842),h=Object.getOwnPropertyDescriptor;t.f=n?h:function(e,t){if(e=a(e),t=c(t),l)try{return h(e,t)}catch(e){}if(u(e,t))return o(!s(i.f,e,t),e[t])}},2430(e,t,r){"use strict";var n=r(7133);e.exports=n({}.isPrototypeOf)},2548(e,t,r){"use strict";var n=r(9422),s=r(460);e.exports=function(e){var t=n(e,"string");return s(t)?t:t+""}},2580(e,t,r){"use strict";var n=r(3353),s=r(4762);n({target:"RegExp",proto:!0,forced:/./.exec!==s},{exec:s})},2625(e){function t(r,n,s,i){var o=Object.defineProperty;try{o({},"",{})}catch(r){o=0}e.exports=t=function(e,r,n,s){function i(r,n){t(e,r,function(e){return this._invoke(r,n,e)})}r?o?o(e,r,{value:n,enumerable:!s,configurable:!s,writable:!s}):e[r]=n:(i("next",0),i("throw",1),i("return",2))},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n,s,i)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},2695(e,t,r){"use strict";var n=r(4932),s=Math.min;e.exports=function(e){var t=n(e);return t>0?s(t,9007199254740991):0}},2909(e,t,r){"use strict";var n,s=r(4398),i=r(2066),o=r(2030),a=r(640),c=r(4510),u=r(1466),l=r(2316),h="prototype",d="script",f=l("IE_PROTO"),p=function(){},g=function(e){return"<"+d+">"+e+"</"+d+">"},m=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},y=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}var e,t,r;y="undefined"!=typeof document?document.domain&&n?m(n):(t=u("iframe"),r="java"+d+":",t.style.display="none",c.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(g("document.F=Object")),e.close(),e.F):m(n);for(var s=o.length;s--;)delete y[h][o[s]];return y()};a[f]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(p[h]=s(e),r=new p,p[h]=null,r[f]=e):r=y(),void 0===t?r:i.f(r,t)}},2971(e,t,r){var n=r(8636)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},2997(e){"use strict";e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},3125(e,t,r){"use strict";var n=r(8793),s=r(9200),i=n.WeakMap;e.exports=s(i)&&/native code/.test(String(i))},3129(e,t,r){"use strict";var n=r(4174),s=r(4446);e.exports=function(e,t,r){return r.get&&n(r.get,t,{getter:!0}),r.set&&n(r.set,t,{setter:!0}),s.f(e,t,r)}},3353(e,t,r){"use strict";var n=r(8793),s=r(2428).f,i=r(5044),o=r(8521),a=r(8466),c=r(4085),u=r(7453);e.exports=function(e,t){var r,l,h,d,f,p=e.target,g=e.global,m=e.stat;if(r=g?n:m?n[p]||a(p,{}):n[p]&&n[p].prototype)for(l in t){if(d=t[l],h=e.dontCallGetSet?(f=s(r,l))&&f.value:r[l],!u(g?l:p+(m?".":"#")+l,e.forced)&&void 0!==h){if(typeof d==typeof h)continue;c(d,h)}(e.sham||h&&h.sham)&&i(d,"sham",!0),o(r,l,d,e)}}},3358(e,t,r){"use strict";var n=r(942),s=r(4702),i=r(9140),o=s("species");e.exports=function(e){return i>=51||!n(function(){var t=[];return(t.constructor={})[o]=function(){return{foo:1}},1!==t[e](Boolean).foo})}},3614(e,t,r){"use strict";var n=r(7133),s=r(942),i=r(9200),o=r(3650),a=r(848),c=r(7217),u=function(){},l=a("Reflect","construct"),h=/^\s*(?:class|function)\b/,d=n(h.exec),f=!h.test(u),p=function(e){if(!i(e))return!1;try{return l(u,[],e),!0}catch(e){return!1}},g=function(e){if(!i(e))return!1;switch(o(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f||!!d(h,c(e))}catch(e){return!0}};g.sham=!0,e.exports=!l||s(function(){var e;return p(p.call)||!p(Object)||!p(function(){e=!0})||e})?g:p},3650(e,t,r){"use strict";var n=r(917),s=r(9200),i=r(5589),o=r(4702)("toStringTag"),a=Object,c="Arguments"===i(function(){return arguments}());e.exports=n?i:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=a(e),o))?r:c?i(t):"Object"===(n=i(t))&&s(t.callee)?"Arguments":n}},3733(e,t,r){"use strict";var n=r(8959),s=r(2030);e.exports=Object.keys||function(e){return n(e,s)}},3977(e,t,r){"use strict";var n=r(2178),s=TypeError;e.exports=function(e){if(n(e))throw new s("Can't call method on "+e);return e}},4085(e,t,r){"use strict";var n=r(9158),s=r(4540),i=r(2428),o=r(4446);e.exports=function(e,t,r){for(var a=s(t),c=o.f,u=i.f,l=0;l<a.length;l++){var h=a[l];n(e,h)||r&&n(r,h)||c(e,h,u(t,h))}}},4174(e,t,r){"use strict";var n=r(7133),s=r(942),i=r(9200),o=r(9158),a=r(6857),c=r(7403).CONFIGURABLE,u=r(7217),l=r(1514),h=l.enforce,d=l.get,f=String,p=Object.defineProperty,g=n("".slice),m=n("".replace),y=n([].join),v=a&&!s(function(){return 8!==p(function(){},"length",{value:8}).length}),w=String(String).split("String"),b=e.exports=function(e,t,r){"Symbol("===g(f(t),0,7)&&(t="["+m(f(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!o(e,"name")||c&&e.name!==t)&&(a?p(e,"name",{value:t,configurable:!0}):e.name=t),v&&r&&o(r,"arity")&&e.length!==r.arity&&p(e,"length",{value:r.arity});try{r&&o(r,"constructor")&&r.constructor?a&&p(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var n=h(e);return o(n,"source")||(n.source=y(w,"string"==typeof t?t:"")),e};Function.prototype.toString=b(function(){return i(this)&&d(this).source||u(this)},"toString")},4360(e,t,r){"use strict";var n=r(8060),s=r(3977);e.exports=function(e){return n(s(e))}},4398(e,t,r){"use strict";var n=r(9131),s=String,i=TypeError;e.exports=function(e){if(n(e))return e;throw new i(s(e)+" is not an object")}},4446(e,t,r){"use strict";var n=r(6857),s=r(5842),i=r(335),o=r(4398),a=r(2548),c=TypeError,u=Object.defineProperty,l=Object.getOwnPropertyDescriptor,h="enumerable",d="configurable",f="writable";t.f=n?i?function(e,t,r){if(o(e),t=a(t),o(r),"function"==typeof e&&"prototype"===t&&"value"in r&&f in r&&!r[f]){var n=l(e,t);n&&n[f]&&(e[t]=r.value,r={configurable:d in r?r[d]:n[d],enumerable:h in r?r[h]:n[h],writable:!1})}return u(e,t,r)}:u:function(e,t,r){if(o(e),t=a(t),o(r),s)try{return u(e,t,r)}catch(e){}if("get"in r||"set"in r)throw new c("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},4510(e,t,r){"use strict";var n=r(848);e.exports=n("document","documentElement")},4540(e,t,r){"use strict";var n=r(848),s=r(7133),i=r(5809),o=r(1264),a=r(4398),c=s([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=i.f(a(e)),r=o.f;return r?c(t,r(e)):t}},4686(e){"use strict";var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},4702(e,t,r){"use strict";var n=r(8793),s=r(6014),i=r(9158),o=r(685),a=r(260),c=r(6253),u=n.Symbol,l=s("wks"),h=c?u.for||u:u&&u.withoutSetter||o;e.exports=function(e){return i(l,e)||(l[e]=a&&i(u,e)?u[e]:h("Symbol."+e)),l[e]}},4762(e,t,r){"use strict";var n,s,i=r(492),o=r(7133),a=r(7830),c=r(9824),u=r(9260),l=r(6014),h=r(2909),d=r(1514).get,f=r(7432),p=r(6437),g=l("native-string-replace",String.prototype.replace),m=RegExp.prototype.exec,y=m,v=o("".charAt),w=o("".indexOf),b=o("".replace),_=o("".slice),E=(s=/b*/g,i(m,n=/a/,"a"),i(m,s,"a"),0!==n.lastIndex||0!==s.lastIndex),T=u.BROKEN_CARET,S=void 0!==/()??/.exec("")[1];(E||S||T||f||p)&&(y=function(e){var t,r,n,s,o,u,l,f=this,p=d(f),I=a(e),k=p.raw;if(k)return k.lastIndex=f.lastIndex,t=i(y,k,I),f.lastIndex=k.lastIndex,t;var C=p.groups,A=T&&f.sticky,O=i(c,f),R=f.source,P=0,N=I;if(A&&(O=b(O,"y",""),-1===w(O,"g")&&(O+="g"),N=_(I,f.lastIndex),f.lastIndex>0&&(!f.multiline||f.multiline&&"\n"!==v(I,f.lastIndex-1))&&(R="(?: "+R+")",N=" "+N,P++),r=new RegExp("^(?:"+R+")",O)),S&&(r=new RegExp("^"+R+"$(?!\\s)",O)),E&&(n=f.lastIndex),s=i(m,A?r:f,N),A?s?(s.input=_(s.input,P),s[0]=_(s[0],P),s.index=f.lastIndex,f.lastIndex+=s[0].length):f.lastIndex=0:E&&s&&(f.lastIndex=f.global?s.index+s[0].length:n),S&&s&&s.length>1&&i(g,s[0],r,function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(s[o]=void 0)}),s&&C)for(s.groups=u=h(null),o=0;o<C.length;o++)u[(l=C[o])[0]]=s[l[1]];return s}),e.exports=y},4932(e,t,r){"use strict";var n=r(8226);e.exports=function(e){var t=+e;return t!=t||0===t?0:n(t)}},5044(e,t,r){"use strict";var n=r(6857),s=r(4446),i=r(2007);e.exports=n?function(e,t,r){return s.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},5119(e,t,r){"use strict";r(2580);var n=r(492),s=r(8521),i=r(4762),o=r(942),a=r(4702),c=r(5044),u=a("species"),l=RegExp.prototype;e.exports=function(e,t,r,h){var d=a(e),f=!o(function(){var t={};return t[d]=function(){return 7},7!==""[e](t)}),p=f&&!o(function(){var t=!1,r=/a/;if("split"===e){var n={};n[u]=function(){return r},(r={constructor:n,flags:""})[d]=/./[d]}return r.exec=function(){return t=!0,null},r[d](""),!t});if(!f||!p||r){var g=/./[d],m=t(d,""[e],function(e,t,r,s,o){var a=t.exec;return a===i||a===l.exec?f&&!o?{done:!0,value:n(g,t,r,s)}:{done:!0,value:n(e,r,t,s)}:{done:!1}});s(String.prototype,e,m[0]),s(l,d,m[1])}h&&c(l[d],"sham",!0)}},5132(e,t,r){var n=r(7986),s=r(7362);e.exports=function(e,t,r,i,o){return new s(n().w(e,t,r,i),o||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports},5133(e,t,r){"use strict";var n=r(3353),s=r(1818),i=r(6857),o=r(8793),a=r(7596),c=r(7133),u=r(7453),l=r(9158),h=r(2210),d=r(2430),f=r(460),p=r(9422),g=r(942),m=r(5809).f,y=r(2428).f,v=r(4446).f,w=r(5949),b=r(7087).trim,_="Number",E=o[_],T=a[_],S=E.prototype,I=o.TypeError,k=c("".slice),C=c("".charCodeAt),A=u(_,!E(" 0o1")||!E("0b1")||E("+0x1")),O=function(e){var t,r=arguments.length<1?0:E(function(e){var t=p(e,"number");return"bigint"==typeof t?t:function(e){var t,r,n,s,i,o,a,c,u=p(e,"number");if(f(u))throw new I("Cannot convert a Symbol value to a number");if("string"==typeof u&&u.length>2)if(u=b(u),43===(t=C(u,0))||45===t){if(88===(r=C(u,2))||120===r)return NaN}else if(48===t){switch(C(u,1)){case 66:case 98:n=2,s=49;break;case 79:case 111:n=8,s=55;break;default:return+u}for(o=(i=k(u,2)).length,a=0;a<o;a++)if((c=C(i,a))<48||c>s)return NaN;return parseInt(i,n)}return+u}(t)}(e));return d(S,t=this)&&g(function(){w(t)})?h(Object(r),this,O):r};O.prototype=S,A&&!s&&(S.constructor=O),n({global:!0,constructor:!0,wrap:!0,forced:A},{Number:O});var R=function(e,t){for(var r,n=i?m(t):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),s=0;n.length>s;s++)l(t,r=n[s])&&!l(e,r)&&v(e,r,y(t,r))};s&&T&&R(a[_],T),(A||s)&&R(a[_],E)},5185(e,t,r){"use strict";var n=r(890),s=r(492),i=r(7133),o=r(5119),a=r(942),c=r(4398),u=r(9200),l=r(9131),h=r(4932),d=r(2695),f=r(7830),p=r(3977),g=r(8718),m=r(9325),y=r(8965),v=r(7781),w=r(957),b=r(4702)("replace"),_=Math.max,E=Math.min,T=i([].concat),S=i([].push),I=i("".indexOf),k=i("".slice),C=function(e){return void 0===e?e:String(e)},A="$0"==="a".replace(/./,"$0"),O=!!/./[b]&&""===/./[b]("a","$0");o("replace",function(e,t,r){var i=O?"$":"$0";return[function(e,r){var n=p(this),i=l(e)?m(e,b):void 0;return i?s(i,e,n,r):s(t,f(n),e,r)},function(e,s){var o=c(this),a=f(e);if("string"==typeof s&&-1===I(s,i)&&-1===I(s,"$<")){var l=r(t,o,a,s);if(l.done)return l.value}var p=u(s);p||(s=f(s));var m,b=f(v(o)),A=-1!==I(b,"g");A&&(m=-1!==I(b,"u"),o.lastIndex=0);for(var O,R=[];null!==(O=w(o,a))&&(S(R,O),A);)""===f(O[0])&&(o.lastIndex=g(a,d(o.lastIndex),m));for(var P="",N=0,x=0;x<R.length;x++){for(var D,L=f((O=R[x])[0]),j=_(E(h(O.index),a.length),0),U=[],M=1;M<O.length;M++)S(U,C(O[M]));var $=O.groups;if(p){var F=T([L],U,j,a);void 0!==$&&S(F,$),D=f(n(s,void 0,F))}else D=y(L,a,j,U,$,s);j>=N&&(P+=k(a,N,j)+D,N=j+L.length)}return P+k(a,N)}]},!!a(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})||!A||O)},5210(e,t,r){"use strict";var n=r(1818),s=r(8793),i=r(8466),o="__core-js_shared__",a=e.exports=s[o]||i(o,{});(a.versions||(a.versions=[])).push({version:"3.47.0",mode:n?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.47.0/LICENSE",source:"https://github.com/zloirock/core-js"})},5589(e,t,r){"use strict";var n=r(7133),s=n({}.toString),i=n("".slice);e.exports=function(e){return i(s(e),8,-1)}},5809(e,t,r){"use strict";var n=r(8959),s=r(2030).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,s)}},5842(e,t,r){"use strict";var n=r(6857),s=r(942),i=r(1466);e.exports=!n&&!s(function(){return 7!==Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a})},5909(e,t,r){"use strict";var n=r(6857),s=r(4446),i=r(2007);e.exports=function(e,t,r){n?s.f(e,t,i(0,r)):e[t]=r}},5949(e,t,r){"use strict";var n=r(7133);e.exports=n(1.1.valueOf)},6014(e,t,r){"use strict";var n=r(5210);e.exports=function(e,t){return n[e]||(n[e]=t||{})}},6134(e,t,r){"use strict";var n=r(4360),s=r(8479),i=r(7457),o=function(e){return function(t,r,o){var a=n(t),c=i(a);if(0===c)return!e&&-1;var u,l=s(o,c);if(e&&r!=r){for(;c>l;)if((u=a[l++])!=u)return!0}else for(;c>l;l++)if((e||l in a)&&a[l]===r)return e||l||0;return!e&&-1}};e.exports={includes:o(!0),indexOf:o(!1)}},6253(e,t,r){"use strict";var n=r(260);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},6345(e,t,r){"use strict";var n=r(6857),s=r(7403).EXISTS,i=r(7133),o=r(3129),a=Function.prototype,c=i(a.toString),u=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,l=i(u.exec);n&&!s&&o(a,"name",{configurable:!0,get:function(){try{return l(u,c(this))[1]}catch(e){return""}}})},6367(e){e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports},6437(e,t,r){"use strict";var n=r(942),s=r(8793).RegExp;e.exports=n(function(){var e=s("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})},6732(e,t){"use strict";var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,s=n&&!r.call({1:2},1);t.f=s?function(e){var t=n(this,e);return!!t&&t.enumerable}:r},6760(e,t,r){"use strict";var n=r(9323),s=r(3614),i=r(9131),o=r(4702)("species"),a=Array;e.exports=function(e){var t;return n(e)&&(t=e.constructor,(s(t)&&(t===a||n(t.prototype))||i(t)&&null===(t=t[o]))&&(t=void 0)),void 0===t?a:t}},6857(e,t,r){"use strict";var n=r(942);e.exports=!n(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},7087(e,t,r){"use strict";var n=r(7133),s=r(3977),i=r(7830),o=r(2997),a=n("".replace),c=RegExp("^["+o+"]+"),u=RegExp("(^|[^"+o+"])["+o+"]+$"),l=function(e){return function(t){var r=i(s(t));return 1&e&&(r=a(r,c,"")),2&e&&(r=a(r,u,"$1")),r}};e.exports={start:l(1),end:l(2),trim:l(3)}},7133(e,t,r){"use strict";var n=r(7315),s=Function.prototype,i=s.call,o=n&&s.bind.bind(i,i);e.exports=n?o:function(e){return function(){return i.apply(e,arguments)}}},7217(e,t,r){"use strict";var n=r(7133),s=r(9200),i=r(5210),o=n(Function.toString);s(i.inspectSource)||(i.inspectSource=function(e){return o(e)}),e.exports=i.inspectSource},7231(e,t,r){"use strict";var n=r(3353),s=r(942),i=r(9323),o=r(9131),a=r(9272),c=r(7457),u=r(4686),l=r(5909),h=r(9498),d=r(3358),f=r(4702),p=r(9140),g=f("isConcatSpreadable"),m=p>=51||!s(function(){var e=[];return e[g]=!1,e.concat()[0]!==e}),y=function(e){if(!o(e))return!1;var t=e[g];return void 0!==t?!!t:i(e)};n({target:"Array",proto:!0,arity:1,forced:!m||!d("concat")},{concat:function(e){var t,r,n,s,i,o=a(this),d=h(o,0),f=0;for(t=-1,n=arguments.length;t<n;t++)if(y(i=-1===t?o:arguments[t]))for(s=c(i),u(f+s),r=0;r<s;r++,f++)r in i&&l(d,f,i[r]);else u(f+1),l(d,f++,i);return d.length=f,d}})},7315(e,t,r){"use strict";var n=r(942);e.exports=!n(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})},7362(e,t,r){var n=r(6367),s=r(2625);e.exports=function e(t,r){function i(e,s,o,a){try{var c=t[e](s),u=c.value;return u instanceof n?r.resolve(u.v).then(function(e){i("next",e,o,a)},function(e){i("throw",e,o,a)}):r.resolve(u).then(function(e){c.value=e,o(c)},function(e){return i("throw",e,o,a)})}catch(e){a(e)}}var o;this.next||(s(e.prototype),s(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),s(this,"_invoke",function(e,t,n){function s(){return new r(function(t,r){i(e,n,t,r)})}return o=o?o.then(s,s):s()},!0)},e.exports.__esModule=!0,e.exports.default=e.exports},7403(e,t,r){"use strict";var n=r(6857),s=r(9158),i=Function.prototype,o=n&&Object.getOwnPropertyDescriptor,a=s(i,"name"),c=a&&"something"===function(){}.name,u=a&&(!n||n&&o(i,"name").configurable);e.exports={EXISTS:a,PROPER:c,CONFIGURABLE:u}},7432(e,t,r){"use strict";var n=r(942),s=r(8793).RegExp;e.exports=n(function(){var e=s(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)})},7453(e,t,r){"use strict";var n=r(942),s=r(9200),i=/#|\.prototype\./,o=function(e,t){var r=c[a(e)];return r===l||r!==u&&(s(t)?n(t):!!t)},a=o.normalize=function(e){return String(e).replace(i,".").toLowerCase()},c=o.data={},u=o.NATIVE="N",l=o.POLYFILL="P";e.exports=o},7457(e,t,r){"use strict";var n=r(2695);e.exports=function(e){return n(e.length)}},7596(e,t,r){"use strict";var n=r(8793);e.exports=n},7781(e,t,r){"use strict";var n=r(492),s=r(9158),i=r(2430),o=r(1150),a=r(9824),c=RegExp.prototype;e.exports=o.correct?function(e){return e.flags}:function(e){return o.correct||!i(c,e)||s(e,"flags")?e.flags:n(a,e)}},7830(e,t,r){"use strict";var n=r(3650),s=String;e.exports=function(e){if("Symbol"===n(e))throw new TypeError("Cannot convert a Symbol value to a string");return s(e)}},7938(e){"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},7986(e,t,r){var n=r(2625);function s(){var t,r,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.toStringTag||"@@toStringTag";function c(e,s,i,o){var a=s&&s.prototype instanceof l?s:l,c=Object.create(a.prototype);return n(c,"_invoke",function(e,n,s){var i,o,a,c=0,l=s||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,r){return i=e,o=0,a=t,d.n=r,u}};function f(e,n){for(o=e,a=n,r=0;!h&&c&&!s&&r<l.length;r++){var s,i=l[r],f=d.p,p=i[2];e>3?(s=p===n)&&(a=i[(o=i[4])?5:(o=3,3)],i[4]=i[5]=t):i[0]<=f&&((s=e<2&&f<i[1])?(o=0,d.v=n,d.n=i[1]):f<p&&(s=e<3||i[0]>n||n>p)&&(i[4]=e,i[5]=n,d.n=p,o=0))}if(s||e>1)return u;throw h=!0,n}return function(s,l,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===l&&f(l,p),o=l,a=p;(r=o<2?t:a)||!h;){i||(o?o<3?(o>1&&(d.n=-1),f(o,a)):d.n=a:d.v=a);try{if(c=2,i){if(o||(s="next"),r=i[s]){if(!(r=r.call(i,a)))throw TypeError("iterator result is not an object");if(!r.done)return r;a=r.value,o<2&&(o=0)}else 1===o&&(r=i.return)&&r.call(i),o<2&&(a=TypeError("The iterator does not provide a '"+s+"' method"),o=1);i=t}else if((r=(h=d.n<0)?a:e.call(n,d))!==u)break}catch(e){i=t,o=1,a=e}finally{c=1}}return{value:r,done:h}}}(e,i,o),!0),c}var u={};function l(){}function h(){}function d(){}r=Object.getPrototypeOf;var f=[][o]?r(r([][o]())):(n(r={},o,function(){return this}),r),p=d.prototype=l.prototype=Object.create(f);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,n(e,a,"GeneratorFunction")),e.prototype=Object.create(p),e}return h.prototype=d,n(p,"constructor",d),n(d,"constructor",h),h.displayName="GeneratorFunction",n(d,a,"GeneratorFunction"),n(p),n(p,a,"Generator"),n(p,o,function(){return this}),n(p,"toString",function(){return"[object Generator]"}),(e.exports=s=function(){return{w:c,m:g}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports},8018(e,t,r){"use strict";var n=r(9229),s=r(9131),i=r(3977),o=r(9677);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=n(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return i(r),o(n),s(r)?(t?e(r,n):r.__proto__=n,r):r}}():void 0)},8060(e,t,r){"use strict";var n=r(7133),s=r(942),i=r(5589),o=Object,a=n("".split);e.exports=s(function(){return!o("z").propertyIsEnumerable(0)})?function(e){return"String"===i(e)?a(e,""):o(e)}:o},8168(e,t,r){var n=r(5132);e.exports=function(e,t,r,s,i){var o=n(e,t,r,s,i);return o.next().then(function(e){return e.done?e.value:o.next()})},e.exports.__esModule=!0,e.exports.default=e.exports},8226(e){"use strict";var t=Math.ceil,r=Math.floor;e.exports=Math.trunc||function(e){var n=+e;return(n>0?r:t)(n)}},8466(e,t,r){"use strict";var n=r(8793),s=Object.defineProperty;e.exports=function(e,t){try{s(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}},8479(e,t,r){"use strict";var n=r(4932),s=Math.max,i=Math.min;e.exports=function(e,t){var r=n(e);return r<0?s(r+t,0):i(r,t)}},8521(e,t,r){"use strict";var n=r(9200),s=r(4446),i=r(4174),o=r(8466);e.exports=function(e,t,r,a){a||(a={});var c=a.enumerable,u=void 0!==a.name?a.name:t;if(n(r)&&i(r,u,a),a.global)c?e[t]=r:o(t,r);else{try{a.unsafe?e[t]&&(c=!0):delete e[t]}catch(e){}c?e[t]=r:s.f(e,t,{value:r,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e}},8636(e,t,r){var n=r(6367),s=r(7986),i=r(8168),o=r(5132),a=r(7362),c=r(58),u=r(8988);function l(){"use strict";var t=s(),r=t.m(l),h=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function d(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))}var f={throw:1,return:2,break:3,continue:3};function p(e){var t,r;return function(n){t||(t={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(e,t){return r(n.a,f[e],t)},delegateYield:function(e,s,i){return t.resultName=s,r(n.d,u(e),i)},finish:function(e){return r(n.f,e)}},r=function(e,r,s){n.p=t.prev,n.n=t.next;try{return e(r,s)}finally{t.next=n.n}}),t.resultName&&(t[t.resultName]=n.v,t.resultName=void 0),t.sent=n.v,t.next=n.n;try{return e.call(this,t)}finally{n.p=t.prev,n.n=t.next}}}return(e.exports=l=function(){return{wrap:function(e,r,n,s){return t.w(p(e),r,n,s&&s.reverse())},isGeneratorFunction:d,mark:t.m,awrap:function(e,t){return new n(e,t)},AsyncIterator:a,async:function(e,t,r,n,s){return(d(t)?o:i)(p(e),t,r,n,s)},keys:c,values:u}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=l,e.exports.__esModule=!0,e.exports.default=e.exports},8718(e,t,r){"use strict";var n=r(9944).charAt;e.exports=function(e,t,r){return t+(r?n(e,t).length:1)}},8793(e,t,r){"use strict";var n=function(e){return e&&e.Math===Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof r.g&&r.g)||n("object"==typeof this&&this)||function(){return this}()||Function("return this")()},8959(e,t,r){"use strict";var n=r(7133),s=r(9158),i=r(4360),o=r(6134).indexOf,a=r(640),c=n([].push);e.exports=function(e,t){var r,n=i(e),u=0,l=[];for(r in n)!s(a,r)&&s(n,r)&&c(l,r);for(;t.length>u;)s(n,r=t[u++])&&(~o(l,r)||c(l,r));return l}},8965(e,t,r){"use strict";var n=r(7133),s=r(9272),i=Math.floor,o=n("".charAt),a=n("".replace),c=n("".slice),u=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,l=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,r,n,h,d){var f=r+e.length,p=n.length,g=l;return void 0!==h&&(h=s(h),g=u),a(d,g,function(s,a){var u;switch(o(a,0)){case"$":return"$";case"&":return e;case"`":return c(t,0,r);case"'":return c(t,f);case"<":u=h[c(a,1,-1)];break;default:var l=+a;if(0===l)return s;if(l>p){var d=i(l/10);return 0===d?s:d<=p?void 0===n[d-1]?o(a,1):n[d-1]+o(a,1):s}u=n[l-1]}return void 0===u?"":u})}},8988(e,t,r){var n=r(9091).default;e.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(n(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports},9091(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},9131(e,t,r){"use strict";var n=r(9200);e.exports=function(e){return"object"==typeof e?null!==e:n(e)}},9140(e,t,r){"use strict";var n,s,i=r(8793),o=r(824),a=i.process,c=i.Deno,u=a&&a.versions||c&&c.version,l=u&&u.v8;l&&(s=(n=l.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!s&&o&&(!(n=o.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=o.match(/Chrome\/(\d+)/))&&(s=+n[1]),e.exports=s},9158(e,t,r){"use strict";var n=r(7133),s=r(9272),i=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return i(s(e),t)}},9200(e){"use strict";var t="object"==typeof document&&document.all;e.exports=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},9229(e,t,r){"use strict";var n=r(7133),s=r(2365);e.exports=function(e,t,r){try{return n(s(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(e){}}},9260(e,t,r){"use strict";var n=r(942),s=r(8793).RegExp,i=n(function(){var e=s("a","y");return e.lastIndex=2,null!==e.exec("abcd")}),o=i||n(function(){return!s("a","y").sticky}),a=i||n(function(){var e=s("^r","gy");return e.lastIndex=2,null!==e.exec("str")});e.exports={BROKEN_CARET:a,MISSED_STICKY:o,UNSUPPORTED_Y:i}},9272(e,t,r){"use strict";var n=r(3977),s=Object;e.exports=function(e){return s(n(e))}},9323(e,t,r){"use strict";var n=r(5589);e.exports=Array.isArray||function(e){return"Array"===n(e)}},9325(e,t,r){"use strict";var n=r(2365),s=r(2178);e.exports=function(e,t){var r=e[t];return s(r)?void 0:n(r)}},9422(e,t,r){"use strict";var n=r(492),s=r(9131),i=r(460),o=r(9325),a=r(1427),c=r(4702),u=TypeError,l=c("toPrimitive");e.exports=function(e,t){if(!s(e)||i(e))return e;var r,c=o(e,l);if(c){if(void 0===t&&(t="default"),r=n(c,e,t),!s(r)||i(r))return r;throw new u("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},9498(e,t,r){"use strict";var n=r(6760);e.exports=function(e,t){return new(n(e))(0===t?0:t)}},9677(e,t,r){"use strict";var n=r(100),s=String,i=TypeError;e.exports=function(e){if(n(e))return e;throw new i("Can't set "+s(e)+" as a prototype")}},9824(e,t,r){"use strict";var n=r(4398);e.exports=function(){var e=n(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},9944(e,t,r){"use strict";var n=r(7133),s=r(4932),i=r(7830),o=r(3977),a=n("".charAt),c=n("".charCodeAt),u=n("".slice),l=function(e){return function(t,r){var n,l,h=i(o(t)),d=s(r),f=h.length;return d<0||d>=f?e?"":void 0:(n=c(h,d))<55296||n>56319||d+1===f||(l=c(h,d+1))<56320||l>57343?e?a(h,d):n:e?u(h,d,d+2):l-56320+(n-55296<<10)+65536}};e.exports={codeAt:l(!1),charAt:l(!0)}}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";function e(e,t,r,n,s,i,o){try{var a=e[i](o),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,s)}function t(t){return function(){var r=this,n=arguments;return new Promise(function(s,i){var o=t.apply(r,n);function a(t){e(o,s,i,a,c,"next",t)}function c(t){e(o,s,i,a,c,"throw",t)}a(void 0)})}}r(7231),r(6345),r(2580),r(5185);var n=r(2971),s=r.n(n);const i=function(e){const t=[];let r=0;for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=63&s|128):55296==(64512&s)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++n)),t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=63&s|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=63&s|128)}return t},o={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){const s=e[t],i=t+1<e.length,o=i?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=s>>2,l=(3&s)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(h=64)),n.push(r[u],r[l],r[h],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let r=0,n=0;for(;r<e.length;){const s=e[r++];if(s<128)t[n++]=String.fromCharCode(s);else if(s>191&&s<224){const i=e[r++];t[n++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(i>>10)),t[n++]=String.fromCharCode(56320+(1023&i))}else{const i=e[r++],o=e[r++];t[n++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){const s=r[e.charAt(t++)],i=t<e.length?r[e.charAt(t)]:0;++t;const o=t<e.length?r[e.charAt(t)]:64;++t;const c=t<e.length?r[e.charAt(t)]:64;if(++t,null==s||null==i||null==o||null==c)throw new a;const u=s<<2|i>>4;if(n.push(u),64!==o){const e=i<<4&240|o>>2;if(n.push(e),64!==c){const e=o<<6&192|c;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class a extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const c=function(e){return function(e){const t=i(e);return o.encodeByteArray(t,!0)}(e).replace(/\./g,"")},u=function(e){try{return o.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};const l=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&u(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},h=e=>{var t,r;return null===(r=null===(t=l())||void 0===t?void 0:t.emulatorHosts)||void 0===r?void 0:r[e]},d=()=>{var e;return null===(e=l())||void 0===e?void 0:e.config},f=e=>{var t;return null===(t=l())||void 0===t?void 0:t[`_${e}`]};class p{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function g(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(e){return!1}}async function m(e){return(await fetch(e,{credentials:"include"})).ok}const y={};let v=!1;function w(e,t){if("undefined"==typeof window||"undefined"==typeof document||!g(window.location.host)||y[e]===t||y[e]||v)return;function r(e){return`__firebase__banner__${e}`}y[e]=t;const n="__firebase__banner",s=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(y))y[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){const e=function(e){let t=document.getElementById(e),r=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),r=!0),{created:r,element:t}}(n),t=r("text"),i=document.getElementById(t)||document.createElement("span"),o=r("learnmore"),a=document.getElementById(o)||document.createElement("a"),c=r("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(a,o);const r=function(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{v=!0,function(){const e=document.getElementById(n);e&&e.remove()}()},e}();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(u,c),t.append(u,i,a,r),document.body.appendChild(t)}s?(i.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',i.innerText="Preview backend running in this workspace."),i.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",i):i()}function b(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function _(){return!function(){var e;const t=null===(e=l())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(r.g.process)}catch(e){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class E extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,E.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,T.prototype.create)}}class T{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},n=`${this.service}/${e}`,s=this.errors[e],i=s?function(e,t){return e.replace(S,(e,r)=>{const n=t[r];return null!=n?String(n):`<${r}?>`})}(s,r):"Error",o=`${this.serviceName}: ${i} (${n}).`;return new E(n,o,r)}}const S=/\{\$([^}]+)}/g;function I(e,t){if(e===t)return!0;const r=Object.keys(e),n=Object.keys(t);for(const s of r){if(!n.includes(s))return!1;const r=e[s],i=t[s];if(k(r)&&k(i)){if(!I(r,i))return!1}else if(r!==i)return!1}for(const e of n)if(!r.includes(e))return!1;return!0}function k(e){return null!==e&&"object"==typeof e}function C(e){const t=[];for(const[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function A(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function O(e){const t=e.indexOf("?");if(!t)return"";const r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}class R{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw new Error("Missing Observer.");n=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:r},void 0===n.next&&(n.next=P),void 0===n.error&&(n.error=P),void 0===n.complete&&(n.complete=P);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function P(){}function N(e){return e&&e._delegate?e._delegate:e}class x{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const D="[DEFAULT]";class L{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new p;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(r)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:r})}catch(e){if(n)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:D})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=D){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=D){return this.instances.has(e)}getOptions(e=D){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){var r;const n=this.normalizeInstanceIdentifier(t),s=null!==(r=this.onInitCallbacks.get(n))&&void 0!==r?r:new Set;s.add(e),this.onInitCallbacks.set(n,s);const i=this.instances.get(n);return i&&e(i,n),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const n of r)try{n(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===D?void 0:n),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(e){}var n;return r||null}normalizeInstanceIdentifier(e=D){return this.component?this.component.multipleInstances?e:D:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class j{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new L(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const U=[];var M;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(M||(M={}));const $={debug:M.DEBUG,verbose:M.VERBOSE,info:M.INFO,warn:M.WARN,error:M.ERROR,silent:M.SILENT},F=M.INFO,V={[M.DEBUG]:"log",[M.VERBOSE]:"log",[M.INFO]:"info",[M.WARN]:"warn",[M.ERROR]:"error"},B=(e,t,...r)=>{if(t<e.logLevel)return;const n=(new Date).toISOString(),s=V[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${n}]  ${e.name}:`,...r)};class q{constructor(e){this.name=e,this._logLevel=F,this._logHandler=B,this._userLogHandler=null,U.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in M))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?$[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,M.DEBUG,...e),this._logHandler(this,M.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,M.VERBOSE,...e),this._logHandler(this,M.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,M.INFO,...e),this._logHandler(this,M.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,M.WARN,...e),this._logHandler(this,M.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,M.ERROR,...e),this._logHandler(this,M.ERROR,...e)}}let z,K;const H=new WeakMap,W=new WeakMap,G=new WeakMap,J=new WeakMap,Y=new WeakMap;let Q={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return W.get(e);if("objectStoreNames"===t)return e.objectStoreNames||G.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Z(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function X(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(K||(K=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(ee(this),e),Z(H.get(this))}:function(...e){return Z(t.apply(ee(this),e))}:function(e,...r){const n=t.call(ee(this),e,...r);return G.set(n,e.sort?e.sort():[e]),Z(n)}:(e instanceof IDBTransaction&&function(e){if(W.has(e))return;const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{t(),n()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)});W.set(e,t)}(e),r=e,(z||(z=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>r instanceof e)?new Proxy(e,Q):e);var t,r}function Z(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{t(Z(e.result)),n()},i=()=>{r(e.error),n()};e.addEventListener("success",s),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&H.set(t,e)}).catch(()=>{}),Y.set(t,e),t}(e);if(J.has(e))return J.get(e);const t=X(e);return t!==e&&(J.set(e,t),Y.set(t,e)),t}const ee=e=>Y.get(e),te=["get","getKey","getAll","getAllKeys","count"],re=["put","add","delete","clear"],ne=new Map;function se(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(ne.get(t))return ne.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,s=re.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!s&&!te.includes(r))return;const i=async function(e,...t){const i=this.transaction(e,s?"readwrite":"readonly");let o=i.store;return n&&(o=o.index(t.shift())),(await Promise.all([o[r](...t),s&&i.done]))[0]};return ne.set(t,i),i}var ie;ie=Q,Q={...ie,get:(e,t,r)=>se(e,t)||ie.get(e,t,r),has:(e,t)=>!!se(e,t)||ie.has(e,t)};class oe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const ae="@firebase/app",ce="0.13.2",ue=new q("@firebase/app"),le="@firebase/app-compat",he="@firebase/analytics-compat",de="@firebase/analytics",fe="@firebase/app-check-compat",pe="@firebase/app-check",ge="@firebase/auth",me="@firebase/auth-compat",ye="@firebase/database",ve="@firebase/data-connect",we="@firebase/database-compat",be="@firebase/functions",_e="@firebase/functions-compat",Ee="@firebase/installations",Te="@firebase/installations-compat",Se="@firebase/messaging",Ie="@firebase/messaging-compat",ke="@firebase/performance",Ce="@firebase/performance-compat",Ae="@firebase/remote-config",Oe="@firebase/remote-config-compat",Re="@firebase/storage",Pe="@firebase/storage-compat",Ne="@firebase/firestore",xe="@firebase/ai",De="@firebase/firestore-compat",Le="firebase",je="[DEFAULT]",Ue={[ae]:"fire-core",[le]:"fire-core-compat",[de]:"fire-analytics",[he]:"fire-analytics-compat",[pe]:"fire-app-check",[fe]:"fire-app-check-compat",[ge]:"fire-auth",[me]:"fire-auth-compat",[ye]:"fire-rtdb",[ve]:"fire-data-connect",[we]:"fire-rtdb-compat",[be]:"fire-fn",[_e]:"fire-fn-compat",[Ee]:"fire-iid",[Te]:"fire-iid-compat",[Se]:"fire-fcm",[Ie]:"fire-fcm-compat",[ke]:"fire-perf",[Ce]:"fire-perf-compat",[Ae]:"fire-rc",[Oe]:"fire-rc-compat",[Re]:"fire-gcs",[Pe]:"fire-gcs-compat",[Ne]:"fire-fst",[De]:"fire-fst-compat",[xe]:"fire-vertex","fire-js":"fire-js",[Le]:"fire-js-all"},Me=new Map,$e=new Map,Fe=new Map;function Ve(e,t){try{e.container.addComponent(t)}catch(r){ue.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function Be(e){const t=e.name;if(Fe.has(t))return ue.debug(`There were multiple attempts to register component ${t}.`),!1;Fe.set(t,e);for(const t of Me.values())Ve(t,e);for(const t of $e.values())Ve(t,e);return!0}function qe(e,t){const r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function ze(e){return null!=e&&void 0!==e.settings}const Ke=new T("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class He{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new x("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ke.create("app-deleted",{appName:this._name})}}const We="11.10.0";function Ge(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});const n=Object.assign({name:je,automaticDataCollectionEnabled:!0},t),s=n.name;if("string"!=typeof s||!s)throw Ke.create("bad-app-name",{appName:String(s)});if(r||(r=d()),!r)throw Ke.create("no-options");const i=Me.get(s);if(i){if(I(r,i.options)&&I(n,i.config))return i;throw Ke.create("duplicate-app",{appName:s})}const o=new j(s);for(const e of Fe.values())o.addComponent(e);const a=new He(r,n,o);return Me.set(s,a),a}function Je(e=je){const t=Me.get(e);if(!t&&e===je&&d())return Ge();if(!t)throw Ke.create("no-app",{appName:e});return t}function Ye(e,t,r){var n;let s=null!==(n=Ue[e])&&void 0!==n?n:e;r&&(s+=`-${r}`);const i=s.match(/\s|\//),o=t.match(/\s|\//);if(i||o){const e=[`Unable to register library "${s}" with version "${t}":`];return i&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void ue.warn(e.join(" "))}Be(new x(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}const Qe="firebase-heartbeat-store";let Xe=null;function Ze(){return Xe||(Xe=function(e,t,{blocked:r,upgrade:n,blocking:s,terminated:i}={}){const o=indexedDB.open(e,t),a=Z(o);return n&&o.addEventListener("upgradeneeded",e=>{n(Z(o.result),e.oldVersion,e.newVersion,Z(o.transaction),e)}),r&&o.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),a.then(e=>{i&&e.addEventListener("close",()=>i()),s&&e.addEventListener("versionchange",e=>s(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Qe)}catch(e){console.warn(e)}}}).catch(e=>{throw Ke.create("idb-open",{originalErrorMessage:e.message})})),Xe}async function et(e,t){try{const r=(await Ze()).transaction(Qe,"readwrite"),n=r.objectStore(Qe);await n.put(t,tt(e)),await r.done}catch(e){if(e instanceof E)ue.warn(e.message);else{const t=Ke.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});ue.warn(t.message)}}}function tt(e){return`${e.name}!${e.options.appId}`}class rt{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new st(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=nt();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:r}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ue.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=nt(),{heartbeatsToSend:r,unsentEntries:n}=function(e,t=1024){const r=[];let n=e.slice();for(const s of e){const e=r.find(e=>e.agent===s.agent);if(e){if(e.dates.push(s.date),it(r)>t){e.dates.pop();break}}else if(r.push({agent:s.agent,dates:[s.date]}),it(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),s=c(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return ue.warn(e),""}}}function nt(){return(new Date).toISOString().substring(0,10)}class st{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let r=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},s.onupgradeneeded=()=>{r=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Ze()).transaction(Qe),r=await t.objectStore(Qe).get(tt(e));return await t.done,r}catch(e){if(e instanceof E)ue.warn(e.message);else{const t=Ke.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});ue.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return et(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return et(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}}}function it(e){return c(JSON.stringify({version:2,heartbeats:e})).length}function ot(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]])}return r}Be(new x("platform-logger",e=>new oe(e),"PRIVATE")),Be(new x("heartbeat",e=>new rt(e),"PRIVATE")),Ye(ae,ce,""),Ye(ae,ce,"esm2017"),Ye("fire-js",""),Ye("firebase","11.10.0","app"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const at=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},ct=new T("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),ut=new q("@firebase/auth");function lt(e,...t){ut.logLevel<=M.ERROR&&ut.error(`Auth (${We}): ${e}`,...t)}function ht(e,...t){throw gt(e,...t)}function dt(e,...t){return gt(e,...t)}function ft(e,t,r){const n=Object.assign(Object.assign({},at()),{[t]:r});return new T("auth","Firebase",n).create(t,{appName:e.name})}function pt(e){return ft(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function gt(e,...t){if("string"!=typeof e){const r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return ct.create(e,...t)}function mt(e,t,...r){if(!e)throw gt(t,...r)}function yt(e){const t="INTERNAL ASSERTION FAILED: "+e;throw lt(t),new Error(t)}function vt(e,t){e||yt(t)}function wt(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function bt(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function _t(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===bt()||"https:"===bt()||function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class Et{constructor(e,t){this.shortDelay=e,this.longDelay=t,vt(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(b())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return _t()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Tt(e,t){vt(e.emulator,"Emulator should always be set here");const{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}class St{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void yt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void yt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void yt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const It={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},kt=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Ct=new Et(3e4,6e4);function At(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Ot(e,t,r,n,s={}){return Rt(e,s,async()=>{let s={},i={};n&&("GET"===t?i=n:s={body:JSON.stringify(n)});const o=C(Object.assign({key:e.config.apiKey},i)).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:a},s);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),e.emulatorConfig&&g(e.emulatorConfig.host)&&(c.credentials="include"),St.fetch()(await Nt(e,e.config.apiHost,r,o),c)})}async function Rt(e,t,r){e._canInitEmulator=!1;const n=Object.assign(Object.assign({},It),t);try{const t=new Dt(e),s=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();const i=await s.json();if("needConfirmation"in i)throw Lt(e,"account-exists-with-different-credential",i);if(s.ok&&!("errorMessage"in i))return i;{const t=s.ok?i.errorMessage:i.error.message,[r,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===r)throw Lt(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===r)throw Lt(e,"email-already-in-use",i);if("USER_DISABLED"===r)throw Lt(e,"user-disabled",i);const a=n[r]||r.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw ft(e,a,o);ht(e,a)}}catch(t){if(t instanceof E)throw t;ht(e,"network-request-failed",{message:String(t)})}}async function Pt(e,t,r,n,s={}){const i=await Ot(e,t,r,n,s);return"mfaPendingCredential"in i&&ht(e,"multi-factor-auth-required",{_serverResponse:i}),i}async function Nt(e,t,r,n){const s=`${t}${r}?${n}`,i=e,o=i.config.emulator?Tt(e.config,s):`${e.config.apiScheme}://${s}`;return kt.includes(r)&&(await i._persistenceManagerAvailable,"COOKIE"===i._getPersistenceType())?i._getPersistence()._getFinalTarget(o).toString():o}function xt(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Dt{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(dt(this.auth,"network-request-failed")),Ct.get())})}}function Lt(e,t,r){const n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);const s=dt(e,t,n);return s.customData._tokenResponse=r,s}function jt(e){return void 0!==e&&void 0!==e.enterprise}class Ut{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return xt(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Mt(e,t){return Ot(e,"GET","/v2/recaptchaConfig",At(e,t))}async function $t(e,t){return Ot(e,"POST","/v1/accounts:lookup",t)}function Ft(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Vt(e){return 1e3*Number(e)}function Bt(e){const[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return lt("JWT malformed, contained fewer than 3 sections"),null;try{const e=u(r);return e?JSON.parse(e):(lt("Failed to decode base64 JWT payload"),null)}catch(e){return lt("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function qt(e){const t=Bt(e);return mt(t,"internal-error"),mt(void 0!==t.exp,"internal-error"),mt(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function zt(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof E&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class Kt{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Ht{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ft(this.lastLoginAt),this.creationTime=Ft(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Wt(e){var t;const r=e.auth,n=await e.getIdToken(),s=await zt(e,$t(r,{idToken:n}));mt(null==s?void 0:s.users.length,r,"internal-error");const i=s.users[0];e._notifyReloadListener(i);const o=(null===(t=i.providerUserInfo)||void 0===t?void 0:t.length)?Gt(i.providerUserInfo):[],a=(c=e.providerData,u=o,[...c.filter(e=>!u.some(t=>t.providerId===e.providerId)),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&i.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Ht(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(e,f)}function Gt(e){return e.map(e=>{var{providerId:t}=e,r=ot(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}class Jt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){mt(e.idToken,"internal-error"),mt(void 0!==e.idToken,"internal-error"),mt(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):qt(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){mt(0!==e.length,"internal-error");const t=qt(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(mt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:n,expiresIn:s}=await async function(e,t){const r=await Rt(e,{},async()=>{const r=C({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:s}=e.config,i=await Nt(e,n,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const a={method:"POST",headers:o,body:r};return e.emulatorConfig&&g(e.emulatorConfig.host)&&(a.credentials="include"),St.fetch()(i,a)});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}(e,t);this.updateTokensAndExpiration(r,n,Number(s))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){const{refreshToken:r,accessToken:n,expirationTime:s}=t,i=new Jt;return r&&(mt("string"==typeof r,"internal-error",{appName:e}),i.refreshToken=r),n&&(mt("string"==typeof n,"internal-error",{appName:e}),i.accessToken=n),s&&(mt("number"==typeof s,"internal-error",{appName:e}),i.expirationTime=s),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Jt,this.toJSON())}_performRefresh(){return yt("not implemented")}}function Yt(e,t){mt("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Qt{constructor(e){var{uid:t,auth:r,stsTokenManager:n}=e,s=ot(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Kt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Ht(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await zt(this,this.stsTokenManager.getToken(this.auth,e));return mt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const r=N(e),n=await r.getIdToken(t),s=Bt(n);mt(s&&s.exp&&s.auth_time&&s.iat,r.auth,"internal-error");const i="object"==typeof s.firebase?s.firebase:void 0,o=null==i?void 0:i.sign_in_provider;return{claims:s,token:n,authTime:Ft(Vt(s.auth_time)),issuedAtTime:Ft(Vt(s.iat)),expirationTime:Ft(Vt(s.exp)),signInProvider:o||null,signInSecondFactor:(null==i?void 0:i.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=N(e);await Wt(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(mt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Qt(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){mt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Wt(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ze(this.auth.app))return Promise.reject(pt(this.auth));const e=await this.getIdToken();return await zt(this,async function(e,t){return Ot(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,n,s,i,o,a,c,u;const l=null!==(r=t.displayName)&&void 0!==r?r:void 0,h=null!==(n=t.email)&&void 0!==n?n:void 0,d=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,f=null!==(i=t.photoURL)&&void 0!==i?i:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:b,providerData:_,stsTokenManager:E}=t;mt(v&&E,e,"internal-error");const T=Jt.fromJSON(this.name,E);mt("string"==typeof v,e,"internal-error"),Yt(l,e.name),Yt(h,e.name),mt("boolean"==typeof w,e,"internal-error"),mt("boolean"==typeof b,e,"internal-error"),Yt(d,e.name),Yt(f,e.name),Yt(p,e.name),Yt(g,e.name),Yt(m,e.name),Yt(y,e.name);const S=new Qt({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:b,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:m,lastLoginAt:y});return _&&Array.isArray(_)&&(S.providerData=_.map(e=>Object.assign({},e))),g&&(S._redirectEventId=g),S}static async _fromIdTokenResponse(e,t,r=!1){const n=new Jt;n.updateFromServerResponse(t);const s=new Qt({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r});return await Wt(s),s}static async _fromGetAccountInfoResponse(e,t,r){const n=t.users[0];mt(void 0!==n.localId,"internal-error");const s=void 0!==n.providerUserInfo?Gt(n.providerUserInfo):[],i=!(n.email&&n.passwordHash||(null==s?void 0:s.length)),o=new Jt;o.updateFromIdToken(r);const a=new Qt({uid:n.localId,auth:e,stsTokenManager:o,isAnonymous:i}),c={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:s,metadata:new Ht(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash||(null==s?void 0:s.length))};return Object.assign(a,c),a}}const Xt=new Map;function Zt(e){vt(e instanceof Function,"Expected a class definition");let t=Xt.get(e);return t?(vt(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Xt.set(e,t),t)}class er{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}er.type="NONE";const tr=er;function rr(e,t,r){return`firebase:${e}:${t}:${r}`}class nr{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:n,name:s}=this.auth;this.fullUserKey=rr(this.userKey,n.apiKey,s),this.fullPersistenceKey=rr("persistence",n.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await $t(this.auth,{idToken:e}).catch(()=>{});return t?Qt._fromGetAccountInfoResponse(this.auth,t,e):null}return Qt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new nr(Zt(tr),e,r);const n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let s=n[0]||Zt(tr);const i=rr(r,e.config.apiKey,e.name);let o=null;for(const r of t)try{const t=await r._get(i);if(t){let n;if("string"==typeof t){const r=await $t(e,{idToken:t}).catch(()=>{});if(!r)break;n=await Qt._fromGetAccountInfoResponse(e,r,t)}else n=Qt._fromJSON(e,t);r!==s&&(o=n),s=r;break}}catch(e){}const a=n.filter(e=>e._shouldAllowMigration);return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(i,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==s)try{await e._remove(i)}catch(e){}})),new nr(s,e,r)):new nr(s,e,r)}}function sr(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(cr(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ir(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(lr(t))return"Blackberry";if(hr(t))return"Webos";if(or(t))return"Safari";if((t.includes("chrome/")||ar(t))&&!t.includes("edge/"))return"Chrome";if(ur(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=e.match(t);if(2===(null==r?void 0:r.length))return r[1]}return"Other"}function ir(e=b()){return/firefox\//i.test(e)}function or(e=b()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ar(e=b()){return/crios\//i.test(e)}function cr(e=b()){return/iemobile/i.test(e)}function ur(e=b()){return/android/i.test(e)}function lr(e=b()){return/blackberry/i.test(e)}function hr(e=b()){return/webos/i.test(e)}function dr(e=b()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function fr(e=b()){return dr(e)||ur(e)||hr(e)||lr(e)||/windows phone/i.test(e)||cr(e)}function pr(e,t=[]){let r;switch(e){case"Browser":r=sr(b());break;case"Worker":r=`${sr(b())}-${e}`;break;default:r=e}const n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${We}/${n}`}class gr{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=t=>new Promise((r,n)=>{try{r(e(t))}catch(e){n(e)}});r.onAbort=t,this.queue.push(r);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class mr{constructor(e){var t,r,n,s;const i=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=i.minPasswordLength)&&void 0!==t?t:6,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),void 0!==i.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),void 0!==i.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),void 0!==i.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),void 0!==i.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(n=null===(r=e.allowedNonAlphanumericCharacters)||void 0===r?void 0:r.join(""))&&void 0!==n?n:"",this.forceUpgradeOnSignin=null!==(s=e.forceUpgradeOnSignin)&&void 0!==s&&s,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,n,s,i,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(r=a.meetsMaxPasswordLength)||void 0===r||r),a.isValid&&(a.isValid=null===(n=a.containsLowercaseLetter)||void 0===n||n),a.isValid&&(a.isValid=null===(s=a.containsUppercaseLetter)||void 0===s||s),a.isValid&&(a.isValid=null===(i=a.containsNumericCharacter)||void 0===i||i),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class yr{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new wr(this),this.idTokenSubscription=new wr(this),this.beforeStateQueue=new gr(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ct,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Zt(t)),this._initializationPromise=this.queue(async()=>{var r,n,s;if(!this._deleted&&(this.persistenceManager=await nr.create(this,e),null===(r=this._resolvePersistenceManagerAvailable)||void 0===r||r.call(this),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(s=this.currentUser)||void 0===s?void 0:s.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await $t(this,{idToken:e}),r=await Qt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(ze(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let n=r,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,i=null==n?void 0:n._redirectEventId,o=await this.tryRedirectSignIn(e);r&&r!==i||!(null==o?void 0:o.user)||(n=o.user,s=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return mt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Wt(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ze(this.app))return Promise.reject(pt(this));const t=e?N(e):null;return t&&mt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&mt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ze(this.app)?Promise.reject(pt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ze(this.app)?Promise.reject(pt(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Zt(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return Ot(e,"GET","/v2/passwordPolicy",At(e,t))}(this),t=new mr(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new T("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return Ot(e,"POST","/v2/accounts:revokeToken",At(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Zt(e)||this._popupRedirectResolver;mt(t,this,"argument-error"),this.redirectPersistenceManager=await nr.create(this,[Zt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(r=this.redirectUser)||void 0===r?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,n){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t);let i=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(mt(o,this,"internal-error"),o.then(()=>{i||s(this.currentUser)}),"function"==typeof t){const s=e.addObserver(t,r,n);return()=>{i=!0,s()}}{const r=e.addObserver(t);return()=>{i=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return mt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=pr(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const n=await this._getAppCheckToken();return n&&(t["X-Firebase-AppCheck"]=n),t}async _getAppCheckToken(){var e;if(ze(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){ut.logLevel<=M.WARN&&ut.warn(`Auth (${We}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function vr(e){return N(e)}class wr{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e){const t=new R(e,void 0);return t.subscribe.bind(t)}(e=>this.observer=e)}get next(){return mt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let br={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _r(e){return br.loadJS(e)}function Er(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Tr{constructor(){this.enterprise=new Sr}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Sr{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Ir="NO_RECAPTCHA";class kr{constructor(e){this.type="recaptcha-enterprise",this.auth=vr(e)}async verify(e="verify",t=!1){function r(t,r,n){const s=window.grecaptcha;jt(s)?s.enterprise.ready(()=>{s.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(Ir)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new Tr).execute("siteKey",{action:"verify"}):new Promise((e,n)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{Mt(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0!==n.recaptchaKey){const r=new Ut(n);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}r(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{r(e)})})})(this.auth).then(s=>{if(!t&&jt(window.grecaptcha))r(s,e,n);else{if("undefined"==typeof window)return void n(new Error("RecaptchaVerifier is only supported in browser"));let t=br.recaptchaEnterpriseScript;0!==t.length&&(t+=s),_r(t).then(()=>{r(s,e,n)}).catch(e=>{n(e)})}}).catch(e=>{n(e)})})}}async function Cr(e,t,r,n=!1,s=!1){const i=new kr(e);let o;if(s)o=Ir;else try{o=await i.verify(r)}catch(e){o=await i.verify(r,!0)}const a=Object.assign({},t);if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return n?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Ar(e,t,r,n,s){var i,o;if("EMAIL_PASSWORD_PROVIDER"===s){if(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await Cr(e,t,r,"getOobCode"===r);return n(e,s)}return n(e,t).catch(async s=>{if("auth/missing-recaptcha-token"===s.code){console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const s=await Cr(e,t,r,"getOobCode"===r);return n(e,s)}return Promise.reject(s)})}if("PHONE_PROVIDER"===s){if(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("PHONE_PROVIDER")){const s=await Cr(e,t,r);return n(e,s).catch(async s=>{var i;if("AUDIT"===(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.getProviderEnforcementState("PHONE_PROVIDER"))&&("auth/missing-recaptcha-token"===s.code||"auth/invalid-app-credential"===s.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);const s=await Cr(e,t,r,!1,!0);return n(e,s)}return Promise.reject(s)})}{const s=await Cr(e,t,r,!1,!0);return n(e,s)}}return Promise.reject(s+" provider is not supported.")}function Or(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Rr(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Pr{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return yt("not implemented")}_getIdTokenResponse(e){return yt("not implemented")}_linkToIdToken(e,t){return yt("not implemented")}_getReauthenticationResolver(e){return yt("not implemented")}}async function Nr(e,t){return Ot(e,"POST","/v1/accounts:signUp",t)}async function xr(e,t){return Pt(e,"POST","/v1/accounts:signInWithPassword",At(e,t))}class Dr extends Pr{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new Dr(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Dr(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Ar(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",xr,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Pt(e,"POST","/v1/accounts:signInWithEmailLink",At(e,t))}(e,{email:this._email,oobCode:this._password});default:ht(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Ar(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Nr,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Pt(e,"POST","/v1/accounts:signInWithEmailLink",At(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:ht(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Lr(e,t){return Pt(e,"POST","/v1/accounts:signInWithIdp",At(e,t))}class jr extends Pr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new jr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ht("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:r,signInMethod:n}=t,s=ot(t,["providerId","signInMethod"]);if(!r||!n)return null;const i=new jr(r,n);return i.idToken=s.idToken||void 0,i.accessToken=s.accessToken||void 0,i.secret=s.secret,i.nonce=s.nonce,i.pendingToken=s.pendingToken||null,i}_getIdTokenResponse(e){return Lr(e,this.buildRequest())}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Lr(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Lr(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=C(t)}return e}}async function Ur(e,t){return Ot(e,"POST","/v1/accounts:sendVerificationCode",At(e,t))}const Mr={USER_NOT_FOUND:"user-not-found"};class $r extends Pr{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new $r({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new $r({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Pt(e,"POST","/v1/accounts:signInWithPhoneNumber",At(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const r=await Pt(e,"POST","/v1/accounts:signInWithPhoneNumber",At(e,t));if(r.temporaryProof)throw Lt(e,"account-exists-with-different-credential",r);return r}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Pt(e,"POST","/v1/accounts:signInWithPhoneNumber",At(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Mr)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:n}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:n}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:s}=e;return r||t||n||s?new $r({verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:s}):null}}class Fr{constructor(e){var t,r,n,s,i,o;const a=A(O(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(r=a.oobCode)&&void 0!==r?r:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(n=a.mode)&&void 0!==n?n:null);mt(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(s=a.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(i=a.lang)&&void 0!==i?i:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=A(O(e)).link,r=t?A(O(t)).deep_link_id:null,n=A(O(e)).deep_link_id;return(n?A(O(n)).link:null)||n||r||t||e}(e);try{return new Fr(t)}catch(e){return null}}}class Vr{constructor(){this.providerId=Vr.PROVIDER_ID}static credential(e,t){return Dr._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Fr.parseLink(t);return mt(r,"argument-error"),Dr._fromEmailAndCode(e,r.code,r.tenantId)}}Vr.PROVIDER_ID="password",Vr.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Vr.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Br{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class qr extends Br{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class zr extends qr{constructor(){super("facebook.com")}static credential(e){return jr._fromParams({providerId:zr.PROVIDER_ID,signInMethod:zr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return zr.credentialFromTaggedObject(e)}static credentialFromError(e){return zr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return zr.credential(e.oauthAccessToken)}catch(e){return null}}}zr.FACEBOOK_SIGN_IN_METHOD="facebook.com",zr.PROVIDER_ID="facebook.com";class Kr extends qr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return jr._fromParams({providerId:Kr.PROVIDER_ID,signInMethod:Kr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Kr.credentialFromTaggedObject(e)}static credentialFromError(e){return Kr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Kr.credential(t,r)}catch(e){return null}}}Kr.GOOGLE_SIGN_IN_METHOD="google.com",Kr.PROVIDER_ID="google.com";class Hr extends qr{constructor(){super("github.com")}static credential(e){return jr._fromParams({providerId:Hr.PROVIDER_ID,signInMethod:Hr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Hr.credentialFromTaggedObject(e)}static credentialFromError(e){return Hr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Hr.credential(e.oauthAccessToken)}catch(e){return null}}}Hr.GITHUB_SIGN_IN_METHOD="github.com",Hr.PROVIDER_ID="github.com";class Wr extends qr{constructor(){super("twitter.com")}static credential(e,t){return jr._fromParams({providerId:Wr.PROVIDER_ID,signInMethod:Wr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Wr.credentialFromTaggedObject(e)}static credentialFromError(e){return Wr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Wr.credential(t,r)}catch(e){return null}}}Wr.TWITTER_SIGN_IN_METHOD="twitter.com",Wr.PROVIDER_ID="twitter.com";class Gr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,n=!1){const s=await Qt._fromIdTokenResponse(e,r,n),i=Jr(r);return new Gr({user:s,providerId:i,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const n=Jr(r);return new Gr({user:e,providerId:n,_tokenResponse:r,operationType:t})}}function Jr(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Yr extends E{constructor(e,t,r,n){var s;super(t.code,t.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,Yr.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,n){return new Yr(e,t,r,n)}}function Qr(e,t,r,n){return("reauthenticate"===t?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(r=>{if("auth/multi-factor-auth-required"===r.code)throw Yr._fromErrorAndOperation(e,r,t,n);throw r})}function Xr(e){return N(e).signOut()}function Zr(e,t){return Ot(e,"POST","/v2/accounts/mfaEnrollment:start",At(e,t))}new WeakMap;const en="__sak";class tn{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(en,"1"),this.storage.removeItem(en),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class rn extends tn{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=fr(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),n=this.localCache[t];r!==n&&e(t,n,r)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,r)=>{this.notifyListeners(e,r)});const r=e.key;t?this.detachListener():this.stopPolling();const n=()=>{const e=this.storage.getItem(r);(t||this.localCache[r]!==e)&&this.notifyListeners(r,e)},s=this.storage.getItem(r);!function(){const e=b();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||s===e.newValue||e.newValue===e.oldValue?n():setTimeout(n,10)}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const e of Array.from(r))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}rn.type="LOCAL";const nn=rn;class sn extends tn{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}sn.type="SESSION";const on=sn;class an{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const r=new an(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:n,data:s}=t.data,i=this.handlersMap[n];if(!(null==i?void 0:i.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:n});const o=Array.from(i).map(async e=>e(t.origin,s)),a=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}}))}(o);t.ports[0].postMessage({status:"done",eventId:r,eventType:n,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function cn(e="",t=10){let r="";for(let e=0;e<t;e++)r+=Math.floor(10*Math.random());return e+r}an.receivers=[];class un{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const n="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let s,i;return new Promise((o,a)=>{const c=cn("",20);n.port1.start();const u=setTimeout(()=>{a(new Error("unsupported_event"))},r);i={messageChannel:n,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),o(t.data.response);break;default:clearTimeout(u),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(i),n.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[n.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function ln(){return window}function hn(){return void 0!==ln().WorkerGlobalScope&&"function"==typeof ln().importScripts}const dn="firebaseLocalStorageDb",fn="firebaseLocalStorage",pn="fbase_key";class gn{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function mn(e,t){return e.transaction([fn],t?"readwrite":"readonly").objectStore(fn)}function yn(){const e=indexedDB.open(dn,1);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(fn,{keyPath:pn})}catch(e){r(e)}}),e.addEventListener("success",async()=>{const r=e.result;r.objectStoreNames.contains(fn)?t(r):(r.close(),await function(){const e=indexedDB.deleteDatabase(dn);return new gn(e).toPromise()}(),t(await yn()))})})}async function vn(e,t,r){const n=mn(e,!0).put({[pn]:t,value:r});return new gn(n).toPromise()}function wn(e,t){const r=mn(e,!0).delete(t);return new gn(r).toPromise()}class bn{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await yn()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return hn()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=an._getInstance(hn()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new un(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&(null===(e=r[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=r[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await yn();return await vn(e,en,"1"),await wn(e,en),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>vn(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const r=mn(e,!1).get(t),n=await new gn(r).toPromise();return void 0===n?null:n.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>wn(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=mn(e,!1).getAll();return new gn(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],r=new Set;if(0!==e.length)for(const{fbase_key:n,value:s}of e)r.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(s)&&(this.notifyListeners(n,s),t.push(n));for(const e of Object.keys(this.localCache))this.localCache[e]&&!r.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const e of Array.from(r))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}bn.type="LOCAL";const _n=bn;function En(e,t){return Ot(e,"POST","/v2/accounts/mfaSignIn:start",At(e,t))}Er("rcb"),new Et(3e4,6e4);const Tn="recaptcha";async function Sn(e,t,r){var n;if(!e._getRecaptchaConfig())try{await async function(e){const t=vr(e),r=await Mt(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),n=new Ut(r);null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,n.isAnyProviderEnabled()&&new kr(t).verify()}(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){mt("enroll"===t.type,e,"internal-error");const n=Ar(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},"mfaSmsEnrollment",async(e,t)=>t.phoneEnrollmentInfo.captchaResponse===Ir?(mt((null==r?void 0:r.type)===Tn,e,"argument-error"),Zr(e,await In(e,t,r))):Zr(e,t),"PHONE_PROVIDER");return(await n.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{mt("signin"===t.type,e,"internal-error");const i=(null===(n=s.multiFactorHint)||void 0===n?void 0:n.uid)||s.multiFactorUid;mt(i,e,"missing-multi-factor-info");const o=Ar(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},"mfaSmsSignIn",async(e,t)=>t.phoneSignInInfo.captchaResponse===Ir?(mt((null==r?void 0:r.type)===Tn,e,"argument-error"),En(e,await In(e,t,r))):En(e,t),"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{const t=Ar(e,{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"},"sendVerificationCode",async(e,t)=>t.captchaResponse===Ir?(mt((null==r?void 0:r.type)===Tn,e,"argument-error"),Ur(e,await In(e,t,r))):Ur(e,t),"PHONE_PROVIDER");return(await t.catch(e=>Promise.reject(e))).sessionInfo}}finally{null==r||r._reset()}}async function In(e,t,r){mt(r.type===Tn,e,"argument-error");const n=await r.verify();mt("string"==typeof n,e,"argument-error");const s=Object.assign({},t);if("phoneEnrollmentInfo"in s){const e=s.phoneEnrollmentInfo.phoneNumber,t=s.phoneEnrollmentInfo.captchaResponse,r=s.phoneEnrollmentInfo.clientType,i=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:n,captchaResponse:t,clientType:r,recaptchaVersion:i}}),s}if("phoneSignInInfo"in s){const e=s.phoneSignInInfo.captchaResponse,t=s.phoneSignInInfo.clientType,r=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:n,captchaResponse:e,clientType:t,recaptchaVersion:r}}),s}return Object.assign(s,{recaptchaToken:n}),s}class kn{constructor(e){this.providerId=kn.PROVIDER_ID,this.auth=vr(e)}verifyPhoneNumber(e,t){return Sn(this.auth,e,N(t))}static credential(e,t){return $r._fromVerification(e,t)}static credentialFromResult(e){const t=e;return kn.credentialFromTaggedObject(t)}static credentialFromError(e){return kn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?$r._fromTokenResponse(t,r):null}}kn.PROVIDER_ID="phone",kn.PHONE_SIGN_IN_METHOD="phone";class Cn extends Pr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Lr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Lr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Lr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function An(e){return async function(e,t,r=!1){if(ze(e.app))return Promise.reject(pt(e));const n="signIn",s=await Qr(e,n,t),i=await Gr._fromIdTokenResponse(e,n,s);return r||await e._updateCurrentUser(i.user),i}(e.auth,new Cn(e),e.bypassAuthState)}function On(e){const{auth:t,user:r}=e;return mt(r,t,"internal-error"),async function(e,t,r=!1){const{auth:n}=e;if(ze(n.app))return Promise.reject(pt(n));const s="reauthenticate";try{const i=await zt(e,Qr(n,s,t,e),r);mt(i.idToken,n,"internal-error");const o=Bt(i.idToken);mt(o,n,"internal-error");const{sub:a}=o;return mt(e.uid===a,n,"user-mismatch"),Gr._forOperation(e,s,i)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&ht(n,"user-mismatch"),e}}(r,new Cn(e),e.bypassAuthState)}async function Rn(e){const{auth:t,user:r}=e;return mt(r,t,"internal-error"),async function(e,t,r=!1){const n=await zt(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return Gr._forOperation(e,"link",n)}(r,new Cn(e),e.bypassAuthState)}class Pn{constructor(e,t,r,n,s=!1){this.auth=e,this.resolver=r,this.user=n,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:n,tenantId:s,error:i,type:o}=e;if(i)return void this.reject(i);const a={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return An;case"linkViaPopup":case"linkViaRedirect":return Rn;case"reauthViaPopup":case"reauthViaRedirect":return On;default:ht(this.auth,"internal-error")}}resolve(e){vt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){vt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Nn=new Et(2e3,1e4);class xn extends Pn{constructor(e,t,r,n,s){super(e,t,n,s),this.provider=r,this.authWindow=null,this.pollId=null,xn.currentPopupAction&&xn.currentPopupAction.cancel(),xn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return mt(e,this.auth,"internal-error"),e}async onExecution(){vt(1===this.filter.length,"Popup operations only handle one event");const e=cn();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(dt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(dt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,xn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;(null===(r=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===r?void 0:r.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(dt(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Nn.get())};e()}}xn.currentPopupAction=null;const Dn=new Map;class Ln extends Pn{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Dn.get(this.auth._key());if(!e){try{const t=await async function(e,t){const r=function(e){return rr("pendingRedirect",e.config.apiKey,e.name)}(t),n=function(e){return Zt(e._redirectPersistence)}(e);if(!await n._isAvailable())return!1;const s="true"===await n._get(r);return await n._remove(r),s}(this.resolver,this.auth),r=t?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Dn.set(this.auth._key(),e)}return this.bypassAuthState||Dn.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function jn(e,t){Dn.set(e._key(),t)}async function Un(e,t,r=!1){if(ze(e.app))return Promise.reject(pt(e));const n=vr(e),s=function(e,t){return t?Zt(t):(mt(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(n,t),i=new Ln(n,s,r),o=await i.execute();return o&&!r&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,t)),o}class Mn{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Fn(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!Fn(e)){const n=(null===(r=e.error.code)||void 0===r?void 0:r.split("auth/")[1])||"internal-error";t.onError(dt(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has($n(e))}saveEventToCache(e){this.cachedEventUids.add($n(e)),this.lastProcessedEventTime=Date.now()}}function $n(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Fn({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const Vn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Bn=/^https?/;function qn(e){const t=wt(),{protocol:r,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===n?"chrome-extension:"===r&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===r&&s.hostname===n}if(!Bn.test(r))return!1;if(Vn.test(e))return n===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(n)}const zn=new Et(3e4,6e4);function Kn(){const e=ln().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}function Hn(e){return new Promise((t,r)=>{var n,s,i;function o(){Kn(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Kn(),r(dt(e,"network-request-failed"))},timeout:zn.get()})}if(null===(s=null===(n=ln().gapi)||void 0===n?void 0:n.iframes)||void 0===s?void 0:s.Iframe)t(gapi.iframes.getContext());else{if(!(null===(i=ln().gapi)||void 0===i?void 0:i.load)){const t=Er("iframefcb");return ln()[t]=()=>{gapi.load?o():r(dt(e,"network-request-failed"))},_r(`${br.gapiScript}?onload=${t}`).catch(e=>r(e))}o()}}).catch(e=>{throw Wn=null,e})}let Wn=null;const Gn=new Et(5e3,15e3),Jn={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Yn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Qn(e){const t=e.config;mt(t.authDomain,e,"auth-domain-config-required");const r=t.emulator?Tt(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,n={apiKey:t.apiKey,appName:e.name,v:We},s=Yn.get(e.config.apiHost);s&&(n.eid=s);const i=e._getFrameworks();return i.length&&(n.fw=i.join(",")),`${r}?${C(n).slice(1)}`}const Xn={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Zn{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const es=encodeURIComponent("fac");async function ts(e,t,r,n,s,i){mt(e.config.authDomain,e,"auth-domain-config-required"),mt(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:n,v:We,eventId:s};if(t instanceof Br){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(i||{}))o[e]=t}if(t instanceof qr){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),u=c?`#${es}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?Tt(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${C(a).slice(1)}${u}`}const rs="webStorageSupport",ns=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=on,this._completeRedirectFn=Un,this._overrideRedirectResult=jn}async _openPopup(e,t,r,n){var s;return vt(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()"),function(e,t,r,n=500,s=600){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let a="";const c=Object.assign(Object.assign({},Xn),{width:n.toString(),height:s.toString(),top:i,left:o}),u=b().toLowerCase();r&&(a=ar(u)?"_blank":r),ir(u)&&(t=t||"http://localhost",c.scrollbars="yes");const l=Object.entries(c).reduce((e,[t,r])=>`${e}${t}=${r},`,"");if(function(e=b()){var t;return dr(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==a)return function(e,t){const r=document.createElement("a");r.href=e,r.target=t;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(n)}(t||"",a),new Zn(null);const h=window.open(t||"",a,l);mt(h,e,"popup-blocked");try{h.focus()}catch(e){}return new Zn(h)}(e,await ts(e,t,r,wt(),n),cn())}async _openRedirect(e,t,r,n){return await this._originValidation(e),s=await ts(e,t,r,wt(),n),ln().location.href=s,new Promise(()=>{});var s}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:r}=this.eventManagers[t];return e?Promise.resolve(e):(vt(r,"If manager is not set, promise should be"),r)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return Wn=Wn||Hn(e),Wn}(e),r=ln().gapi;return mt(r,e,"internal-error"),t.open({where:document.body,url:Qn(e),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Jn,dontclear:!0},t=>new Promise(async(r,n)=>{await t.restyle({setHideOnLeave:!1});const s=dt(e,"network-request-failed"),i=ln().setTimeout(()=>{n(s)},Gn.get());function o(){ln().clearTimeout(i),r(t)}t.ping(o).then(o,()=>{n(s)})}))}(e),r=new Mn(e);return t.register("authEvent",t=>(mt(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(rs,{type:rs},r=>{var n;const s=null===(n=null==r?void 0:r[0])||void 0===n?void 0:n[rs];void 0!==s&&t(!!s),ht(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return Ot(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(qn(e))return}catch(e){}ht(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return fr()||or()||dr()}};var ss="@firebase/auth",is="1.10.8";class os{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){mt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const as=f("authIdTokenMaxAge")||300;let cs=null;var us;br={loadJS:e=>new Promise((t,r)=>{const n=document.createElement("script");var s,i;n.setAttribute("src",e),n.onload=t,n.onerror=e=>{const t=dt("internal-error");t.customData=e,r(t)},n.type="text/javascript",n.charset="UTF-8",(null!==(i=null===(s=document.getElementsByTagName("head"))||void 0===s?void 0:s[0])&&void 0!==i?i:document).appendChild(n)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},us="Browser",Be(new x("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:i,authDomain:o}=r.options;mt(i&&!i.includes(":"),"invalid-api-key",{appName:r.name});const a={apiKey:i,authDomain:o,clientPlatform:us,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:pr(us)},c=new yr(r,n,s,a);return function(e,t){const r=(null==t?void 0:t.persistence)||[],n=(Array.isArray(r)?r:[r]).map(Zt);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,null==t?void 0:t.popupRedirectResolver)}(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Be(new x("auth-internal",e=>(e=>new os(e))(vr(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),Ye(ss,is,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(us)),Ye(ss,is,"esm2017");var ls,hs,ds="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{},fs={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function r(e,t,r){r||(r=0);var n=Array(16);if("string"==typeof t)for(var s=0;16>s;++s)n[s]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(s=0;16>s;++s)n[s]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],s=e.g[2];var i=e.g[3],o=t+(i^r&(s^i))+n[0]+3614090360&4294967295;o=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=r+(o<<7&4294967295|o>>>25))+((o=i+(s^t&(r^s))+n[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(r^i&(t^r))+n[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=r+(t^s&(i^t))+n[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^r&(s^i))+n[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(r^s))+n[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(r^i&(t^r))+n[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=r+(t^s&(i^t))+n[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^r&(s^i))+n[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(r^s))+n[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(r^i&(t^r))+n[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=r+(t^s&(i^t))+n[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^r&(s^i))+n[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(r^s))+n[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(r^i&(t^r))+n[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=r+(t^s&(i^t))+n[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^i&(r^s))+n[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(r^s&(t^r))+n[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^r&(i^t))+n[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=r+(i^t&(s^i))+n[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(r^s))+n[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(r^s&(t^r))+n[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^r&(i^t))+n[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=r+(i^t&(s^i))+n[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(r^s))+n[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(r^s&(t^r))+n[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^r&(i^t))+n[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=r+(i^t&(s^i))+n[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(r^s))+n[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(r^s&(t^r))+n[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^r&(i^t))+n[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=r+(i^t&(s^i))+n[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^s^i)+n[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^r^s)+n[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^r)+n[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=r+(s^i^t)+n[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(r^s^i)+n[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^r^s)+n[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^r)+n[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=r+(s^i^t)+n[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(r^s^i)+n[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^r^s)+n[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^r)+n[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=r+(s^i^t)+n[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(r^s^i)+n[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^r^s)+n[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^r)+n[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=r+(s^i^t)+n[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(s^(r|~i))+n[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(r^(t|~s))+n[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~r))+n[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=r+(i^(s|~t))+n[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(r|~i))+n[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(r^(t|~s))+n[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~r))+n[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=r+(i^(s|~t))+n[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(r|~i))+n[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(r^(t|~s))+n[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~r))+n[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=r+(i^(s|~t))+n[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(t=r+((o=t+(s^(r|~i))+n[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(r^(t|~s))+n[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=i+((o=s+(t^(i|~r))+n[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+n[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+i&4294967295}function n(e,t){this.h=t;for(var r=[],n=!0,s=e.length-1;0<=s;s--){var i=0|e[s];n&&i==t||(r[s]=i,n=!1)}this.g=r}!function(e,t){function r(){}r.prototype=t.prototype,e.D=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.C=function(e,r,n){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[r].apply(e,s)}}(t,function(){this.blockSize=-1}),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,s=this.B,i=this.h,o=0;o<t;){if(0==i)for(;o<=n;)r(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(s[i++]=e.charCodeAt(o++),i==this.blockSize){r(this,s),i=0;break}}else for(;o<t;)if(s[i++]=e[o++],i==this.blockSize){r(this,s),i=0;break}}this.h=i,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var r=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&r,r/=256;for(this.u(e),e=Array(16),t=r=0;4>t;++t)for(var n=0;32>n;n+=8)e[r++]=this.g[t]>>>n&255;return e};var s={};function i(e){return-128<=e&&128>e?function(e){var t=s;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new n([0|e],0>e?-1:0)}(e)}(e):new n([0|e],0>e?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(0>e)return d(o(-e));for(var t=[],r=1,s=0;e>=r;s++)t[s]=e/r|0,r*=4294967296;return new n(t,0)}var a=i(0),c=i(1),u=i(16777216);function l(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function h(e){return-1==e.h}function d(e){for(var t=e.g.length,r=[],s=0;s<t;s++)r[s]=~e.g[s];return new n(r,~e.h).add(c)}function f(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function g(e,t){this.g=e,this.h=t}function m(e,t){if(l(t))throw Error("division by zero");if(l(e))return new g(a,a);if(h(e))return t=m(d(e),t),new g(d(t.g),d(t.h));if(h(t))return t=m(e,d(t)),new g(d(t.g),t.h);if(30<e.g.length){if(h(e)||h(t))throw Error("slowDivide_ only works with positive integers.");for(var r=c,n=t;0>=n.l(e);)r=y(r),n=y(n);var s=v(r,1),i=v(n,1);for(n=v(n,2),r=v(r,2);!l(n);){var u=i.add(n);0>=u.l(e)&&(s=s.add(r),i=u),n=v(n,1),r=v(r,1)}return t=f(e,s.j(t)),new g(s,t)}for(s=a;0<=e.l(t);){for(r=Math.max(1,Math.floor(e.m()/t.m())),n=48>=(n=Math.ceil(Math.log(r)/Math.LN2))?1:Math.pow(2,n-48),u=(i=o(r)).j(t);h(u)||0<u.l(e);)u=(i=o(r-=n)).j(t);l(i)&&(i=c),s=s.add(i),e=f(e,u)}return new g(s,e)}function y(e){for(var t=e.g.length+1,r=[],s=0;s<t;s++)r[s]=e.i(s)<<1|e.i(s-1)>>>31;return new n(r,e.h)}function v(e,t){var r=t>>5;t%=32;for(var s=e.g.length-r,i=[],o=0;o<s;o++)i[o]=0<t?e.i(o+r)>>>t|e.i(o+r+1)<<32-t:e.i(o+r);return new n(i,e.h)}(e=n.prototype).m=function(){if(h(this))return-d(this).m();for(var e=0,t=1,r=0;r<this.g.length;r++){var n=this.i(r);e+=(0<=n?n:4294967296+n)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(l(this))return"0";if(h(this))return"-"+d(this).toString(e);for(var t=o(Math.pow(e,6)),r=this,n="";;){var s=m(r,t).g,i=((0<(r=f(r,s.j(t))).g.length?r.g[0]:r.h)>>>0).toString(e);if(l(r=s))return i+n;for(;6>i.length;)i="0"+i;n=i+n}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return h(e=f(this,e))?-1:l(e)?0:1},e.abs=function(){return h(this)?d(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],s=0,i=0;i<=t;i++){var o=s+(65535&this.i(i))+(65535&e.i(i)),a=(o>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);s=a>>>16,o&=65535,a&=65535,r[i]=a<<16|o}return new n(r,-2147483648&r[r.length-1]?-1:0)},e.j=function(e){if(l(this)||l(e))return a;if(h(this))return h(e)?d(this).j(d(e)):d(d(this).j(e));if(h(e))return d(this.j(d(e)));if(0>this.l(u)&&0>e.l(u))return o(this.m()*e.m());for(var t=this.g.length+e.g.length,r=[],s=0;s<2*t;s++)r[s]=0;for(s=0;s<this.g.length;s++)for(var i=0;i<e.g.length;i++){var c=this.i(s)>>>16,f=65535&this.i(s),g=e.i(i)>>>16,m=65535&e.i(i);r[2*s+2*i]+=f*m,p(r,2*s+2*i),r[2*s+2*i+1]+=c*m,p(r,2*s+2*i+1),r[2*s+2*i+1]+=f*g,p(r,2*s+2*i+1),r[2*s+2*i+2]+=c*g,p(r,2*s+2*i+2)}for(s=0;s<t;s++)r[s]=r[2*s+1]<<16|r[2*s];for(s=t;s<2*t;s++)r[s]=0;return new n(r,0)},e.A=function(e){return m(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],s=0;s<t;s++)r[s]=this.i(s)&e.i(s);return new n(r,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],s=0;s<t;s++)r[s]=this.i(s)|e.i(s);return new n(r,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],s=0;s<t;s++)r[s]=this.i(s)^e.i(s);return new n(r,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,hs=fs.Md5=t,n.prototype.add=n.prototype.add,n.prototype.multiply=n.prototype.j,n.prototype.modulo=n.prototype.A,n.prototype.compare=n.prototype.l,n.prototype.toNumber=n.prototype.m,n.prototype.toString=n.prototype.toString,n.prototype.getBits=n.prototype.i,n.fromNumber=o,n.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if(2>(r=r||10)||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return d(e(t.substring(1),r));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=o(Math.pow(r,8)),s=a,i=0;i<t.length;i+=8){var c=Math.min(8,t.length-i),u=parseInt(t.substring(i,i+c),r);8>c?(c=o(Math.pow(r,c)),s=s.j(c).add(o(u))):s=(s=s.j(n)).add(o(u))}return s},ls=fs.Integer=n}).apply(void 0!==ds?ds:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var ps,gs,ms,ys,vs,ws,bs,_s,Es="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{},Ts={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){return e==Array.prototype||e==Object.prototype||(e[t]=r.value),e},r=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Es&&Es];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);!function(e,n){if(n)e:{var s=r;e=e.split(".");for(var i=0;i<e.length-1;i++){var o=e[i];if(!(o in s))break e;s=s[o]}(n=n(i=s[e=e[e.length-1]]))!=i&&null!=n&&t(s,e,{configurable:!0,writable:!0,value:n})}}("Array.prototype.values",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var r=0,n=!1,s={next:function(){if(!n&&r<e.length){var s=r++;return{value:t(0,e[s]),done:!1}}return n=!0,{done:!0,value:void 0}}};return s[Symbol.iterator]=function(){return s},s}(this,function(e,t){return t})}});var n=n||{},s=this||self;function i(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,r){return e.call.apply(e.bind,arguments)}function c(e,t,r){if(!e)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,n),e.apply(t,r)}}return function(){return e.apply(t,arguments)}}function u(e,t,r){return(u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function l(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function h(e,t){function r(){}r.prototype=t.prototype,e.aa=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Qb=function(e,r,n){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[r].apply(e,s)}}function d(e){const t=e.length;if(0<t){const r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function f(e,t){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(i(r)){const t=e.length||0,n=r.length||0;e.length=t+n;for(let s=0;s<n;s++)e[t+s]=r[s]}else e.push(r)}}function p(e){return/^[\s\xa0]*$/.test(e)}function g(){var e=s.navigator;return e&&(e=e.userAgent)?e:""}function m(e){return m[" "](e),e}m[" "]=function(){};var y=!(-1==g().indexOf("Gecko")||-1!=g().toLowerCase().indexOf("webkit")&&-1==g().indexOf("Edge")||-1!=g().indexOf("Trident")||-1!=g().indexOf("MSIE")||-1!=g().indexOf("Edge"));function v(e,t,r){for(const n in e)t.call(r,e[n],n,e)}function w(e){const t={};for(const r in e)t[r]=e[r];return t}const b="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t],n)e[r]=n[r];for(let t=0;t<b.length;t++)r=b[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}function E(e){var t=1;e=e.split(":");const r=[];for(;0<t&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}function T(e){s.setTimeout(()=>{throw e},0)}function S(){var e=O;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var I=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new k,e=>e.reset());class k{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let C,A=!1,O=new class{constructor(){this.h=this.g=null}add(e,t){const r=I.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},R=()=>{const e=s.Promise.resolve(void 0);C=()=>{e.then(P)}};var P=()=>{for(var e;e=S();){try{e.h.call(e.g)}catch(e){T(e)}var t=I;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}A=!1};function N(){this.s=this.s,this.C=this.C}function x(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}N.prototype.s=!1,N.prototype.ma=function(){this.s||(this.s=!0,this.N())},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},x.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};s.addEventListener("test",e,t),s.removeEventListener("test",e,t)}catch(e){}return e}();function L(e,t){if(x.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(y){e:{try{m(t.nodeName);var s=!0;break e}catch(e){}s=!1}s||(t=null)}}else"mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement);this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:j[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&L.aa.h.call(this)}}h(L,x);var j={2:"touch",3:"pen",4:"mouse"};L.prototype.h=function(){L.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var U="closure_listenable_"+(1e6*Math.random()|0),M=0;function $(e,t,r,n,s){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=s,this.key=++M,this.da=this.fa=!1}function F(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function V(e){this.src=e,this.g={},this.h=0}function B(e,t){var r=t.type;if(r in e.g){var n,s=e.g[r],i=Array.prototype.indexOf.call(s,t,void 0);(n=0<=i)&&Array.prototype.splice.call(s,i,1),n&&(F(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function q(e,t,r,n){for(var s=0;s<e.length;++s){var i=e[s];if(!i.da&&i.listener==t&&i.capture==!!r&&i.ha==n)return s}return-1}V.prototype.add=function(e,t,r,n,s){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var o=q(e,t,n,s);return-1<o?(t=e[o],r||(t.fa=!1)):((t=new $(t,this.src,i,!!n,s)).fa=r,e.push(t)),t};var z="closure_lm_"+(1e6*Math.random()|0),K={};function H(e,t,r,n,s){if(n&&n.once)return G(e,t,r,n,s);if(Array.isArray(t)){for(var i=0;i<t.length;i++)H(e,t[i],r,n,s);return null}return r=te(r),e&&e[U]?e.K(t,r,o(n)?!!n.capture:!!n,s):W(e,t,r,!1,n,s)}function W(e,t,r,n,s,i){if(!t)throw Error("Invalid event type");var a=o(s)?!!s.capture:!!s,c=Z(e);if(c||(e[z]=c=new V(e)),(r=c.add(t,r,n,a,i)).proxy)return r;if(n=function(){const e=X;return function t(r){return e.call(t.src,t.listener,r)}}(),r.proxy=n,n.src=e,n.listener=r,e.addEventListener)D||(s=a),void 0===s&&(s=!1),e.addEventListener(t.toString(),n,s);else if(e.attachEvent)e.attachEvent(Q(t.toString()),n);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(n)}return r}function G(e,t,r,n,s){if(Array.isArray(t)){for(var i=0;i<t.length;i++)G(e,t[i],r,n,s);return null}return r=te(r),e&&e[U]?e.L(t,r,o(n)?!!n.capture:!!n,s):W(e,t,r,!0,n,s)}function J(e,t,r,n,s){if(Array.isArray(t))for(var i=0;i<t.length;i++)J(e,t[i],r,n,s);else n=o(n)?!!n.capture:!!n,r=te(r),e&&e[U]?(e=e.i,(t=String(t).toString())in e.g&&-1<(r=q(i=e.g[t],r,n,s))&&(F(i[r]),Array.prototype.splice.call(i,r,1),0==i.length&&(delete e.g[t],e.h--))):e&&(e=Z(e))&&(t=e.g[t.toString()],e=-1,t&&(e=q(t,r,n,s)),(r=-1<e?t[e]:null)&&Y(r))}function Y(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[U])B(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(Q(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=Z(t))?(B(r,e),0==r.h&&(r.src=null,t[z]=null)):F(e)}}}function Q(e){return e in K?K[e]:K[e]="on"+e}function X(e,t){if(e.da)e=!0;else{t=new L(t,this);var r=e.listener,n=e.ha||e.src;e.fa&&Y(e),e=r.call(n,t)}return e}function Z(e){return(e=e[z])instanceof V?e:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(e){return"function"==typeof e?e:(e[ee]||(e[ee]=function(t){return e.handleEvent(t)}),e[ee])}function re(){N.call(this),this.i=new V(this),this.M=this,this.F=null}function ne(e,t){var r,n=e.F;if(n)for(r=[];n;n=n.F)r.push(n);if(e=e.M,n=t.type||t,"string"==typeof t)t=new x(t,e);else if(t instanceof x)t.target=t.target||e;else{var s=t;_(t=new x(n,e),s)}if(s=!0,r)for(var i=r.length-1;0<=i;i--){var o=t.g=r[i];s=se(o,n,!0,t)&&s}if(s=se(o=t.g=e,n,!0,t)&&s,s=se(o,n,!1,t)&&s,r)for(i=0;i<r.length;i++)s=se(o=t.g=r[i],n,!1,t)&&s}function se(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.da&&o.capture==r){var a=o.listener,c=o.ha||o.src;o.fa&&B(e.i,o),s=!1!==a.call(c,n)&&s}}return s&&!n.defaultPrevented}function ie(e,t,r){if("function"==typeof e)r&&(e=u(e,r));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=u(e.handleEvent,e)}return 2147483647<Number(t)?-1:s.setTimeout(e,t||0)}function oe(e){e.g=ie(()=>{e.g=null,e.i&&(e.i=!1,oe(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}h(re,N),re.prototype[U]=!0,re.prototype.removeEventListener=function(e,t,r,n){J(this,e,t,r,n)},re.prototype.N=function(){if(re.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var r=t.g[e],n=0;n<r.length;n++)F(r[n]);delete t.g[e],t.h--}}this.F=null},re.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},re.prototype.L=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class ae extends N{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:oe(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ce(e){N.call(this),this.h=e,this.g={}}h(ce,N);var ue=[];function le(e){v(e.g,function(e,t){this.g.hasOwnProperty(t)&&Y(e)},e),e.g={}}ce.prototype.N=function(){ce.aa.N.call(this),le(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var he=s.JSON.stringify,de=s.JSON.parse,fe=class{stringify(e){return s.JSON.stringify(e,void 0)}parse(e){return s.JSON.parse(e,void 0)}};function pe(){}function ge(e){return e.h||(e.h=e.i())}function me(){}pe.prototype.h=null;var ye={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ve(){x.call(this,"d")}function we(){x.call(this,"c")}h(ve,x),h(we,x);var be={},_e=null;function Ee(){return _e=_e||new re}function Te(e){x.call(this,be.La,e)}function Se(e){const t=Ee();ne(t,new Te(t))}function Ie(e,t){x.call(this,be.STAT_EVENT,e),this.stat=t}function ke(e){const t=Ee();ne(t,new Ie(t,e))}function Ce(e,t){x.call(this,be.Ma,e),this.size=t}function Ae(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){e()},t)}function Oe(){this.g=!0}function Re(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var r=JSON.parse(t);if(r)for(e=0;e<r.length;e++)if(Array.isArray(r[e])){var n=r[e];if(!(2>n.length)){var s=n[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return he(r)}catch(e){return t}}(e,r)+(n?" "+n:"")})}be.La="serverreachability",h(Te,x),be.STAT_EVENT="statevent",h(Ie,x),be.Ma="timingevent",h(Ce,x),Oe.prototype.xa=function(){this.g=!1},Oe.prototype.info=function(){};var Pe,Ne={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},xe={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function De(){}function Le(e,t,r,n){this.j=e,this.i=t,this.l=r,this.R=n||1,this.U=new ce(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new je}function je(){this.i=null,this.g="",this.h=!1}h(De,pe),De.prototype.g=function(){return new XMLHttpRequest},De.prototype.i=function(){return{}},Pe=new De;var Ue={},Me={};function $e(e,t,r){e.L=1,e.v=ht(ot(t)),e.m=r,e.P=!0,Fe(e,null)}function Fe(e,t){e.F=Date.now(),qe(e),e.A=ot(e.v);var r=e.A,n=e.R;Array.isArray(n)||(n=[String(n)]),It(r.i,"t",n),e.C=0,r=e.j.J,e.h=new je,e.g=dr(e.j,r?t:null,!e.m),0<e.O&&(e.M=new ae(u(e.Y,e,e.g),e.O)),t=e.U,r=e.g,n=e.ca;var s="readystatechange";Array.isArray(s)||(s&&(ue[0]=s.toString()),s=ue);for(var i=0;i<s.length;i++){var o=H(r,s[i],n||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?w(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Se(),function(e,t,r,n,s,i){e.info(function(){if(e.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+n+") [attempt "+s+"]: "+t+"\n"+r+"\n"+o})}(e.i,e.u,e.A,e.l,e.R,e.m)}function Ve(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function Be(e,t){var r=e.C,n=t.indexOf("\n",r);return-1==n?Me:(r=Number(t.substring(r,n)),isNaN(r)?Ue:(n+=1)+r>t.length?Me:(t=t.slice(n,n+r),e.C=n+r,t))}function qe(e){e.S=Date.now()+e.I,ze(e,e.I)}function ze(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ae(u(e.ba,e),t)}function Ke(e){e.B&&(s.clearTimeout(e.B),e.B=null)}function He(e){0==e.j.G||e.J||ar(e.j,e)}function We(e){Ke(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,le(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function Ge(e,t){try{var r=e.j;if(0!=r.G&&(r.g==e||Ze(r.h,e)))if(!e.K&&Ze(r.h,e)&&3==r.G){try{var n=r.Da.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var s=n;if(0==s[0]){e:if(!r.u){if(r.g){if(!(r.g.F+3e3<e.F))break e;or(r),Yt(r)}nr(r),ke(18)}}else r.za=s[1],0<r.za-r.T&&37500>s[2]&&r.F&&0==r.v&&!r.C&&(r.C=Ae(u(r.Za,r),6e3));if(1>=Xe(r.h)&&r.ca){try{r.ca()}catch(e){}r.ca=void 0}}else ur(r,11)}else if((e.K||r.g==e)&&or(r),!p(t))for(s=r.Da.g.parse(t),t=0;t<s.length;t++){let u=s[t];if(r.T=u[0],u=u[1],2==r.G)if("c"==u[0]){r.K=u[1],r.ia=u[2];const t=u[3];null!=t&&(r.la=t,r.j.info("VER="+r.la));const s=u[4];null!=s&&(r.Aa=s,r.j.info("SVER="+r.Aa));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(n=1.5*l,r.L=n,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=n.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(et(i,i.h),i.h=null))}if(n.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.ya=e,lt(n.I,n.D,e))}}r.G=3,r.l&&r.l.ua(),r.ba&&(r.R=Date.now()-e.F,r.j.info("Handshake RTT: "+r.R+"ms"));var o=e;if((n=r).qa=hr(n,n.J?n.ia:null,n.W),o.K){tt(n.h,o);var a=o,c=n.L;c&&(a.I=c),a.B&&(Ke(a),qe(a)),n.g=o}else rr(n);0<r.i.length&&Xt(r)}else"stop"!=u[0]&&"close"!=u[0]||ur(r,7);else 3==r.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?ur(r,7):Jt(r):"noop"!=u[0]&&r.l&&r.l.ta(u),r.v=0)}Se()}catch(e){}}Le.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Kt(e)?t.j():this.Y(e)},Le.prototype.Y=function(e){try{if(e==this.g)e:{const d=Kt(this.g);var t=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||Ht(this.g)))){this.J||4!=d||7==t||Se(),Ke(this);var r=this.g.Z();this.X=r;t:if(Ve(this)){var n=Ht(this.g);e="";var i=n.length,o=4==Kt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){We(this),He(this);var a="";break t}this.h.i=new s.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(n[t],{stream:!(o&&t==i-1)});n.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==r,function(e,t,r,n,s,i,o){e.info(function(){return"XMLHTTP RESP ("+n+") [ attempt "+s+"]: "+t+"\n"+r+"\n"+i+" "+o})}(this.i,this.u,this.A,this.l,this.R,d,r),this.o){if(this.T&&!this.K){t:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(c)){var l=c;break t}}l=null}if(!(r=l)){this.o=!1,this.s=3,ke(12),We(this),He(this);break e}Re(this.i,this.l,r,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ge(this,r)}if(this.P){let e;for(r=!0;!this.J&&this.C<a.length;){if(e=Be(this,a),e==Me){4==d&&(this.s=4,ke(14),r=!1),Re(this.i,this.l,null,"[Incomplete Response]");break}if(e==Ue){this.s=4,ke(15),Re(this.i,this.l,a,"[Invalid Chunk]"),r=!1;break}Re(this.i,this.l,e,null),Ge(this,e)}if(Ve(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,ke(16),r=!1),this.o=this.o&&r,r){if(0<a.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),sr(h),h.M=!0,ke(11))}}else Re(this.i,this.l,a,"[Invalid Chunked Response]"),We(this),He(this)}else Re(this.i,this.l,a,null),Ge(this,a);4==d&&We(this),this.o&&!this.J&&(4==d?ar(this.j,this):(this.o=!1,qe(this)))}else(function(e){const t={};e=(e.g&&2<=Kt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(p(e[n]))continue;var r=E(e[n]);const s=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();const i=t[s]||[];t[s]=i,i.push(r)}!function(e,t){for(const r in e)t.call(void 0,e[r],r,e)}(t,function(e){return e.join(", ")})})(this.g),400==r&&0<a.indexOf("Unknown SID")?(this.s=3,ke(12)):(this.s=0,ke(13)),We(this),He(this)}}}catch(e){}},Le.prototype.cancel=function(){this.J=!0,We(this)},Le.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(Se(),ke(17)),We(this),this.s=2,He(this)):ze(this,this.S-e)};var Je=class{constructor(e,t){this.g=e,this.map=t}};function Ye(e){this.l=e||10,e=s.PerformanceNavigationTiming?0<(e=s.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Qe(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Xe(e){return e.h?1:e.g?e.g.size:0}function Ze(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function et(e,t){e.g?e.g.add(t):e.h=t}function tt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function rt(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const r of e.g.values())t=t.concat(r.D);return t}return d(e.i)}function nt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(i(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var r=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(i(e)||"string"==typeof e){var t=[];e=e.length;for(var r=0;r<e;r++)t.push(r);return t}t=[],r=0;for(const n in e)t[r++]=n;return t}}}(e),n=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(i(e)){for(var t=[],r=e.length,n=0;n<r;n++)t.push(e[n]);return t}for(n in t=[],r=0,e)t[r++]=e[n];return t}(e),s=n.length,o=0;o<s;o++)t.call(void 0,n[o],r&&r[o],e)}Ye.prototype.cancel=function(){if(this.i=rt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var st=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function it(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof it){this.h=e.h,at(this,e.j),this.o=e.o,this.g=e.g,ct(this,e.s),this.l=e.l;var t=e.i,r=new _t;r.i=t.i,t.g&&(r.g=new Map(t.g),r.h=t.h),ut(this,r),this.m=e.m}else e&&(t=String(e).match(st))?(this.h=!1,at(this,t[1]||"",!0),this.o=dt(t[2]||""),this.g=dt(t[3]||"",!0),ct(this,t[4]),this.l=dt(t[5]||"",!0),ut(this,t[6]||"",!0),this.m=dt(t[7]||"")):(this.h=!1,this.i=new _t(null,this.h))}function ot(e){return new it(e)}function at(e,t,r){e.j=r?dt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ct(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function ut(e,t,r){t instanceof _t?(e.i=t,function(e,t){t&&!e.j&&(Et(e),e.i=null,e.g.forEach(function(e,t){var r=t.toLowerCase();t!=r&&(Tt(this,t),It(this,r,e))},e)),e.j=t}(e.i,e.h)):(r||(t=ft(t,wt)),e.i=new _t(t,e.h))}function lt(e,t,r){e.i.set(t,r)}function ht(e){return lt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function dt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ft(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,pt),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function pt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}it.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ft(t,mt,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ft(t,mt,!0),"@"),e.push(encodeURIComponent(String(r)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.s)&&e.push(":",String(r))),(r=this.l)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(ft(r,"/"==r.charAt(0)?vt:yt,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",ft(r,bt)),e.join("")};var gt,mt=/[#\/\?@]/g,yt=/[#\?:]/g,vt=/[#\?]/g,wt=/[#\?@]/g,bt=/#/g;function _t(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Et(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var r=0;r<e.length;r++){var n=e[r].indexOf("="),s=null;if(0<=n){var i=e[r].substring(0,n);s=e[r].substring(n+1)}else i=e[r];t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function Tt(e,t){Et(e),t=kt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function St(e,t){return Et(e),t=kt(e,t),e.g.has(t)}function It(e,t,r){Tt(e,t),0<r.length&&(e.i=null,e.g.set(kt(e,t),d(r)),e.h+=r.length)}function kt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Ct(e,t,r,n,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),n(r)}catch(e){}}function At(){this.g=new fe}function Ot(e,t,r){const n=r||"";try{nt(e,function(e,r){let s=e;o(e)&&(s=he(e)),t.push(n+r+"="+encodeURIComponent(s))})}catch(e){throw t.push(n+"type="+encodeURIComponent("_badmap")),e}}function Rt(e){this.l=e.Ub||null,this.j=e.eb||!1}function Pt(e,t){re.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Nt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function xt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Dt(e)}function Dt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Lt(e){let t="";return v(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function jt(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=Lt(r),"string"==typeof e?null!=r&&encodeURIComponent(String(r)):lt(e,t,r))}function Ut(e){re.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=_t.prototype).add=function(e,t){Et(this),this.i=null,e=kt(this,e);var r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},e.forEach=function(e,t){Et(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},e.na=function(){Et(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),r=[];for(let n=0;n<t.length;n++){const s=e[n];for(let e=0;e<s.length;e++)r.push(t[n])}return r},e.V=function(e){Et(this);let t=[];if("string"==typeof e)St(this,e)&&(t=t.concat(this.g.get(kt(this,e))));else{e=Array.from(this.g.values());for(let r=0;r<e.length;r++)t=t.concat(e[r])}return t},e.set=function(e,t){return Et(this),this.i=null,St(this,e=kt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var r=0;r<t.length;r++){var n=t[r];const i=encodeURIComponent(String(n)),o=this.V(n);for(n=0;n<o.length;n++){var s=i;""!==o[n]&&(s+="="+encodeURIComponent(String(o[n]))),e.push(s)}}return this.i=e.join("&")},h(Rt,pe),Rt.prototype.g=function(){return new Pt(this.l,this.j)},Rt.prototype.i=(gt={},function(){return gt}),h(Pt,re),(e=Pt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Dt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||s).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,xt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Dt(this)),this.g&&(this.readyState=3,Dt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==s.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Nt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?xt(this):Dt(this),3==this.readyState&&Nt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,xt(this))},e.Qa=function(e){this.g&&(this.response=e,xt(this))},e.ga=function(){this.g&&xt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var r=t.next();!r.done;)r=r.value,e.push(r[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(Pt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),h(Ut,re);var Mt=/^https?$/i,$t=["POST","PUT"];function Ft(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Vt(e),qt(e)}function Vt(e){e.A||(e.A=!0,ne(e,"complete"),ne(e,"error"))}function Bt(e){if(e.h&&void 0!==n&&(!e.v[1]||4!=Kt(e)||2!=e.Z()))if(e.u&&4==Kt(e))ie(e.Ea,0,e);else if(ne(e,"readystatechange"),4==Kt(e)){e.h=!1;try{const n=e.Z();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var r;if(!(r=t)){var i;if(i=0===n){var o=String(e.D).match(st)[1]||null;!o&&s.self&&s.self.location&&(o=s.self.location.protocol.slice(0,-1)),i=!Mt.test(o?o.toLowerCase():"")}r=i}if(r)ne(e,"complete"),ne(e,"success");else{e.m=6;try{var a=2<Kt(e)?e.g.statusText:""}catch(e){a=""}e.l=a+" ["+e.Z()+"]",Vt(e)}}finally{qt(e)}}}function qt(e,t){if(e.g){zt(e);const r=e.g,n=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||ne(e,"ready");try{r.onreadystatechange=n}catch(e){}}}function zt(e){e.I&&(s.clearTimeout(e.I),e.I=null)}function Kt(e){return e.g?e.g.readyState:0}function Ht(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Wt(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function Gt(e){this.Aa=0,this.i=[],this.j=new Oe,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Wt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Wt("baseRetryDelayMs",5e3,e),this.cb=Wt("retryDelaySeedMs",1e4,e),this.Wa=Wt("forwardChannelMaxRetries",2,e),this.wa=Wt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Ye(e&&e.concurrentRequestLimit),this.Da=new At,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Jt(e){if(Qt(e),3==e.G){var t=e.U++,r=ot(e.I);if(lt(r,"SID",e.K),lt(r,"RID",t),lt(r,"TYPE","terminate"),er(e,r),(t=new Le(e,e.j,t)).L=2,t.v=ht(ot(r)),r=!1,s.navigator&&s.navigator.sendBeacon)try{r=s.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!r&&s.Image&&((new Image).src=t.v,r=!0),r||(t.g=dr(t.j,null),t.g.ea(t.v)),t.F=Date.now(),qe(t)}lr(e)}function Yt(e){e.g&&(sr(e),e.g.cancel(),e.g=null)}function Qt(e){Yt(e),e.u&&(s.clearTimeout(e.u),e.u=null),or(e),e.h.cancel(),e.s&&("number"==typeof e.s&&s.clearTimeout(e.s),e.s=null)}function Xt(e){if(!Qe(e.h)&&!e.s){e.s=!0;var t=e.Ga;C||R(),A||(C(),A=!0),O.add(t,e),e.B=0}}function Zt(e,t){var r;r=t?t.l:e.U++;const n=ot(e.I);lt(n,"SID",e.K),lt(n,"RID",r),lt(n,"AID",e.T),er(e,n),e.m&&e.o&&jt(n,e.m,e.o),r=new Le(e,e.j,r,e.B+1),null===e.m&&(r.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tr(e,r,1e3),r.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),et(e.h,r),$e(r,n,t)}function er(e,t){e.H&&v(e.H,function(e,r){lt(t,r,e)}),e.l&&nt({},function(e,r){lt(t,r,e)})}function tr(e,t,r){r=Math.min(e.i.length,r);var n=e.l?u(e.l.Na,e.l,e):null;e:{var s=e.i;let t=-1;for(;;){const e=["count="+r];-1==t?0<r?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let i=!0;for(let o=0;o<r;o++){let r=s[o].g;const a=s[o].map;if(r-=t,0>r)t=Math.max(0,s[o].g-100),i=!1;else try{Ot(a,e,"req"+r+"_")}catch(e){n&&n(a)}}if(i){n=e.join("&");break e}}}return e=e.i.splice(0,r),t.D=e,n}function rr(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;C||R(),A||(C(),A=!0),O.add(t,e),e.v=0}}function nr(e){return!(e.g||e.u||3<=e.v||(e.Y++,e.u=Ae(u(e.Fa,e),cr(e,e.v)),e.v++,0))}function sr(e){null!=e.A&&(s.clearTimeout(e.A),e.A=null)}function ir(e){e.g=new Le(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=ot(e.qa);lt(t,"RID","rpc"),lt(t,"SID",e.K),lt(t,"AID",e.T),lt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&lt(t,"TO",e.ja),lt(t,"TYPE","xmlhttp"),er(e,t),e.m&&e.o&&jt(t,e.m,e.o),e.L&&(e.g.I=e.L);var r=e.g;e=e.ia,r.L=1,r.v=ht(ot(t)),r.m=null,r.P=!0,Fe(r,e)}function or(e){null!=e.C&&(s.clearTimeout(e.C),e.C=null)}function ar(e,t){var r=null;if(e.g==t){or(e),sr(e),e.g=null;var n=2}else{if(!Ze(e.h,t))return;r=t.D,tt(e.h,t),n=1}if(0!=e.G)if(t.o)if(1==n){r=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;ne(n=Ee(),new Ce(n,r)),Xt(e)}else rr(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==n&&function(e,t){return!(Xe(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=Ae(u(e.Ga,e,t),cr(e,e.B)),e.B++,0)))}(e,t)||2==n&&nr(e)))switch(r&&0<r.length&&(t=e.h,t.i=t.i.concat(r)),s){case 1:ur(e,5);break;case 4:ur(e,10);break;case 3:ur(e,6);break;default:ur(e,2)}}function cr(e,t){let r=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(r*=2),r*t}function ur(e,t){if(e.j.info("Error code "+t),2==t){var r=u(e.fb,e),n=e.Xa;const t=!n;n=new it(n||"//www.google.com/images/cleardot.gif"),s.location&&"http"==s.location.protocol||at(n,"https"),ht(n),t?function(e,t){const r=new Oe;if(s.Image){const n=new Image;n.onload=l(Ct,r,"TestLoadImage: loaded",!0,t,n),n.onerror=l(Ct,r,"TestLoadImage: error",!1,t,n),n.onabort=l(Ct,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=l(Ct,r,"TestLoadImage: timeout",!1,t,n),s.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(n.toString(),r):function(e,t){new Oe;const r=new AbortController,n=setTimeout(()=>{r.abort(),Ct(0,0,!1,t)},1e4);fetch(e,{signal:r.signal}).then(e=>{clearTimeout(n),e.ok?Ct(0,0,!0,t):Ct(0,0,!1,t)}).catch(()=>{clearTimeout(n),Ct(0,0,!1,t)})}(n.toString(),r)}else ke(2);e.G=0,e.l&&e.l.sa(t),lr(e),Qt(e)}function lr(e){if(e.G=0,e.ka=[],e.l){const t=rt(e.h);0==t.length&&0==e.i.length||(f(e.ka,t),f(e.ka,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.ra()}}function hr(e,t,r){var n=r instanceof it?ot(r):new it(r);if(""!=n.g)t&&(n.g=t+"."+n.g),ct(n,n.s);else{var i=s.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var o=new it(null);n&&at(o,n),t&&(o.g=t),i&&ct(o,i),r&&(o.l=r),n=o}return r=e.D,t=e.ya,r&&t&&lt(n,r,t),lt(n,"VER",e.la),er(e,n),n}function dr(e,t,r){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Ut(new Rt({eb:r})):new Ut(e.pa)).Ha(e.J),t}function fr(){}function pr(){}function gr(e,t){re.call(this),this.g=new Gt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!p(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!p(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new vr(this)}function mr(e){ve.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function yr(){we.call(this),this.status=1}function vr(e){this.g=e}(e=Ut.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,r,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Pe.g(),this.v=this.o?ge(this.o):ge(Pe),this.g.onreadystatechange=u(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void Ft(this,e)}if(e=r||"",r=new Map(this.headers),n)if(Object.getPrototypeOf(n)===Object.prototype)for(var i in n)r.set(i,n[i]);else{if("function"!=typeof n.keys||"function"!=typeof n.get)throw Error("Unknown input type for opt_headers: "+String(n));for(const e of n.keys())r.set(e,n.get(e))}n=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),i=s.FormData&&e instanceof s.FormData,!(0<=Array.prototype.indexOf.call($t,t,void 0))||n||i||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of r)this.g.setRequestHeader(e,t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{zt(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){Ft(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,ne(this,"complete"),ne(this,"abort"),qt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),qt(this,!0)),Ut.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Bt(this):this.bb())},e.bb=function(){Bt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Kt(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),de(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Gt.prototype).la=8,e.G=1,e.connect=function(e,t,r,n){ke(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.I=hr(this,null,this.W),Xt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const s=new Le(this,this.j,e);let i=this.o;if(this.S&&(i?(i=w(i),_(i,this.S)):i=this.S),null!==this.m||this.O||(s.H=i,i=null),this.P)e:{for(var t=0,r=0;r<this.i.length;r++){var n=this.i[r];if(void 0===(n="__data__"in n.map&&"string"==typeof(n=n.map.__data__)?n.length:void 0))break;if(4096<(t+=n)){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tr(this,s,t),lt(r=ot(this.I),"RID",e),lt(r,"CVER",22),this.D&&lt(r,"X-HTTP-Session-Id",this.D),er(this,r),i&&(this.O?t="headers="+encodeURIComponent(String(Lt(i)))+"&"+t:this.m&&jt(r,this.m,i)),et(this.h,s),this.Ua&&lt(r,"TYPE","init"),this.P?(lt(r,"$req",t),lt(r,"SID","null"),s.T=!0,$e(s,r,null)):$e(s,r,t),this.G=2}}else 3==this.G&&(e?Zt(this,e):0==this.i.length||Qe(this.h)||Zt(this))},e.Fa=function(){if(this.u=null,ir(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Ae(u(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ke(10),Yt(this),ir(this))},e.Za=function(){null!=this.C&&(this.C=null,Yt(this),nr(this),ke(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),ke(2)):(this.j.info("Failed to ping google.com"),ke(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=fr.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},pr.prototype.g=function(e,t){return new gr(e,t)},h(gr,re),gr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},gr.prototype.close=function(){Jt(this.g)},gr.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.u&&((r={}).__data__=he(e),e=r);t.i.push(new Je(t.Ya++,e)),3==t.G&&Xt(t)},gr.prototype.N=function(){this.g.l=null,delete this.j,Jt(this.g),delete this.g,gr.aa.N.call(this)},h(mr,ve),h(yr,we),h(vr,fr),vr.prototype.ua=function(){ne(this.g,"a")},vr.prototype.ta=function(e){ne(this.g,new mr(e))},vr.prototype.sa=function(e){ne(this.g,new yr)},vr.prototype.ra=function(){ne(this.g,"b")},pr.prototype.createWebChannel=pr.prototype.g,gr.prototype.send=gr.prototype.o,gr.prototype.open=gr.prototype.m,gr.prototype.close=gr.prototype.close,_s=Ts.createWebChannelTransport=function(){return new pr},bs=Ts.getStatEventTarget=function(){return Ee()},ws=Ts.Event=be,vs=Ts.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ne.NO_ERROR=0,Ne.TIMEOUT=8,Ne.HTTP_ERROR=6,ys=Ts.ErrorCode=Ne,xe.COMPLETE="complete",ms=Ts.EventType=xe,me.EventType=ye,ye.OPEN="a",ye.CLOSE="b",ye.ERROR="c",ye.MESSAGE="d",re.prototype.listen=re.prototype.K,gs=Ts.WebChannel=me,Ts.FetchXmlHttpFactory=Rt,Ut.prototype.listenOnce=Ut.prototype.L,Ut.prototype.getLastError=Ut.prototype.Ka,Ut.prototype.getLastErrorCode=Ut.prototype.Ba,Ut.prototype.getStatus=Ut.prototype.Z,Ut.prototype.getResponseJson=Ut.prototype.Oa,Ut.prototype.getResponseText=Ut.prototype.oa,Ut.prototype.send=Ut.prototype.ea,Ut.prototype.setWithCredentials=Ut.prototype.Ha,ps=Ts.XhrIo=Ut}).apply(void 0!==Es?Es:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Ss="@firebase/firestore",Is="4.8.0";class ks{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ks.UNAUTHENTICATED=new ks(null),ks.GOOGLE_CREDENTIALS=new ks("google-credentials-uid"),ks.FIRST_PARTY=new ks("first-party-uid"),ks.MOCK_USER=new ks("mock-user");let Cs="11.10.0";const As=new q("@firebase/firestore");function Os(){return As.logLevel}function Rs(e,...t){if(As.logLevel<=M.DEBUG){const r=t.map(xs);As.debug(`Firestore (${Cs}): ${e}`,...r)}}function Ps(e,...t){if(As.logLevel<=M.ERROR){const r=t.map(xs);As.error(`Firestore (${Cs}): ${e}`,...r)}}function Ns(e,...t){if(As.logLevel<=M.WARN){const r=t.map(xs);As.warn(`Firestore (${Cs}): ${e}`,...r)}}function xs(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function Ds(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,Ls(e,n,r)}function Ls(e,t,r){let n=`FIRESTORE (${Cs}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw Ps(n),new Error(n)}function js(e,t,r,n){let s="Unexpected state";"string"==typeof r?s=r:n=r,e||Ls(t,s,n)}function Us(e,t){return e}const Ms={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class $s extends E{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Fs{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Vs{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Bs{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ks.UNAUTHENTICATED))}shutdown(){}}class qs{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class zs{constructor(e){this.t=e,this.currentUser=ks.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){js(void 0===this.o,42304);let r=this.i;const n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve();let s=new Fs;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Fs,e.enqueueRetryable(()=>n(this.currentUser))};const i=()=>{const t=s;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},o=e=>{Rs("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Rs("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Fs)}},0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(Rs("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(js("string"==typeof t.accessToken,31837,{l:t}),new Vs(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return js(null===e||"string"==typeof e,2055,{h:e}),new ks(e)}}class Ks{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=ks.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Hs{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Ks(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(ks.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ws{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Gs{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ze(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){js(void 0===this.o,3512);const r=e=>{null!=e.error&&Rs("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const r=e.token!==this.m;return this.m=e.token,Rs("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};const n=e=>{Rs("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?n(e):Rs("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ws(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(js("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new Ws(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Js(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let t=0;t<e;t++)r[t]=Math.floor(256*Math.random());return r}function Ys(){return new TextEncoder}class Qs{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const r=Js(40);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function Xs(e,t){return e<t?-1:e>t?1:0}function Zs(e,t){let r=0;for(;r<e.length&&r<t.length;){const n=e.codePointAt(r),s=t.codePointAt(r);if(n!==s){if(n<128&&s<128)return Xs(n,s);{const i=Ys(),o=ti(i.encode(ei(e,r)),i.encode(ei(t,r)));return 0!==o?o:Xs(n,s)}}r+=n>65535?2:1}return Xs(e.length,t.length)}function ei(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function ti(e,t){for(let r=0;r<e.length&&r<t.length;++r)if(e[r]!==t[r])return Xs(e[r],t[r]);return Xs(e.length,t.length)}function ri(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}const ni="__name__";class si{constructor(e,t,r){void 0===t?t=0:t>e.length&&Ds(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&Ds(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===si.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof si?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let n=0;n<r;n++){const r=si.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return Xs(e.length,t.length)}static compareSegments(e,t){const r=si.isNumericId(e),n=si.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?si.extractNumericId(e).compare(si.extractNumericId(t)):Zs(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ls.fromString(e.substring(4,e.length-2))}}class ii extends si{construct(e,t,r){return new ii(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new $s(Ms.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new ii(t)}static emptyPath(){return new ii([])}}const oi=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ai extends si{construct(e,t,r){return new ai(e,t,r)}static isValidIdentifier(e){return oi.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ai.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===ni}static keyField(){return new ai([ni])}static fromServerFormat(e){const t=[];let r="",n=0;const s=()=>{if(0===r.length)throw new $s(Ms.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let i=!1;for(;n<e.length;){const t=e[n];if("\\"===t){if(n+1===e.length)throw new $s(Ms.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new $s(Ms.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?(i=!i,n++):"."!==t||i?(r+=t,n++):(s(),n++)}if(s(),i)throw new $s(Ms.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ai(t)}static emptyPath(){return new ai([])}}class ci{constructor(e){this.path=e}static fromPath(e){return new ci(ii.fromString(e))}static fromName(e){return new ci(ii.fromString(e).popFirst(5))}static empty(){return new ci(ii.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ii.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ii.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ci(new ii(e.slice()))}}function ui(e){if(!ci.isDocumentKey(e))throw new $s(Ms.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function li(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new $s(Ms.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=function(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Ds(12329,{type:typeof e})}(e);throw new $s(Ms.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function hi(e,t){const r={typeString:e};return t&&(r.value=t),r}function di(e,t){if(!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(e))throw new $s(Ms.INVALID_ARGUMENT,"JSON must be an object");let r;for(const n in t)if(t[n]){const s=t[n].typeString,i="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}const o=e[n];if(s&&typeof o!==s){r=`JSON field '${n}' must be a ${s}.`;break}if(void 0!==i&&o!==i.value){r=`Expected '${n}' field to equal '${i.value}'`;break}}if(r)throw new $s(Ms.INVALID_ARGUMENT,r);return!0}const fi=-62135596800,pi=1e6;class gi{static now(){return gi.fromMillis(Date.now())}static fromDate(e){return gi.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*pi);return new gi(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new $s(Ms.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new $s(Ms.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<fi)throw new $s(Ms.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new $s(Ms.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/pi}_compareTo(e){return this.seconds===e.seconds?Xs(this.nanoseconds,e.nanoseconds):Xs(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:gi._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(di(e,gi._jsonSchema))return new gi(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-fi;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}gi._jsonSchemaVersion="firestore/timestamp/1.0",gi._jsonSchema={type:hi("string",gi._jsonSchemaVersion),seconds:hi("number"),nanoseconds:hi("number")};class mi{static fromTimestamp(e){return new mi(e)}static min(){return new mi(new gi(0,0))}static max(){return new mi(new gi(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function yi(e){return new vi(e.readTime,e.key,-1)}class vi{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new vi(mi.min(),ci.empty(),-1)}static max(){return new vi(mi.max(),ci.empty(),-1)}}function wi(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r?r:(r=ci.comparator(e.documentKey,t.documentKey),0!==r?r:Xs(e.largestBatchId,t.largestBatchId))}class bi{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function _i(e){if(e.code!==Ms.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;Rs("LocalStore","Unexpectedly lost primary lease")}class Ei{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ds(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Ei((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Ei?t:Ei.resolve(t)}catch(e){return Ei.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Ei.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Ei.reject(t)}static resolve(e){return new Ei((t,r)=>{t(e)})}static reject(e){return new Ei((t,r)=>{r(e)})}static waitFor(e){return new Ei((t,r)=>{let n=0,s=0,i=!1;e.forEach(e=>{++n,e.next(()=>{++s,i&&s===n&&t()},e=>r(e))}),i=!0,s===n&&t()})}static or(e){let t=Ei.resolve(!1);for(const r of e)t=t.next(e=>e?Ei.resolve(e):r());return t}static forEach(e,t){const r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new Ei((r,n)=>{const s=e.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;t(e[c]).next(e=>{i[c]=e,++o,o===s&&r(i)},e=>n(e))}})}static doWhile(e,t){return new Ei((r,n)=>{const s=()=>{!0===e()?t().next(()=>{s()},n):r()};s()})}}function Ti(e){return"IndexedDbTransactionError"===e.name}class Si{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this._e(e),this.ae=e=>t.writeSequenceNumber(e))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ae&&this.ae(e),e}}Si.ue=-1;function Ii(e){return null==e}function ki(e){return 0===e&&1/e==-1/0}function Ci(e,t){let r=t;const n=e.length;for(let t=0;t<n;t++){const n=e.charAt(t);switch(n){case"\0":r+="";break;case"":r+="";break;default:r+=n}}return r}function Ai(e){return e+""}const Oi="owner",Ri="mutationQueues",Pi="mutations",Ni="documentMutations",xi="remoteDocumentGlobal",Di="targets",Li="targetDocuments",ji="targetGlobal",Ui="collectionParents",Mi="clientMetadata",$i="bundles",Fi="namedQueries";function Vi(e){let t=0;for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function Bi(e,t){for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}class qi{constructor(e,t){this.comparator=e,this.root=t||Ki.EMPTY}insert(e,t){return new qi(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ki.BLACK,null,null))}remove(e){return new qi(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ki.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new zi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new zi(this.root,e,this.comparator,!1)}getReverseIterator(){return new zi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new zi(this.root,e,this.comparator,!0)}}class zi{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&n&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ki{constructor(e,t,r,n,s){this.key=e,this.value=t,this.color=null!=r?r:Ki.RED,this.left=null!=n?n:Ki.EMPTY,this.right=null!=s?s:Ki.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,s){return new Ki(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this;const s=r(e,n.key);return n=s<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===s?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r)),n.fixUp()}removeMin(){if(this.left.isEmpty())return Ki.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,n=this;if(t(e,n.key)<0)n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return Ki.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ki.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ki.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ds(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ds(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ds(27949);return e+(this.isRed()?0:1)}}Ki.EMPTY=null,Ki.RED=!0,Ki.BLACK=!1,Ki.EMPTY=new class{constructor(){this.size=0}get key(){throw Ds(57766)}get value(){throw Ds(16141)}get color(){throw Ds(16727)}get left(){throw Ds(29726)}get right(){throw Ds(36894)}copy(e,t,r,n,s){return this}insert(e,t,r){return new Ki(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Hi{constructor(e){this.comparator=e,this.data=new qi(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Wi(this.data.getIterator())}getIteratorFrom(e){return new Wi(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Hi))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Hi(this.comparator);return t.data=e,t}}class Wi{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Gi{constructor(e){this.fields=e,e.sort(ai.comparator)}static empty(){return new Gi([])}unionWith(e){let t=new Hi(ai.comparator);for(const e of this.fields)t=t.add(e);for(const r of e)t=t.add(r);return new Gi(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ri(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Ji extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Yi{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Ji("Invalid base64 string: "+e):e}}(e);return new Yi(t)}static fromUint8Array(e){const t=function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e);return new Yi(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Xs(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Yi.EMPTY_BYTE_STRING=new Yi("");const Qi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Xi(e){if(js(!!e,39018),"string"==typeof e){let t=0;const r=Qi.exec(e);if(js(!!r,46558,{timestamp:e}),r[1]){let e=r[1];e=(e+"000000000").substr(0,9),t=Number(e)}const n=new Date(e);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:Zi(e.seconds),nanos:Zi(e.nanos)}}function Zi(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function eo(e){return"string"==typeof e?Yi.fromBase64String(e):Yi.fromUint8Array(e)}const to="server_timestamp",ro="__type__",no="__previous_value__",so="__local_write_time__";function io(e){var t,r;return(null===(r=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[ro])||void 0===r?void 0:r.stringValue)===to}function oo(e){const t=e.mapValue.fields[no];return io(t)?oo(t):t}function ao(e){const t=Xi(e.mapValue.fields[so].timestampValue);return new gi(t.seconds,t.nanos)}class co{constructor(e,t,r,n,s,i,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=u}}const uo="(default)";class lo{constructor(e,t){this.projectId=e,this.database=t||uo}static empty(){return new lo("","")}get isDefaultDatabase(){return this.database===uo}isEqual(e){return e instanceof lo&&e.projectId===this.projectId&&e.database===this.database}}const ho="__max__",fo={fields:{__type__:{stringValue:ho}}},po="value";function go(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?io(e)?4:Po(e)?9007199254740991:Oo(e)?10:11:Ds(28295,{value:e})}function mo(e,t){if(e===t)return!0;const r=go(e);if(r!==go(t))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return ao(e).isEqual(ao(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const r=Xi(e.timestampValue),n=Xi(t.timestampValue);return r.seconds===n.seconds&&r.nanos===n.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return eo(e.bytesValue).isEqual(eo(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Zi(e.geoPointValue.latitude)===Zi(t.geoPointValue.latitude)&&Zi(e.geoPointValue.longitude)===Zi(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Zi(e.integerValue)===Zi(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const r=Zi(e.doubleValue),n=Zi(t.doubleValue);return r===n?ki(r)===ki(n):isNaN(r)&&isNaN(n)}return!1}(e,t);case 9:return ri(e.arrayValue.values||[],t.arrayValue.values||[],mo);case 10:case 11:return function(e,t){const r=e.mapValue.fields||{},n=t.mapValue.fields||{};if(Vi(r)!==Vi(n))return!1;for(const e in r)if(r.hasOwnProperty(e)&&(void 0===n[e]||!mo(r[e],n[e])))return!1;return!0}(e,t);default:return Ds(52216,{left:e})}}function yo(e,t){return void 0!==(e.values||[]).find(e=>mo(e,t))}function vo(e,t){if(e===t)return 0;const r=go(e),n=go(t);if(r!==n)return Xs(r,n);switch(r){case 0:case 9007199254740991:return 0;case 1:return Xs(e.booleanValue,t.booleanValue);case 2:return function(e,t){const r=Zi(e.integerValue||e.doubleValue),n=Zi(t.integerValue||t.doubleValue);return r<n?-1:r>n?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1}(e,t);case 3:return wo(e.timestampValue,t.timestampValue);case 4:return wo(ao(e),ao(t));case 5:return Zs(e.stringValue,t.stringValue);case 6:return function(e,t){const r=eo(e),n=eo(t);return r.compareTo(n)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){const t=Xs(r[e],n[e]);if(0!==t)return t}return Xs(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const r=Xs(Zi(e.latitude),Zi(t.latitude));return 0!==r?r:Xs(Zi(e.longitude),Zi(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return bo(e.arrayValue,t.arrayValue);case 10:return function(e,t){var r,n,s,i;const o=e.fields||{},a=t.fields||{},c=null===(r=o[po])||void 0===r?void 0:r.arrayValue,u=null===(n=a[po])||void 0===n?void 0:n.arrayValue,l=Xs((null===(s=null==c?void 0:c.values)||void 0===s?void 0:s.length)||0,(null===(i=null==u?void 0:u.values)||void 0===i?void 0:i.length)||0);return 0!==l?l:bo(c,u)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===fo&&t===fo)return 0;if(e===fo)return 1;if(t===fo)return-1;const r=e.fields||{},n=Object.keys(r),s=t.fields||{},i=Object.keys(s);n.sort(),i.sort();for(let e=0;e<n.length&&e<i.length;++e){const t=Zs(n[e],i[e]);if(0!==t)return t;const o=vo(r[n[e]],s[i[e]]);if(0!==o)return o}return Xs(n.length,i.length)}(e.mapValue,t.mapValue);default:throw Ds(23264,{le:r})}}function wo(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Xs(e,t);const r=Xi(e),n=Xi(t),s=Xs(r.seconds,n.seconds);return 0!==s?s:Xs(r.nanos,n.nanos)}function bo(e,t){const r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){const t=vo(r[e],n[e]);if(t)return t}return Xs(r.length,n.length)}function _o(e){return Eo(e)}function Eo(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Xi(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return eo(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return ci.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",r=!0;for(const n of e.values||[])r?r=!1:t+=",",t+=Eo(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let r="{",n=!0;for(const s of t)n?n=!1:r+=",",r+=`${s}:${Eo(e.fields[s])}`;return r+"}"}(e.mapValue):Ds(61005,{value:e})}function To(e){switch(go(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=oo(e);return t?16+To(t):16;case 5:return 2*e.stringValue.length;case 6:return eo(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce((e,t)=>e+To(t),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return Bi(e.fields,(e,r)=>{t+=e.length+To(r)}),t}(e.mapValue);default:throw Ds(13486,{value:e})}}function So(e){return!!e&&"integerValue"in e}function Io(e){return!!e&&"arrayValue"in e}function ko(e){return!!e&&"nullValue"in e}function Co(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Ao(e){return!!e&&"mapValue"in e}function Oo(e){var t,r;return"__vector__"===(null===(r=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===r?void 0:r.stringValue)}function Ro(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Bi(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=Ro(r)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=Ro(e.arrayValue.values[r]);return t}return Object.assign({},e)}function Po(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===ho}class No{constructor(e){this.value=e}static empty(){return new No({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ao(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ro(t)}setAll(e){let t=ai.emptyPath(),r={},n=[];e.forEach((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=s.popLast()}e?r[s.lastSegment()]=Ro(e):n.push(s.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,n)}delete(e){const t=this.field(e.popLast());Ao(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return mo(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];Ao(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){Bi(t,(t,r)=>e[t]=r);for(const t of r)delete e[t]}clone(){return new No(Ro(this.value))}}class xo{constructor(e,t,r,n,s,i,o){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(e){return new xo(e,0,mi.min(),mi.min(),mi.min(),No.empty(),0)}static newFoundDocument(e,t,r,n){return new xo(e,1,t,mi.min(),r,n,0)}static newNoDocument(e,t){return new xo(e,2,t,mi.min(),mi.min(),No.empty(),0)}static newUnknownDocument(e,t){return new xo(e,3,t,mi.min(),mi.min(),No.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(mi.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=No.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=No.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=mi.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof xo&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new xo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Do{constructor(e,t){this.position=e,this.inclusive=t}}function Lo(e,t,r){let n=0;for(let s=0;s<e.position.length;s++){const i=t[s],o=e.position[s];if(n=i.field.isKeyField()?ci.comparator(ci.fromName(o.referenceValue),r.key):vo(o,r.data.field(i.field)),"desc"===i.dir&&(n*=-1),0!==n)break}return n}function jo(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!mo(e.position[r],t.position[r]))return!1;return!0}class Uo{constructor(e,t="asc"){this.field=e,this.dir=t}}function Mo(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class $o{}class Fo extends $o{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new Wo(e,t,r):"array-contains"===t?new Qo(e,r):"in"===t?new Xo(e,r):"not-in"===t?new Zo(e,r):"array-contains-any"===t?new ea(e,r):new Fo(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new Go(e,r):new Jo(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(vo(t,this.value)):null!==t&&go(this.value)===go(t)&&this.matchesComparison(vo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Ds(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Vo extends $o{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new Vo(e,t)}matches(e){return Bo(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.he||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function Bo(e){return"and"===e.op}function qo(e){return function(e){for(const t of e.filters)if(t instanceof Vo)return!1;return!0}(e)&&Bo(e)}function zo(e){if(e instanceof Fo)return e.field.canonicalString()+e.op.toString()+_o(e.value);if(qo(e))return e.filters.map(e=>zo(e)).join(",");{const t=e.filters.map(e=>zo(e)).join(",");return`${e.op}(${t})`}}function Ko(e,t){return e instanceof Fo?function(e,t){return t instanceof Fo&&e.op===t.op&&e.field.isEqual(t.field)&&mo(e.value,t.value)}(e,t):e instanceof Vo?function(e,t){return t instanceof Vo&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,r,n)=>e&&Ko(r,t.filters[n]),!0)}(e,t):void Ds(19439)}function Ho(e){return e instanceof Fo?function(e){return`${e.field.canonicalString()} ${e.op} ${_o(e.value)}`}(e):e instanceof Vo?function(e){return e.op.toString()+" {"+e.getFilters().map(Ho).join(" ,")+"}"}(e):"Filter"}class Wo extends Fo{constructor(e,t,r){super(e,t,r),this.key=ci.fromName(r.referenceValue)}matches(e){const t=ci.comparator(e.key,this.key);return this.matchesComparison(t)}}class Go extends Fo{constructor(e,t){super(e,"in",t),this.keys=Yo(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Jo extends Fo{constructor(e,t){super(e,"not-in",t),this.keys=Yo(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Yo(e,t){var r;return((null===(r=t.arrayValue)||void 0===r?void 0:r.values)||[]).map(e=>ci.fromName(e.referenceValue))}class Qo extends Fo{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Io(t)&&yo(t.arrayValue,this.value)}}class Xo extends Fo{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&yo(this.value.arrayValue,t)}}class Zo extends Fo{constructor(e,t){super(e,"not-in",t)}matches(e){if(yo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!yo(this.value.arrayValue,t)}}class ea extends Fo{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Io(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>yo(this.value.arrayValue,e))}}class ta{constructor(e,t=null,r=[],n=[],s=null,i=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=s,this.startAt=i,this.endAt=o,this.Pe=null}}function ra(e,t=null,r=[],n=[],s=null,i=null,o=null){return new ta(e,t,r,n,s,i,o)}function na(e){const t=Us(e);if(null===t.Pe){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>zo(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Ii(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>_o(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>_o(e)).join(",")),t.Pe=e}return t.Pe}function sa(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++)if(!Mo(e.orderBy[r],t.orderBy[r]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!Ko(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!jo(e.startAt,t.startAt)&&jo(e.endAt,t.endAt)}function ia(e){return ci.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class oa{constructor(e,t=null,r=[],n=[],s=null,i="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function aa(e){return new oa(e)}function ca(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function ua(e){const t=Us(e);if(null===t.Te){t.Te=[];const e=new Set;for(const r of t.explicitOrderBy)t.Te.push(r),e.add(r.field.canonicalString());const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",n=function(e){let t=new Hi(ai.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);n.forEach(n=>{e.has(n.canonicalString())||n.isKeyField()||t.Te.push(new Uo(n,r))}),e.has(ai.keyField().canonicalString())||t.Te.push(new Uo(ai.keyField(),r))}return t.Te}function la(e){const t=Us(e);return t.Ie||(t.Ie=function(e,t){if("F"===e.limitType)return ra(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new Uo(e.field,t)});const r=e.endAt?new Do(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new Do(e.startAt.position,e.startAt.inclusive):null;return ra(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}(t,ua(e))),t.Ie}function ha(e,t,r){return new oa(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function da(e,t){return sa(la(e),la(t))&&e.limitType===t.limitType}function fa(e){return`${na(la(e))}|lt:${e.limitType}`}function pa(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>Ho(e)).join(", ")}]`),Ii(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>_o(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>_o(e)).join(",")),`Target(${t})`}(la(e))}; limitType=${e.limitType})`}function ga(e,t){return t.isFoundDocument()&&function(e,t){const r=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):ci.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r)}(e,t)&&function(e,t){for(const r of ua(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(const r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,r){const n=Lo(e,t,r);return e.inclusive?n<=0:n<0}(e.startAt,ua(e),t)||e.endAt&&!function(e,t,r){const n=Lo(e,t,r);return e.inclusive?n>=0:n>0}(e.endAt,ua(e),t))}(e,t)}function ma(e){return(t,r)=>{let n=!1;for(const s of ua(e)){const e=ya(s,t,r);if(0!==e)return e;n=n||s.field.isKeyField()}return 0}}function ya(e,t,r){const n=e.field.isKeyField()?ci.comparator(t.key,r.key):function(e,t,r){const n=t.data.field(e),s=r.data.field(e);return null!==n&&null!==s?vo(n,s):Ds(42886)}(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return Ds(19790,{direction:e.dir})}}class va{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[t,n]of r)if(this.equalsFn(t,e))return n}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){Bi(this.inner,(t,r)=>{for(const[t,n]of r)e(t,n)})}isEmpty(){return function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(this.inner)}size(){return this.innerSize}}const wa=new qi(ci.comparator);function ba(){return wa}const _a=new qi(ci.comparator);function Ea(...e){let t=_a;for(const r of e)t=t.insert(r.key,r);return t}function Ta(e){let t=_a;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function Sa(){return ka()}function Ia(){return ka()}function ka(){return new va(e=>e.toString(),(e,t)=>e.isEqual(t))}new qi(ci.comparator);const Ca=new Hi(ci.comparator);function Aa(...e){let t=Ca;for(const r of e)t=t.add(r);return t}const Oa=new Hi(Xs);class Ra{constructor(){this._=void 0}}function Pa(e,t,r){return e instanceof xa?function(e,t){const r={fields:{[ro]:{stringValue:to},[so]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&io(t)&&(t=oo(t)),t&&(r.fields[no]=t),{mapValue:r}}(r,t):e instanceof Da?La(e,t):e instanceof ja?Ua(e,t):function(e,t){const r=function(e,t){return e instanceof Ma?function(e){return So(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}(e,t),n=$a(r)+$a(e.Ee);return So(r)&&So(e.Ee)?function(e){return{integerValue:""+e}}(n):function(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ki(t)?"-0":t}}(e.serializer,n)}(e,t)}function Na(e,t,r){return e instanceof Da?La(e,t):e instanceof ja?Ua(e,t):r}class xa extends Ra{}class Da extends Ra{constructor(e){super(),this.elements=e}}function La(e,t){const r=Fa(t);for(const t of e.elements)r.some(e=>mo(e,t))||r.push(t);return{arrayValue:{values:r}}}class ja extends Ra{constructor(e){super(),this.elements=e}}function Ua(e,t){let r=Fa(t);for(const t of e.elements)r=r.filter(e=>!mo(e,t));return{arrayValue:{values:r}}}class Ma extends Ra{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function $a(e){return Zi(e.integerValue||e.doubleValue)}function Fa(e){return Io(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Va{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Va}static exists(e){return new Va(void 0,e)}static updateTime(e){return new Va(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ba(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class qa{}function za(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Za(e.key,Va.none()):new Ga(e.key,e.data,Va.none());{const r=e.data,n=No.empty();let s=new Hi(ai.comparator);for(let e of t.fields)if(!s.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),s=s.add(e)}return new Ja(e.key,n,new Gi(s.toArray()),Va.none())}}function Ka(e,t,r){e instanceof Ga?function(e,t,r){const n=e.value.clone(),s=Qa(e.fieldTransforms,t,r.transformResults);n.setAll(s),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()}(e,t,r):e instanceof Ja?function(e,t,r){if(!Ba(e.precondition,t))return void t.convertToUnknownDocument(r.version);const n=Qa(e.fieldTransforms,t,r.transformResults),s=t.data;s.setAll(Ya(e)),s.setAll(n),t.convertToFoundDocument(r.version,s).setHasCommittedMutations()}(e,t,r):function(e,t,r){t.convertToNoDocument(r.version).setHasCommittedMutations()}(0,t,r)}function Ha(e,t,r,n){return e instanceof Ga?function(e,t,r,n){if(!Ba(e.precondition,t))return r;const s=e.value.clone(),i=Xa(e.fieldTransforms,n,t);return s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,r,n):e instanceof Ja?function(e,t,r,n){if(!Ba(e.precondition,t))return r;const s=Xa(e.fieldTransforms,n,t),i=t.data;return i.setAll(Ya(e)),i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===r?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):function(e,t,r){return Ba(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}(e,t,r)}function Wa(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&ri(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Da&&t instanceof Da||e instanceof ja&&t instanceof ja?ri(e.elements,t.elements,mo):e instanceof Ma&&t instanceof Ma?mo(e.Ee,t.Ee):e instanceof xa&&t instanceof xa}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Ga extends qa{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class Ja extends qa{constructor(e,t,r,n,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Ya(e){const t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const n=e.data.field(r);t.set(r,n)}}),t}function Qa(e,t,r){const n=new Map;js(e.length===r.length,32656,{Ae:r.length,Re:e.length});for(let s=0;s<r.length;s++){const i=e[s],o=i.transform,a=t.data.field(i.field);n.set(i.field,Na(o,a,r[s]))}return n}function Xa(e,t,r){const n=new Map;for(const s of e){const e=s.transform,i=r.data.field(s.field);n.set(s.field,Pa(e,i,t))}return n}class Za extends qa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ec{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const n=this.mutations[t];n.key.isEqual(e.key)&&Ka(n,e,r[t])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ha(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Ha(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Ia();return this.mutations.forEach(n=>{const s=e.get(n.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=t.has(n.key)?null:o;const a=za(i,o);null!==a&&r.set(n.key,a),i.isValidDocument()||i.convertToNoDocument(mi.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Aa())}isEqual(e){return this.batchId===e.batchId&&ri(this.mutations,e.mutations,(e,t)=>Wa(e,t))&&ri(this.baseMutations,e.baseMutations,(e,t)=>Wa(e,t))}}class tc{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class rc{constructor(e,t){this.count=e,this.unchangedNames=t}}var nc,sc;function ic(e){if(void 0===e)return Ps("GRPC error has no .code"),Ms.UNKNOWN;switch(e){case nc.OK:return Ms.OK;case nc.CANCELLED:return Ms.CANCELLED;case nc.UNKNOWN:return Ms.UNKNOWN;case nc.DEADLINE_EXCEEDED:return Ms.DEADLINE_EXCEEDED;case nc.RESOURCE_EXHAUSTED:return Ms.RESOURCE_EXHAUSTED;case nc.INTERNAL:return Ms.INTERNAL;case nc.UNAVAILABLE:return Ms.UNAVAILABLE;case nc.UNAUTHENTICATED:return Ms.UNAUTHENTICATED;case nc.INVALID_ARGUMENT:return Ms.INVALID_ARGUMENT;case nc.NOT_FOUND:return Ms.NOT_FOUND;case nc.ALREADY_EXISTS:return Ms.ALREADY_EXISTS;case nc.PERMISSION_DENIED:return Ms.PERMISSION_DENIED;case nc.FAILED_PRECONDITION:return Ms.FAILED_PRECONDITION;case nc.ABORTED:return Ms.ABORTED;case nc.OUT_OF_RANGE:return Ms.OUT_OF_RANGE;case nc.UNIMPLEMENTED:return Ms.UNIMPLEMENTED;case nc.DATA_LOSS:return Ms.DATA_LOSS;default:return Ds(39323,{code:e})}}(sc=nc||(nc={}))[sc.OK=0]="OK",sc[sc.CANCELLED=1]="CANCELLED",sc[sc.UNKNOWN=2]="UNKNOWN",sc[sc.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",sc[sc.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",sc[sc.NOT_FOUND=5]="NOT_FOUND",sc[sc.ALREADY_EXISTS=6]="ALREADY_EXISTS",sc[sc.PERMISSION_DENIED=7]="PERMISSION_DENIED",sc[sc.UNAUTHENTICATED=16]="UNAUTHENTICATED",sc[sc.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",sc[sc.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",sc[sc.ABORTED=10]="ABORTED",sc[sc.OUT_OF_RANGE=11]="OUT_OF_RANGE",sc[sc.UNIMPLEMENTED=12]="UNIMPLEMENTED",sc[sc.INTERNAL=13]="INTERNAL",sc[sc.UNAVAILABLE=14]="UNAVAILABLE",sc[sc.DATA_LOSS=15]="DATA_LOSS";const oc=new ls([4294967295,4294967295],0);function ac(e){const t=Ys().encode(e),r=new hs;return r.update(t),new Uint8Array(r.digest())}function cc(e){const t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new ls([r,n],0),new ls([s,i],0)]}class uc{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new lc(`Invalid padding: ${t}`);if(r<0)throw new lc(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new lc(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new lc(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=ls.fromNumber(this.fe)}pe(e,t,r){let n=e.add(t.multiply(ls.fromNumber(r)));return 1===n.compare(oc)&&(n=new ls([n.getBits(0),n.getBits(1)],0)),n.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.fe)return!1;const t=ac(e),[r,n]=cc(t);for(let e=0;e<this.hashCount;e++){const t=this.pe(r,n,e);if(!this.ye(t))return!1}return!0}static create(e,t,r){const n=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),i=new uc(s,n,t);return r.forEach(e=>i.insert(e)),i}insert(e){if(0===this.fe)return;const t=ac(e),[r,n]=cc(t);for(let e=0;e<this.hashCount;e++){const t=this.pe(r,n,e);this.we(t)}}we(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class lc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class hc{constructor(e,t,r,n,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const n=new Map;return n.set(e,dc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new hc(mi.min(),n,new qi(Xs),ba(),Aa())}}class dc{constructor(e,t,r,n,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new dc(r,t,Aa(),Aa(),Aa())}}class fc{constructor(e,t,r,n){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=n}}class pc{constructor(e,t){this.targetId=e,this.De=t}}class gc{constructor(e,t,r=Yi.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class mc{constructor(){this.ve=0,this.Ce=wc(),this.Fe=Yi.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return 0!==this.ve}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=Aa(),t=Aa(),r=Aa();return this.Ce.forEach((n,s)=>{switch(s){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:Ds(38017,{changeType:s})}}),new dc(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=wc()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,js(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class yc{constructor(e){this.We=e,this.Ge=new Map,this.ze=ba(),this.je=vc(),this.Je=vc(),this.He=new qi(Xs)}Ye(e){for(const t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(const t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{const r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:Ds(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((e,r)=>{this.nt(r)&&t(r)})}it(e){const t=e.targetId,r=e.De.count,n=this.st(t);if(n){const s=n.target;if(ia(s))if(0===r){const e=new ci(s.path);this.Xe(t,e,xo.newNoDocument(e,mi.min()))}else js(1===r,20013,{expectedCount:r});else{const n=this.ot(t);if(n!==r){const r=this._t(e),s=r?this.ut(r,e,n):1;if(0!==s){this.rt(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,e)}}}}}_t(e){const t=e.De.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:n=0},hashCount:s=0}=t;let i,o;try{i=eo(r).toUint8Array()}catch(e){if(e instanceof Ji)return Ns("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new uc(i,n,s)}catch(e){return Ns(e instanceof lc?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.fe?null:o}ut(e,t,r){return t.De.count===r-this.ht(e,t.targetId)?0:2}ht(e,t){const r=this.We.getRemoteKeysForTarget(t);let n=0;return r.forEach(r=>{const s=this.We.lt(),i=`projects/${s.projectId}/databases/${s.database}/documents/${r.path.canonicalString()}`;e.mightContain(i)||(this.Xe(t,r,null),n++)}),n}Pt(e){const t=new Map;this.Ge.forEach((r,n)=>{const s=this.st(n);if(s){if(r.current&&ia(s.target)){const t=new ci(s.target.path);this.Tt(t).has(n)||this.It(n,t)||this.Xe(n,t,xo.newNoDocument(t,e))}r.Ne&&(t.set(n,r.Le()),r.ke())}});let r=Aa();this.Je.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{const t=this.st(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.ze.forEach((t,r)=>r.setReadTime(e));const n=new hc(e,t,this.He,this.ze,r);return this.ze=ba(),this.je=vc(),this.Je=vc(),this.He=new qi(Xs),n}Ze(e,t){if(!this.nt(e))return;const r=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;const n=this.tt(e);this.It(e,t)?n.qe(t,1):n.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){const t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new mc,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new Hi(Xs),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new Hi(Xs),this.je=this.je.insert(e,t)),t}nt(e){const t=null!==this.st(e);return t||Rs("WatchChangeAggregator","Detected inactive target",e),t}st(e){const t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new mc),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}}function vc(){return new qi(ci.comparator)}function wc(){return new qi(ci.comparator)}const bc={asc:"ASCENDING",desc:"DESCENDING"},_c={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ec={and:"AND",or:"OR"};class Tc{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Sc(e,t){return e.useProto3Json||Ii(t)?t:{value:t}}function Ic(e){return js(!!e,49232),mi.fromTimestamp(function(e){const t=Xi(e);return new gi(t.seconds,t.nanos)}(e))}function kc(e,t){const r=function(e){return new ii(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?r:r.child(t)}function Cc(e){const t=ii.fromString(e);return js(Bc(t),10190,{key:t.toString()}),t}function Ac(e,t){const r=Cc(t);if(r.get(1)!==e.databaseId.projectId)throw new $s(Ms.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new $s(Ms.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new ci(Pc(r))}function Oc(e,t){return function(e,t){return kc(e,t).canonicalString()}(e.databaseId,t)}function Rc(e){return new ii(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Pc(e){return js(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function Nc(e,t){return{documents:[Oc(e,t.path)]}}function xc(e,t){const r={structuredQuery:{}},n=t.path;let s;null!==t.collectionGroup?(s=n,r.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=n.popLast(),r.structuredQuery.from=[{collectionId:n.lastSegment()}]),r.parent=Oc(e,s);const i=function(e){if(0!==e.length)return Vc(Vo.create(e,"and"))}(t.filters);i&&(r.structuredQuery.where=i);const o=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:$c(e.field),direction:jc(e.dir)}}(e))}(t.orderBy);o&&(r.structuredQuery.orderBy=o);const a=Sc(e,t.limit);return null!==a&&(r.structuredQuery.limit=a),t.startAt&&(r.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(r.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{Vt:r,parent:s}}function Dc(e){let t=function(e){const t=Cc(e);return 4===t.length?ii.emptyPath():Pc(t)}(e.parent);const r=e.structuredQuery,n=r.from?r.from.length:0;let s=null;if(n>0){js(1===n,65062);const e=r.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let i=[];r.where&&(i=function(e){const t=Lc(e);return t instanceof Vo&&qo(t)?t.getFilters():[t]}(r.where));let o=[];r.orderBy&&(o=function(e){return e.map(e=>function(e){return new Uo(Fc(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(r.orderBy));let a=null;r.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Ii(t)?null:t}(r.limit));let c=null;r.startAt&&(c=function(e){const t=!!e.before,r=e.values||[];return new Do(r,t)}(r.startAt));let u=null;return r.endAt&&(u=function(e){const t=!e.before,r=e.values||[];return new Do(r,t)}(r.endAt)),function(e,t,r,n,s,i,o,a){return new oa(e,t,r,n,s,i,o,a)}(t,s,o,i,a,"F",c,u)}function Lc(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Fc(e.unaryFilter.field);return Fo.create(t,"==",{doubleValue:NaN});case"IS_NULL":const r=Fc(e.unaryFilter.field);return Fo.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const n=Fc(e.unaryFilter.field);return Fo.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Fc(e.unaryFilter.field);return Fo.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ds(61313);default:return Ds(60726)}}(e):void 0!==e.fieldFilter?function(e){return Fo.create(Fc(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ds(58110);default:return Ds(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Vo.create(e.compositeFilter.filters.map(e=>Lc(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Ds(1026)}}(e.compositeFilter.op))}(e):Ds(30097,{filter:e})}function jc(e){return bc[e]}function Uc(e){return _c[e]}function Mc(e){return Ec[e]}function $c(e){return{fieldPath:e.canonicalString()}}function Fc(e){return ai.fromServerFormat(e.fieldPath)}function Vc(e){return e instanceof Fo?function(e){if("=="===e.op){if(Co(e.value))return{unaryFilter:{field:$c(e.field),op:"IS_NAN"}};if(ko(e.value))return{unaryFilter:{field:$c(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Co(e.value))return{unaryFilter:{field:$c(e.field),op:"IS_NOT_NAN"}};if(ko(e.value))return{unaryFilter:{field:$c(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$c(e.field),op:Uc(e.op),value:e.value}}}(e):e instanceof Vo?function(e){const t=e.getFilters().map(e=>Vc(e));return 1===t.length?t[0]:{compositeFilter:{op:Mc(e.op),filters:t}}}(e):Ds(54877,{filter:e})}function Bc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class qc{constructor(e,t,r,n,s=mi.min(),i=mi.min(),o=Yi.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new qc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new qc(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new qc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new qc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class zc{constructor(e){this.gt=e}}function Kc(e){const t=Dc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?ha(t,t.limit,"L"):t}class Hc{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(Zi(e.integerValue));else if("doubleValue"in e){const r=Zi(e.doubleValue);isNaN(r)?this.Ct(t,13):(this.Ct(t,15),ki(r)?t.Ft(0):t.Ft(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ct(t,20),"string"==typeof r&&(r=Xi(r)),t.Mt(`${r.seconds||""}`),t.Ft(r.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(eo(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ct(t,45),t.Ft(r.latitude||0),t.Ft(r.longitude||0)}else"mapValue"in e?Po(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):Oo(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):Ds(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){const r=e.fields||{};this.Ct(t,55);for(const e of Object.keys(r))this.xt(e,t),this.Dt(r[e],t)}Lt(e,t){var r,n;const s=e.fields||{};this.Ct(t,53);const i=po,o=(null===(n=null===(r=s[i].arrayValue)||void 0===r?void 0:r.values)||void 0===n?void 0:n.length)||0;this.Ct(t,15),t.Ft(Zi(o)),this.xt(i,t),this.Dt(s[i],t)}qt(e,t){const r=e.values||[];this.Ct(t,50);for(const e of r)this.Dt(e,t)}Bt(e,t){this.Ct(t,37),ci.fromName(e).path.forEach(e=>{this.Ct(t,60),this.$t(e,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}}Hc.Ut=new Hc;class Wc{constructor(){this.Dn=new Gc}addToCollectionParentIndex(e,t){return this.Dn.add(t),Ei.resolve()}getCollectionParents(e,t){return Ei.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return Ei.resolve()}deleteFieldIndex(e,t){return Ei.resolve()}deleteAllFieldIndexes(e){return Ei.resolve()}createTargetIndexes(e,t){return Ei.resolve()}getDocumentsMatchingTarget(e,t){return Ei.resolve(null)}getIndexType(e,t){return Ei.resolve(0)}getFieldIndexes(e,t){return Ei.resolve([])}getNextCollectionGroupToUpdate(e){return Ei.resolve(null)}getMinOffset(e,t){return Ei.resolve(vi.min())}getMinOffsetFromCollectionGroup(e,t){return Ei.resolve(vi.min())}updateCollectionGroup(e,t,r){return Ei.resolve()}updateIndexEntries(e,t){return Ei.resolve()}}class Gc{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new Hi(ii.comparator),s=!n.has(r);return this.index[t]=n.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new Hi(ii.comparator)).toArray()}}new Uint8Array(0);const Jc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Yc=41943040;class Qc{static withCacheSize(e){return new Qc(e,Qc.DEFAULT_COLLECTION_PERCENTILE,Qc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}Qc.DEFAULT_COLLECTION_PERCENTILE=10,Qc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qc.DEFAULT=new Qc(Yc,Qc.DEFAULT_COLLECTION_PERCENTILE,Qc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qc.DISABLED=new Qc(-1,0,0);class Xc{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new Xc(0)}static ur(){return new Xc(-1)}}const Zc="LruGarbageCollector";function eu([e,t],[r,n]){const s=Xs(e,r);return 0===s?Xs(t,n):s}class tu{constructor(e){this.Tr=e,this.buffer=new Hi(eu),this.Ir=0}dr(){return++this.Ir}Er(e){const t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();eu(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ru{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return null!==this.Ar}Rr(e){Rs(Zc,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ti(e)?Rs(Zc,"Ignoring IndexedDB error during garbage collection: ",e):await _i(e)}await this.Rr(3e5)})}}class nu{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return Ei.resolve(Si.ue);const r=new tu(t);return this.Vr.forEachTarget(e,e=>r.Er(e.sequenceNumber)).next(()=>this.Vr.gr(e,e=>r.Er(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(Rs("LruGarbageCollector","Garbage collection skipped; disabled"),Ei.resolve(Jc)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(Rs("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Jc):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,n,s,i,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(Rs("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,i=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,o=Date.now(),this.removeTargets(e,r,t))).next(t=>(s=t,a=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(c=Date.now(),Os()<=M.DEBUG&&Rs("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-u}ms\n\tDetermined least recently used ${n} in `+(o-i)+"ms\n"+`\tRemoved ${s} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),Ei.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:s,documentsRemoved:e})))}}class su{constructor(){this.changes=new va(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,xo.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?Ei.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class iu{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ou{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&Ha(r.mutation,e,Gi.empty(),gi.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,Aa()).next(()=>t))}getLocalViewOfDocuments(e,t,r=Aa()){const n=Sa();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=Ea();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const r=Sa();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Aa()))}populateOverlays(e,t,r){const n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let s=ba();const i=ka(),o=ka();return t.forEach((e,t)=>{const o=r.get(t.key);n.has(t.key)&&(void 0===o||o.mutation instanceof Ja)?s=s.insert(t.key,t):void 0!==o?(i.set(t.key,o.mutation.getFieldMask()),Ha(o.mutation,t,o.mutation.getFieldMask(),gi.now())):i.set(t.key,Gi.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>{var r;return o.set(e,new iu(t,null!==(r=i.get(e))&&void 0!==r?r:null))}),o))}recalculateAndSaveOverlays(e,t){const r=ka();let n=new qi((e,t)=>e-t),s=Aa();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const s of e)s.keys().forEach(e=>{const i=t.get(e);if(null===i)return;let o=r.get(e)||Gi.empty();o=s.applyToLocalView(i,o),r.set(e,o);const a=(n.get(s.batchId)||Aa()).add(e);n=n.insert(s.batchId,a)})}).next(()=>{const i=[],o=n.getReverseIterator();for(;o.hasNext();){const n=o.getNext(),a=n.key,c=n.value,u=Ia();c.forEach(e=>{if(!s.has(e)){const n=za(t.get(e),r.get(e));null!==n&&u.set(e,n),s=s.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Ei.waitFor(i)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return function(e){return ci.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):function(e){return null!==e.collectionGroup}(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(s=>{const i=n-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-s.size):Ei.resolve(Sa());let o=-1,a=s;return i.next(t=>Ei.forEach(t,(t,r)=>(o<r.largestBatchId&&(o=r.largestBatchId),s.get(t)?Ei.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,s)).next(()=>this.computeViews(e,a,t,Aa())).next(e=>({batchId:o,changes:Ta(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ci(t)).next(e=>{let t=Ea();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){const s=t.collectionGroup;let i=Ea();return this.indexManager.getCollectionParents(e,s).next(o=>Ei.forEach(o,o=>{const a=function(e,t){return new oa(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(s));return this.getDocumentsMatchingCollectionQuery(e,a,r,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,r,n){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,n))).next(e=>{s.forEach((t,r)=>{const n=r.getKey();null===e.get(n)&&(e=e.insert(n,xo.newInvalidDocument(n)))});let r=Ea();return e.forEach((e,n)=>{const i=s.get(e);void 0!==i&&Ha(i.mutation,n,Gi.empty(),gi.now()),ga(t,n)&&(r=r.insert(e,n))}),r})}}class au{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return Ei.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Ic(e.createTime)}}(t)),Ei.resolve()}getNamedQuery(e,t){return Ei.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,function(e){return{name:e.name,query:Kc(e.bundledQuery),readTime:Ic(e.readTime)}}(t)),Ei.resolve()}}class cu{constructor(){this.overlays=new qi(ci.comparator),this.kr=new Map}getOverlay(e,t){return Ei.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Sa();return Ei.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.wt(e,t,n)}),Ei.resolve()}removeOverlaysForBatchId(e,t,r){const n=this.kr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.kr.delete(r)),Ei.resolve()}getOverlaysForCollection(e,t,r){const n=Sa(),s=t.length+1,i=new ci(t.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const e=o.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===s&&e.largestBatchId>r&&n.set(e.getKey(),e)}return Ei.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let s=new qi((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=s.get(e.largestBatchId);null===t&&(t=Sa(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Sa(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=n)););return Ei.resolve(o)}wt(e,t,r){const n=this.overlays.get(r.key);if(null!==n){const e=this.kr.get(n.largestBatchId).delete(r.key);this.kr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new tc(t,r));let s=this.kr.get(t);void 0===s&&(s=Aa(),this.kr.set(t,s)),this.kr.set(t,s.add(r.key))}}class uu{constructor(){this.sessionToken=Yi.EMPTY_BYTE_STRING}getSessionToken(e){return Ei.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Ei.resolve()}}class lu{constructor(){this.qr=new Hi(hu.Qr),this.$r=new Hi(hu.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){const r=new hu(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new hu(e,t))}Gr(e,t){e.forEach(e=>this.removeReference(e,t))}zr(e){const t=new ci(new ii([])),r=new hu(t,e),n=new hu(t,e+1),s=[];return this.$r.forEachInRange([r,n],e=>{this.Wr(e),s.push(e.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const t=new ci(new ii([])),r=new hu(t,e),n=new hu(t,e+1);let s=Aa();return this.$r.forEachInRange([r,n],e=>{s=s.add(e.key)}),s}containsKey(e){const t=new hu(e,0),r=this.qr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class hu{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return ci.comparator(e.key,t.key)||Xs(e.Hr,t.Hr)}static Ur(e,t){return Xs(e.Hr,t.Hr)||ci.comparator(e.key,t.key)}}class du{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new Hi(hu.Qr)}checkEmpty(e){return Ei.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){const s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new ec(s,t,r,n);this.mutationQueue.push(i);for(const t of n)this.Yr=this.Yr.add(new hu(t.key,s)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Ei.resolve(i)}lookupMutationBatch(e,t){return Ei.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=this.Xr(r),s=n<0?0:n;return Ei.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Ei.resolve(0===this.mutationQueue.length?-1:this.er-1)}getAllMutationBatches(e){return Ei.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new hu(t,0),n=new hu(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([r,n],e=>{const t=this.Zr(e.Hr);s.push(t)}),Ei.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Hi(Xs);return t.forEach(e=>{const t=new hu(e,0),n=new hu(e,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([t,n],e=>{r=r.add(e.Hr)})}),Ei.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,n=r.length+1;let s=r;ci.isDocumentKey(s)||(s=s.child(""));const i=new hu(new ci(s),0);let o=new Hi(Xs);return this.Yr.forEachWhile(e=>{const t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(o=o.add(e.Hr)),!0)},i),Ei.resolve(this.ei(o))}ei(e){const t=[];return e.forEach(e=>{const r=this.Zr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){js(0===this.ti(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Yr;return Ei.forEach(t.mutations,n=>{const s=new hu(n.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Yr=r})}rr(e){}containsKey(e,t){const r=new hu(t,0),n=this.Yr.firstAfterOrEqual(r);return Ei.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ei.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class fu{constructor(e){this.ni=e,this.docs=new qi(ci.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,n=this.docs.get(r),s=n?n.size:0,i=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return Ei.resolve(r?r.document.mutableCopy():xo.newInvalidDocument(t))}getEntries(e,t){let r=ba();return t.forEach(e=>{const t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():xo.newInvalidDocument(e))}),Ei.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let s=ba();const i=t.path,o=new ci(i.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||wi(yi(o),r)<=0||(n.has(o.key)||ga(t,o))&&(s=s.insert(o.key,o.mutableCopy()))}return Ei.resolve(s)}getAllFromCollectionGroup(e,t,r,n){Ds(9500)}ri(e,t){return Ei.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new pu(this)}getSize(e){return Ei.resolve(this.size)}}class pu extends su{constructor(e){super(),this.Or=e}applyChanges(e){const t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Or.addEntry(e,n)):this.Or.removeEntry(r)}),Ei.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}}class gu{constructor(e){this.persistence=e,this.ii=new va(e=>na(e),sa),this.lastRemoteSnapshotVersion=mi.min(),this.highestTargetId=0,this.si=0,this.oi=new lu,this.targetCount=0,this._i=Xc.ar()}forEachTarget(e,t){return this.ii.forEach((e,r)=>t(r)),Ei.resolve()}getLastRemoteSnapshotVersion(e){return Ei.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ei.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),Ei.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),Ei.resolve()}hr(e){this.ii.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this._i=new Xc(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,Ei.resolve()}updateTargetData(e,t){return this.hr(t),Ei.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,Ei.resolve()}removeTargets(e,t,r){let n=0;const s=[];return this.ii.forEach((i,o)=>{o.sequenceNumber<=t&&null===r.get(o.targetId)&&(this.ii.delete(i),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),n++)}),Ei.waitFor(s).next(()=>n)}getTargetCount(e){return Ei.resolve(this.targetCount)}getTargetData(e,t){const r=this.ii.get(t)||null;return Ei.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),Ei.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);const n=this.persistence.referenceDelegate,s=[];return n&&t.forEach(t=>{s.push(n.markPotentiallyOrphaned(e,t))}),Ei.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),Ei.resolve()}getMatchingKeysForTargetId(e,t){const r=this.oi.Jr(t);return Ei.resolve(r)}containsKey(e,t){return Ei.resolve(this.oi.containsKey(t))}}class mu{constructor(e,t){this.ai={},this.overlays={},this.ui=new Si(0),this.ci=!1,this.ci=!0,this.li=new uu,this.referenceDelegate=e(this),this.hi=new gu(this),this.indexManager=new Wc,this.remoteDocumentCache=function(e){return new fu(e)}(e=>this.referenceDelegate.Pi(e)),this.serializer=new zc(t),this.Ti=new au(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new cu,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new du(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){Rs("MemoryPersistence","Starting transaction:",e);const n=new yu(this.ui.next());return this.referenceDelegate.Ii(),r(n).next(e=>this.referenceDelegate.di(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ei(e,t){return Ei.or(Object.values(this.ai).map(r=>()=>r.containsKey(e,t)))}}class yu extends bi{constructor(e){super(),this.currentSequenceNumber=e}}class vu{constructor(e){this.persistence=e,this.Ai=new lu,this.Ri=null}static Vi(e){return new vu(e)}get mi(){if(this.Ri)return this.Ri;throw Ds(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),Ei.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),Ei.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),Ei.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(e=>this.mi.add(e.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.mi.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ei.forEach(this.mi,r=>{const n=ci.fromPath(r);return this.fi(e,n).next(e=>{e||t.removeEntry(n,mi.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(e=>{e?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return Ei.or([()=>Ei.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class wu{constructor(e,t){this.persistence=e,this.gi=new va(e=>function(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t=Ai(t)),t=Ci(e.get(r),t);return Ai(t)}(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=function(e,t){return new nu(e,t)}(this,t)}static Vi(e,t){return new wu(e,t)}Ii(){}di(e){return Ei.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){const t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}yr(e){let t=0;return this.gr(e,e=>{t++}).next(()=>t)}gr(e,t){return Ei.forEach(this.gi,(r,n)=>this.Sr(e,r,n).next(e=>e?Ei.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const n=this.persistence.getRemoteDocumentCache(),s=n.newChangeBuffer();return n.ri(e,n=>this.Sr(e,n,t).next(e=>{e||(r++,s.removeEntry(n,mi.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),Ei.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),Ei.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),Ei.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),Ei.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=To(e.data.value)),t}Sr(e,t,r){return Ei.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.gi.get(t);return Ei.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class bu{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=n}static Es(e,t){let r=Aa(),n=Aa();for(const e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new bu(e,t.fromCache,r,n)}}class _u{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Eu{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=_()?8:function(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}(b())>0?6:4}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,n){const s={result:null};return this.ps(e,t).next(e=>{s.result=e}).next(()=>{if(!s.result)return this.ys(e,t,n,r).next(e=>{s.result=e})}).next(()=>{if(s.result)return;const r=new _u;return this.ws(e,t,r).next(n=>{if(s.result=n,this.Rs)return this.Ss(e,t,r,n.size)})}).next(()=>s.result)}Ss(e,t,r,n){return r.documentReadCount<this.Vs?(Os()<=M.DEBUG&&Rs("QueryEngine","SDK will not create cache indexes for query:",pa(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),Ei.resolve()):(Os()<=M.DEBUG&&Rs("QueryEngine","Query:",pa(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.fs*n?(Os()<=M.DEBUG&&Rs("QueryEngine","The SDK decides to create cache indexes for query:",pa(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,la(t))):Ei.resolve())}ps(e,t){if(ca(t))return Ei.resolve(null);let r=la(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(t=ha(t,null,"F"),r=la(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{const s=Aa(...n);return this.gs.getDocuments(e,s).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{const i=this.bs(t,n);return this.Ds(t,i,s,r.readTime)?this.ps(e,ha(t,null,"F")):this.vs(e,i,t,r)}))})))}ys(e,t,r,n){return ca(t)||n.isEqual(mi.min())?Ei.resolve(null):this.gs.getDocuments(e,r).next(s=>{const i=this.bs(t,s);return this.Ds(t,i,r,n)?Ei.resolve(null):(Os()<=M.DEBUG&&Rs("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),pa(t)),this.vs(e,i,t,function(e,t){const r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1,s=mi.fromTimestamp(1e9===n?new gi(r+1,0):new gi(r,n));return new vi(s,ci.empty(),t)}(n,-1)).next(e=>e))})}bs(e,t){let r=new Hi(ma(e));return t.forEach((t,n)=>{ga(e,n)&&(r=r.add(n))}),r}Ds(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(n)>0)}ws(e,t,r){return Os()<=M.DEBUG&&Rs("QueryEngine","Using full collection scan to execute query:",pa(t)),this.gs.getDocumentsMatchingQuery(e,t,vi.min(),r)}vs(e,t,r,n){return this.gs.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const Tu="LocalStore";class Su{constructor(e,t,r,n){this.persistence=e,this.Cs=t,this.serializer=n,this.Fs=new qi(Xs),this.Ms=new va(e=>na(e),sa),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ou(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}}async function Iu(e,t){const r=Us(e);return await r.persistence.runTransaction("Handle user change","readonly",e=>{let n;return r.mutationQueue.getAllMutationBatches(e).next(s=>(n=s,r.Ns(t),r.mutationQueue.getAllMutationBatches(e))).next(t=>{const s=[],i=[];let o=Aa();for(const e of n){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return r.localDocuments.getDocuments(e,o).next(e=>({Bs:e,removedBatchIds:s,addedBatchIds:i}))})})}function ku(e){const t=Us(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.hi.getLastRemoteSnapshotVersion(e))}async function Cu(e,t,r){const n=Us(e),s=n.Fs.get(t),i=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",i,e=>n.persistence.referenceDelegate.removeTarget(e,s))}catch(e){if(!Ti(e))throw e;Rs(Tu,`Failed to update sequence numbers for target ${t}: ${e}`)}n.Fs=n.Fs.remove(t),n.Ms.delete(s.target)}function Au(e,t,r){const n=Us(e);let s=mi.min(),i=Aa();return n.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,r){const n=Us(e),s=n.Ms.get(r);return void 0!==s?Ei.resolve(n.Fs.get(s)):n.hi.getTargetData(t,r)}(n,e,la(t)).next(t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,n.hi.getMatchingKeysForTargetId(e,t.targetId).next(e=>{i=e})}).next(()=>n.Cs.getDocumentsMatchingQuery(e,t,r?s:mi.min(),r?i:Aa())).next(e=>(function(e,t,r){let n=e.xs.get(t)||mi.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.xs.set(t,n)}(n,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,qs:i})))}class Ou{constructor(){this.activeTargetIds=Oa}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ru{constructor(){this.Fo=new Ou,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new Ou,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Pu{xo(e){}shutdown(){}}const Nu="ConnectivityMonitor";class xu{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){Rs(Nu,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){Rs(Nu,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Du=null;function Lu(){return null===Du?Du=268435456+Math.round(2147483648*Math.random()):Du++,"0x"+Du.toString(16)}const ju="RestConnection",Uu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Mu{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${n}`,this.Ko=this.databaseId.database===uo?`project_id=${r}`:`project_id=${r}&database_id=${n}`}Wo(e,t,r,n,s){const i=Lu(),o=this.Go(e,t.toUriEncodedString());Rs(ju,`Sending RPC '${e}' ${i}:`,o,r);const a={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(a,n,s);const{host:c}=new URL(o),u=g(c);return this.jo(e,o,a,r,u).then(t=>(Rs(ju,`Received RPC '${e}' ${i}: `,t),t),t=>{throw Ns(ju,`RPC '${e}' ${i} failed with error: `,t,"url: ",o,"request:",r),t})}Jo(e,t,r,n,s,i){return this.Wo(e,t,r,n,s)}zo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+Cs,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}Go(e,t){const r=Uu[e];return`${this.$o}/v1/${t}:${r}`}terminate(){}}class $u{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}const Fu="WebChannelConnection";class Vu extends Mu{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,n,s){const i=Lu();return new Promise((s,o)=>{const a=new ps;a.setWithCredentials(!0),a.listenOnce(ms.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case ys.NO_ERROR:const t=a.getResponseJson();Rs(Fu,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case ys.TIMEOUT:Rs(Fu,`RPC '${e}' ${i} timed out`),o(new $s(Ms.DEADLINE_EXCEEDED,"Request time out"));break;case ys.HTTP_ERROR:const r=a.getStatus();if(Rs(Fu,`RPC '${e}' ${i} failed with status:`,r,"response text:",a.getResponseText()),r>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Ms).indexOf(t)>=0?t:Ms.UNKNOWN}(t.status);o(new $s(e,t.message))}else o(new $s(Ms.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new $s(Ms.UNAVAILABLE,"Connection failed."));break;default:Ds(9055,{c_:e,streamId:i,l_:a.getLastErrorCode(),h_:a.getLastError()})}}finally{Rs(Fu,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(n);Rs(Fu,`RPC '${e}' ${i} sending request:`,n),a.send(t,"POST",c,r,15)})}P_(e,t,r){const n=Lu(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=_s(),o=bs(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.zo(a.initMessageHeaders,t,r),a.encodeInitMessageHeaders=!0;const u=s.join("");Rs(Fu,`Creating RPC '${e}' stream ${n}: ${u}`,a);const l=i.createWebChannel(u,a);this.T_(l);let h=!1,d=!1;const f=new $u({Ho:t=>{d?Rs(Fu,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(h||(Rs(Fu,`Opening RPC '${e}' stream ${n} transport.`),l.open(),h=!0),Rs(Fu,`RPC '${e}' stream ${n} sending:`,t),l.send(t))},Yo:()=>l.close()}),p=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(l,gs.EventType.OPEN,()=>{d||(Rs(Fu,`RPC '${e}' stream ${n} transport opened.`),f.s_())}),p(l,gs.EventType.CLOSE,()=>{d||(d=!0,Rs(Fu,`RPC '${e}' stream ${n} transport closed`),f.__(),this.I_(l))}),p(l,gs.EventType.ERROR,t=>{d||(d=!0,Ns(Fu,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),f.__(new $s(Ms.UNAVAILABLE,"The operation could not be completed")))}),p(l,gs.EventType.MESSAGE,t=>{var r;if(!d){const s=t.data[0];js(!!s,16349);const i=s,o=(null==i?void 0:i.error)||(null===(r=i[0])||void 0===r?void 0:r.error);if(o){Rs(Fu,`RPC '${e}' stream ${n} received error:`,o);const t=o.status;let r=function(e){const t=nc[e];if(void 0!==t)return ic(t)}(t),s=o.message;void 0===r&&(r=Ms.INTERNAL,s="Unknown error status: "+t+" with message "+o.message),d=!0,f.__(new $s(r,s)),l.close()}else Rs(Fu,`RPC '${e}' stream ${n} received:`,s),f.a_(s)}}),p(o,ws.STAT_EVENT,t=>{t.stat===vs.PROXY?Rs(Fu,`RPC '${e}' stream ${n} detected buffering proxy`):t.stat===vs.NOPROXY&&Rs(Fu,`RPC '${e}' stream ${n} detected no buffering proxy`)}),setTimeout(()=>{f.o_()},0),f}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}}function Bu(){return"undefined"!=typeof document?document:null}function qu(e){return new Tc(e,!0)}class zu{constructor(e,t,r=1e3,n=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=n,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),n=Math.max(0,t-r);n>0&&Rs("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,n,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){null!==this.V_&&(this.V_.skipDelay(),this.V_=null)}cancel(){null!==this.V_&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}const Ku="PersistentStream";class Hu{constructor(e,t,r,n,s,i,o,a){this.Fi=e,this.w_=r,this.S_=n,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new zu(e,t)}M_(){return 1===this.state||5===this.state||this.x_()}x_(){return 2===this.state||3===this.state}start(){this.C_=0,4!==this.state?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&null===this.D_&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,4!==e?this.F_.reset():t&&t.code===Ms.RESOURCE_EXHAUSTED?(Ps(t.toString()),Ps("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===Ms.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(t)}U_(){}auth(){this.state=1;const e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.b_===t&&this.W_(e,r)},t=>{e(()=>{const e=new $s(Ms.UNKNOWN,"Fetching auth token failed: "+t.message);return this.G_(e)})})}W_(e,t){const r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(e=>{r(()=>this.G_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.C_?this.j_(e):this.onNext(e))})}O_(){this.state=5,this.F_.g_(async()=>{this.state=0,this.start()})}G_(e){return Rs(Ku,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(Rs(Ku,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Wu extends Hu{constructor(e,t,r,n,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,i),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();const t=function(e,t){let r;if("targetChange"in t){t.targetChange;const n=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Ds(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(e,t){return e.useProto3Json?(js(void 0===t||"string"==typeof t,58123),Yi.fromBase64String(t||"")):(js(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),Yi.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Ms.UNKNOWN:ic(e.code);return new $s(t,e.message||"")}(o);r=new gc(n,s,i,a||null)}else if("documentChange"in t){t.documentChange;const n=t.documentChange;n.document,n.document.name,n.document.updateTime;const s=Ac(e,n.document.name),i=Ic(n.document.updateTime),o=n.document.createTime?Ic(n.document.createTime):mi.min(),a=new No({mapValue:{fields:n.document.fields}}),c=xo.newFoundDocument(s,i,o,a),u=n.targetIds||[],l=n.removedTargetIds||[];r=new fc(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const n=t.documentDelete;n.document;const s=Ac(e,n.document),i=n.readTime?Ic(n.readTime):mi.min(),o=xo.newNoDocument(s,i),a=n.removedTargetIds||[];r=new fc([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const n=t.documentRemove;n.document;const s=Ac(e,n.document),i=n.removedTargetIds||[];r=new fc([],i,s,null)}else{if(!("filter"in t))return Ds(11601,{At:t});{t.filter;const e=t.filter;e.targetId;const{count:n=0,unchangedNames:s}=e,i=new rc(n,s),o=e.targetId;r=new pc(o,i)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return mi.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?mi.min():t.readTime?Ic(t.readTime):mi.min()}(e);return this.listener.J_(t,r)}H_(e){const t={};t.database=Rc(this.serializer),t.addTarget=function(e,t){let r;const n=t.target;if(r=ia(n)?{documents:Nc(e,n)}:{query:xc(e,n).Vt},r.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=function(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}(e,t.resumeToken);const n=Sc(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(mi.min())>0){r.readTime=function(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}(e,t.snapshotVersion.toTimestamp());const n=Sc(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);const r=function(e,t){const r=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ds(28987,{purpose:e})}}(t.purpose);return null==r?null:{"goog-listen-tags":r}}(this.serializer,e);r&&(t.labels=r),this.k_(t)}Y_(e){const t={};t.database=Rc(this.serializer),t.removeTarget=e,this.k_(t)}}class Gu{}class Ju extends Gu{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ra=!1}ia(){if(this.ra)throw new $s(Ms.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,n){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.connection.Wo(e,kc(t,r),n,s,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Ms.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new $s(Ms.UNKNOWN,e.toString())})}Jo(e,t,r,n,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Jo(e,kc(t,r),n,i,o,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Ms.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new $s(Ms.UNKNOWN,e.toString())})}terminate(){this.ra=!0,this.connection.terminate()}}class Yu{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){0===this.sa&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){"Online"===this.state?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,"Online"===e&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(Ps(t),this._a=!1):Rs("OnlineStateTracker",t)}ha(){null!==this.oa&&(this.oa.cancel(),this.oa=null)}}const Qu="RemoteStore";class Xu{constructor(e,t,r,n,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(e=>{r.enqueueAndForget(async()=>{al(this)&&(Rs(Qu,"Restarting streams for network reachability change."),await async function(e){const t=Us(e);t.Ia.add(4),await el(t),t.Aa.set("Unknown"),t.Ia.delete(4),await Zu(t)}(this))})}),this.Aa=new Yu(r,n)}}async function Zu(e){if(al(e))for(const t of e.da)await t(!0)}async function el(e){for(const t of e.da)await t(!1)}function tl(e,t){const r=Us(e);r.Ta.has(t.targetId)||(r.Ta.set(t.targetId,t),ol(r)?il(r):gl(r).x_()&&nl(r,t))}function rl(e,t){const r=Us(e),n=gl(r);r.Ta.delete(t),n.x_()&&sl(r,t),0===r.Ta.size&&(n.x_()?n.B_():al(r)&&r.Aa.set("Unknown"))}function nl(e,t){if(e.Ra.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(mi.min())>0){const r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}gl(e).H_(t)}function sl(e,t){e.Ra.$e(t),gl(e).Y_(t)}function il(e){e.Ra=new yc({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.Ta.get(t)||null,lt:()=>e.datastore.serializer.databaseId}),gl(e).start(),e.Aa.aa()}function ol(e){return al(e)&&!gl(e).M_()&&e.Ta.size>0}function al(e){return 0===Us(e).Ia.size}function cl(e){e.Ra=void 0}async function ul(e){e.Aa.set("Online")}async function ll(e){e.Ta.forEach((t,r)=>{nl(e,t)})}async function hl(e,t){cl(e),ol(e)?(e.Aa.la(t),il(e)):e.Aa.set("Unknown")}async function dl(e,t,r){if(e.Aa.set("Online"),t instanceof gc&&2===t.state&&t.cause)try{await async function(e,t){const r=t.cause;for(const n of t.targetIds)e.Ta.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ta.delete(n),e.Ra.removeTarget(n))}(e,t)}catch(r){Rs(Qu,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await fl(e,r)}else if(t instanceof fc?e.Ra.Ye(t):t instanceof pc?e.Ra.it(t):e.Ra.et(t),!r.isEqual(mi.min()))try{const t=await ku(e.localStore);r.compareTo(t)>=0&&await function(e,t){const r=e.Ra.Pt(t);return r.targetChanges.forEach((r,n)=>{if(r.resumeToken.approximateByteSize()>0){const s=e.Ta.get(n);s&&e.Ta.set(n,s.withResumeToken(r.resumeToken,t))}}),r.targetMismatches.forEach((t,r)=>{const n=e.Ta.get(t);if(!n)return;e.Ta.set(t,n.withResumeToken(Yi.EMPTY_BYTE_STRING,n.snapshotVersion)),sl(e,t);const s=new qc(n.target,t,r,n.sequenceNumber);nl(e,s)}),e.remoteSyncer.applyRemoteEvent(r)}(e,r)}catch(t){Rs(Qu,"Failed to raise snapshot:",t),await fl(e,t)}}async function fl(e,t,r){if(!Ti(t))throw t;e.Ia.add(1),await el(e),e.Aa.set("Offline"),r||(r=()=>ku(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{Rs(Qu,"Retrying IndexedDB access"),await r(),e.Ia.delete(1),await Zu(e)})}async function pl(e,t){const r=Us(e);r.asyncQueue.verifyOperationInProgress(),Rs(Qu,"RemoteStore received new credentials");const n=al(r);r.Ia.add(3),await el(r),n&&r.Aa.set("Unknown"),await r.remoteSyncer.handleCredentialChange(t),r.Ia.delete(3),await Zu(r)}function gl(e){return e.Va||(e.Va=function(e,t,r){const n=Us(e);return n.ia(),new Wu(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}(e.datastore,e.asyncQueue,{Zo:ul.bind(null,e),e_:ll.bind(null,e),n_:hl.bind(null,e),J_:dl.bind(null,e)}),e.da.push(async t=>{t?(e.Va.N_(),ol(e)?il(e):e.Aa.set("Unknown")):(await e.Va.stop(),cl(e))})),e.Va}class ml{constructor(e,t,r,n,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=s,this.deferred=new Fs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,s){const i=Date.now()+r,o=new ml(e,t,i,n,s);return o.start(r),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new $s(Ms.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function yl(e,t){if(Ps("AsyncQueue",`${t}: ${e}`),Ti(e))return new $s(Ms.UNAVAILABLE,`${t}: ${e}`);throw e}class vl{static emptySet(e){return new vl(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||ci.comparator(t.key,r.key):(e,t)=>ci.comparator(e.key,t.key),this.keyedMap=Ea(),this.sortedSet=new qi(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof vl))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new vl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class wl{constructor(){this.fa=new qi(ci.comparator)}track(e){const t=e.doc.key,r=this.fa.get(t);r?0!==e.type&&3===r.type?this.fa=this.fa.insert(t,e):3===e.type&&1!==r.type?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.fa=this.fa.remove(t):1===e.type&&2===r.type?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):Ds(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){const e=[];return this.fa.inorderTraversal((t,r)=>{e.push(r)}),e}}class bl{constructor(e,t,r,n,s,i,o,a,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,n,s){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new bl(e,t,vl.emptySet(t),i,r,n,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&da(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class _l{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}}class El{constructor(){this.queries=Tl(),this.onlineState="Unknown",this.Da=new Set}terminate(){!function(e,t){const r=Us(e),n=r.queries;r.queries=Tl(),n.forEach((e,r)=>{for(const e of r.wa)e.onError(t)})}(this,new $s(Ms.ABORTED,"Firestore shutting down"))}}function Tl(){return new va(e=>fa(e),da)}function Sl(e,t){const r=Us(e);let n=!1;for(const e of t){const t=e.query,s=r.queries.get(t);if(s){for(const t of s.wa)t.Ca(e)&&(n=!0);s.ya=e}}n&&kl(r)}function Il(e,t,r){const n=Us(e),s=n.queries.get(t);if(s)for(const e of s.wa)e.onError(r);n.queries.delete(t)}function kl(e){e.Da.forEach(e=>{e.next()})}var Cl,Al;(Al=Cl||(Cl={})).Fa="default",Al.Cache="cache";class Ol{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){const t=[];for(const r of e.docChanges)3!==r.type&&t.push(r);e=new bl(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache)return!0;if(!this.ba())return!0;const r="Offline"!==t;return(!this.options.ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Na(e){if(e.docChanges.length>0)return!0;const t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}La(e){e=bl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==Cl.Cache}}class Rl{constructor(e){this.key=e}}class Pl{constructor(e){this.key=e}}class Nl{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=Aa(),this.mutatedKeys=Aa(),this.Xa=ma(e),this.eu=new vl(this.Xa)}get tu(){return this.Ha}nu(e,t){const r=t?t.ru:new wl,n=t?t.eu:this.eu;let s=t?t.mutatedKeys:this.mutatedKeys,i=n,o=!1;const a="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,c="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{const u=n.get(e),l=ga(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(r.track({type:3,doc:l}),f=!0):this.iu(u,l)||(r.track({type:2,doc:l}),f=!0,(a&&this.Xa(l,a)>0||c&&this.Xa(l,c)<0)&&(o=!0)):!u&&l?(r.track({type:0,doc:l}),f=!0):u&&!l&&(r.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(i=i.add(l),s=d?s.add(e):s.delete(e)):(i=i.delete(e),s=s.delete(e)))}),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),s=s.delete(e.key),r.track({type:1,doc:e})}return{eu:i,ru:r,Ds:o,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){const s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;const i=e.ru.pa();i.sort((e,t)=>function(e,t){const r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ds(20277,{At:e})}};return r(e)-r(t)}(e.type,t.type)||this.Xa(e.doc,t.doc)),this.su(r),n=null!=n&&n;const o=t&&!n?this.ou():[],a=0===this.Za.size&&this.current&&!n?1:0,c=a!==this.Ya;return this.Ya=a,0!==i.length||c?{snapshot:new bl(this.query,e.eu,s,i,e.mutatedKeys,0===a,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:o}:{_u:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({eu:this.eu,ru:new wl,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=e.current)}ou(){if(!this.current)return[];const e=this.Za;this.Za=Aa(),this.eu.forEach(e=>{this.au(e.key)&&(this.Za=this.Za.add(e.key))});const t=[];return e.forEach(e=>{this.Za.has(e)||t.push(new Pl(e))}),this.Za.forEach(r=>{e.has(r)||t.push(new Rl(r))}),t}uu(e){this.Ha=e.qs,this.Za=Aa();const t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return bl.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,0===this.Ya,this.hasCachedResults)}}const xl="SyncEngine";class Dl{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Ll{constructor(e){this.key=e,this.lu=!1}}class jl{constructor(e,t,r,n,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.hu={},this.Pu=new va(e=>fa(e),da),this.Tu=new Map,this.Iu=new Set,this.du=new qi(ci.comparator),this.Eu=new Map,this.Au=new lu,this.Ru={},this.Vu=new Map,this.mu=Xc.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return!0===this.fu}}async function Ul(e,t,r=!0){const n=Zl(e);let s;const i=n.Pu.get(t);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.cu()):s=await $l(n,t,r,!0),s}async function Ml(e,t){const r=Zl(e);await $l(r,t,!0,!1)}async function $l(e,t,r,n){const s=await function(e,t){const r=Us(e);return r.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return r.hi.getTargetData(e,t).next(s=>s?(n=s,Ei.resolve(n)):r.hi.allocateTargetId(e).next(s=>(n=new qc(t,s,"TargetPurposeListen",e.currentSequenceNumber),r.hi.addTargetData(e,n).next(()=>n))))}).then(e=>{const n=r.Fs.get(e.targetId);return(null===n||e.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(r.Fs=r.Fs.insert(e.targetId,e),r.Ms.set(t,e.targetId)),e})}(e.localStore,la(t)),i=s.targetId,o=e.sharedClientState.addLocalQueryTarget(i,r);let a;return n&&(a=await async function(e,t,r,n,s){e.gu=(t,r,n)=>async function(e,t,r,n){let s=t.view.nu(r);s.Ds&&(s=await Au(e.localStore,t.query,!1).then(({documents:e})=>t.view.nu(e,s)));const i=n&&n.targetChanges.get(t.targetId),o=n&&null!=n.targetMismatches.get(t.targetId),a=t.view.applyChanges(s,e.isPrimaryClient,i,o);return Wl(e,t.targetId,a._u),a.snapshot}(e,t,r,n);const i=await Au(e.localStore,t,!0),o=new Nl(t,i.qs),a=o.nu(i.documents),c=dc.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,s),u=o.applyChanges(a,e.isPrimaryClient,c);Wl(e,r,u._u);const l=new Dl(t,r,o);return e.Pu.set(t,l),e.Tu.has(r)?e.Tu.get(r).push(t):e.Tu.set(r,[t]),u.snapshot}(e,t,i,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&tl(e.remoteStore,s),a}async function Fl(e,t,r){const n=Us(e),s=n.Pu.get(t),i=n.Tu.get(s.targetId);if(i.length>1)return n.Tu.set(s.targetId,i.filter(e=>!da(e,t))),void n.Pu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Cu(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),r&&rl(n.remoteStore,s.targetId),Kl(n,s.targetId)}).catch(_i)):(Kl(n,s.targetId),await Cu(n.localStore,s.targetId,!0))}async function Vl(e,t){const r=Us(e),n=r.Pu.get(t),s=r.Tu.get(n.targetId);r.isPrimaryClient&&1===s.length&&(r.sharedClientState.removeLocalQueryTarget(n.targetId),rl(r.remoteStore,n.targetId))}async function Bl(e,t){const r=Us(e);try{const e=await function(e,t){const r=Us(e),n=t.snapshotVersion;let s=r.Fs;return r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const i=r.Os.newChangeBuffer({trackRemovals:!0});s=r.Fs;const o=[];t.targetChanges.forEach((i,a)=>{const c=s.get(a);if(!c)return;o.push(r.hi.removeMatchingKeys(e,i.removedDocuments,a).next(()=>r.hi.addMatchingKeys(e,i.addedDocuments,a)));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(Yi.EMPTY_BYTE_STRING,mi.min()).withLastLimboFreeSnapshotVersion(mi.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,n)),s=s.insert(a,u),function(e,t,r){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size>0}(c,u,i)&&o.push(r.hi.updateTargetData(e,u))});let a=ba(),c=Aa();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&o.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),o.push(function(e,t,r){let n=Aa(),s=Aa();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=ba();return r.forEach((r,i)=>{const o=e.get(r);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(r)),i.isNoDocument()&&i.version.isEqual(mi.min())?(t.removeEntry(r,i.readTime),n=n.insert(r,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(i),n=n.insert(r,i)):Rs(Tu,"Ignoring outdated watch update for ",r,". Current version:",o.version," Watch version:",i.version)}),{Ls:n,ks:s}})}(e,i,t.documentUpdates).next(e=>{a=e.Ls,c=e.ks})),!n.isEqual(mi.min())){const t=r.hi.getLastRemoteSnapshotVersion(e).next(t=>r.hi.setTargetsMetadata(e,e.currentSequenceNumber,n));o.push(t)}return Ei.waitFor(o).next(()=>i.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,a,c)).next(()=>a)}).then(e=>(r.Fs=s,e))}(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.Eu.get(t);n&&(js(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?n.lu=!0:e.modifiedDocuments.size>0?js(n.lu,14607):e.removedDocuments.size>0&&(js(n.lu,42227),n.lu=!1))}),await Yl(r,e,t)}catch(e){await _i(e)}}function ql(e,t,r){const n=Us(e);if(n.isPrimaryClient&&0===r||!n.isPrimaryClient&&1===r){const e=[];n.Pu.forEach((r,n)=>{const s=n.view.va(t);s.snapshot&&e.push(s.snapshot)}),function(e,t){const r=Us(e);r.onlineState=t;let n=!1;r.queries.forEach((e,r)=>{for(const e of r.wa)e.va(t)&&(n=!0)}),n&&kl(r)}(n.eventManager,t),e.length&&n.hu.J_(e),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function zl(e,t,r){const n=Us(e);n.sharedClientState.updateQueryState(t,"rejected",r);const s=n.Eu.get(t),i=s&&s.key;if(i){let e=new qi(ci.comparator);e=e.insert(i,xo.newNoDocument(i,mi.min()));const r=Aa().add(i),s=new hc(mi.min(),new Map,new qi(Xs),e,r);await Bl(n,s),n.du=n.du.remove(i),n.Eu.delete(t),Jl(n)}else await Cu(n.localStore,t,!1).then(()=>Kl(n,t,r)).catch(_i)}function Kl(e,t,r=null){e.sharedClientState.removeLocalQueryTarget(t);for(const n of e.Tu.get(t))e.Pu.delete(n),r&&e.hu.pu(n,r);e.Tu.delete(t),e.isPrimaryClient&&e.Au.zr(t).forEach(t=>{e.Au.containsKey(t)||Hl(e,t)})}function Hl(e,t){e.Iu.delete(t.path.canonicalString());const r=e.du.get(t);null!==r&&(rl(e.remoteStore,r),e.du=e.du.remove(t),e.Eu.delete(r),Jl(e))}function Wl(e,t,r){for(const n of r)n instanceof Rl?(e.Au.addReference(n.key,t),Gl(e,n)):n instanceof Pl?(Rs(xl,"Document no longer in limbo: "+n.key),e.Au.removeReference(n.key,t),e.Au.containsKey(n.key)||Hl(e,n.key)):Ds(19791,{yu:n})}function Gl(e,t){const r=t.key,n=r.path.canonicalString();e.du.get(r)||e.Iu.has(n)||(Rs(xl,"New document in limbo: "+r),e.Iu.add(n),Jl(e))}function Jl(e){for(;e.Iu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Iu.values().next().value;e.Iu.delete(t);const r=new ci(ii.fromString(t)),n=e.mu.next();e.Eu.set(n,new Ll(r)),e.du=e.du.insert(r,n),tl(e.remoteStore,new qc(la(aa(r.path)),n,"TargetPurposeLimboResolution",Si.ue))}}async function Yl(e,t,r){const n=Us(e),s=[],i=[],o=[];n.Pu.isEmpty()||(n.Pu.forEach((e,a)=>{o.push(n.gu(a,t,r).then(e=>{var t;if((e||r)&&n.isPrimaryClient){const s=e?!e.fromCache:null===(t=null==r?void 0:r.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;n.sharedClientState.updateQueryState(a.targetId,s?"current":"not-current")}if(e){s.push(e);const t=bu.Es(a.targetId,e);i.push(t)}}))}),await Promise.all(o),n.hu.J_(s),await async function(e,t){const r=Us(e);try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Ei.forEach(t,t=>Ei.forEach(t.Is,n=>r.persistence.referenceDelegate.addReference(e,t.targetId,n)).next(()=>Ei.forEach(t.ds,n=>r.persistence.referenceDelegate.removeReference(e,t.targetId,n)))))}catch(e){if(!Ti(e))throw e;Rs(Tu,"Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.Fs.get(t),n=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(n);r.Fs=r.Fs.insert(t,s)}}}(n.localStore,i))}async function Ql(e,t){const r=Us(e);if(!r.currentUser.isEqual(t)){Rs(xl,"User change. New user:",t.toKey());const e=await Iu(r.localStore,t);r.currentUser=t,function(e){e.Vu.forEach(e=>{e.forEach(e=>{e.reject(new $s(Ms.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Vu.clear()}(r),r.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Yl(r,e.Bs)}}function Xl(e,t){const r=Us(e),n=r.Eu.get(t);if(n&&n.lu)return Aa().add(n.key);{let e=Aa();const n=r.Tu.get(t);if(!n)return e;for(const t of n){const n=r.Pu.get(t);e=e.unionWith(n.view.tu)}return e}}function Zl(e){const t=Us(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Bl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Xl.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=zl.bind(null,t),t.hu.J_=Sl.bind(null,t.eventManager),t.hu.pu=Il.bind(null,t.eventManager),t}class eh{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=qu(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,t){return null}Fu(e,t){return null}vu(e){return function(e,t,r,n){return new Su(e,t,r,n)}(this.persistence,new Eu,e.initialUser,this.serializer)}Du(e){return new mu(vu.Vi,this.serializer)}bu(e){return new Ru}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}eh.provider={build:()=>new eh};class th extends eh{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){js(this.persistence.referenceDelegate instanceof wu,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new ru(r,e.asyncQueue,t)}Du(e){const t=void 0!==this.cacheSizeBytes?Qc.withCacheSize(this.cacheSizeBytes):Qc.DEFAULT;return new mu(e=>wu.Vi(e,t),this.serializer)}}class rh{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>ql(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ql.bind(null,this.syncEngine),await async function(e,t){const r=Us(e);t?(r.Ia.delete(2),await Zu(r)):t||(r.Ia.add(2),await el(r),r.Aa.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new El}createDatastore(e){const t=qu(e.databaseInfo.databaseId),r=function(e){return new Vu(e)}(e.databaseInfo);return function(e,t,r,n){return new Ju(e,t,r,n)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(e,t,r,n,s){return new Xu(e,t,r,n,s)}(this.localStore,this.datastore,e.asyncQueue,e=>ql(this.syncEngine,e,0),xu.C()?new xu:new Pu)}createSyncEngine(e,t){return function(e,t,r,n,s,i,o){const a=new jl(e,t,r,n,s,i);return o&&(a.fu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=Us(e);Rs(Qu,"RemoteStore shutting down."),t.Ia.add(5),await el(t),t.Ea.shutdown(),t.Aa.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}rh.provider={build:()=>new rh};class nh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):Ps("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const sh="FirestoreClient";class ih{constructor(e,t,r,n,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=ks.UNAUTHENTICATED,this.clientId=Qs.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async e=>{Rs(sh,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(Rs(sh,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Fs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=yl(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function oh(e,t){e.asyncQueue.verifyOperationInProgress(),Rs(sh,"Initializing OfflineComponentProvider");const r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await Iu(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>{Ns("Terminating Firestore due to IndexedDb database deletion"),e.terminate().then(()=>{Rs("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(e=>{Ns("Terminating Firestore due to IndexedDb database deletion failed",e)})}),e._offlineComponents=t}async function ah(e,t){e.asyncQueue.verifyOperationInProgress();const r=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Rs(sh,"Using user provided OfflineComponentProvider");try{await oh(e,e._uninitializedComponentsProvider._offline)}catch(t){const r=t;if(!function(e){return"FirebaseError"===e.name?e.code===Ms.FAILED_PRECONDITION||e.code===Ms.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(r))throw r;Ns("Error using user provided cache. Falling back to memory cache: "+r),await oh(e,new eh)}}else Rs(sh,"Using default OfflineComponentProvider"),await oh(e,new th(void 0));return e._offlineComponents}(e);Rs(sh,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>pl(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>pl(t.remoteStore,r)),e._onlineComponents=t}async function ch(e){const t=await async function(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Rs(sh,"Using user provided OnlineComponentProvider"),await ah(e,e._uninitializedComponentsProvider._online)):(Rs(sh,"Using default OnlineComponentProvider"),await ah(e,new rh))),e._onlineComponents}(e),r=t.eventManager;return r.onListen=Ul.bind(null,t.syncEngine),r.onUnlisten=Fl.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=Ml.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=Vl.bind(null,t.syncEngine),r}function uh(e,t,r={}){const n=new Fs;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,r,n,s){const i=new nh({next:a=>{i.Ou(),t.enqueueAndForget(()=>async function(e,t){const r=Us(e),n=t.query;let s=3;const i=r.queries.get(n);if(i){const e=i.wa.indexOf(t);e>=0&&(i.wa.splice(e,1),0===i.wa.length?s=t.ba()?0:1:!i.Sa()&&t.ba()&&(s=2))}switch(s){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}(e,o));const c=a.docs.has(r);!c&&a.fromCache?s.reject(new $s(Ms.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&n&&"server"===n.source?s.reject(new $s(Ms.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(a)},error:e=>s.reject(e)}),o=new Ol(aa(r.path),i,{includeMetadataChanges:!0,ka:!0});return async function(e,t){const r=Us(e);let n=3;const s=t.query;let i=r.queries.get(s);i?!i.Sa()&&t.ba()&&(n=2):(i=new _l,n=t.ba()?0:1);try{switch(n){case 0:i.ya=await r.onListen(s,!0);break;case 1:i.ya=await r.onListen(s,!1);break;case 2:await r.onFirstRemoteStoreListen(s)}}catch(e){const r=yl(e,`Initialization of query '${pa(t.query)}' failed`);return void t.onError(r)}r.queries.set(s,i),i.wa.push(t),t.va(r.onlineState),i.ya&&t.Ca(i.ya)&&kl(r)}(e,o)}(await ch(e),e.asyncQueue,t,r,n)),n.promise}function lh(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const hh=new Map,dh="firestore.googleapis.com",fh=!0;class ph{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new $s(Ms.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=dh,this.ssl=fh}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:fh;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=Yc;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new $s(Ms.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,r,n){if(!0===t&&!0===n)throw new $s(Ms.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=lh(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new $s(Ms.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new $s(Ms.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new $s(Ms.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class gh{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ph({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new $s(Ms.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new $s(Ms.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ph(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Bs;switch(e.type){case"firstParty":return new Hs(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new $s(Ms.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=hh.get(e);t&&(Rs("ComponentProvider","Removing Datastore"),hh.delete(e),t.terminate())}(this),Promise.resolve()}}class mh{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new mh(this.firestore,e,this._query)}}class yh{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new vh(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new yh(this.firestore,e,this._key)}toJSON(){return{type:yh._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(di(t,yh._jsonSchema))return new yh(e,r||null,new ci(ii.fromString(t.referencePath)))}}yh._jsonSchemaVersion="firestore/documentReference/1.0",yh._jsonSchema={type:hi("string",yh._jsonSchemaVersion),referencePath:hi("string")};class vh extends mh{constructor(e,t,r){super(e,t,aa(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new yh(this.firestore,null,new ci(e))}withConverter(e){return new vh(this.firestore,e,this._path)}}function wh(e,t,...r){if(e=N(e),1===arguments.length&&(t=Qs.newId()),function(e,t,r){if(!r)throw new $s(Ms.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}("doc","path",t),e instanceof gh){const n=ii.fromString(t,...r);return ui(n),new yh(e,null,new ci(n))}{if(!(e instanceof yh||e instanceof vh))throw new $s(Ms.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(ii.fromString(t,...r));return ui(n),new yh(e.firestore,e instanceof vh?e.converter:null,new ci(n))}}const bh="AsyncQueue";class _h{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new zu(this,"async_queue_retry"),this.oc=()=>{const e=Bu();e&&Rs(bh,"Visibility state changed to "+e.visibilityState),this.F_.y_()},this._c=e;const t=Bu();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const t=Bu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});const t=new Fs;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}async cc(){if(0!==this.Zu.length){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!Ti(e))throw e;Rs(bh,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}}uc(e){const t=this._c.then(()=>(this.nc=!0,e().catch(e=>{throw this.tc=e,this.nc=!1,Ps("INTERNAL UNHANDLED ERROR: ",Eh(e)),e}).then(e=>(this.nc=!1,e))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);const n=ml.createAndSchedule(this,e,t,r,e=>this.lc(e));return this.ec.push(n),n}ac(){this.tc&&Ds(47125,{hc:Eh(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do{e=this._c,await e}while(e!==this._c)}Tc(e){for(const t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.ec)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){const t=this.ec.indexOf(e);this.ec.splice(t,1)}}function Eh(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class Th extends gh{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new _h,this._persistenceKey=(null==n?void 0:n.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new _h(e),this._firestoreClient=void 0,await e}}}function Sh(e){if(e._terminated)throw new $s(Ms.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,r,n;const s=e._freezeSettings(),i=function(e,t,r,n){return new co(e,t,r,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling,lh(n.experimentalLongPollingOptions),n.useFetchStreams,n.isUsingEmulator)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,s);e._componentsProvider||(null===(r=s.localCache)||void 0===r?void 0:r._offlineComponentProvider)&&(null===(n=s.localCache)||void 0===n?void 0:n._onlineComponentProvider)&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new ih(e._authCredentials,e._appCheckCredentials,e._queue,i,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class Ih{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ih(Yi.fromBase64String(e))}catch(e){throw new $s(Ms.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Ih(Yi.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Ih._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(di(e,Ih._jsonSchema))return Ih.fromBase64String(e.bytes)}}Ih._jsonSchemaVersion="firestore/bytes/1.0",Ih._jsonSchema={type:hi("string",Ih._jsonSchemaVersion),bytes:hi("string")};class kh{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new $s(Ms.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ai(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Ch{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new $s(Ms.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new $s(Ms.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Xs(this._lat,e._lat)||Xs(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ch._jsonSchemaVersion}}static fromJSON(e){if(di(e,Ch._jsonSchema))return new Ch(e.latitude,e.longitude)}}Ch._jsonSchemaVersion="firestore/geoPoint/1.0",Ch._jsonSchema={type:hi("string",Ch._jsonSchemaVersion),latitude:hi("number"),longitude:hi("number")};class Ah{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Ah._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(di(e,Ah._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new Ah(e.vectorValues);throw new $s(Ms.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ah._jsonSchemaVersion="firestore/vectorValue/1.0",Ah._jsonSchema={type:hi("string",Ah._jsonSchemaVersion),vectorValues:hi("object")};const Oh=new RegExp("[~\\*/\\[\\]]");function Rh(e,t,r,n,s){const i=n&&!n.isEmpty(),o=void 0!==s;let a=`Function ${t}() called with invalid data`;r&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${n}`),o&&(c+=` in document ${s}`),c+=")"),new $s(Ms.INVALID_ARGUMENT,a+e+c)}class Ph{constructor(e,t,r,n,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new yh(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Nh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(xh("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Nh extends Ph{data(){return super.data()}}function xh(e,t){return"string"==typeof t?function(e,t,r){if(t.search(Oh)>=0)throw Rh(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new kh(...t.split("."))._internalPath}catch(n){throw Rh(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}(e,t):t instanceof kh?t._internalPath:t._delegate._internalPath}class Dh{convertValue(e,t="none"){switch(go(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Zi(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(eo(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ds(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Bi(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){var t,r,n;const s=null===(n=null===(r=null===(t=e.fields)||void 0===t?void 0:t[po].arrayValue)||void 0===r?void 0:r.values)||void 0===n?void 0:n.map(e=>Zi(e.doubleValue));return new Ah(s)}convertGeoPoint(e){return new Ch(Zi(e.latitude),Zi(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=oo(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ao(e));default:return null}}convertTimestamp(e){const t=Xi(e);return new gi(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ii.fromString(e);js(Bc(r),9688,{name:e});const n=new lo(r.get(1),r.get(3)),s=new ci(r.popFirst(5));return n.isEqual(t)||Ps(`Document ${s} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}class Lh{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class jh extends Ph{constructor(e,t,r,n,s,i){super(e,t,r,n,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Uh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(xh("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new $s(Ms.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=jh._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}jh._jsonSchemaVersion="firestore/documentSnapshot/1.0",jh._jsonSchema={type:hi("string",jh._jsonSchemaVersion),bundleSource:hi("string","DocumentSnapshot"),bundleName:hi("string"),bundle:hi("string")};class Uh extends jh{data(e={}){return super.data(e)}}class Mh{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new Lh(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Uh(this._firestore,this._userDataWriter,r.key,r,new Lh(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new $s(Ms.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{const n=new Uh(e._firestore,e._userDataWriter,r.doc.key,r.doc,new Lh(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const n=new Uh(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Lh(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,i=-1;return 0!==t.type&&(s=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(r=r.add(t.doc),i=r.indexOf(t.doc.key)),{type:$h(t.type),doc:n,oldIndex:s,newIndex:i}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new $s(Ms.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Mh._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Qs.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function $h(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ds(61501,{type:e})}}function Fh(e){e=li(e,yh);const t=li(e.firestore,Th);return uh(Sh(t),e._key).then(r=>function(e,t,r){const n=r.docs.get(t._key),s=new Vh(e);return new jh(e,s,t._key,n,new Lh(r.hasPendingWrites,r.fromCache),t.converter)}(t,e,r))}Mh._jsonSchemaVersion="firestore/querySnapshot/1.0",Mh._jsonSchema={type:hi("string",Mh._jsonSchemaVersion),bundleSource:hi("string","QuerySnapshot"),bundleName:hi("string"),bundle:hi("string")};class Vh extends Dh{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ih(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new yh(this.firestore,null,t)}}new WeakMap,function(e,t=!0){!function(e){Cs=e}(We),Be(new x("firestore",(e,{instanceIdentifier:r,options:n})=>{const s=e.getProvider("app").getImmediate(),i=new Th(new zs(e.getProvider("auth-internal")),new Gs(s,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new $s(Ms.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new lo(e.options.projectId,t)}(s,r),s);return n=Object.assign({useFetchStreams:t},n),i._setSettings(n),i},"PUBLIC").setMultipleInstances(!0)),Ye(Ss,Is,e),Ye(Ss,Is,"esm2017")}();class Bh extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class qh extends Bh{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class zh extends Bh{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Kh extends Bh{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Hh;!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(Hh||(Hh={}));class Wh{constructor(e,{headers:t={},customFetch:r,region:n=Hh.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=(e=>e?(...t)=>e(...t):(...e)=>fetch(...e))(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return t=this,r=arguments,s=function*(e,t={}){var r;let n,s;try{const{headers:i,method:o,body:a,signal:c,timeout:u}=t;let l={},{region:h}=t;h||(h=this.region);const d=new URL(`${this.url}/${e}`);let f;h&&"any"!==h&&(l["x-region"]=h,d.searchParams.set("forceFunctionRegion",h)),a&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?"undefined"!=typeof Blob&&a instanceof Blob||a instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",f=a):"string"==typeof a?(l["Content-Type"]="text/plain",f=a):"undefined"!=typeof FormData&&a instanceof FormData?f=a:(l["Content-Type"]="application/json",f=JSON.stringify(a)):f=!a||"string"==typeof a||"undefined"!=typeof Blob&&a instanceof Blob||a instanceof ArrayBuffer||"undefined"!=typeof FormData&&a instanceof FormData?a:JSON.stringify(a);let p=c;u&&(s=new AbortController,n=setTimeout(()=>s.abort(),u),c?(p=s.signal,c.addEventListener("abort",()=>s.abort())):p=s.signal);const g=yield this.fetch(d.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),i),body:f,signal:p}).catch(e=>{throw new qh(e)}),m=g.headers.get("x-relay-error");if(m&&"true"===m)throw new zh(g);if(!g.ok)throw new Kh(g);let y,v=(null!==(r=g.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return y="application/json"===v?yield g.json():"application/octet-stream"===v||"application/pdf"===v?yield g.blob():"text/event-stream"===v?g:"multipart/form-data"===v?yield g.formData():yield g.text(),{data:y,error:null,response:g}}catch(e){return{data:null,error:e,response:e instanceof Kh||e instanceof zh?e.context:void 0}}finally{n&&clearTimeout(n)}},new((n=void 0)||(n=Promise))(function(e,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n(function(e){e(r)})).then(o,a)}c((s=s.apply(t,r||[])).next())});var t,r,n,s}}var Gh=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},Jh=class{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(r=e.isMaybeSingle)&&void 0!==r&&r,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var r=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let n=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{let t=null,n=null,s=null,i=e.status,o=e.statusText;if(e.ok){var a,c;if("HEAD"!==r.method){var u;const t=await e.text();""===t||(n="text/csv"===r.headers.get("Accept")||r.headers.get("Accept")&&(null===(u=r.headers.get("Accept"))||void 0===u?void 0:u.includes("application/vnd.pgrst.plan+text"))?t:JSON.parse(t))}const l=null===(a=r.headers.get("Prefer"))||void 0===a?void 0:a.match(/count=(exact|planned|estimated)/),h=null===(c=e.headers.get("content-range"))||void 0===c?void 0:c.split("/");l&&h&&h.length>1&&(s=parseInt(h[1])),r.isMaybeSingle&&"GET"===r.method&&Array.isArray(n)&&(n.length>1?(t={code:"PGRST116",details:`Results contain ${n.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},n=null,s=null,i=406,o="Not Acceptable"):n=1===n.length?n[0]:null)}else{var l;const s=await e.text();try{t=JSON.parse(s),Array.isArray(t)&&404===e.status&&(n=[],t=null,i=200,o="OK")}catch(r){404===e.status&&""===s?(i=204,o="No Content"):t={message:s}}if(t&&r.isMaybeSingle&&(null==t||null===(l=t.details)||void 0===l?void 0:l.includes("0 rows"))&&(t=null,i=200,o="OK"),t&&r.shouldThrowOnError)throw new Gh(t)}return{error:t,data:n,count:s,status:i,statusText:o}});return this.shouldThrowOnError||(n=n.catch(e=>{var t;let r="";const n=null==e?void 0:e.cause;if(n){var s,i,o,a;const t=null!==(s=null==n?void 0:n.message)&&void 0!==s?s:"",c=null!==(i=null==n?void 0:n.code)&&void 0!==i?i:"";r=`${null!==(o=null==e?void 0:e.name)&&void 0!==o?o:"FetchError"}: ${null==e?void 0:e.message}`,r+=`\n\nCaused by: ${null!==(a=null==n?void 0:n.name)&&void 0!==a?a:"Error"}: ${t}`,c&&(r+=` (${c})`),(null==n?void 0:n.stack)&&(r+=`\n${n.stack}`)}else{var c;r=null!==(c=null==e?void 0:e.stack)&&void 0!==c?c:""}return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:r,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}},Yh=class extends Jh{select(e){let t=!1;const r=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:n,referencedTable:s=n}={}){const i=s?`${s}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const n=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:n=r}={}){const s=void 0===n?"offset":`${n}.offset`,i=void 0===n?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:s=!1,format:i="text"}={}){var o;const a=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,s?"wal":null].filter(Boolean).join("|"),c=null!==(o=this.headers.get("Accept"))&&void 0!==o?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${c}"; options=${a};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};const Qh=new RegExp("[,()]");var Xh=class extends Yh{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(e=>"string"==typeof e&&Qh.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}notIn(e,t){const r=Array.from(new Set(t)).map(e=>"string"==typeof e&&Qh.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`not.in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:n}={}){let s="";"plain"===n?s="pl":"phrase"===n?s="ph":"websearch"===n&&(s="w");const i=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${s}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}},Zh=class{constructor(e,{headers:t={},schema:r,fetch:n}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=n}select(e,t){const{head:r=!1,count:n}=null!=t?t:{},s=r?"HEAD":"GET";let i=!1;const o=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!i?"":('"'===e&&(i=!i),e)).join("");return this.url.searchParams.set("select",o),n&&this.headers.append("Prefer",`count=${n}`),new Xh({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:r=!0}={}){var n;if(t&&this.headers.append("Prefer",`count=${t}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new Xh({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:s=!0}={}){var i;if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),void 0!==t&&this.url.searchParams.set("on_conflict",t),n&&this.headers.append("Prefer",`count=${n}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new Xh({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}update(e,{count:t}={}){var r;return t&&this.headers.append("Prefer",`count=${t}`),new Xh({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}delete({count:e}={}){var t;return e&&this.headers.append("Prefer",`count=${e}`),new Xh({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}},ed=class e{constructor(e,{headers:t={},schema:r,fetch:n}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.fetch=n}from(e){if(!e||"string"!=typeof e||""===e.trim())throw new Error("Invalid relation name: relation must be a non-empty string.");return new Zh(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:n=!1,count:s}={}){var i;let o;const a=new URL(`${this.url}/rpc/${e}`);let c;const u=e=>null!==e&&"object"==typeof e&&(!Array.isArray(e)||e.some(u)),l=r&&Object.values(t).some(u);l?(o="POST",c=t):r||n?(o=r?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{a.searchParams.append(e,t)})):(o="POST",c=t);const h=new Headers(this.headers);return l?h.set("Prefer",s?`count=${s},return=minimal`:"return=minimal"):s&&h.set("Prefer",`count=${s}`),new Xh({method:o,url:a,headers:h,schema:this.schemaName,body:c,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}};const td=class{constructor(){}static detectEnvironment(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if(void 0!==r.g&&void 0!==r.g.WebSocket)return{type:"native",constructor:r.g.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const t=globalThis.process;if(t){const e=t.versions;if(e&&e.node){const t=e.node,r=parseInt(t.replace(/^v/,"").split(".")[0]);return r>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`\n\nSuggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}},rd="1.0.0",nd=rd;var sd,id,od,ad,cd,ud,ld;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(sd||(sd={})),(ld=id||(id={})).closed="closed",ld.errored="errored",ld.joined="joined",ld.joining="joining",ld.leaving="leaving",function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(od||(od={})),function(e){e.websocket="websocket"}(ad||(ad={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(cd||(cd={}));class hd{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=null!=e?e:[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&"string"==typeof e.payload.event)return t(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer(null===(t=e.payload)||void 0===t?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,r;const n=null!==(r=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==r?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,n)}_encodeJsonUserBroadcastPush(e){var t,r;const n=null!==(r=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==r?r:{},s=(new TextEncoder).encode(JSON.stringify(n)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,s)}_encodeUserBroadcastPush(e,t,r){var n,s;const i=e.topic,o=null!==(n=e.ref)&&void 0!==n?n:"",a=null!==(s=e.join_ref)&&void 0!==s?s:"",c=e.payload.event,u=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},l=0===Object.keys(u).length?"":JSON.stringify(u);if(a.length>255)throw new Error(`joinRef length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`ref length ${o.length} exceeds maximum of 255`);if(i.length>255)throw new Error(`topic length ${i.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`userEvent length ${c.length} exceeds maximum of 255`);if(l.length>255)throw new Error(`metadata length ${l.length} exceeds maximum of 255`);const h=this.USER_BROADCAST_PUSH_META_LENGTH+a.length+o.length+i.length+c.length+l.length,d=new ArrayBuffer(this.HEADER_LENGTH+h);let f=new DataView(d),p=0;f.setUint8(p++,this.KINDS.userBroadcastPush),f.setUint8(p++,a.length),f.setUint8(p++,o.length),f.setUint8(p++,i.length),f.setUint8(p++,c.length),f.setUint8(p++,l.length),f.setUint8(p++,t),Array.from(a,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(o,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(i,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(c,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(l,e=>f.setUint8(p++,e.charCodeAt(0)));var g=new Uint8Array(d.byteLength+r.byteLength);return g.set(new Uint8Array(d),0),g.set(new Uint8Array(r),d.byteLength),g.buffer}decode(e,t){if(this._isArrayBuffer(e))return t(this._binaryDecode(e));if("string"==typeof e){const r=JSON.parse(e),[n,s,i,o,a]=r;return t({join_ref:n,ref:s,topic:i,event:o,payload:a})}return t({})}_binaryDecode(e){const t=new DataView(e),r=t.getUint8(0),n=new TextDecoder;if(r===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,t,n)}_decodeUserBroadcast(e,t,r){const n=t.getUint8(1),s=t.getUint8(2),i=t.getUint8(3),o=t.getUint8(4);let a=this.HEADER_LENGTH+4;const c=r.decode(e.slice(a,a+n));a+=n;const u=r.decode(e.slice(a,a+s));a+=s;const l=r.decode(e.slice(a,a+i));a+=i;const h=e.slice(a,e.byteLength),d=o===this.JSON_ENCODING?JSON.parse(r.decode(h)):h,f={type:this.BROADCAST_EVENT,event:u,payload:d};return i>0&&(f.meta=JSON.parse(l)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:f}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||"ArrayBuffer"===(null===(t=null==e?void 0:e.constructor)||void 0===t?void 0:t.name)}_pick(e,t){return e&&"object"==typeof e?Object.fromEntries(Object.entries(e).filter(([e])=>t.includes(e))):{}}}class dd{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(ud||(ud={}));const fd=(e,t,r={})=>{var n;const s=null!==(n=r.skipTypes)&&void 0!==n?n:[];return t?Object.keys(t).reduce((r,n)=>(r[n]=pd(n,e,t,s),r),{}):{}},pd=(e,t,r,n)=>{const s=t.find(t=>t.name===e),i=null==s?void 0:s.type,o=r[e];return i&&!n.includes(i)?gd(i,o):md(o)},gd=(e,t)=>{if("_"===e.charAt(0)){const r=e.slice(1,e.length);return bd(t,r)}switch(e){case ud.bool:return yd(t);case ud.float4:case ud.float8:case ud.int2:case ud.int4:case ud.int8:case ud.numeric:case ud.oid:return vd(t);case ud.json:case ud.jsonb:return wd(t);case ud.timestamp:return _d(t);case ud.abstime:case ud.date:case ud.daterange:case ud.int4range:case ud.int8range:case ud.money:case ud.reltime:case ud.text:case ud.time:case ud.timestamptz:case ud.timetz:case ud.tsrange:case ud.tstzrange:default:return md(t)}},md=e=>e,yd=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},vd=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},wd=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}return e},bd=(e,t)=>{if("string"!=typeof e)return e;const r=e.length-1,n=e[r];if("{"===e[0]&&"}"===n){let n;const s=e.slice(1,r);try{n=JSON.parse("["+s+"]")}catch(e){n=s?s.split(","):[]}return n.map(e=>gd(t,e))}return e},_d=e=>"string"==typeof e?e.replace(" ","T"):e,Ed=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===t.pathname||"/"===t.pathname?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class Td{constructor(e,t,r={},n=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Sd,Id,kd,Cd;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(Sd||(Sd={}));class Ad{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{const{onJoin:t,onLeave:r,onSync:n}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ad.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=Ad.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],n()}),this.channel._on(r.diff,{},e=>{const{onJoin:t,onLeave:r,onSync:n}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=Ad.syncDiff(this.state,e,t,r),n())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const s=this.cloneDeep(e),i=this.transformState(t),o={},a={};return this.map(s,(e,t)=>{i[e]||(a[e]=t)}),this.map(i,(e,t)=>{const r=s[e];if(r){const n=t.map(e=>e.presence_ref),s=r.map(e=>e.presence_ref),i=t.filter(e=>s.indexOf(e.presence_ref)<0),c=r.filter(e=>n.indexOf(e.presence_ref)<0);i.length>0&&(o[e]=i),c.length>0&&(a[e]=c)}else o[e]=t}),this.syncDiff(s,{joins:o,leaves:a},r,n)}static syncDiff(e,t,r,n){const{joins:s,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(s,(t,n)=>{var s;const i=null!==(s=e[t])&&void 0!==s?s:[];if(e[t]=this.cloneDeep(n),i.length>0){const r=e[t].map(e=>e.presence_ref),n=i.filter(e=>r.indexOf(e.presence_ref)<0);e[t].unshift(...n)}r(t,i,n)}),this.map(i,(t,r)=>{let s=e[t];if(!s)return;const i=r.map(e=>e.presence_ref);s=s.filter(e=>i.indexOf(e.presence_ref)<0),e[t]=s,n(t,s,r),0===s.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return t[r]="metas"in n?n.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(Id||(Id={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(kd||(kd={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(Cd||(Cd={}));class Od{constructor(e,t={config:{}},r){var n,s;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=id.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Td(this,od.join,this.params,this.timeout),this.rejoinTimer=new dd(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=id.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=id.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=id.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=id.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=id.errored,this.rejoinTimer.scheduleTimeout())}),this._on(od.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new Ad(this),this.broadcastEndpointURL=Ed(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(s=null===(n=this.params.config)||void 0===n?void 0:n.broadcast)||void 0===s?void 0:s.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,n,s;if(this.socket.isConnected()||this.socket.connect(),this.state==id.closed){const{config:{broadcast:i,presence:o,private:a}}=this.params,c=null!==(n=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(e=>e.filter))&&void 0!==n?n:[],u=!!this.bindings[kd.PRESENCE]&&this.bindings[kd.PRESENCE].length>0||!0===(null===(s=this.params.config.presence)||void 0===s?void 0:s.enabled),l={},h={broadcast:i,presence:Object.assign(Object.assign({},o),{enabled:u}),postgres_changes:c,private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(Cd.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(Cd.CLOSED)),this.updateJoinPayload(Object.assign({config:h},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var r;if(this.socket._isManualToken()||this.socket.setAuth(),void 0!==t){const n=this.bindings.postgres_changes,s=null!==(r=null==n?void 0:n.length)&&void 0!==r?r:0,i=[];for(let r=0;r<s;r++){const s=n[r],{filter:{event:o,schema:a,table:c,filter:u}}=s,l=t&&t[r];if(!(l&&l.event===o&&Od.isFilterValueEqual(l.schema,a)&&Od.isFilterValueEqual(l.table,c)&&Od.isFilterValueEqual(l.filter,u)))return this.unsubscribe(),this.state=id.errored,void(null==e||e(Cd.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));i.push(Object.assign(Object.assign({},s),{id:l.id}))}return this.bindings.postgres_changes=i,void(e&&e(Cd.SUBSCRIBED))}null==e||e(Cd.SUBSCRIBED)}).receive("error",t=>{this.state=id.errored,null==e||e(Cd.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(Cd.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===id.joined&&e===kd.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,r)}async httpSend(e,t,r={}){var n;if(null==t)return Promise.reject("Payload is required for httpSend()");const s={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(s.Authorization=`Bearer ${this.socket.accessTokenValue}`);const i={method:"POST",headers:s,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,i,null!==(n=r.timeout)&&void 0!==n?n:this.timeout);if(202===o.status)return{success:!0};let a=o.statusText;try{const e=await o.json();a=e.error||e.message||a}catch(e){}return Promise.reject(new Error(a))}async send(e,t={}){var r,n;if(this._canPush()||"broadcast"!==e.type)return new Promise(r=>{var n,s,i;const o=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(i=null===(s=null===(n=this.params)||void 0===n?void 0:n.config)||void 0===s?void 0:s.broadcast)||void 0===i?void 0:i.ack)||r("ok"),o.receive("ok",()=>r("ok")),o.receive("error",()=>r("error")),o.receive("timeout",()=>r("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:s,payload:i}=e,o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization=`Bearer ${this.socket.accessTokenValue}`);const a={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:i,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,a,null!==(r=t.timeout)&&void 0!==r?r:this.timeout);return await(null===(n=e.body)||void 0===n?void 0:n.cancel()),e.ok?"ok":"error"}catch(e){return"AbortError"===e.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=id.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(od.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new Td(this,od.leave,{},e),r.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{null==r||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=id.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const n=new AbortController,s=setTimeout(()=>n.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(s),i}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Td(this,e,t,r);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,s;const i=e.toLocaleLowerCase(),{close:o,error:a,leave:c,join:u}=od;if(r&&[o,a,c,u].indexOf(i)>=0&&r!==this._joinRef())return;let l=this._onMessage(i,t,r);if(t&&!l)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null===(n=this.bindings.postgres_changes)||void 0===n||n.filter(e=>{var t,r,n;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(n=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===n?void 0:n.toLocaleLowerCase())===i}).map(e=>e.callback(l,r)):null===(s=this.bindings[i])||void 0===s||s.filter(e=>{var r,n,s,o,a,c;if(["broadcast","presence","postgres_changes"].includes(i)){if("id"in e){const i=e.id,o=null===(r=e.filter)||void 0===r?void 0:r.event;return i&&(null===(n=t.ids)||void 0===n?void 0:n.includes(i))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(s=t.data)||void 0===s?void 0:s.type.toLocaleLowerCase()))}{const r=null===(a=null===(o=null==e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===r||r===(null===(c=null==t?void 0:t.event)||void 0===c?void 0:c.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===i}).map(e=>{if("object"==typeof l&&"ids"in l){const e=l.data,{schema:t,table:r,commit_timestamp:n,type:s,errors:i}=e,o={schema:t,table:r,commit_timestamp:n,eventType:s,new:{},old:{},errors:i};l=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(l,r)})}_isClosed(){return this.state===id.closed}_isJoined(){return this.state===id.joined}_isJoining(){return this.state===id.joining}_isLeaving(){return this.state===id.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const n=e.toLocaleLowerCase(),s={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(s):this.bindings[n]=[s],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(e=>{var n;return!((null===(n=e.type)||void 0===n?void 0:n.toLocaleLowerCase())===r&&Od.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}static isFilterValueEqual(e,t){return(null!=e?e:void 0)===(null!=t?t:void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(od.close,{},e)}_onError(e){this._on(od.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=id.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=fd(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=fd(e.columns,e.old_record)),t}}const Rd=()=>{},Pd=[1e3,2e3,5e3,1e4];class Nd{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.transport=null,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Rd,this.ref=0,this.reconnectTimer=null,this.vsn=nd,this.logger=Rd,this.conn=null,this.sendBuffer=[],this.serializer=new hd,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),!(null===(r=null==t?void 0:t.params)||void 0===r?void 0:r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${ad.websocket}`,this.httpEndpoint=Ed(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=td.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error(`${t}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},"function"==typeof this.conn.close&&(e?this.conn.close(e,null!=t?t:""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case sd.connecting:return cd.Connecting;case sd.open:return cd.Open;case sd.closing:return cd.Closing;default:return cd.Closed}}isConnected(){return this.connectionState()===cd.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){const r=`realtime:${e}`,n=this.getChannels().find(e=>e.topic===r);if(n)return n;{const r=new Od(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){const{topic:t,event:r,payload:n,ref:s}=e,i=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${r} (${s})`,n),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},100)}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event&&e.ref&&e.ref===this.pendingHeartbeatRef){const t=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error",t)}catch(e){this.log("error","error in heartbeat callback",e)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:t,event:r,payload:n,ref:s}=e,i=s?`(${s})`:"",o=n.status||"";this.log("receive",`${o} ${t} ${r} ${i}`.trim(),n),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,n,s)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===sd.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===sd.open||this.conn.readyState===sd.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this._terminateWorker()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(od.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const r=e.match(/\?/)?"&":"?";return`${e}${r}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,r=!1;if(e)t=e,r=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(e){this.log("error","Error fetching access token from callback",e),t=this.accessTokenValue}else t=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const r={access_token:t,version:"realtime-js/2.90.0"};t&&e.updateJoinPayload(r),e.joinedOnce&&e._isJoined()&&e._push(od.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(t){this.log("error",`error in ${e} callback`,t)}})}catch(t){this.log("error",`error triggering ${e} callbacks`,t)}}_setupReconnectionTimer(){this.reconnectTimer=new dd(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},10)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,n,s,i,o,a,c,u,l,h,d;switch(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(r=null==e?void 0:e.timeout)&&void 0!==r?r:1e4,this.heartbeatIntervalMs=null!==(n=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==n?n:25e3,this.worker=null!==(s=null==e?void 0:e.worker)&&void 0!==s&&s,this.accessToken=null!==(i=null==e?void 0:e.accessToken)&&void 0!==i?i:null,this.heartbeatCallback=null!==(o=null==e?void 0:e.heartbeatCallback)&&void 0!==o?o:Rd,this.vsn=null!==(a=null==e?void 0:e.vsn)&&void 0!==a?a:nd,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(c=null==e?void 0:e.reconnectAfterMs)&&void 0!==c?c:e=>Pd[e-1]||1e4,this.vsn){case rd:this.encode=null!==(u=null==e?void 0:e.encode)&&void 0!==u?u:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(l=null==e?void 0:e.decode)&&void 0!==l?l:(e,t)=>t(JSON.parse(e));break;case"2.0.0":this.encode=null!==(h=null==e?void 0:e.encode)&&void 0!==h?h:this.serializer.encode.bind(this.serializer),this.decode=null!==(d=null==e?void 0:e.decode)&&void 0!==d?d:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}var xd=class extends Error{constructor(e,t){super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown="CommitStateUnknownException"===t.icebergType||[500,502,504].includes(t.status)&&!0===t.icebergType?.includes("CommitState")}isNotFound(){return 404===this.status}isConflict(){return 409===this.status}isAuthenticationTimeout(){return 419===this.status}};function Dd(e){return e.join("")}var Ld=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:Dd(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(e=>({namespace:e}))}async createNamespace(e,t){const r={namespace:e.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Dd(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Dd(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Dd(e.namespace)}`}),!0}catch(e){if(e instanceof xd&&404===e.status)return!1;throw e}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(e){if(e instanceof xd&&409===e.status)return;throw e}}};function jd(e){return e.join("")}var Ud=class{constructor(e,t="",r){this.client=e,this.prefix=t,this.accessDelegation=r}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${jd(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${jd(e.namespace)}/tables`,body:t,headers:r})).data.metadata}async updateTable(e,t){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${jd(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${jd(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${jd(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${jd(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(e){if(e instanceof xd&&404===e.status)return!1;throw e}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(r){if(r instanceof xd&&409===r.status)return await this.loadTable({namespace:e.namespace,name:t.name});throw r}}},Md=class{constructor(e){let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const r=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=function(e){const t=e.fetchImpl??globalThis.fetch;return{async request({method:r,path:n,query:s,body:i,headers:o}){const a=function(e,t,r){const n=new URL(t,e);if(r)for(const[e,t]of Object.entries(r))void 0!==t&&n.searchParams.set(e,t);return n.toString()}(e.baseUrl,n,s),c=await async function(e){return e&&"none"!==e.type?"bearer"===e.type?{Authorization:`Bearer ${e.token}`}:"header"===e.type?{[e.name]:e.value}:"custom"===e.type?await e.getHeaders():{}:{}}(e.auth),u=await t(a,{method:r,headers:{...i?{"Content-Type":"application/json"}:{},...c,...o},body:i?JSON.stringify(i):void 0}),l=await u.text(),h=(u.headers.get("content-type")||"").includes("application/json"),d=h&&l?JSON.parse(l):l;if(!u.ok){const e=h?d:void 0,t=e?.error;throw new xd(t?.message??`Request failed with status ${u.status}`,{status:u.status,icebergType:t?.type,icebergCode:t?.code,details:e})}return{status:u.status,headers:u.headers,data:d}}}}({baseUrl:r,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=e.accessDelegation?.join(","),this.namespaceOps=new Ld(this.client,t),this.tableOps=new Ud(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},$d=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function Fd(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}var Vd=class extends $d{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Bd=class extends $d{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};const qd=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),zd=e=>{if(Array.isArray(e))return e.map(e=>zd(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,r])=>{const n=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[n]=zd(r)}),t};function Kd(e){return(Kd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hd(e,t,r){return(t=function(e){var t=function(e){if("object"!=Kd(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Kd(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Kd(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Wd(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Gd(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Wd(Object(r),!0).forEach(function(t){Hd(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wd(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const Jd=e=>{var t;return e.msg||e.message||e.error_description||("string"==typeof e.error?e.error:null===(t=e.error)||void 0===t?void 0:t.message)||JSON.stringify(e)};async function Yd(e,t,r,n,s,i){return new Promise((o,a)=>{e(r,((e,t,r,n)=>{const s={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&n?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(n)?(s.headers=Gd({"Content-Type":"application/json"},null==t?void 0:t.headers),s.body=JSON.stringify(n)):s.body=n,(null==t?void 0:t.duplex)&&(s.duplex=t.duplex),Gd(Gd({},s),r)):s})(t,n,s,i)).then(e=>{if(!e.ok)throw e;return(null==n?void 0:n.noResolveJson)?e:e.json()}).then(e=>o(e)).catch(e=>(async(e,t,r)=>{e instanceof await Response&&!(null==r?void 0:r.noResolveJson)?e.json().then(r=>{const n=e.status||500,s=(null==r?void 0:r.statusCode)||n+"";t(new Vd(Jd(r),n,s))}).catch(e=>{t(new Bd(Jd(e),e))}):t(new Bd(Jd(e),e))})(e,a,n))})}async function Qd(e,t,r,n){return Yd(e,"GET",t,r,n)}async function Xd(e,t,r,n,s){return Yd(e,"POST",t,n,s,r)}async function Zd(e,t,r,n,s){return Yd(e,"PUT",t,n,s,r)}async function ef(e,t,r,n,s){return Yd(e,"DELETE",t,n,s,r)}var tf=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){try{return{data:(await this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}};let rf;rf=Symbol.toStringTag;var nf=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[rf]="BlobDownloadBuilder",this.promise=null}asStream(){return new tf(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){try{return{data:await(await this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}};const sf={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},of={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var af=class{constructor(e,t={},r,n){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=qd(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(e,t,r,n){var s=this;try{let i;const o=Gd(Gd({},of),n);let a=Gd(Gd({},s.headers),"POST"===e&&{"x-upsert":String(o.upsert)});const c=o.metadata;"undefined"!=typeof Blob&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",s.encodeMetadata(c)),i.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(i=r,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),c&&!i.has("metadata")&&i.append("metadata",s.encodeMetadata(c))):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,c&&(a["x-metadata"]=s.toBase64(s.encodeMetadata(c))),("undefined"!=typeof ReadableStream&&i instanceof ReadableStream||i&&"object"==typeof i&&"pipe"in i&&"function"==typeof i.pipe)&&!o.duplex&&(o.duplex="half")),(null==n?void 0:n.headers)&&(a=Gd(Gd({},a),n.headers));const u=s._removeEmptyFolders(t),l=s._getFinalPath(u),h=await("PUT"==e?Zd:Xd)(s.fetch,`${s.url}/object/${l}`,i,Gd({headers:a},(null==o?void 0:o.duplex)?{duplex:o.duplex}:{}));return{data:{path:u,id:h.Id,fullPath:h.Key},error:null}}catch(e){if(s.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}async upload(e,t,r){return this.uploadOrUpdate("POST",e,t,r)}async uploadToSignedUrl(e,t,r,n){var s=this;const i=s._removeEmptyFolders(e),o=s._getFinalPath(i),a=new URL(s.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let e;const t=Gd({upsert:of.upsert},n),o=Gd(Gd({},s.headers),{"x-upsert":String(t.upsert)});return"undefined"!=typeof Blob&&r instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r,e.append("cacheControl",t.cacheControl)):(e=r,o["cache-control"]=`max-age=${t.cacheControl}`,o["content-type"]=t.contentType),{data:{path:i,fullPath:(await Zd(s.fetch,a.toString(),e,{headers:o})).Key},error:null}}catch(e){if(s.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}async createSignedUploadUrl(e,t){var r=this;try{let n=r._getFinalPath(e);const s=Gd({},r.headers);(null==t?void 0:t.upsert)&&(s["x-upsert"]="true");const i=await Xd(r.fetch,`${r.url}/object/upload/sign/${n}`,{},{headers:s}),o=new URL(r.url+i.url),a=o.searchParams.get("token");if(!a)throw new $d("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}async update(e,t,r){return this.uploadOrUpdate("PUT",e,t,r)}async move(e,t,r){var n=this;try{return{data:await Xd(n.fetch,`${n.url}/object/move`,{bucketId:n.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:n.headers}),error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}async copy(e,t,r){var n=this;try{return{data:{path:(await Xd(n.fetch,`${n.url}/object/copy`,{bucketId:n.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:n.headers})).Key},error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}async createSignedUrl(e,t,r){var n=this;try{let s=n._getFinalPath(e),i=await Xd(n.fetch,`${n.url}/object/sign/${s}`,Gd({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:n.headers});const o=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return i={signedUrl:encodeURI(`${n.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}async createSignedUrls(e,t,r){var n=this;try{const s=await Xd(n.fetch,`${n.url}/object/sign/${n.bucketId}`,{expiresIn:t,paths:e},{headers:n.headers}),i=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:s.map(e=>Gd(Gd({},e),{},{signedUrl:e.signedURL?encodeURI(`${n.url}${e.signedURL}${i}`):null})),error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}download(e,t){const r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",n=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),s=n?`?${n}`:"",i=this._getFinalPath(e);return new nf(()=>Qd(this.fetch,`${this.url}/${r}/${i}${s}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}async info(e){var t=this;const r=t._getFinalPath(e);try{return{data:zd(await Qd(t.fetch,`${t.url}/object/info/${r}`,{headers:t.headers})),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}async exists(e){var t=this;const r=t._getFinalPath(e);try{return await async function(e,t,r){return Yd(e,"HEAD",t,Gd(Gd({},r),{},{noResolveJson:!0}),void 0)}(t.fetch,`${t.url}/object/${r}`,{headers:t.headers}),{data:!0,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Fd(e)&&e instanceof Bd){const t=e.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:e}}throw e}}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],s=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==s&&n.push(s);const i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==o&&n.push(o);let a=n.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${r}${a}`)}}}async remove(e){var t=this;try{return{data:await ef(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:e},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}async list(e,t,r){var n=this;try{const s=Gd(Gd(Gd({},sf),t),{},{prefix:e||""});return{data:await Xd(n.fetch,`${n.url}/object/list/${n.bucketId}`,s,{headers:n.headers},r),error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}async listV2(e,t){var r=this;try{const n=Gd({},e);return{data:await Xd(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,n,{headers:r.headers},t),error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};const cf="2.90.0",uf={"X-Client-Info":`storage-js/${cf}`};var lf=class{constructor(e,t={},r,n){this.shouldThrowOnError=!1;const s=new URL(e);(null==n?void 0:n.useNewHostname)&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href.replace(/\/$/,""),this.headers=Gd(Gd({},uf),t),this.fetch=qd(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(e){var t=this;try{const r=t.listBucketOptionsToQueryString(e);return{data:await Qd(t.fetch,`${t.url}/bucket${r}`,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}async getBucket(e){var t=this;try{return{data:await Qd(t.fetch,`${t.url}/bucket/${e}`,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}async createBucket(e,t={public:!1}){var r=this;try{return{data:await Xd(r.fetch,`${r.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}),error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}async updateBucket(e,t){var r=this;try{return{data:await Zd(r.fetch,`${r.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}),error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}async emptyBucket(e){var t=this;try{return{data:await Xd(t.fetch,`${t.url}/bucket/${e}/empty`,{},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}async deleteBucket(e){var t=this;try{return{data:await ef(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},hf=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Gd(Gd({},uf),t),this.fetch=qd(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await Xd(t.fetch,`${t.url}/bucket`,{name:e},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}async listBuckets(e){var t=this;try{const r=new URLSearchParams;void 0!==(null==e?void 0:e.limit)&&r.set("limit",e.limit.toString()),void 0!==(null==e?void 0:e.offset)&&r.set("offset",e.offset.toString()),(null==e?void 0:e.sortColumn)&&r.set("sortColumn",e.sortColumn),(null==e?void 0:e.sortOrder)&&r.set("sortOrder",e.sortOrder),(null==e?void 0:e.search)&&r.set("search",e.search);const n=r.toString(),s=n?`${t.url}/bucket?${n}`:`${t.url}/bucket`;return{data:await Qd(t.fetch,s,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}async deleteBucket(e){var t=this;try{return{data:await ef(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Fd(e))return{data:null,error:e};throw e}}from(e){var t=this;if(!(e=>!(!e||"string"!=typeof e)&&!(0===e.length||e.length>100)&&e.trim()===e&&!e.includes("/")&&!e.includes("\\")&&/^[\w!.\*'() &$@=;:+,?-]+$/.test(e))(e))throw new $d("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new Md({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(r,{get(e,t){const r=e[t];return"function"!=typeof r?r:async(...t)=>{try{return{data:await r.apply(e,t),error:null}}catch(e){if(n)throw e;return{data:null,error:e}}}}})}};const df={"X-Client-Info":`storage-js/${cf}`,"Content-Type":"application/json"};var ff=class extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function pf(e){return"object"==typeof e&&null!==e&&"__isStorageVectorsError"in e}var gf=class extends ff{constructor(e,t,r){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},mf=class extends ff{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}};const yf=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),vf=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e);async function wf(e,t,r,n,s,i){return new Promise((o,a)=>{e(r,((e,t,r,n)=>{const s={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&n?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(n)?(s.headers=Gd({"Content-Type":"application/json"},null==t?void 0:t.headers),s.body=JSON.stringify(n)):s.body=n,Gd(Gd({},s),r)):s})(t,n,s,i)).then(e=>{if(!e.ok)throw e;if(null==n?void 0:n.noResolveJson)return e;const t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():{}}).then(e=>o(e)).catch(e=>(async(e,t,r)=>{if(e&&"object"==typeof e&&"status"in e&&"ok"in e&&"number"==typeof e.status&&!(null==r?void 0:r.noResolveJson)){const r=e.status||500,n=e;if("function"==typeof n.json)n.json().then(e=>{const n=(null==e?void 0:e.statusCode)||(null==e?void 0:e.code)||r+"";t(new gf(vf(e),r,n))}).catch(()=>{const e=r+"";t(new gf(n.statusText||`HTTP ${r} error`,r,e))});else{const e=r+"";t(new gf(n.statusText||`HTTP ${r} error`,r,e))}}else t(new mf(vf(e),e))})(e,a,n))})}async function bf(e,t,r,n,s){return wf(e,"POST",t,n,s,r)}var _f=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Gd(Gd({},df),t),this.fetch=yf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(e){var t=this;try{return{data:await bf(t.fetch,`${t.url}/CreateIndex`,e,{headers:t.headers})||{},error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(pf(e))return{data:null,error:e};throw e}}async getIndex(e,t){var r=this;try{return{data:await bf(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers}),error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(pf(e))return{data:null,error:e};throw e}}async listIndexes(e){var t=this;try{return{data:await bf(t.fetch,`${t.url}/ListIndexes`,e,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(pf(e))return{data:null,error:e};throw e}}async deleteIndex(e,t){var r=this;try{return{data:await bf(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers})||{},error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(pf(e))return{data:null,error:e};throw e}}},Ef=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Gd(Gd({},df),t),this.fetch=yf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(e){var t=this;try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await bf(t.fetch,`${t.url}/PutVectors`,e,{headers:t.headers})||{},error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(pf(e))return{data:null,error:e};throw e}}async getVectors(e){var t=this;try{return{data:await bf(t.fetch,`${t.url}/GetVectors`,e,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(pf(e))return{data:null,error:e};throw e}}async listVectors(e){var t=this;try{if(void 0!==e.segmentCount){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(void 0!==e.segmentIndex&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error("segmentIndex must be between 0 and "+(e.segmentCount-1))}return{data:await bf(t.fetch,`${t.url}/ListVectors`,e,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(pf(e))return{data:null,error:e};throw e}}async queryVectors(e){var t=this;try{return{data:await bf(t.fetch,`${t.url}/QueryVectors`,e,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(pf(e))return{data:null,error:e};throw e}}async deleteVectors(e){var t=this;try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await bf(t.fetch,`${t.url}/DeleteVectors`,e,{headers:t.headers})||{},error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(pf(e))return{data:null,error:e};throw e}}},Tf=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Gd(Gd({},df),t),this.fetch=yf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await bf(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(pf(e))return{data:null,error:e};throw e}}async getBucket(e){var t=this;try{return{data:await bf(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:e},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(pf(e))return{data:null,error:e};throw e}}async listBuckets(e={}){var t=this;try{return{data:await bf(t.fetch,`${t.url}/ListVectorBuckets`,e,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(pf(e))return{data:null,error:e};throw e}}async deleteBucket(e){var t=this;try{return{data:await bf(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(pf(e))return{data:null,error:e};throw e}}},Sf=class extends Tf{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new If(this.url,this.headers,e,this.fetch)}async createBucket(e){return(()=>super.createBucket)().call(this,e)}async getBucket(e){return(()=>super.getBucket)().call(this,e)}async listBuckets(e={}){return(()=>super.listBuckets)().call(this,e)}async deleteBucket(e){return(()=>super.deleteBucket)().call(this,e)}},If=class extends _f{constructor(e,t,r,n){super(e,t,n),this.vectorBucketName=r}async createIndex(e){return(()=>super.createIndex)().call(this,Gd(Gd({},e),{},{vectorBucketName:this.vectorBucketName}))}async listIndexes(e={}){return(()=>super.listIndexes)().call(this,Gd(Gd({},e),{},{vectorBucketName:this.vectorBucketName}))}async getIndex(e){return(()=>super.getIndex)().call(this,this.vectorBucketName,e)}async deleteIndex(e){return(()=>super.deleteIndex)().call(this,this.vectorBucketName,e)}index(e){return new kf(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},kf=class extends Ef{constructor(e,t,r,n,s){super(e,t,s),this.vectorBucketName=r,this.indexName=n}async putVectors(e){var t=this;return(()=>super.putVectors)().call(t,Gd(Gd({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async getVectors(e){var t=this;return(()=>super.getVectors)().call(t,Gd(Gd({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async listVectors(e={}){var t=this;return(()=>super.listVectors)().call(t,Gd(Gd({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async queryVectors(e){var t=this;return(()=>super.queryVectors)().call(t,Gd(Gd({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async deleteVectors(e){var t=this;return(()=>super.deleteVectors)().call(t,Gd(Gd({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}},Cf=class extends lf{constructor(e,t={},r,n){super(e,t,r,n)}from(e){return new af(this.url,this.headers,e,this.fetch)}get vectors(){return new Sf(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new hf(this.url+"/iceberg",this.headers,this.fetch)}};const Af="2.90.0",Of=3e4,Rf={"X-Client-Info":`gotrue-js/${Af}`},Pf="X-Supabase-Api-Version",Nf=Date.parse("2024-01-01T00:00:00.0Z"),xf="2024-01-01",Df=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class Lf extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function jf(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Uf extends Lf{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}class Mf extends Lf{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class $f extends Lf{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class Ff extends $f{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Vf extends $f{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Bf extends $f{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class qf extends $f{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class zf extends $f{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Kf extends $f{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Hf extends $f{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Wf(e){return jf(e)&&"AuthRetryableFetchError"===e.name}class Gf extends $f{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Jf extends $f{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Yf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Qf=" \t\n\r=".split(""),Xf=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Qf.length;t+=1)e[Qf[t].charCodeAt(0)]=-2;for(let t=0;t<Yf.length;t+=1)e[Yf[t].charCodeAt(0)]=t;return e})();function Zf(e,t,r){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(Yf[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(Yf[e]),t.queuedBits-=6}}function ep(e,t,r){const n=Xf[e];if(!(n>-1)){if(-2===n)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function tp(e){const t=[],r=e=>{t.push(String.fromCodePoint(e))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=e=>{!function(e,t,r){if(0===t.utf8seq){if(e<=127)return void r(e);for(let r=1;r<6;r+=1)if(!(e>>7-r&1)){t.utf8seq=r;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&r(t.codepoint)}}(e,n,r)};for(let t=0;t<e.length;t+=1)ep(e.charCodeAt(t),s,i);return t.join("")}function rp(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function np(e){const t=[],r={queue:0,queuedBits:0},n=e=>{t.push(e)};for(let t=0;t<e.length;t+=1)ep(e.charCodeAt(t),r,n);return new Uint8Array(t)}function sp(e){const t=[],r={queue:0,queuedBits:0},n=e=>{t.push(e)};return e.forEach(e=>Zf(e,r,n)),Zf(null,r,n),t.join("")}const ip=()=>"undefined"!=typeof window&&"undefined"!=typeof document,op={tested:!1,writable:!1},ap=()=>{if(!ip())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(op.tested)return op.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),op.tested=!0,op.writable=!0}catch(e){op.tested=!0,op.writable=!1}return op.writable},cp=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),up=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},lp=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(e){return r}},hp=async(e,t)=>{await e.removeItem(t)};class dp{constructor(){this.promise=new dp.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function fp(e){const t=e.split(".");if(3!==t.length)throw new Jf("Invalid JWT structure");for(let e=0;e<t.length;e++)if(!Df.test(t[e]))throw new Jf("JWT not in base64url format");return{header:JSON.parse(tp(t[0])),payload:JSON.parse(tp(t[1])),signature:np(t[2]),raw:{header:t[0],payload:t[1]}}}function pp(e){return("0"+e.toString(16)).substr(-2)}async function gp(e,t,r=!1){const n=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let r="";for(let n=0;n<56;n++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,pp).join("")}();let s=n;r&&(s+="/PASSWORD_RECOVERY"),await up(e,`${t}-code-verifier`,s);const i=await async function(e){if("undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder)return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(n);return[i,n===i?"plain":"s256"]}dp.promiseConstructor=Promise;const mp=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,yp=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function vp(e){if(!yp.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function wp(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function bp(e){return JSON.parse(JSON.stringify(e))}const _p=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Ep=[502,503,504];async function Tp(e){var t,r;if(!("object"==typeof(r=e)&&null!==r&&"status"in r&&"ok"in r&&"json"in r&&"function"==typeof r.json))throw new Hf(_p(e),0);if(Ep.includes(e.status))throw new Hf(_p(e),e.status);let n,s;try{n=await e.json()}catch(e){throw new Mf(_p(e),e)}const i=function(e){const t=e.headers.get(Pf);if(!t)return null;if(!t.match(mp))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(e){return null}}(e);if(i&&i.getTime()>=Nf&&"object"==typeof n&&n&&"string"==typeof n.code?s=n.code:"object"==typeof n&&n&&"string"==typeof n.error_code&&(s=n.error_code),s){if("weak_password"===s)throw new Gf(_p(n),e.status,(null===(t=n.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===s)throw new Ff}else if("object"==typeof n&&n&&"object"==typeof n.weak_password&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new Gf(_p(n),e.status,n.weak_password.reasons);throw new Uf(_p(n),e.status||500,s)}async function Sp(e,t,r,n){var s;const i=Object.assign({},null==n?void 0:n.headers);i[Pf]||(i[Pf]=xf),(null==n?void 0:n.jwt)&&(i.Authorization=`Bearer ${n.jwt}`);const o=null!==(s=null==n?void 0:n.query)&&void 0!==s?s:{};(null==n?void 0:n.redirectTo)&&(o.redirect_to=n.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await async function(e,t,r,n,s,i){const o=((e,t,r,n)=>{const s={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))})(t,n,{},i);let a;try{a=await e(r,Object.assign({},o))}catch(e){throw console.error(e),new Hf(_p(e),0)}if(a.ok||await Tp(a),null==n?void 0:n.noResolveJson)return a;try{return await a.json()}catch(e){await Tp(e)}}(e,t,r+a,{headers:i,noResolveJson:null==n?void 0:n.noResolveJson},0,null==n?void 0:n.body);return(null==n?void 0:n.xform)?null==n?void 0:n.xform(c):{data:Object.assign({},c),error:null}}function Ip(e){var t;let r=null;var n;return function(e){return e.access_token&&e.refresh_token&&e.expires_in}(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=(n=e.expires_in,Math.round(Date.now()/1e3)+n))),{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function kp(e){const t=Ip(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function Cp(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Ap(e){return{data:e,error:null}}function Op(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:i}=e,o=ot(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:i},user:Object.assign({},o)},error:null}}function Rp(e){return e}const Pp=["global","local","others"];class Np{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=cp(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Pp[0]){if(Pp.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Pp.join(", ")}`);try{return await Sp(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(e){if(jf(e))return{data:null,error:e};throw e}}async inviteUserByEmail(e,t={}){try{return await Sp(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Cp})}catch(e){if(jf(e))return{data:{user:null},error:e};throw e}}async generateLink(e){try{const{options:t}=e,r=ot(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=null==r?void 0:r.newEmail,delete n.newEmail),await Sp(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Op,redirectTo:null==t?void 0:t.redirectTo})}catch(e){if(jf(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(e){try{return await Sp(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Cp})}catch(e){if(jf(e))return{data:{user:null},error:e};throw e}}async listUsers(e){var t,r,n,s,i,o,a;try{const c={nextPage:null,lastPage:0,total:0},u=await Sp(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(s=null===(n=null==e?void 0:e.perPage)||void 0===n?void 0:n.toString())&&void 0!==s?s:""},xform:Rp});if(u.error)throw u.error;const l=await u.json(),h=null!==(i=u.headers.get("x-total-count"))&&void 0!==i?i:0,d=null!==(a=null===(o=u.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);c[`${r}Page`]=t}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},l),c),error:null}}catch(e){if(jf(e))return{data:{users:[]},error:e};throw e}}async getUserById(e){vp(e);try{return await Sp(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Cp})}catch(e){if(jf(e))return{data:{user:null},error:e};throw e}}async updateUserById(e,t){vp(e);try{return await Sp(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Cp})}catch(e){if(jf(e))return{data:{user:null},error:e};throw e}}async deleteUser(e,t=!1){vp(e);try{return await Sp(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Cp})}catch(e){if(jf(e))return{data:{user:null},error:e};throw e}}async _listFactors(e){vp(e.userId);try{const{data:t,error:r}=await Sp(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(e){if(jf(e))return{data:null,error:e};throw e}}async _deleteFactor(e){vp(e.userId),vp(e.id);try{return{data:await Sp(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(e){if(jf(e))return{data:null,error:e};throw e}}async _listOAuthClients(e){var t,r,n,s,i,o,a;try{const c={nextPage:null,lastPage:0,total:0},u=await Sp(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(s=null===(n=null==e?void 0:e.perPage)||void 0===n?void 0:n.toString())&&void 0!==s?s:""},xform:Rp});if(u.error)throw u.error;const l=await u.json(),h=null!==(i=u.headers.get("x-total-count"))&&void 0!==i?i:0,d=null!==(a=null===(o=u.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);c[`${r}Page`]=t}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},l),c),error:null}}catch(e){if(jf(e))return{data:{clients:[]},error:e};throw e}}async _createOAuthClient(e){try{return await Sp(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(jf(e))return{data:null,error:e};throw e}}async _getOAuthClient(e){try{return await Sp(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(jf(e))return{data:null,error:e};throw e}}async _updateOAuthClient(e,t){try{return await Sp(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(jf(e))return{data:null,error:e};throw e}}async _deleteOAuthClient(e){try{return await Sp(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(jf(e))return{data:null,error:e};throw e}}async _regenerateOAuthClientSecret(e){try{return await Sp(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(jf(e))return{data:null,error:e};throw e}}}function xp(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const Dp=!!(globalThis&&ap()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Lp extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class jp extends Lp{}async function Up(e,t,r){Dp&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),Dp&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async n=>{if(!n){if(0===t)throw Dp&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new jp(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Dp)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(e){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",e)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}Dp&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,n.name);try{return await r()}finally{Dp&&console.log("@supabase/gotrue-js: navigatorLock: released",e,n.name)}}))}function Mp(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function $p(e){const t=(new TextEncoder).encode(e);return"0x"+Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}class Fp extends Error{constructor({message:e,code:t,cause:r,name:n}){var s;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=null!==(s=null!=n?n:r instanceof Error?r.name:void 0)&&void 0!==s?s:"Unknown Error",this.code=t}}class Vp extends Fp{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Bp({error:e,options:t}){var r,n,s;const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new Fp({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("ConstraintError"===e.name){if(!0===(null===(r=i.authenticatorSelection)||void 0===r?void 0:r.requireResidentKey))return new Fp({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if("conditional"===t.mediation&&"required"===(null===(n=i.authenticatorSelection)||void 0===n?void 0:n.userVerification))return new Fp({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if("required"===(null===(s=i.authenticatorSelection)||void 0===s?void 0:s.userVerification))return new Fp({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if("InvalidStateError"===e.name)return new Fp({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if("NotAllowedError"===e.name)return new Fp({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("NotSupportedError"===e.name)return 0===i.pubKeyCredParams.filter(e=>"public-key"===e.type).length?new Fp({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Fp({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if("SecurityError"===e.name){const t=window.location.hostname;if(!Jp(t))return new Fp({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(i.rp.id!==t)return new Fp({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("TypeError"===e.name){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Fp({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if("UnknownError"===e.name)return new Fp({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Fp({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function qp({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new Fp({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if("NotAllowedError"===e.name)return new Fp({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("SecurityError"===e.name){const t=window.location.hostname;if(!Jp(t))return new Fp({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(r.rpId!==t)return new Fp({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("UnknownError"===e.name)return new Fp({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Fp({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}const zp=new class{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};function Kp(e){if(!e)throw new Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:n}=e,s=ot(e,["challenge","user","excludeCredentials"]),i=np(t).buffer,o=Object.assign(Object.assign({},r),{id:np(r.id).buffer}),a=Object.assign(Object.assign({},s),{challenge:i,user:o});if(n&&n.length>0){a.excludeCredentials=new Array(n.length);for(let e=0;e<n.length;e++){const t=n[e];a.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:np(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return a}function Hp(e){if(!e)throw new Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,n=ot(e,["challenge","allowCredentials"]),s=np(t).buffer,i=Object.assign(Object.assign({},n),{challenge:s});if(r&&r.length>0){i.allowCredentials=new Array(r.length);for(let e=0;e<r.length;e++){const t=r[e];i.allowCredentials[e]=Object.assign(Object.assign({},t),{id:np(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return i}function Wp(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:sp(new Uint8Array(e.response.attestationObject)),clientDataJSON:sp(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:null!==(t=r.authenticatorAttachment)&&void 0!==t?t:void 0}}function Gp(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const r=e,n=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:sp(new Uint8Array(s.authenticatorData)),clientDataJSON:sp(new Uint8Array(s.clientDataJSON)),signature:sp(new Uint8Array(s.signature)),userHandle:s.userHandle?sp(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:null!==(t=r.authenticatorAttachment)&&void 0!==t?t:void 0}}function Jp(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function Yp(){var e,t;return!!(ip()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.create)&&"function"==typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.get))}const Qp={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},Xp={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Zp(...e){const t=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),r=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),n={};for(const s of e)if(s)for(const e in s){const i=s[e];if(void 0!==i)if(Array.isArray(i))n[e]=i;else if(r(i))n[e]=i;else if(t(i)){const r=n[e];t(r)?n[e]=Zp(r,i):n[e]=Zp(i)}else n[e]=i}return n}class eg{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:r,signal:n},s){try{const{data:i,error:o}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!i)return{data:null,error:o};const a=null!=n?n:zp.createNewAbortSignal();if("create"===i.webauthn.type){const{user:e}=i.webauthn.credential_options.publicKey;e.name||(e.name=`${e.id}:${r}`),e.displayName||(e.displayName=e.name)}switch(i.webauthn.type){case"create":{const t=function(e,t){return Zp(Qp,e,t||{})}(i.webauthn.credential_options.publicKey,null==s?void 0:s.create),{data:r,error:n}=await async function(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Vp("Browser returned unexpected credential type",t)}:{data:null,error:new Vp("Empty credential response",t)}}catch(t){return{data:null,error:Bp({error:t,options:e})}}}({publicKey:t,signal:a});return r?{data:{factorId:e,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:r}},error:null}:{data:null,error:n}}case"request":{const t=function(e,t){return Zp(Xp,e,t||{})}(i.webauthn.credential_options.publicKey,null==s?void 0:s.request),{data:r,error:n}=await async function(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Vp("Browser returned unexpected credential type",t)}:{data:null,error:new Vp("Empty credential response",t)}}catch(t){return{data:null,error:qp({error:t,options:e})}}}(Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:t,signal:a}));return r?{data:{factorId:e,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:r}},error:null}:{data:null,error:n}}}}catch(e){return jf(e)?{data:null,error:e}:{data:null,error:new Mf("Unexpected error in challenge",e)}}}async _verify({challengeId:e,factorId:t,webauthn:r}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:r=("undefined"!=typeof window?[window.location.origin]:void 0),signal:n}={}},s){if(!t)return{data:null,error:new Lf("rpId is required for WebAuthn authentication")};try{if(!Yp())return{data:null,error:new Mf("Browser does not support WebAuthn",null)};const{data:i,error:o}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:r},signal:n},{request:s});if(!i)return{data:null,error:o};const{webauthn:a}=i;return this._verify({factorId:e,challengeId:i.challengeId,webauthn:{type:a.type,rpId:t,rpOrigins:r,credential_response:a.credential_response}})}catch(e){return jf(e)?{data:null,error:e}:{data:null,error:new Mf("Unexpected error in authenticate",e)}}}async _register({friendlyName:e,webauthn:{rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:r=("undefined"!=typeof window?[window.location.origin]:void 0),signal:n}={}},s){if(!t)return{data:null,error:new Lf("rpId is required for WebAuthn registration")};try{if(!Yp())return{data:null,error:new Mf("Browser does not support WebAuthn",null)};const{data:i,error:o}=await this._enroll({friendlyName:e});if(!i)return await this.client.mfa.listFactors().then(t=>{var r;return null===(r=t.data)||void 0===r?void 0:r.all.find(t=>"webauthn"===t.factor_type&&t.friendly_name===e&&"unverified"!==t.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null==e?void 0:e.id}):void 0),{data:null,error:o};const{data:a,error:c}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:t,rpOrigins:r},signal:n},{create:s});return a?this._verify({factorId:i.id,challengeId:a.challengeId,webauthn:{rpId:t,rpOrigins:r,type:a.webauthn.type,credential_response:a.webauthn.credential_response}}):{data:null,error:c}}catch(e){return jf(e)?{data:null,error:e}:{data:null,error:new Mf("Unexpected error in register",e)}}}}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const tg={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Rf,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function rg(e,t,r){return await r()}const ng={};class sg{get jwks(){var e,t;return null!==(t=null===(e=ng[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){ng[this.storageKey]=Object.assign(Object.assign({},ng[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=ng[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){ng[this.storageKey]=Object.assign(Object.assign({},ng[this.storageKey]),{cachedAt:e})}constructor(e){var t,r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const s=Object.assign(Object.assign({},tg),e);if(this.storageKey=s.storageKey,this.instanceID=null!==(t=sg.nextInstanceID[this.storageKey])&&void 0!==t?t:0,sg.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.instanceID>0&&ip()){const e=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(e),this.logDebugMessages&&console.trace(e)}if(this.persistSession=s.persistSession,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Np({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=cp(s.fetch),this.lock=s.lock||rg,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,this.throwOnError=s.throwOnError,this.lockAcquireTimeout=s.lockAcquireTimeout,s.lock?this.lock=s.lock:this.persistSession&&ip()&&(null===(r=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===r?void 0:r.locks)?this.lock=Up:this.lock=rg,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new eg(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:ap()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=xp(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=xp(this.memoryStorage)),ip()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(e){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",e)}null===(n=this.broadcastChannel)||void 0===n||n.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Af}) ${(new Date).toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t={},r="none";if(ip()&&(t=function(e){const t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((e,r)=>{t[r]=e})}catch(e){}return r.searchParams.forEach((e,r)=>{t[r]=e}),t}(window.location.href),this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce")),ip()&&this.detectSessionInUrl&&"none"!==r){const{data:n,error:s}=await this._getSessionFromURL(t,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),function(e){return jf(e)&&"AuthImplicitGrantRedirectError"===e.name}(s)){const t=null===(e=s.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:s}}return{error:s}}const{session:i,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",i,"redirect type",o),await this._saveSession(i),setTimeout(async()=>{"recovery"===o?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return jf(e)?this._returnResult({error:e}):this._returnResult({error:new Mf("Unexpected error during initialization",e)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,n;try{const s=await Sp(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(r=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==r?r:{},gotrue_meta_security:{captcha_token:null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.captchaToken}},xform:Ip}),{data:i,error:o}=s;if(o||!i)return this._returnResult({data:{user:null,session:null},error:o});const a=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),this._returnResult({data:{user:c,session:a},error:null})}catch(e){if(jf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signUp(e){var t,r,n;try{let s;if("email"in e){const{email:r,password:n,options:i}=e;let o=null,a=null;"pkce"===this.flowType&&([o,a]=await gp(this.storage,this.storageKey)),s=await Sp(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:r,password:n,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:o,code_challenge_method:a},xform:Ip})}else{if(!("phone"in e))throw new Bf("You must provide either an email or phone number and a password");{const{phone:t,password:i,options:o}=e;s=await Sp(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!==(r=null==o?void 0:o.data)&&void 0!==r?r:{},channel:null!==(n=null==o?void 0:o.channel)&&void 0!==n?n:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:Ip})}}const{data:i,error:o}=s;if(o||!i)return await hp(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:o});const a=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),this._returnResult({data:{user:c,session:a},error:null})}catch(e){if(await hp(this.storage,`${this.storageKey}-code-verifier`),jf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:n,options:s}=e;t=await Sp(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},xform:kp})}else{if(!("phone"in e))throw new Bf("You must provide either an email or phone number and a password");{const{phone:r,password:n,options:s}=e;t=await Sp(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},xform:kp})}}const{data:r,error:n}=t;if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!r||!r.session||!r.user){const e=new Vf;return this._returnResult({data:{user:null,session:null},error:e})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(e){if(jf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOAuth(e){var t,r,n,s;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:null===(s=e.options)||void 0===s?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,r,n,s,i,o,a,c,u,l,h;let d,f;if("message"in e)d=e.message,f=e.signature;else{const{chain:l,wallet:h,statement:p,options:g}=e;let m;if(ip())if("object"==typeof h)m=h;else{const e=window;if(!("ethereum"in e)||"object"!=typeof e.ethereum||!("request"in e.ethereum)||"function"!=typeof e.ethereum.request)throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.");m=e.ethereum}else{if("object"!=typeof h||!(null==g?void 0:g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");m=h}const y=new URL(null!==(t=null==g?void 0:g.url)&&void 0!==t?t:window.location.href),v=await m.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!v||0===v.length)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const w=Mp(v[0]);let b=null===(r=null==g?void 0:g.signInWithEthereum)||void 0===r?void 0:r.chainId;if(!b){const e=await m.request({method:"eth_chainId"});b=parseInt(e,16)}d=function(e){var t;const{chainId:r,domain:n,expirationTime:s,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:c,resources:u,scheme:l,uri:h,version:d}=e;if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==d)throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${d}`);if(null===(t=e.statement)||void 0===t?void 0:t.includes("\n"))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`);const f=`${l?`${l}://${n}`:n} wants you to sign in with your Ethereum account:\n${Mp(e.address)}\n\n${e.statement?`${e.statement}\n`:""}`;let p=`URI: ${h}\nVersion: ${d}\nChain ID: ${r}${o?`\nNonce: ${o}`:""}\nIssued At: ${i.toISOString()}`;if(s&&(p+=`\nExpiration Time: ${s.toISOString()}`),a&&(p+=`\nNot Before: ${a.toISOString()}`),c&&(p+=`\nRequest ID: ${c}`),u){let e="\nResources:";for(const t of u){if(!t||"string"!=typeof t)throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${t}`);e+=`\n- ${t}`}p+=e}return`${f}\n${p}`}({domain:y.host,address:w,statement:p,uri:y.href,version:"1",chainId:b,nonce:null===(n=null==g?void 0:g.signInWithEthereum)||void 0===n?void 0:n.nonce,issuedAt:null!==(i=null===(s=null==g?void 0:g.signInWithEthereum)||void 0===s?void 0:s.issuedAt)&&void 0!==i?i:new Date,expirationTime:null===(o=null==g?void 0:g.signInWithEthereum)||void 0===o?void 0:o.expirationTime,notBefore:null===(a=null==g?void 0:g.signInWithEthereum)||void 0===a?void 0:a.notBefore,requestId:null===(c=null==g?void 0:g.signInWithEthereum)||void 0===c?void 0:c.requestId,resources:null===(u=null==g?void 0:g.signInWithEthereum)||void 0===u?void 0:u.resources}),f=await m.request({method:"personal_sign",params:[$p(d),w]})}try{const{data:t,error:r}=await Sp(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:d,signature:f},(null===(l=e.options)||void 0===l?void 0:l.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:Ip});if(r)throw r;if(!t||!t.session||!t.user){const e=new Vf;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:r})}catch(e){if(jf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithSolana(e){var t,r,n,s,i,o,a,c,u,l,h,d;let f,p;if("message"in e)f=e.message,p=e.signature;else{const{chain:h,wallet:d,statement:g,options:m}=e;let y;if(ip())if("object"==typeof d)y=d;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");y=e.solana}else{if("object"!=typeof d||!(null==m?void 0:m.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=d}const v=new URL(null!==(t=null==m?void 0:m.url)&&void 0!==t?t:window.location.href);if("signIn"in y&&y.signIn){const e=await y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==m?void 0:m.signInWithSolana),{version:"1",domain:v.host,uri:v.href}),g?{statement:g}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");f="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in y&&"function"==typeof y.signMessage&&"publicKey"in y&&"object"==typeof y&&y.publicKey&&"toBase58"in y.publicKey&&"function"==typeof y.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${v.host} wants you to sign in with your Solana account:`,y.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${v.href}`,`Issued At: ${null!==(n=null===(r=null==m?void 0:m.signInWithSolana)||void 0===r?void 0:r.issuedAt)&&void 0!==n?n:(new Date).toISOString()}`,...(null===(s=null==m?void 0:m.signInWithSolana)||void 0===s?void 0:s.notBefore)?[`Not Before: ${m.signInWithSolana.notBefore}`]:[],...(null===(i=null==m?void 0:m.signInWithSolana)||void 0===i?void 0:i.expirationTime)?[`Expiration Time: ${m.signInWithSolana.expirationTime}`]:[],...(null===(o=null==m?void 0:m.signInWithSolana)||void 0===o?void 0:o.chainId)?[`Chain ID: ${m.signInWithSolana.chainId}`]:[],...(null===(a=null==m?void 0:m.signInWithSolana)||void 0===a?void 0:a.nonce)?[`Nonce: ${m.signInWithSolana.nonce}`]:[],...(null===(c=null==m?void 0:m.signInWithSolana)||void 0===c?void 0:c.requestId)?[`Request ID: ${m.signInWithSolana.requestId}`]:[],...(null===(l=null===(u=null==m?void 0:m.signInWithSolana)||void 0===u?void 0:u.resources)||void 0===l?void 0:l.length)?["Resources",...m.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=await y.signMessage((new TextEncoder).encode(f),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:r}=await Sp(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:sp(p)},(null===(h=e.options)||void 0===h?void 0:h.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=e.options)||void 0===d?void 0:d.captchaToken}}:null),xform:Ip});if(r)throw r;if(!t||!t.session||!t.user){const e=new Vf;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:r})}catch(e){if(jf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _exchangeCodeForSession(e){const t=await lp(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(null!=t?t:"").split("/");try{if(!r&&"pkce"===this.flowType)throw new Kf;const{data:t,error:s}=await Sp(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Ip});if(await hp(this.storage,`${this.storageKey}-code-verifier`),s)throw s;if(!t||!t.session||!t.user){const e=new Vf;return this._returnResult({data:{user:null,session:null,redirectType:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign(Object.assign({},t),{redirectType:null!=n?n:null}),error:s})}catch(e){if(await hp(this.storage,`${this.storageKey}-code-verifier`),jf(e))return this._returnResult({data:{user:null,session:null,redirectType:null},error:e});throw e}}async signInWithIdToken(e){try{const{options:t,provider:r,token:n,access_token:s,nonce:i}=e,o=await Sp(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:s,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:Ip}),{data:a,error:c}=o;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!a||!a.session||!a.user){const e=new Vf;return this._returnResult({data:{user:null,session:null},error:e})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:a,error:c})}catch(e){if(jf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOtp(e){var t,r,n,s,i;try{if("email"in e){const{email:n,options:s}=e;let i=null,o=null;"pkce"===this.flowType&&([i,o]=await gp(this.storage,this.storageKey));const{error:a}=await Sp(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:n,data:null!==(t=null==s?void 0:s.data)&&void 0!==t?t:{},create_user:null===(r=null==s?void 0:s.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},code_challenge:i,code_challenge_method:o},redirectTo:null==s?void 0:s.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:a})}if("phone"in e){const{phone:t,options:r}=e,{data:o,error:a}=await Sp(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(n=null==r?void 0:r.data)&&void 0!==n?n:{},create_user:null===(s=null==r?void 0:r.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(i=null==r?void 0:r.channel)&&void 0!==i?i:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a})}throw new Bf("You must provide either an email or phone number.")}catch(e){if(await hp(this.storage,`${this.storageKey}-code-verifier`),jf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async verifyOtp(e){var t,r;try{let n,s;"options"in e&&(n=null===(t=e.options)||void 0===t?void 0:t.redirectTo,s=null===(r=e.options)||void 0===r?void 0:r.captchaToken);const{data:i,error:o}=await Sp(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:n,xform:Ip});if(o)throw o;if(!i)throw new Error("An error occurred on token verification.");const a=i.session,c=i.user;return(null==a?void 0:a.access_token)&&(await this._saveSession(a),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),this._returnResult({data:{user:c,session:a},error:null})}catch(e){if(jf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithSSO(e){var t,r,n,s,i;try{let o=null,a=null;"pkce"===this.flowType&&([o,a]=await gp(this.storage,this.storageKey));const c=await Sp(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:a}),headers:this.headers,xform:Ap});return(null===(s=c.data)||void 0===s?void 0:s.url)&&ip()&&!(null===(i=e.options)||void 0===i?void 0:i.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(e){if(await hp(this.storage,`${this.storageKey}-code-verifier`),jf(e))return this._returnResult({data:null,error:e});throw e}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Ff;const{error:n}=await Sp(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:n})})}catch(e){if(jf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:s}=e,{error:i}=await Sp(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},redirectTo:null==s?void 0:s.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:i})}if("phone"in e){const{phone:r,type:n,options:s}=e,{data:i,error:o}=await Sp(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o})}throw new Bf("You must provide either an email or phone number and a type")}catch(e){if(jf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(e){}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(e){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await lp(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=!!e.expires_at&&1e3*e.expires_at-Date.now()<9e4;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const t=await lp(this.userStorage,this.storageKey+"-user");(null==t?void 0:t.user)?e.user=t.user:e.user=wp()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const t={value:this.suppressGetSessionWarning};e.user=function(e,t){return new Proxy(e,{get:(e,r,n)=>{if("__isInsecureUserWarningProxy"===r)return!0;if("symbol"==typeof r){const t=r.toString();if("Symbol(Symbol.toPrimitive)"===t||"Symbol(Symbol.toStringTag)"===t||"Symbol(util.inspect.custom)"===t||"Symbol(nodejs.util.inspect.custom)"===t)return Reflect.get(e,r,n)}return t.value||"string"!=typeof r||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(e,r,n)}})}(e.user,t),t.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:n,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{session:null},error:s}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await Sp(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Cp}):await this._useSession(async e=>{var t,r,n;const{data:s,error:i}=e;if(i)throw i;return(null===(t=s.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Sp(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(n=null===(r=s.session)||void 0===r?void 0:r.access_token)&&void 0!==n?n:void 0,xform:Cp}):{data:{user:null},error:new Ff}})}catch(e){if(jf(e))return function(e){return jf(e)&&"AuthSessionMissingError"===e.name}(e)&&(await this._removeSession(),await hp(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:e});throw e}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:n,error:s}=r;if(s)throw s;if(!n.session)throw new Ff;const i=n.session;let o=null,a=null;"pkce"===this.flowType&&null!=e.email&&([o,a]=await gp(this.storage,this.storageKey));const{data:c,error:u}=await Sp(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:a}),jwt:i.access_token,xform:Cp});if(u)throw u;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),this._returnResult({data:{user:i.user},error:null})})}catch(e){if(await hp(this.storage,`${this.storageKey}-code-verifier`),jf(e))return this._returnResult({data:{user:null},error:e});throw e}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ff;const t=Date.now()/1e3;let r=t,n=!0,s=null;const{payload:i}=fp(e.access_token);if(i.exp&&(r=i.exp,n=r<=t),n){const{data:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!t)return{data:{user:null,session:null},error:null};s=t}else{const{data:n,error:i}=await this._getUser(e.access_token);if(i)throw i;s={access_token:e.access_token,refresh_token:e.refresh_token,user:n.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return this._returnResult({data:{user:s.user,session:s},error:null})}catch(e){if(jf(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:n,error:s}=t;if(s)throw s;e=null!==(r=n.session)&&void 0!==r?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new Ff;const{data:n,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{user:null,session:null},error:s}):n?this._returnResult({data:{user:n.user,session:n},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(e){if(jf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _getSessionFromURL(e,t){try{if(!ip())throw new qf("No browser detected.");if(e.error||e.error_description||e.error_code)throw new qf(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new zf("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new qf("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new zf("No code detected.");const{data:t,error:r}=await this._exchangeCodeForSession(e.code);if(r)throw r;const n=new URL(window.location.href);return n.searchParams.delete("code"),window.history.replaceState(window.history.state,"",n.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:s,refresh_token:i,expires_in:o,expires_at:a,token_type:c}=e;if(!(s&&o&&i&&c))throw new qf("No session defined in URL");const u=Math.round(Date.now()/1e3),l=parseInt(o);let h=u+l;a&&(h=parseInt(a));const d=h-u;1e3*d<=Of&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${l}s`);const f=h-l;u-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,h,u):u-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,h,u);const{data:p,error:g}=await this._getUser(s);if(g)throw g;const m={provider_token:r,provider_refresh_token:n,access_token:s,expires_in:l,expires_at:h,refresh_token:i,token_type:c,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:m,redirectType:e.type},error:null})}catch(e){if(jf(e))return this._returnResult({data:{session:null,redirectType:null},error:e});throw e}}_isImplicitGrantCallback(e){return"function"==typeof this.detectSessionInUrl?this.detectSessionInUrl(new URL(window.location.href),e):Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await lp(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:n,error:s}=t;if(s)return this._returnResult({error:s});const i=null===(r=n.session)||void 0===r?void 0:r.access_token;if(i){const{error:t}=await this.admin.signOut(i,e);if(t&&(!function(e){return jf(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return this._returnResult({error:t})}return"others"!==e&&(await this._removeSession(),await hp(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=Symbol("auth-callback"),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,n;try{const{data:{session:n},error:s}=t;if(s)throw s;await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(t){await(null===(n=this.stateChangeEmitters.get(e))||void 0===n?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",t),console.error(t)}})}async resetPasswordForEmail(e,t={}){let r=null,n=null;"pkce"===this.flowType&&([r,n]=await gp(this.storage,this.storageKey,!0));try{return await Sp(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(e){if(await hp(this.storage,`${this.storageKey}-code-verifier`),jf(e))return this._returnResult({data:null,error:e});throw e}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null})}catch(e){if(jf(e))return this._returnResult({data:null,error:e});throw e}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:r,error:n}=await this._useSession(async t=>{var r,n,s,i,o;const{data:a,error:c}=t;if(c)throw c;const u=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(r=e.options)||void 0===r?void 0:r.redirectTo,scopes:null===(n=e.options)||void 0===n?void 0:n.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:!0});return await Sp(this.fetch,"GET",u,{headers:this.headers,jwt:null!==(o=null===(i=a.session)||void 0===i?void 0:i.access_token)&&void 0!==o?o:void 0})});if(n)throw n;return ip()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==r?void 0:r.url),this._returnResult({data:{provider:e.provider,url:null==r?void 0:r.url},error:null})}catch(t){if(jf(t))return this._returnResult({data:{provider:e.provider,url:null},error:t});throw t}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var r;try{const{error:n,data:{session:s}}=t;if(n)throw n;const{options:i,provider:o,token:a,access_token:c,nonce:u}=e,l=await Sp(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!==(r=null==s?void 0:s.access_token)&&void 0!==r?r:void 0,body:{provider:o,id_token:a,access_token:c,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:Ip}),{data:h,error:d}=l;return d?this._returnResult({data:{user:null,session:null},error:d}):h&&h.session&&h.user?(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:d})):this._returnResult({data:{user:null,session:null},error:new Vf})}catch(e){if(await hp(this.storage,`${this.storageKey}-code-verifier`),jf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,n;const{data:s,error:i}=t;if(i)throw i;return await Sp(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(n=null===(r=s.session)||void 0===r?void 0:r.access_token)&&void 0!==n?n:void 0})})}catch(e){if(jf(e))return this._returnResult({data:null,error:e});throw e}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await(r=async r=>(r>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await Sp(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ip})),n=(e,t)=>{const r=200*Math.pow(2,e);return t&&Wf(t)&&Date.now()+r-s<Of},new Promise((e,t)=>{(async()=>{for(let s=0;s<1/0;s++)try{const t=await r(s);if(!n(s,null))return void e(t)}catch(e){if(!n(s,e))return void t(e)}})()}))}catch(e){if(this._debug(t,"error",e),jf(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}finally{this._debug(t,"end")}var r,n}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),ip()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=await lp(this.storage,this.storageKey);if(n&&this.userStorage){let t=await lp(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:n.user},await up(this.userStorage,this.storageKey+"-user",t)),n.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:wp()}else if(n&&!n.user&&!n.user){const e=await lp(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(n.user=e.user,await hp(this.storage,this.storageKey+"-user"),await up(this.storage,this.storageKey,n)):n.user=wp()}if(this._debug(r,"session from storage",n),!this._isValidSession(n))return this._debug(r,"session is not valid"),void(null!==n&&await this._removeSession());const s=1e3*(null!==(t=n.expires_at)&&void 0!==t?t:1/0)-Date.now()<9e4;if(this._debug(r,`session has${s?"":" not"} expired with margin of 90000s`),s){if(this.autoRefreshToken&&n.refresh_token){const{error:e}=await this._callRefreshToken(n.refresh_token);e&&(console.error(e),Wf(e)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(n.user&&!0===n.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(n.access_token);!t&&(null==e?void 0:e.user)?(n.user=e.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(e){console.error("Error getting user data:",e),this._debug(r,"error getting user data, skipping SIGNED_IN notification",e)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(e){return this._debug(r,"error",e),void console.error(e)}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Ff;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new dp;const{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new Ff;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const n={data:t.session,error:null};return this.refreshingDeferred.resolve(n),n}catch(e){if(this._debug(n,"error",e),jf(e)){const r={data:null,error:e};return Wf(e)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(r),r}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(e),e}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,r=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],s=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(e){n.push(e)}});if(await Promise.all(s),n.length>0){for(let e=0;e<n.length;e+=1)console.error(n[e]);throw n[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await hp(this.storage,`${this.storageKey}-code-verifier`);const t=Object.assign({},e),r=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!r&&t.user&&await up(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const n=bp(e);await up(this.storage,this.storageKey,n)}else{const e=bp(t);await up(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await hp(this.storage,this.storageKey),await hp(this.storage,this.storageKey+"-code-verifier"),await hp(this.storage,this.storageKey+"-user"),this.userStorage&&await hp(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ip()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Of);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e);const t=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const t=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,t&&clearTimeout(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const n=Math.floor((1e3*r.expires_at-e)/Of);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),n<=3&&await this._callRefreshToken(r.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(!(e.isAcquireTimeout||e instanceof Lp))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ip()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const n=[`provider=${encodeURIComponent(t)}`];if((null==r?void 0:r.redirectTo)&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),(null==r?void 0:r.scopes)&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),"pkce"===this.flowType){const[e,t]=await gp(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});n.push(r.toString())}if(null==r?void 0:r.queryParams){const e=new URLSearchParams(r.queryParams);n.push(e.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:n,error:s}=t;return s?this._returnResult({data:null,error:s}):await Sp(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token})})}catch(e){if(jf(e))return this._returnResult({data:null,error:e});throw e}}async _enroll(e){try{return await this._useSession(async t=>{var r,n;const{data:s,error:i}=t;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:a,error:c}=await Sp(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});return c?this._returnResult({data:null,error:c}):("totp"===e.factorType&&"totp"===a.type&&(null===(n=null==a?void 0:a.totp)||void 0===n?void 0:n.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),this._returnResult({data:a,error:null}))})}catch(e){if(jf(e))return this._returnResult({data:null,error:e});throw e}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:s}=t;if(s)return this._returnResult({data:null,error:s});const i=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?Wp(e.webauthn.credential_response):Gp(e.webauthn.credential_response)})}:{code:e.code}),{data:o,error:a}=await Sp(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:i,headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});return a?this._returnResult({data:null,error:a}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),this._returnResult({data:o,error:a}))})}catch(e){if(jf(e))return this._returnResult({data:null,error:e});throw e}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:s}=t;if(s)return this._returnResult({data:null,error:s});const i=await Sp(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});if(i.error)return i;const{data:o}=i;if("webauthn"!==o.type)return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Kp(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Hp(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(jf(e))return this._returnResult({data:null,error:e});throw e}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};const n={all:[],phone:[],totp:[],webauthn:[]};for(const r of null!==(e=null==t?void 0:t.factors)&&void 0!==e?e:[])n.all.push(r),"verified"===r.status&&n[r.factor_type].push(r);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:r},error:n}=await this.getSession();if(n)return this._returnResult({data:null,error:n});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:s}=fp(r.access_token);let i=null;s.aal&&(i=s.aal);let o=i;return(null!==(t=null===(e=r.user.factors)||void 0===e?void 0:e.filter(e=>"verified"===e.status))&&void 0!==t?t:[]).length>0&&(o="aal2"),{data:{currentLevel:i,nextLevel:o,currentAuthenticationMethods:s.amr||[]},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;return n?this._returnResult({data:null,error:n}):r?await Sp(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new Ff})})}catch(e){if(jf(e))return this._returnResult({data:null,error:e});throw e}}async _approveAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;if(s)return this._returnResult({data:null,error:s});if(!n)return this._returnResult({data:null,error:new Ff});const i=await Sp(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"approve"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&ip()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(e){if(jf(e))return this._returnResult({data:null,error:e});throw e}}async _denyAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;if(s)return this._returnResult({data:null,error:s});if(!n)return this._returnResult({data:null,error:new Ff});const i=await Sp(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"deny"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&ip()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(e){if(jf(e))return this._returnResult({data:null,error:e});throw e}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;return r?this._returnResult({data:null,error:r}):t?await Sp(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new Ff})})}catch(e){if(jf(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;return n?this._returnResult({data:null,error:n}):r?(await Sp(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Ff})})}catch(e){if(jf(e))return this._returnResult({data:null,error:e});throw e}}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(t=>t.kid===e);if(r)return r;const n=Date.now();if(r=this.jwks.keys.find(t=>t.kid===e),r&&this.jwks_cached_at+6e5>n)return r;const{data:s,error:i}=await Sp(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return s.keys&&0!==s.keys.length?(this.jwks=s,this.jwks_cached_at=n,r=s.keys.find(t=>t.kid===e),r||null):null}async getClaims(e,t={}){try{let r=e;if(!r){const{data:e,error:t}=await this.getSession();if(t||!e.session)return this._returnResult({data:null,error:t});r=e.session.access_token}const{header:n,payload:s,signature:i,raw:{header:o,payload:a}}=fp(r);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(s.exp);const c=n.alg&&!n.alg.startsWith("HS")&&n.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(n.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks):null;if(!c){const{error:e}=await this.getUser(r);if(e)throw e;return{data:{claims:s,header:n,signature:i},error:null}}const u=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(n.alg),l=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,l,i,function(e){const t=[];return function(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const t=1024*(n-55296)&65535;n=65536+(e.charCodeAt(r+1)-56320&65535|t),r+=1}rp(n,t)}}(e,e=>t.push(e)),new Uint8Array(t)}(`${o}.${a}`)))throw new Jf("Invalid JWT signature");return{data:{claims:s,header:n,signature:i},error:null}}catch(e){if(jf(e))return this._returnResult({data:null,error:e});throw e}}}sg.nextInstanceID={};const ig=sg;let og="";og="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const ag={headers:{"X-Client-Info":`supabase-js-${og}/2.90.0`}},cg={schema:"public"},ug={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},lg={};function hg(e){return(hg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dg(e,t,r){return(t=function(e){var t=function(e){if("object"!=hg(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=hg(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==hg(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fg(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function pg(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fg(Object(r),!0).forEach(function(t){dg(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fg(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var gg=class extends ig{constructor(e){super(e)}},mg=class{constructor(e,t,r){var n,s;this.supabaseUrl=e,this.supabaseKey=t;const i=function(e){const t=null==e?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((r=t).endsWith("/")?r:r+"/")}catch(e){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var r}(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,a=function(e,t){var r,n;const{db:s,auth:i,realtime:o,global:a}=e,{db:c,auth:u,realtime:l,global:h}=t,d={db:pg(pg({},c),s),auth:pg(pg({},u),i),realtime:pg(pg({},l),o),storage:{},global:pg(pg(pg({},h),a),{},{headers:pg(pg({},null!==(r=null==h?void 0:h.headers)&&void 0!==r?r:{}),null!==(n=null==a?void 0:a.headers)&&void 0!==n?n:{})}),accessToken:async()=>""};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}(null!=r?r:{},{db:cg,realtime:lg,auth:pg(pg({},ug),{},{storageKey:o}),global:ag});var c;this.storageKey=null!==(n=a.auth.storageKey)&&void 0!==n?n:"",this.headers=null!==(s=a.global.headers)&&void 0!==s?s:{},a.accessToken?(this.accessToken=a.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(c=a.auth)&&void 0!==c?c:{},this.headers,a.global.fetch),this.fetch=((e,t,r)=>{const n=(e=>e?(...t)=>e(...t):(...e)=>fetch(...e))(r),s=Headers;return async(r,i)=>{var o;const a=null!==(o=await t())&&void 0!==o?o:e;let c=new s(null==i?void 0:i.headers);return c.has("apikey")||c.set("apikey",e),c.has("Authorization")||c.set("Authorization",`Bearer ${a}`),n(r,pg(pg({},i),{},{headers:c}))}})(t,this._getAccessToken.bind(this),a.global.fetch),this.realtime=this._initRealtimeClient(pg({headers:this.headers,accessToken:this._getAccessToken.bind(this)},a.realtime)),this.accessToken&&this.accessToken().then(e=>this.realtime.setAuth(e)).catch(e=>console.warn("Failed to set initial Realtime auth token:",e)),this.rest=new ed(new URL("rest/v1",i).href,{headers:this.headers,schema:a.db.schema,fetch:this.fetch}),this.storage=new Cf(this.storageUrl.href,this.headers,this.fetch,null==r?void 0:r.storage),a.accessToken||this._listenForAuthEvents()}get functions(){return new Wh(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t,r=this;if(r.accessToken)return await r.accessToken();const{data:n}=await r.auth.getSession();return null!==(e=null===(t=n.session)||void 0===t?void 0:t.access_token)&&void 0!==e?e:r.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:s,storageKey:i,flowType:o,lock:a,debug:c,throwOnError:u},l,h){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new gg({url:this.authUrl.href,headers:pg(pg({},d),l),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:s,flowType:o,lock:a,debug:c,throwOnError:u,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new Nd(this.realtimeUrl.href,pg(pg({},e),{},{params:pg(pg({},{apikey:this.supabaseKey}),null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===r?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=r,this.realtime.setAuth(r))}};(function(){if("undefined"!=typeof window)return!1;const e=globalThis.process;if(!e)return!1;const t=e.version;if(null==t)return!1;const r=t.match(/^v(\d+)\./);return!!r&&parseInt(r[1],10)<=18})()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");var yg=function(){var e=t(s().mark(function e(t,r,n){var i,o,a,c,u;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=wh(r,"users",t),e.next=1,Fh(o);case 1:if((a=e.sent).exists()||alert("Kullanıcı bilgileri bulunamadı!"),c=a.data(),u=null!==(i=c.expireDate)&&void 0!==i&&i.toDate?c.expireDate.toDate():new Date(c.expireDate),!(new Date>u)){e.next=2;break}return alert("Hesabınızın süresi dolmuş. Lütfen yönetici ile iletişime geçin."),e.next=2,Xr(n);case 2:case"end":return e.stop()}},e)}));return function(t,r,n){return e.apply(this,arguments)}}(),vg=(r(5133),new mg("https://oybvsqonvawnkztnhwec.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im95YnZzcW9udmF3bmt6dG5od2VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMjMwMDIsImV4cCI6MjA3NzY5OTAwMn0.OPa9rGvmFVAocrzlNPLx-8AJ7IF-Wcm58jlS4zXEYW0",void 0)),wg=Ge({apiKey:"AIzaSyDIGME8_6gN9bI1SCadrsx93QhQRCfC-dM",authDomain:"canli-altin-app.firebaseapp.com",databaseURL:"https://canli-altin-app-default-rtdb.europe-west1.firebasedatabase.app",projectId:"canli-altin-app",storageBucket:"canli-altin-app.firebasestorage.app",messagingSenderId:"675863034125",appId:"1:675863034125:web:301006180c35a5f0549844",measurementId:"G-V3YHGPSB8M"}),bg=function(e=Je()){const t=qe(e,"auth");if(t.isInitialized())return t.getImmediate();const r=function(e,t){const r=qe(e,"auth");if(r.isInitialized()){const e=r.getImmediate();if(I(r.getOptions(),null!=t?t:{}))return e;ht(e,"already-initialized")}return r.initialize({options:t})}(e,{popupRedirectResolver:ns,persistence:[_n,nn,on]}),n=f("authTokenSyncURL");if(n&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(n,location.origin);if(location.origin===e.origin){const t=(s=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),r=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>as)return;const n=null==t?void 0:t.token;cs!==n&&(cs=n,await fetch(s,{method:n?"POST":"DELETE",headers:n?{Authorization:`Bearer ${n}`}:{}}))});!function(e,t,r){N(e).beforeAuthStateChanged(t,r)}(r,t,()=>t(r.currentUser)),function(e){N(e).onIdTokenChanged(e=>t(e),void 0,void 0)}(r)}}var s;const i=h("auth");return i&&function(e,t,r){const n=vr(e);mt(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const s=!!(null==r?void 0:r.disableWarnings),i=Or(t),{host:o,port:a}=function(e){const t=Or(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};const n=r[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(n);if(s){const e=s[1];return{host:e,port:Rr(n.substr(e.length+1))}}{const[e,t]=n.split(":");return{host:e,port:Rr(t)}}}(t),c=null===a?"":`:${a}`,u={url:`${i}//${o}${c}/`},l=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!n._canInitEmulator)return mt(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),void mt(I(u,n.config.emulator)&&I(l,n.emulatorConfig),n,"emulator-config-failed");n.config.emulator=u,n.emulatorConfig=l,n.settings.appVerificationDisabledForTesting=!0,g(o)?(m(`${i}//${o}${c}`),w("Auth",!0)):s||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(r,`http://${i}`),r}(wg),_g=function(e){const t="object"==typeof e?e:Je(),r="string"==typeof e?e:uo,n=qe(t,"firestore").getImmediate({identifier:r});if(!n._initialized){const e=(()=>{const e=h("firestore");if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return"["===e[0]?[e.substring(1,t-1),r]:[e.substring(0,t),r]})();e&&function(e,t,r,n={}){var s;e=li(e,gh);const i=g(t),o=e._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:e._getEmulatorOptions()}),u=`${t}:${r}`;i&&(m(`https://${u}`),w("Firestore",!0)),o.host!==dh&&o.host!==u&&Ns("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l=Object.assign(Object.assign({},o),{host:u,ssl:i,emulatorOptions:n});if(!I(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=ks.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r=t||"demo-project",n=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:n,exp:n+3600,auth_time:n,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[c(JSON.stringify({alg:"none",type:"JWT"})),c(JSON.stringify(i)),""].join(".")}(n.mockUserToken,null===(s=e._app)||void 0===s?void 0:s.options.projectId);const i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new $s(Ms.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new ks(i)}e._authCredentials=new qs(new Vs(t,r))}}(n,...e)}return n}(wg),Eg=document.getElementById("logoInput"),Tg=document.getElementById("adInput"),Sg=document.getElementById("uploadBtn"),Ig=null,kg=!1;!function(e,t){N(e).onAuthStateChanged(t,void 0,void 0)}(bg,function(){var e=t(s().mark(function e(t){var r,n;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=1,yg(t.uid,_g,bg);case 1:return Ig=t,r=document.getElementById("topButtons"),n=wh(_g,"admins",t.uid),e.next=2,Fh(n);case 2:e.sent.exists()?(kg=!0,r.innerHTML='\n            <button id="adminPanelBtn" class="newUserBtn backgroundColor">\n              Admin Paneli\n            </button>\n            <button id="homeBtn" class="homeBtn backgroundColor">\n              🏠 Ana Sayfa\n            </button>\n            <button id="logoutBtn" class="logoutBtn backgroundColor">\n              🔒 Çıkış Yap\n            </button>\n          '):(document.getElementById("ad-container").style.display="none",r.innerHTML='\n            <button id="homeBtn" class="homeBtn backgroundColor">\n              🏠 Ana Sayfa\n            </button>\n            <button id="logoutBtn" class="logoutBtn backgroundColor">\n              🔒 Çıkış Yap\n            </button>\n          '),document.getElementById("adminPanelBtn")&&document.getElementById("adminPanelBtn").addEventListener("click",function(){window.location.href="../adminPanel/adminPanel.html"}),document.getElementById("homeBtn").addEventListener("click",function(){window.location.href="../livePrices/livePrices.html"}),document.getElementById("logoutBtn").addEventListener("click",function(){Xr(bg).then(function(){window.location.href="../index.html"}).catch(function(e){console.error("Çıkış yapılamadı:",e),alert("Çıkış sırasında bir hata oluştu!")})}),e.next=4;break;case 3:window.location.href="../index.html";case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());var Cg=function(){var e=t(s().mark(function e(t,r,n){var i,o,a,c,u,l;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.name.replace(/[^a-zA-Z0-9.]/g,"_"),o="users/".concat(Ig.uid,"/").concat(t,"_").concat(Date.now(),"_").concat(i),e.next=1,vg.storage.from(r).upload(o,n,{upsert:!0});case 1:if((a=e.sent).data,!(c=a.error)){e.next=2;break}return console.error("Yükleme hatası:",c),alert("Yükleme hatası: "+c.message),e.abrupt("return",null);case 2:return u=vg.storage.from(r).getPublicUrl(o),l=u.data,e.abrupt("return",l.publicUrl);case 3:case"end":return e.stop()}},e)}));return function(t,r,n){return e.apply(this,arguments)}}();Sg.addEventListener("click",t(s().mark(function e(){var t,r,n,i;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Eg.files[0],r=Tg.files[0],t&&(!kg||r)){e.next=1;break}return alert("Lütfen bir dosya seçin."),e.abrupt("return");case 1:return e.next=2,Cg("logo","logos",t);case 2:if(n=e.sent,i=null,!kg){e.next=4;break}return e.next=3,Cg("ad","ads",r);case 3:i=e.sent;case 4:if(n&&(!kg||i)){e.next=5;break}return e.abrupt("return");case 5:return e.next=6,vg.from("profiles").upsert({id:Ig.uid,logo_url:n,updated_at:(new Date).toISOString()});case 6:if(!kg){e.next=7;break}return e.next=7,vg.from("ads").upsert({id:Ig.uid,ad_url:i,updated_at:(new Date).toISOString()});case 7:alert("Yükleme başarılı!");case 8:case"end":return e.stop()}},e)})))})()})();