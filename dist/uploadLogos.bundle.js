/*! For license information please see uploadLogos.bundle.js.LICENSE.txt */
(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const t=function(e){const t=[];let r=0;for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=63&s|128):55296==(64512&s)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++n)),t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=63&s|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=63&s|128)}return t},r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){const s=e[t],i=t+1<e.length,o=i?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,l=s>>2,u=(3&s)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(h=64)),n.push(r[l],r[u],r[h],r[d])}return n.join("")},encodeString(e,r){return this.HAS_NATIVE_SUPPORT&&!r?btoa(e):this.encodeByteArray(t(e),r)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let r=0,n=0;for(;r<e.length;){const s=e[r++];if(s<128)t[n++]=String.fromCharCode(s);else if(s>191&&s<224){const i=e[r++];t[n++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(i>>10)),t[n++]=String.fromCharCode(56320+(1023&i))}else{const i=e[r++],o=e[r++];t[n++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const r=t?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let t=0;t<e.length;){const i=r[e.charAt(t++)],o=t<e.length?r[e.charAt(t)]:0;++t;const a=t<e.length?r[e.charAt(t)]:64;++t;const c=t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==o||null==a||null==c)throw new n;const l=i<<2|o>>4;if(s.push(l),64!==a){const e=o<<4&240|a>>2;if(s.push(e),64!==c){const e=a<<6&192|c;s.push(e)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class n extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const s=function(e){return function(e){const n=t(e);return r.encodeByteArray(n,!0)}(e).replace(/\./g,"")},i=function(e){try{return r.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};const o=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&i(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},a=e=>{var t,r;return null===(r=null===(t=o())||void 0===t?void 0:t.emulatorHosts)||void 0===r?void 0:r[e]},c=()=>{var e;return null===(e=o())||void 0===e?void 0:e.config},l=e=>{var t;return null===(t=o())||void 0===t?void 0:t[`_${e}`]};class u{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function h(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(e){return!1}}async function d(e){return(await fetch(e,{credentials:"include"})).ok}const f={};let p=!1;function g(e,t){if("undefined"==typeof window||"undefined"==typeof document||!h(window.location.host)||f[e]===t||f[e]||p)return;function r(e){return`__firebase__banner__${e}`}f[e]=t;const n="__firebase__banner",s=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(f))f[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){const e=function(e){let t=document.getElementById(e),r=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),r=!0),{created:r,element:t}}(n),t=r("text"),i=document.getElementById(t)||document.createElement("span"),o=r("learnmore"),a=document.getElementById(o)||document.createElement("a"),c=r("preprendIcon"),l=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(a,o);const r=function(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{p=!0,function(){const e=document.getElementById(n);e&&e.remove()}()},e}();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(l,c),t.append(l,i,a,r),document.body.appendChild(t)}s?(i.innerText="Preview backend disconnected.",l.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(l.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',i.innerText="Preview backend running in this workspace."),i.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",i):i()}function m(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function y(){return!function(){var t;const r=null===(t=o())||void 0===t?void 0:t.forceEnvironment;if("node"===r)return!0;if("browser"===r)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class v extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,v.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,w.prototype.create)}}class w{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},n=`${this.service}/${e}`,s=this.errors[e],i=s?function(e,t){return e.replace(_,(e,r)=>{const n=t[r];return null!=n?String(n):`<${r}?>`})}(s,r):"Error",o=`${this.serviceName}: ${i} (${n}).`;return new v(n,o,r)}}const _=/\{\$([^}]+)}/g;function b(e,t){if(e===t)return!0;const r=Object.keys(e),n=Object.keys(t);for(const s of r){if(!n.includes(s))return!1;const r=e[s],i=t[s];if(E(r)&&E(i)){if(!b(r,i))return!1}else if(r!==i)return!1}for(const e of n)if(!r.includes(e))return!1;return!0}function E(e){return null!==e&&"object"==typeof e}function T(e){const t=[];for(const[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function S(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function I(e){const t=e.indexOf("?");if(!t)return"";const r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}class k{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw new Error("Missing Observer.");n=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:r},void 0===n.next&&(n.next=C),void 0===n.error&&(n.error=C),void 0===n.complete&&(n.complete=C);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function C(){}function A(e){return e&&e._delegate?e._delegate:e}class O{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const R="[DEFAULT]";class P{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new u;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(r)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:r})}catch(e){if(n)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:R})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=R){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=R){return this.instances.has(e)}getOptions(e=R){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){var r;const n=this.normalizeInstanceIdentifier(t),s=null!==(r=this.onInitCallbacks.get(n))&&void 0!==r?r:new Set;s.add(e),this.onInitCallbacks.set(n,s);const i=this.instances.get(n);return i&&e(i,n),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const n of r)try{n(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===R?void 0:n),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(e){}var n;return r||null}normalizeInstanceIdentifier(e=R){return this.component?this.component.multipleInstances?e:R:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class N{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new P(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const D=[];var x;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(x||(x={}));const L={debug:x.DEBUG,verbose:x.VERBOSE,info:x.INFO,warn:x.WARN,error:x.ERROR,silent:x.SILENT},j=x.INFO,U={[x.DEBUG]:"log",[x.VERBOSE]:"log",[x.INFO]:"info",[x.WARN]:"warn",[x.ERROR]:"error"},M=(e,t,...r)=>{if(t<e.logLevel)return;const n=(new Date).toISOString(),s=U[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${n}]  ${e.name}:`,...r)};class ${constructor(e){this.name=e,this._logLevel=j,this._logHandler=M,this._userLogHandler=null,D.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in x))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?L[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,x.DEBUG,...e),this._logHandler(this,x.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,x.VERBOSE,...e),this._logHandler(this,x.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,x.INFO,...e),this._logHandler(this,x.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,x.WARN,...e),this._logHandler(this,x.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,x.ERROR,...e),this._logHandler(this,x.ERROR,...e)}}let V,F;const B=new WeakMap,q=new WeakMap,z=new WeakMap,H=new WeakMap,K=new WeakMap;let W={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return q.get(e);if("objectStoreNames"===t)return e.objectStoreNames||z.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return J(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function G(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(F||(F=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(Q(this),e),J(B.get(this))}:function(...e){return J(t.apply(Q(this),e))}:function(e,...r){const n=t.call(Q(this),e,...r);return z.set(n,e.sort?e.sort():[e]),J(n)}:(e instanceof IDBTransaction&&function(e){if(q.has(e))return;const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{t(),n()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)});q.set(e,t)}(e),r=e,(V||(V=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>r instanceof e)?new Proxy(e,W):e);var t,r}function J(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{t(J(e.result)),n()},i=()=>{r(e.error),n()};e.addEventListener("success",s),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&B.set(t,e)}).catch(()=>{}),K.set(t,e),t}(e);if(H.has(e))return H.get(e);const t=G(e);return t!==e&&(H.set(e,t),K.set(t,e)),t}const Q=e=>K.get(e),Y=["get","getKey","getAll","getAllKeys","count"],X=["put","add","delete","clear"],Z=new Map;function ee(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Z.get(t))return Z.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,s=X.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!s&&!Y.includes(r))return;const i=async function(e,...t){const i=this.transaction(e,s?"readwrite":"readonly");let o=i.store;return n&&(o=o.index(t.shift())),(await Promise.all([o[r](...t),s&&i.done]))[0]};return Z.set(t,i),i}var te;te=W,W={...te,get:(e,t,r)=>ee(e,t)||te.get(e,t,r),has:(e,t)=>!!ee(e,t)||te.has(e,t)};class re{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const ne="@firebase/app",se="0.13.2",ie=new $("@firebase/app"),oe="@firebase/app-compat",ae="@firebase/analytics-compat",ce="@firebase/analytics",le="@firebase/app-check-compat",ue="@firebase/app-check",he="@firebase/auth",de="@firebase/auth-compat",fe="@firebase/database",pe="@firebase/data-connect",ge="@firebase/database-compat",me="@firebase/functions",ye="@firebase/functions-compat",ve="@firebase/installations",we="@firebase/installations-compat",_e="@firebase/messaging",be="@firebase/messaging-compat",Ee="@firebase/performance",Te="@firebase/performance-compat",Se="@firebase/remote-config",Ie="@firebase/remote-config-compat",ke="@firebase/storage",Ce="@firebase/storage-compat",Ae="@firebase/firestore",Oe="@firebase/ai",Re="@firebase/firestore-compat",Pe="firebase",Ne="[DEFAULT]",De={[ne]:"fire-core",[oe]:"fire-core-compat",[ce]:"fire-analytics",[ae]:"fire-analytics-compat",[ue]:"fire-app-check",[le]:"fire-app-check-compat",[he]:"fire-auth",[de]:"fire-auth-compat",[fe]:"fire-rtdb",[pe]:"fire-data-connect",[ge]:"fire-rtdb-compat",[me]:"fire-fn",[ye]:"fire-fn-compat",[ve]:"fire-iid",[we]:"fire-iid-compat",[_e]:"fire-fcm",[be]:"fire-fcm-compat",[Ee]:"fire-perf",[Te]:"fire-perf-compat",[Se]:"fire-rc",[Ie]:"fire-rc-compat",[ke]:"fire-gcs",[Ce]:"fire-gcs-compat",[Ae]:"fire-fst",[Re]:"fire-fst-compat",[Oe]:"fire-vertex","fire-js":"fire-js",[Pe]:"fire-js-all"},xe=new Map,Le=new Map,je=new Map;function Ue(e,t){try{e.container.addComponent(t)}catch(r){ie.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function Me(e){const t=e.name;if(je.has(t))return ie.debug(`There were multiple attempts to register component ${t}.`),!1;je.set(t,e);for(const t of xe.values())Ue(t,e);for(const t of Le.values())Ue(t,e);return!0}function $e(e,t){const r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function Ve(e){return null!=e&&void 0!==e.settings}const Fe=new w("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Be{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new O("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Fe.create("app-deleted",{appName:this._name})}}const qe="11.10.0";function ze(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});const n=Object.assign({name:Ne,automaticDataCollectionEnabled:!0},t),s=n.name;if("string"!=typeof s||!s)throw Fe.create("bad-app-name",{appName:String(s)});if(r||(r=c()),!r)throw Fe.create("no-options");const i=xe.get(s);if(i){if(b(r,i.options)&&b(n,i.config))return i;throw Fe.create("duplicate-app",{appName:s})}const o=new N(s);for(const e of je.values())o.addComponent(e);const a=new Be(r,n,o);return xe.set(s,a),a}function He(e=Ne){const t=xe.get(e);if(!t&&e===Ne&&c())return ze();if(!t)throw Fe.create("no-app",{appName:e});return t}function Ke(e,t,r){var n;let s=null!==(n=De[e])&&void 0!==n?n:e;r&&(s+=`-${r}`);const i=s.match(/\s|\//),o=t.match(/\s|\//);if(i||o){const e=[`Unable to register library "${s}" with version "${t}":`];return i&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void ie.warn(e.join(" "))}Me(new O(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}const We="firebase-heartbeat-store";let Ge=null;function Je(){return Ge||(Ge=function(e,t,{blocked:r,upgrade:n,blocking:s,terminated:i}={}){const o=indexedDB.open(e,t),a=J(o);return n&&o.addEventListener("upgradeneeded",e=>{n(J(o.result),e.oldVersion,e.newVersion,J(o.transaction),e)}),r&&o.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),a.then(e=>{i&&e.addEventListener("close",()=>i()),s&&e.addEventListener("versionchange",e=>s(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(We)}catch(e){console.warn(e)}}}).catch(e=>{throw Fe.create("idb-open",{originalErrorMessage:e.message})})),Ge}async function Qe(e,t){try{const r=(await Je()).transaction(We,"readwrite"),n=r.objectStore(We);await n.put(t,Ye(e)),await r.done}catch(e){if(e instanceof v)ie.warn(e.message);else{const t=Fe.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});ie.warn(t.message)}}}function Ye(e){return`${e.name}!${e.options.appId}`}class Xe{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new et(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=Ze();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:r}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ie.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Ze(),{heartbeatsToSend:r,unsentEntries:n}=function(e,t=1024){const r=[];let n=e.slice();for(const s of e){const e=r.find(e=>e.agent===s.agent);if(e){if(e.dates.push(s.date),tt(r)>t){e.dates.pop();break}}else if(r.push({agent:s.agent,dates:[s.date]}),tt(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),i=s(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return ie.warn(e),""}}}function Ze(){return(new Date).toISOString().substring(0,10)}class et{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let r=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},s.onupgradeneeded=()=>{r=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Je()).transaction(We),r=await t.objectStore(We).get(Ye(e));return await t.done,r}catch(e){if(e instanceof v)ie.warn(e.message);else{const t=Fe.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});ie.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return Qe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return Qe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}}}function tt(e){return s(JSON.stringify({version:2,heartbeats:e})).length}function rt(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]])}return r}Me(new O("platform-logger",e=>new re(e),"PRIVATE")),Me(new O("heartbeat",e=>new Xe(e),"PRIVATE")),Ke(ne,se,""),Ke(ne,se,"esm2017"),Ke("fire-js",""),Ke("firebase","11.10.0","app"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const nt=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},st=new w("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),it=new $("@firebase/auth");function ot(e,...t){it.logLevel<=x.ERROR&&it.error(`Auth (${qe}): ${e}`,...t)}function at(e,...t){throw ht(e,...t)}function ct(e,...t){return ht(e,...t)}function lt(e,t,r){const n=Object.assign(Object.assign({},nt()),{[t]:r});return new w("auth","Firebase",n).create(t,{appName:e.name})}function ut(e){return lt(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ht(e,...t){if("string"!=typeof e){const r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return st.create(e,...t)}function dt(e,t,...r){if(!e)throw ht(t,...r)}function ft(e){const t="INTERNAL ASSERTION FAILED: "+e;throw ot(t),new Error(t)}function pt(e,t){e||ft(t)}function gt(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function mt(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function yt(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===mt()||"https:"===mt()||function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class vt{constructor(e,t){this.shortDelay=e,this.longDelay=t,pt(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(m())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return yt()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function wt(e,t){pt(e.emulator,"Emulator should always be set here");const{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}class _t{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void ft("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void ft("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void ft("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const bt={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Et=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Tt=new vt(3e4,6e4);function St(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function It(e,t,r,n,s={}){return kt(e,s,async()=>{let s={},i={};n&&("GET"===t?i=n:s={body:JSON.stringify(n)});const o=T(Object.assign({key:e.config.apiKey},i)).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:a},s);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),e.emulatorConfig&&h(e.emulatorConfig.host)&&(c.credentials="include"),_t.fetch()(await At(e,e.config.apiHost,r,o),c)})}async function kt(e,t,r){e._canInitEmulator=!1;const n=Object.assign(Object.assign({},bt),t);try{const t=new Rt(e),s=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();const i=await s.json();if("needConfirmation"in i)throw Pt(e,"account-exists-with-different-credential",i);if(s.ok&&!("errorMessage"in i))return i;{const t=s.ok?i.errorMessage:i.error.message,[r,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===r)throw Pt(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===r)throw Pt(e,"email-already-in-use",i);if("USER_DISABLED"===r)throw Pt(e,"user-disabled",i);const a=n[r]||r.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw lt(e,a,o);at(e,a)}}catch(t){if(t instanceof v)throw t;at(e,"network-request-failed",{message:String(t)})}}async function Ct(e,t,r,n,s={}){const i=await It(e,t,r,n,s);return"mfaPendingCredential"in i&&at(e,"multi-factor-auth-required",{_serverResponse:i}),i}async function At(e,t,r,n){const s=`${t}${r}?${n}`,i=e,o=i.config.emulator?wt(e.config,s):`${e.config.apiScheme}://${s}`;return Et.includes(r)&&(await i._persistenceManagerAvailable,"COOKIE"===i._getPersistenceType())?i._getPersistence()._getFinalTarget(o).toString():o}function Ot(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Rt{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(ct(this.auth,"network-request-failed")),Tt.get())})}}function Pt(e,t,r){const n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);const s=ct(e,t,n);return s.customData._tokenResponse=r,s}function Nt(e){return void 0!==e&&void 0!==e.enterprise}class Dt{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Ot(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function xt(e,t){return It(e,"GET","/v2/recaptchaConfig",St(e,t))}async function Lt(e,t){return It(e,"POST","/v1/accounts:lookup",t)}function jt(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Ut(e){return 1e3*Number(e)}function Mt(e){const[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return ot("JWT malformed, contained fewer than 3 sections"),null;try{const e=i(r);return e?JSON.parse(e):(ot("Failed to decode base64 JWT payload"),null)}catch(e){return ot("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function $t(e){const t=Mt(e);return dt(t,"internal-error"),dt(void 0!==t.exp,"internal-error"),dt(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Vt(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof v&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class Ft{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Bt{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=jt(this.lastLoginAt),this.creationTime=jt(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function qt(e){var t;const r=e.auth,n=await e.getIdToken(),s=await Vt(e,Lt(r,{idToken:n}));dt(null==s?void 0:s.users.length,r,"internal-error");const i=s.users[0];e._notifyReloadListener(i);const o=(null===(t=i.providerUserInfo)||void 0===t?void 0:t.length)?zt(i.providerUserInfo):[],a=(c=e.providerData,l=o,[...c.filter(e=>!l.some(t=>t.providerId===e.providerId)),...l]);var c,l;const u=e.isAnonymous,h=!(e.email&&i.passwordHash||(null==a?void 0:a.length)),d=!!u&&h,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Bt(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(e,f)}function zt(e){return e.map(e=>{var{providerId:t}=e,r=rt(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}class Ht{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){dt(e.idToken,"internal-error"),dt(void 0!==e.idToken,"internal-error"),dt(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):$t(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){dt(0!==e.length,"internal-error");const t=$t(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(dt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:n,expiresIn:s}=await async function(e,t){const r=await kt(e,{},async()=>{const r=T({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:s}=e.config,i=await At(e,n,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const a={method:"POST",headers:o,body:r};return e.emulatorConfig&&h(e.emulatorConfig.host)&&(a.credentials="include"),_t.fetch()(i,a)});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}(e,t);this.updateTokensAndExpiration(r,n,Number(s))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){const{refreshToken:r,accessToken:n,expirationTime:s}=t,i=new Ht;return r&&(dt("string"==typeof r,"internal-error",{appName:e}),i.refreshToken=r),n&&(dt("string"==typeof n,"internal-error",{appName:e}),i.accessToken=n),s&&(dt("number"==typeof s,"internal-error",{appName:e}),i.expirationTime=s),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ht,this.toJSON())}_performRefresh(){return ft("not implemented")}}function Kt(e,t){dt("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Wt{constructor(e){var{uid:t,auth:r,stsTokenManager:n}=e,s=rt(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Ft(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Bt(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Vt(this,this.stsTokenManager.getToken(this.auth,e));return dt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const r=A(e),n=await r.getIdToken(t),s=Mt(n);dt(s&&s.exp&&s.auth_time&&s.iat,r.auth,"internal-error");const i="object"==typeof s.firebase?s.firebase:void 0,o=null==i?void 0:i.sign_in_provider;return{claims:s,token:n,authTime:jt(Ut(s.auth_time)),issuedAtTime:jt(Ut(s.iat)),expirationTime:jt(Ut(s.exp)),signInProvider:o||null,signInSecondFactor:(null==i?void 0:i.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=A(e);await qt(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(dt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Wt(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){dt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await qt(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ve(this.auth.app))return Promise.reject(ut(this.auth));const e=await this.getIdToken();return await Vt(this,async function(e,t){return It(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,n,s,i,o,a,c,l;const u=null!==(r=t.displayName)&&void 0!==r?r:void 0,h=null!==(n=t.email)&&void 0!==n?n:void 0,d=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,f=null!==(i=t.photoURL)&&void 0!==i?i:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:v,emailVerified:w,isAnonymous:_,providerData:b,stsTokenManager:E}=t;dt(v&&E,e,"internal-error");const T=Ht.fromJSON(this.name,E);dt("string"==typeof v,e,"internal-error"),Kt(u,e.name),Kt(h,e.name),dt("boolean"==typeof w,e,"internal-error"),dt("boolean"==typeof _,e,"internal-error"),Kt(d,e.name),Kt(f,e.name),Kt(p,e.name),Kt(g,e.name),Kt(m,e.name),Kt(y,e.name);const S=new Wt({uid:v,auth:e,email:h,emailVerified:w,displayName:u,isAnonymous:_,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:m,lastLoginAt:y});return b&&Array.isArray(b)&&(S.providerData=b.map(e=>Object.assign({},e))),g&&(S._redirectEventId=g),S}static async _fromIdTokenResponse(e,t,r=!1){const n=new Ht;n.updateFromServerResponse(t);const s=new Wt({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r});return await qt(s),s}static async _fromGetAccountInfoResponse(e,t,r){const n=t.users[0];dt(void 0!==n.localId,"internal-error");const s=void 0!==n.providerUserInfo?zt(n.providerUserInfo):[],i=!(n.email&&n.passwordHash||(null==s?void 0:s.length)),o=new Ht;o.updateFromIdToken(r);const a=new Wt({uid:n.localId,auth:e,stsTokenManager:o,isAnonymous:i}),c={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:s,metadata:new Bt(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash||(null==s?void 0:s.length))};return Object.assign(a,c),a}}const Gt=new Map;function Jt(e){pt(e instanceof Function,"Expected a class definition");let t=Gt.get(e);return t?(pt(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Gt.set(e,t),t)}class Qt{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Qt.type="NONE";const Yt=Qt;function Xt(e,t,r){return`firebase:${e}:${t}:${r}`}class Zt{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:n,name:s}=this.auth;this.fullUserKey=Xt(this.userKey,n.apiKey,s),this.fullPersistenceKey=Xt("persistence",n.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await Lt(this.auth,{idToken:e}).catch(()=>{});return t?Wt._fromGetAccountInfoResponse(this.auth,t,e):null}return Wt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Zt(Jt(Yt),e,r);const n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let s=n[0]||Jt(Yt);const i=Xt(r,e.config.apiKey,e.name);let o=null;for(const r of t)try{const t=await r._get(i);if(t){let n;if("string"==typeof t){const r=await Lt(e,{idToken:t}).catch(()=>{});if(!r)break;n=await Wt._fromGetAccountInfoResponse(e,r,t)}else n=Wt._fromJSON(e,t);r!==s&&(o=n),s=r;break}}catch(e){}const a=n.filter(e=>e._shouldAllowMigration);return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(i,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==s)try{await e._remove(i)}catch(e){}})),new Zt(s,e,r)):new Zt(s,e,r)}}function er(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(sr(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(tr(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(or(t))return"Blackberry";if(ar(t))return"Webos";if(rr(t))return"Safari";if((t.includes("chrome/")||nr(t))&&!t.includes("edge/"))return"Chrome";if(ir(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=e.match(t);if(2===(null==r?void 0:r.length))return r[1]}return"Other"}function tr(e=m()){return/firefox\//i.test(e)}function rr(e=m()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function nr(e=m()){return/crios\//i.test(e)}function sr(e=m()){return/iemobile/i.test(e)}function ir(e=m()){return/android/i.test(e)}function or(e=m()){return/blackberry/i.test(e)}function ar(e=m()){return/webos/i.test(e)}function cr(e=m()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function lr(e=m()){return cr(e)||ir(e)||ar(e)||or(e)||/windows phone/i.test(e)||sr(e)}function ur(e,t=[]){let r;switch(e){case"Browser":r=er(m());break;case"Worker":r=`${er(m())}-${e}`;break;default:r=e}const n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${qe}/${n}`}class hr{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=t=>new Promise((r,n)=>{try{r(e(t))}catch(e){n(e)}});r.onAbort=t,this.queue.push(r);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class dr{constructor(e){var t,r,n,s;const i=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=i.minPasswordLength)&&void 0!==t?t:6,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),void 0!==i.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),void 0!==i.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),void 0!==i.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),void 0!==i.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(n=null===(r=e.allowedNonAlphanumericCharacters)||void 0===r?void 0:r.join(""))&&void 0!==n?n:"",this.forceUpgradeOnSignin=null!==(s=e.forceUpgradeOnSignin)&&void 0!==s&&s,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,n,s,i,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(r=a.meetsMaxPasswordLength)||void 0===r||r),a.isValid&&(a.isValid=null===(n=a.containsLowercaseLetter)||void 0===n||n),a.isValid&&(a.isValid=null===(s=a.containsUppercaseLetter)||void 0===s||s),a.isValid&&(a.isValid=null===(i=a.containsNumericCharacter)||void 0===i||i),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class fr{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new gr(this),this.idTokenSubscription=new gr(this),this.beforeStateQueue=new hr(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=st,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Jt(t)),this._initializationPromise=this.queue(async()=>{var r,n,s;if(!this._deleted&&(this.persistenceManager=await Zt.create(this,e),null===(r=this._resolvePersistenceManagerAvailable)||void 0===r||r.call(this),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(s=this.currentUser)||void 0===s?void 0:s.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Lt(this,{idToken:e}),r=await Wt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Ve(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let n=r,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,i=null==n?void 0:n._redirectEventId,o=await this.tryRedirectSignIn(e);r&&r!==i||!(null==o?void 0:o.user)||(n=o.user,s=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return dt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await qt(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ve(this.app))return Promise.reject(ut(this));const t=e?A(e):null;return t&&dt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&dt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ve(this.app)?Promise.reject(ut(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ve(this.app)?Promise.reject(ut(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Jt(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return It(e,"GET","/v2/passwordPolicy",St(e,t))}(this),t=new dr(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new w("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return It(e,"POST","/v2/accounts:revokeToken",St(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Jt(e)||this._popupRedirectResolver;dt(t,this,"argument-error"),this.redirectPersistenceManager=await Zt.create(this,[Jt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(r=this.redirectUser)||void 0===r?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,n){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t);let i=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(dt(o,this,"internal-error"),o.then(()=>{i||s(this.currentUser)}),"function"==typeof t){const s=e.addObserver(t,r,n);return()=>{i=!0,s()}}{const r=e.addObserver(t);return()=>{i=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return dt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ur(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const n=await this._getAppCheckToken();return n&&(t["X-Firebase-AppCheck"]=n),t}async _getAppCheckToken(){var e;if(Ve(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){it.logLevel<=x.WARN&&it.warn(`Auth (${qe}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function pr(e){return A(e)}class gr{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e){const t=new k(e,void 0);return t.subscribe.bind(t)}(e=>this.observer=e)}get next(){return dt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let mr={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function yr(e){return mr.loadJS(e)}function vr(e){return`__${e}${Math.floor(1e6*Math.random())}`}class wr{constructor(){this.enterprise=new _r}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class _r{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const br="NO_RECAPTCHA";class Er{constructor(e){this.type="recaptcha-enterprise",this.auth=pr(e)}async verify(e="verify",t=!1){function r(t,r,n){const s=window.grecaptcha;Nt(s)?s.enterprise.ready(()=>{s.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(br)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new wr).execute("siteKey",{action:"verify"}):new Promise((e,n)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{xt(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0!==n.recaptchaKey){const r=new Dt(n);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}r(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{r(e)})})})(this.auth).then(s=>{if(!t&&Nt(window.grecaptcha))r(s,e,n);else{if("undefined"==typeof window)return void n(new Error("RecaptchaVerifier is only supported in browser"));let t=mr.recaptchaEnterpriseScript;0!==t.length&&(t+=s),yr(t).then(()=>{r(s,e,n)}).catch(e=>{n(e)})}}).catch(e=>{n(e)})})}}async function Tr(e,t,r,n=!1,s=!1){const i=new Er(e);let o;if(s)o=br;else try{o=await i.verify(r)}catch(e){o=await i.verify(r,!0)}const a=Object.assign({},t);if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return n?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Sr(e,t,r,n,s){var i,o;if("EMAIL_PASSWORD_PROVIDER"===s){if(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await Tr(e,t,r,"getOobCode"===r);return n(e,s)}return n(e,t).catch(async s=>{if("auth/missing-recaptcha-token"===s.code){console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const s=await Tr(e,t,r,"getOobCode"===r);return n(e,s)}return Promise.reject(s)})}if("PHONE_PROVIDER"===s){if(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("PHONE_PROVIDER")){const s=await Tr(e,t,r);return n(e,s).catch(async s=>{var i;if("AUDIT"===(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.getProviderEnforcementState("PHONE_PROVIDER"))&&("auth/missing-recaptcha-token"===s.code||"auth/invalid-app-credential"===s.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);const s=await Tr(e,t,r,!1,!0);return n(e,s)}return Promise.reject(s)})}{const s=await Tr(e,t,r,!1,!0);return n(e,s)}}return Promise.reject(s+" provider is not supported.")}function Ir(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function kr(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Cr{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ft("not implemented")}_getIdTokenResponse(e){return ft("not implemented")}_linkToIdToken(e,t){return ft("not implemented")}_getReauthenticationResolver(e){return ft("not implemented")}}async function Ar(e,t){return It(e,"POST","/v1/accounts:signUp",t)}async function Or(e,t){return Ct(e,"POST","/v1/accounts:signInWithPassword",St(e,t))}class Rr extends Cr{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new Rr(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Rr(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Sr(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Or,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Ct(e,"POST","/v1/accounts:signInWithEmailLink",St(e,t))}(e,{email:this._email,oobCode:this._password});default:at(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Sr(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ar,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Ct(e,"POST","/v1/accounts:signInWithEmailLink",St(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:at(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Pr(e,t){return Ct(e,"POST","/v1/accounts:signInWithIdp",St(e,t))}class Nr extends Cr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Nr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):at("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:r,signInMethod:n}=t,s=rt(t,["providerId","signInMethod"]);if(!r||!n)return null;const i=new Nr(r,n);return i.idToken=s.idToken||void 0,i.accessToken=s.accessToken||void 0,i.secret=s.secret,i.nonce=s.nonce,i.pendingToken=s.pendingToken||null,i}_getIdTokenResponse(e){return Pr(e,this.buildRequest())}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Pr(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Pr(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=T(t)}return e}}async function Dr(e,t){return It(e,"POST","/v1/accounts:sendVerificationCode",St(e,t))}const xr={USER_NOT_FOUND:"user-not-found"};class Lr extends Cr{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Lr({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Lr({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Ct(e,"POST","/v1/accounts:signInWithPhoneNumber",St(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const r=await Ct(e,"POST","/v1/accounts:signInWithPhoneNumber",St(e,t));if(r.temporaryProof)throw Pt(e,"account-exists-with-different-credential",r);return r}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Ct(e,"POST","/v1/accounts:signInWithPhoneNumber",St(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),xr)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:n}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:n}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:s}=e;return r||t||n||s?new Lr({verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:s}):null}}class jr{constructor(e){var t,r,n,s,i,o;const a=S(I(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,l=null!==(r=a.oobCode)&&void 0!==r?r:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(n=a.mode)&&void 0!==n?n:null);dt(c&&l&&u,"argument-error"),this.apiKey=c,this.operation=u,this.code=l,this.continueUrl=null!==(s=a.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(i=a.lang)&&void 0!==i?i:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=S(I(e)).link,r=t?S(I(t)).deep_link_id:null,n=S(I(e)).deep_link_id;return(n?S(I(n)).link:null)||n||r||t||e}(e);try{return new jr(t)}catch(e){return null}}}class Ur{constructor(){this.providerId=Ur.PROVIDER_ID}static credential(e,t){return Rr._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=jr.parseLink(t);return dt(r,"argument-error"),Rr._fromEmailAndCode(e,r.code,r.tenantId)}}Ur.PROVIDER_ID="password",Ur.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Ur.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Mr{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class $r extends Mr{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Vr extends $r{constructor(){super("facebook.com")}static credential(e){return Nr._fromParams({providerId:Vr.PROVIDER_ID,signInMethod:Vr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Vr.credentialFromTaggedObject(e)}static credentialFromError(e){return Vr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Vr.credential(e.oauthAccessToken)}catch(e){return null}}}Vr.FACEBOOK_SIGN_IN_METHOD="facebook.com",Vr.PROVIDER_ID="facebook.com";class Fr extends $r{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Nr._fromParams({providerId:Fr.PROVIDER_ID,signInMethod:Fr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Fr.credentialFromTaggedObject(e)}static credentialFromError(e){return Fr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Fr.credential(t,r)}catch(e){return null}}}Fr.GOOGLE_SIGN_IN_METHOD="google.com",Fr.PROVIDER_ID="google.com";class Br extends $r{constructor(){super("github.com")}static credential(e){return Nr._fromParams({providerId:Br.PROVIDER_ID,signInMethod:Br.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Br.credentialFromTaggedObject(e)}static credentialFromError(e){return Br.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Br.credential(e.oauthAccessToken)}catch(e){return null}}}Br.GITHUB_SIGN_IN_METHOD="github.com",Br.PROVIDER_ID="github.com";class qr extends $r{constructor(){super("twitter.com")}static credential(e,t){return Nr._fromParams({providerId:qr.PROVIDER_ID,signInMethod:qr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return qr.credentialFromTaggedObject(e)}static credentialFromError(e){return qr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return qr.credential(t,r)}catch(e){return null}}}qr.TWITTER_SIGN_IN_METHOD="twitter.com",qr.PROVIDER_ID="twitter.com";class zr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,n=!1){const s=await Wt._fromIdTokenResponse(e,r,n),i=Hr(r);return new zr({user:s,providerId:i,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const n=Hr(r);return new zr({user:e,providerId:n,_tokenResponse:r,operationType:t})}}function Hr(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Kr extends v{constructor(e,t,r,n){var s;super(t.code,t.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,Kr.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,n){return new Kr(e,t,r,n)}}function Wr(e,t,r,n){return("reauthenticate"===t?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(r=>{if("auth/multi-factor-auth-required"===r.code)throw Kr._fromErrorAndOperation(e,r,t,n);throw r})}function Gr(e){return A(e).signOut()}function Jr(e,t){return It(e,"POST","/v2/accounts/mfaEnrollment:start",St(e,t))}new WeakMap;const Qr="__sak";class Yr{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Qr,"1"),this.storage.removeItem(Qr),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Xr extends Yr{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=lr(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),n=this.localCache[t];r!==n&&e(t,n,r)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,r)=>{this.notifyListeners(e,r)});const r=e.key;t?this.detachListener():this.stopPolling();const n=()=>{const e=this.storage.getItem(r);(t||this.localCache[r]!==e)&&this.notifyListeners(r,e)},s=this.storage.getItem(r);!function(){const e=m();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||s===e.newValue||e.newValue===e.oldValue?n():setTimeout(n,10)}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const e of Array.from(r))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Xr.type="LOCAL";const Zr=Xr;class en extends Yr{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}en.type="SESSION";const tn=en;class rn{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const r=new rn(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:n,data:s}=t.data,i=this.handlersMap[n];if(!(null==i?void 0:i.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:n});const o=Array.from(i).map(async e=>e(t.origin,s)),a=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}}))}(o);t.ports[0].postMessage({status:"done",eventId:r,eventType:n,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function nn(e="",t=10){let r="";for(let e=0;e<t;e++)r+=Math.floor(10*Math.random());return e+r}rn.receivers=[];class sn{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const n="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let s,i;return new Promise((o,a)=>{const c=nn("",20);n.port1.start();const l=setTimeout(()=>{a(new Error("unsupported_event"))},r);i={messageChannel:n,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),s=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),o(t.data.response);break;default:clearTimeout(l),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(i),n.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[n.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function on(){return window}function an(){return void 0!==on().WorkerGlobalScope&&"function"==typeof on().importScripts}const cn="firebaseLocalStorageDb",ln="firebaseLocalStorage",un="fbase_key";class hn{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function dn(e,t){return e.transaction([ln],t?"readwrite":"readonly").objectStore(ln)}function fn(){const e=indexedDB.open(cn,1);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(ln,{keyPath:un})}catch(e){r(e)}}),e.addEventListener("success",async()=>{const r=e.result;r.objectStoreNames.contains(ln)?t(r):(r.close(),await function(){const e=indexedDB.deleteDatabase(cn);return new hn(e).toPromise()}(),t(await fn()))})})}async function pn(e,t,r){const n=dn(e,!0).put({[un]:t,value:r});return new hn(n).toPromise()}function gn(e,t){const r=dn(e,!0).delete(t);return new hn(r).toPromise()}class mn{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await fn()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return an()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=rn._getInstance(an()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new sn(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&(null===(e=r[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=r[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await fn();return await pn(e,Qr,"1"),await gn(e,Qr),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>pn(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const r=dn(e,!1).get(t),n=await new hn(r).toPromise();return void 0===n?null:n.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>gn(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=dn(e,!1).getAll();return new hn(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],r=new Set;if(0!==e.length)for(const{fbase_key:n,value:s}of e)r.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(s)&&(this.notifyListeners(n,s),t.push(n));for(const e of Object.keys(this.localCache))this.localCache[e]&&!r.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const e of Array.from(r))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}mn.type="LOCAL";const yn=mn;function vn(e,t){return It(e,"POST","/v2/accounts/mfaSignIn:start",St(e,t))}vr("rcb"),new vt(3e4,6e4);const wn="recaptcha";async function _n(e,t,r){var n;if(!e._getRecaptchaConfig())try{await async function(e){const t=pr(e),r=await xt(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),n=new Dt(r);null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,n.isAnyProviderEnabled()&&new Er(t).verify()}(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){dt("enroll"===t.type,e,"internal-error");const n=Sr(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},"mfaSmsEnrollment",async(e,t)=>t.phoneEnrollmentInfo.captchaResponse===br?(dt((null==r?void 0:r.type)===wn,e,"argument-error"),Jr(e,await bn(e,t,r))):Jr(e,t),"PHONE_PROVIDER");return(await n.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{dt("signin"===t.type,e,"internal-error");const i=(null===(n=s.multiFactorHint)||void 0===n?void 0:n.uid)||s.multiFactorUid;dt(i,e,"missing-multi-factor-info");const o=Sr(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},"mfaSmsSignIn",async(e,t)=>t.phoneSignInInfo.captchaResponse===br?(dt((null==r?void 0:r.type)===wn,e,"argument-error"),vn(e,await bn(e,t,r))):vn(e,t),"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{const t=Sr(e,{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"},"sendVerificationCode",async(e,t)=>t.captchaResponse===br?(dt((null==r?void 0:r.type)===wn,e,"argument-error"),Dr(e,await bn(e,t,r))):Dr(e,t),"PHONE_PROVIDER");return(await t.catch(e=>Promise.reject(e))).sessionInfo}}finally{null==r||r._reset()}}async function bn(e,t,r){dt(r.type===wn,e,"argument-error");const n=await r.verify();dt("string"==typeof n,e,"argument-error");const s=Object.assign({},t);if("phoneEnrollmentInfo"in s){const e=s.phoneEnrollmentInfo.phoneNumber,t=s.phoneEnrollmentInfo.captchaResponse,r=s.phoneEnrollmentInfo.clientType,i=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:n,captchaResponse:t,clientType:r,recaptchaVersion:i}}),s}if("phoneSignInInfo"in s){const e=s.phoneSignInInfo.captchaResponse,t=s.phoneSignInInfo.clientType,r=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:n,captchaResponse:e,clientType:t,recaptchaVersion:r}}),s}return Object.assign(s,{recaptchaToken:n}),s}class En{constructor(e){this.providerId=En.PROVIDER_ID,this.auth=pr(e)}verifyPhoneNumber(e,t){return _n(this.auth,e,A(t))}static credential(e,t){return Lr._fromVerification(e,t)}static credentialFromResult(e){const t=e;return En.credentialFromTaggedObject(t)}static credentialFromError(e){return En.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Lr._fromTokenResponse(t,r):null}}En.PROVIDER_ID="phone",En.PHONE_SIGN_IN_METHOD="phone";class Tn extends Cr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Pr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Pr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Pr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Sn(e){return async function(e,t,r=!1){if(Ve(e.app))return Promise.reject(ut(e));const n="signIn",s=await Wr(e,n,t),i=await zr._fromIdTokenResponse(e,n,s);return r||await e._updateCurrentUser(i.user),i}(e.auth,new Tn(e),e.bypassAuthState)}function In(e){const{auth:t,user:r}=e;return dt(r,t,"internal-error"),async function(e,t,r=!1){const{auth:n}=e;if(Ve(n.app))return Promise.reject(ut(n));const s="reauthenticate";try{const i=await Vt(e,Wr(n,s,t,e),r);dt(i.idToken,n,"internal-error");const o=Mt(i.idToken);dt(o,n,"internal-error");const{sub:a}=o;return dt(e.uid===a,n,"user-mismatch"),zr._forOperation(e,s,i)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&at(n,"user-mismatch"),e}}(r,new Tn(e),e.bypassAuthState)}async function kn(e){const{auth:t,user:r}=e;return dt(r,t,"internal-error"),async function(e,t,r=!1){const n=await Vt(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return zr._forOperation(e,"link",n)}(r,new Tn(e),e.bypassAuthState)}class Cn{constructor(e,t,r,n,s=!1){this.auth=e,this.resolver=r,this.user=n,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:n,tenantId:s,error:i,type:o}=e;if(i)return void this.reject(i);const a={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Sn;case"linkViaPopup":case"linkViaRedirect":return kn;case"reauthViaPopup":case"reauthViaRedirect":return In;default:at(this.auth,"internal-error")}}resolve(e){pt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){pt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const An=new vt(2e3,1e4);class On extends Cn{constructor(e,t,r,n,s){super(e,t,n,s),this.provider=r,this.authWindow=null,this.pollId=null,On.currentPopupAction&&On.currentPopupAction.cancel(),On.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return dt(e,this.auth,"internal-error"),e}async onExecution(){pt(1===this.filter.length,"Popup operations only handle one event");const e=nn();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(ct(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(ct(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,On.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;(null===(r=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===r?void 0:r.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ct(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,An.get())};e()}}On.currentPopupAction=null;const Rn=new Map;class Pn extends Cn{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Rn.get(this.auth._key());if(!e){try{const t=await async function(e,t){const r=function(e){return Xt("pendingRedirect",e.config.apiKey,e.name)}(t),n=function(e){return Jt(e._redirectPersistence)}(e);if(!await n._isAvailable())return!1;const s="true"===await n._get(r);return await n._remove(r),s}(this.resolver,this.auth),r=t?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Rn.set(this.auth._key(),e)}return this.bypassAuthState||Rn.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Nn(e,t){Rn.set(e._key(),t)}async function Dn(e,t,r=!1){if(Ve(e.app))return Promise.reject(ut(e));const n=pr(e),s=function(e,t){return t?Jt(t):(dt(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(n,t),i=new Pn(n,s,r),o=await i.execute();return o&&!r&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,t)),o}class xn{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return jn(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!jn(e)){const n=(null===(r=e.error.code)||void 0===r?void 0:r.split("auth/")[1])||"internal-error";t.onError(ct(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ln(e))}saveEventToCache(e){this.cachedEventUids.add(Ln(e)),this.lastProcessedEventTime=Date.now()}}function Ln(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function jn({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const Un=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Mn=/^https?/;function $n(e){const t=gt(),{protocol:r,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===n?"chrome-extension:"===r&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===r&&s.hostname===n}if(!Mn.test(r))return!1;if(Un.test(e))return n===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(n)}const Vn=new vt(3e4,6e4);function Fn(){const e=on().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}function Bn(e){return new Promise((t,r)=>{var n,s,i;function o(){Fn(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Fn(),r(ct(e,"network-request-failed"))},timeout:Vn.get()})}if(null===(s=null===(n=on().gapi)||void 0===n?void 0:n.iframes)||void 0===s?void 0:s.Iframe)t(gapi.iframes.getContext());else{if(!(null===(i=on().gapi)||void 0===i?void 0:i.load)){const t=vr("iframefcb");return on()[t]=()=>{gapi.load?o():r(ct(e,"network-request-failed"))},yr(`${mr.gapiScript}?onload=${t}`).catch(e=>r(e))}o()}}).catch(e=>{throw qn=null,e})}let qn=null;const zn=new vt(5e3,15e3),Hn={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Kn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Wn(e){const t=e.config;dt(t.authDomain,e,"auth-domain-config-required");const r=t.emulator?wt(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,n={apiKey:t.apiKey,appName:e.name,v:qe},s=Kn.get(e.config.apiHost);s&&(n.eid=s);const i=e._getFrameworks();return i.length&&(n.fw=i.join(",")),`${r}?${T(n).slice(1)}`}const Gn={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Jn{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const Qn=encodeURIComponent("fac");async function Yn(e,t,r,n,s,i){dt(e.config.authDomain,e,"auth-domain-config-required"),dt(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:n,v:qe,eventId:s};if(t instanceof Mr){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(i||{}))o[e]=t}if(t instanceof $r){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),l=c?`#${Qn}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?wt(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${T(a).slice(1)}${l}`}const Xn="webStorageSupport",Zn=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=tn,this._completeRedirectFn=Dn,this._overrideRedirectResult=Nn}async _openPopup(e,t,r,n){var s;return pt(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()"),function(e,t,r,n=500,s=600){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let a="";const c=Object.assign(Object.assign({},Gn),{width:n.toString(),height:s.toString(),top:i,left:o}),l=m().toLowerCase();r&&(a=nr(l)?"_blank":r),tr(l)&&(t=t||"http://localhost",c.scrollbars="yes");const u=Object.entries(c).reduce((e,[t,r])=>`${e}${t}=${r},`,"");if(function(e=m()){var t;return cr(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==a)return function(e,t){const r=document.createElement("a");r.href=e,r.target=t;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(n)}(t||"",a),new Jn(null);const h=window.open(t||"",a,u);dt(h,e,"popup-blocked");try{h.focus()}catch(e){}return new Jn(h)}(e,await Yn(e,t,r,gt(),n),nn())}async _openRedirect(e,t,r,n){return await this._originValidation(e),s=await Yn(e,t,r,gt(),n),on().location.href=s,new Promise(()=>{});var s}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:r}=this.eventManagers[t];return e?Promise.resolve(e):(pt(r,"If manager is not set, promise should be"),r)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return qn=qn||Bn(e),qn}(e),r=on().gapi;return dt(r,e,"internal-error"),t.open({where:document.body,url:Wn(e),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Hn,dontclear:!0},t=>new Promise(async(r,n)=>{await t.restyle({setHideOnLeave:!1});const s=ct(e,"network-request-failed"),i=on().setTimeout(()=>{n(s)},zn.get());function o(){on().clearTimeout(i),r(t)}t.ping(o).then(o,()=>{n(s)})}))}(e),r=new xn(e);return t.register("authEvent",t=>(dt(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Xn,{type:Xn},r=>{var n;const s=null===(n=null==r?void 0:r[0])||void 0===n?void 0:n[Xn];void 0!==s&&t(!!s),at(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return It(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if($n(e))return}catch(e){}at(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return lr()||rr()||cr()}};var es="@firebase/auth",ts="1.10.8";class rs{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){dt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const ns=l("authIdTokenMaxAge")||300;let ss=null;var is;mr={loadJS:e=>new Promise((t,r)=>{const n=document.createElement("script");var s,i;n.setAttribute("src",e),n.onload=t,n.onerror=e=>{const t=ct("internal-error");t.customData=e,r(t)},n.type="text/javascript",n.charset="UTF-8",(null!==(i=null===(s=document.getElementsByTagName("head"))||void 0===s?void 0:s[0])&&void 0!==i?i:document).appendChild(n)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},is="Browser",Me(new O("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:i,authDomain:o}=r.options;dt(i&&!i.includes(":"),"invalid-api-key",{appName:r.name});const a={apiKey:i,authDomain:o,clientPlatform:is,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ur(is)},c=new fr(r,n,s,a);return function(e,t){const r=(null==t?void 0:t.persistence)||[],n=(Array.isArray(r)?r:[r]).map(Jt);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,null==t?void 0:t.popupRedirectResolver)}(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Me(new O("auth-internal",e=>(e=>new rs(e))(pr(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),Ke(es,ts,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(is)),Ke(es,ts,"esm2017");var os,as,cs="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e.g?e.g:"undefined"!=typeof self?self:{},ls={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function r(e,t,r){r||(r=0);var n=Array(16);if("string"==typeof t)for(var s=0;16>s;++s)n[s]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(s=0;16>s;++s)n[s]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],s=e.g[2];var i=e.g[3],o=t+(i^r&(s^i))+n[0]+3614090360&4294967295;o=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=(r=(s=(i=(t=r+(o<<7&4294967295|o>>>25))+((o=i+(s^t&(r^s))+n[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(r^i&(t^r))+n[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=r+(t^s&(i^t))+n[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^r&(s^i))+n[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(r^s))+n[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(r^i&(t^r))+n[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=r+(t^s&(i^t))+n[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^r&(s^i))+n[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(r^s))+n[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(r^i&(t^r))+n[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=r+(t^s&(i^t))+n[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^r&(s^i))+n[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(r^s))+n[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(r^i&(t^r))+n[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=r+(t^s&(i^t))+n[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^i&(r^s))+n[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(r^s&(t^r))+n[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^r&(i^t))+n[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=r+(i^t&(s^i))+n[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(r^s))+n[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(r^s&(t^r))+n[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^r&(i^t))+n[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=r+(i^t&(s^i))+n[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(r^s))+n[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(r^s&(t^r))+n[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^r&(i^t))+n[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=r+(i^t&(s^i))+n[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(r^s))+n[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(r^s&(t^r))+n[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^r&(i^t))+n[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=r+(i^t&(s^i))+n[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^s^i)+n[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^r^s)+n[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^r)+n[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=r+(s^i^t)+n[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(r^s^i)+n[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^r^s)+n[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^r)+n[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=r+(s^i^t)+n[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(r^s^i)+n[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^r^s)+n[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^r)+n[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=r+(s^i^t)+n[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(r^s^i)+n[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^r^s)+n[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^r)+n[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=r+(s^i^t)+n[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(s^(r|~i))+n[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(r^(t|~s))+n[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~r))+n[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=r+(i^(s|~t))+n[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(r|~i))+n[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(r^(t|~s))+n[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~r))+n[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=r+(i^(s|~t))+n[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(r|~i))+n[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(r^(t|~s))+n[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~r))+n[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=r+(i^(s|~t))+n[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(t=r+((o=t+(s^(r|~i))+n[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(r^(t|~s))+n[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=i+((o=s+(t^(i|~r))+n[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+n[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+i&4294967295}function n(e,t){this.h=t;for(var r=[],n=!0,s=e.length-1;0<=s;s--){var i=0|e[s];n&&i==t||(r[s]=i,n=!1)}this.g=r}!function(e,t){function r(){}r.prototype=t.prototype,e.D=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.C=function(e,r,n){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[r].apply(e,s)}}(t,function(){this.blockSize=-1}),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,s=this.B,i=this.h,o=0;o<t;){if(0==i)for(;o<=n;)r(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(s[i++]=e.charCodeAt(o++),i==this.blockSize){r(this,s),i=0;break}}else for(;o<t;)if(s[i++]=e[o++],i==this.blockSize){r(this,s),i=0;break}}this.h=i,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var r=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&r,r/=256;for(this.u(e),e=Array(16),t=r=0;4>t;++t)for(var n=0;32>n;n+=8)e[r++]=this.g[t]>>>n&255;return e};var s={};function i(e){return-128<=e&&128>e?function(e){var t=s;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new n([0|e],0>e?-1:0)}(e)}(e):new n([0|e],0>e?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(0>e)return d(o(-e));for(var t=[],r=1,s=0;e>=r;s++)t[s]=e/r|0,r*=4294967296;return new n(t,0)}var a=i(0),c=i(1),l=i(16777216);function u(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function h(e){return-1==e.h}function d(e){for(var t=e.g.length,r=[],s=0;s<t;s++)r[s]=~e.g[s];return new n(r,~e.h).add(c)}function f(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function g(e,t){this.g=e,this.h=t}function m(e,t){if(u(t))throw Error("division by zero");if(u(e))return new g(a,a);if(h(e))return t=m(d(e),t),new g(d(t.g),d(t.h));if(h(t))return t=m(e,d(t)),new g(d(t.g),t.h);if(30<e.g.length){if(h(e)||h(t))throw Error("slowDivide_ only works with positive integers.");for(var r=c,n=t;0>=n.l(e);)r=y(r),n=y(n);var s=v(r,1),i=v(n,1);for(n=v(n,2),r=v(r,2);!u(n);){var l=i.add(n);0>=l.l(e)&&(s=s.add(r),i=l),n=v(n,1),r=v(r,1)}return t=f(e,s.j(t)),new g(s,t)}for(s=a;0<=e.l(t);){for(r=Math.max(1,Math.floor(e.m()/t.m())),n=48>=(n=Math.ceil(Math.log(r)/Math.LN2))?1:Math.pow(2,n-48),l=(i=o(r)).j(t);h(l)||0<l.l(e);)l=(i=o(r-=n)).j(t);u(i)&&(i=c),s=s.add(i),e=f(e,l)}return new g(s,e)}function y(e){for(var t=e.g.length+1,r=[],s=0;s<t;s++)r[s]=e.i(s)<<1|e.i(s-1)>>>31;return new n(r,e.h)}function v(e,t){var r=t>>5;t%=32;for(var s=e.g.length-r,i=[],o=0;o<s;o++)i[o]=0<t?e.i(o+r)>>>t|e.i(o+r+1)<<32-t:e.i(o+r);return new n(i,e.h)}(e=n.prototype).m=function(){if(h(this))return-d(this).m();for(var e=0,t=1,r=0;r<this.g.length;r++){var n=this.i(r);e+=(0<=n?n:4294967296+n)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(u(this))return"0";if(h(this))return"-"+d(this).toString(e);for(var t=o(Math.pow(e,6)),r=this,n="";;){var s=m(r,t).g,i=((0<(r=f(r,s.j(t))).g.length?r.g[0]:r.h)>>>0).toString(e);if(u(r=s))return i+n;for(;6>i.length;)i="0"+i;n=i+n}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return h(e=f(this,e))?-1:u(e)?0:1},e.abs=function(){return h(this)?d(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],s=0,i=0;i<=t;i++){var o=s+(65535&this.i(i))+(65535&e.i(i)),a=(o>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);s=a>>>16,o&=65535,a&=65535,r[i]=a<<16|o}return new n(r,-2147483648&r[r.length-1]?-1:0)},e.j=function(e){if(u(this)||u(e))return a;if(h(this))return h(e)?d(this).j(d(e)):d(d(this).j(e));if(h(e))return d(this.j(d(e)));if(0>this.l(l)&&0>e.l(l))return o(this.m()*e.m());for(var t=this.g.length+e.g.length,r=[],s=0;s<2*t;s++)r[s]=0;for(s=0;s<this.g.length;s++)for(var i=0;i<e.g.length;i++){var c=this.i(s)>>>16,f=65535&this.i(s),g=e.i(i)>>>16,m=65535&e.i(i);r[2*s+2*i]+=f*m,p(r,2*s+2*i),r[2*s+2*i+1]+=c*m,p(r,2*s+2*i+1),r[2*s+2*i+1]+=f*g,p(r,2*s+2*i+1),r[2*s+2*i+2]+=c*g,p(r,2*s+2*i+2)}for(s=0;s<t;s++)r[s]=r[2*s+1]<<16|r[2*s];for(s=t;s<2*t;s++)r[s]=0;return new n(r,0)},e.A=function(e){return m(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],s=0;s<t;s++)r[s]=this.i(s)&e.i(s);return new n(r,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],s=0;s<t;s++)r[s]=this.i(s)|e.i(s);return new n(r,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],s=0;s<t;s++)r[s]=this.i(s)^e.i(s);return new n(r,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,as=ls.Md5=t,n.prototype.add=n.prototype.add,n.prototype.multiply=n.prototype.j,n.prototype.modulo=n.prototype.A,n.prototype.compare=n.prototype.l,n.prototype.toNumber=n.prototype.m,n.prototype.toString=n.prototype.toString,n.prototype.getBits=n.prototype.i,n.fromNumber=o,n.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if(2>(r=r||10)||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return d(e(t.substring(1),r));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=o(Math.pow(r,8)),s=a,i=0;i<t.length;i+=8){var c=Math.min(8,t.length-i),l=parseInt(t.substring(i,i+c),r);8>c?(c=o(Math.pow(r,c)),s=s.j(c).add(o(l))):s=(s=s.j(n)).add(o(l))}return s},os=ls.Integer=n}).apply(void 0!==cs?cs:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var us,hs,ds,fs,ps,gs,ms,ys,vs="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e.g?e.g:"undefined"!=typeof self?self:{},ws={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){return e==Array.prototype||e==Object.prototype||(e[t]=r.value),e},r=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof vs&&vs];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);!function(e,n){if(n)e:{var s=r;e=e.split(".");for(var i=0;i<e.length-1;i++){var o=e[i];if(!(o in s))break e;s=s[o]}(n=n(i=s[e=e[e.length-1]]))!=i&&null!=n&&t(s,e,{configurable:!0,writable:!0,value:n})}}("Array.prototype.values",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var r=0,n=!1,s={next:function(){if(!n&&r<e.length){var s=r++;return{value:t(0,e[s]),done:!1}}return n=!0,{done:!0,value:void 0}}};return s[Symbol.iterator]=function(){return s},s}(this,function(e,t){return t})}});var n=n||{},s=this||self;function i(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,r){return e.call.apply(e.bind,arguments)}function c(e,t,r){if(!e)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,n),e.apply(t,r)}}return function(){return e.apply(t,arguments)}}function l(e,t,r){return(l=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function u(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function h(e,t){function r(){}r.prototype=t.prototype,e.aa=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Qb=function(e,r,n){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[r].apply(e,s)}}function d(e){const t=e.length;if(0<t){const r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function f(e,t){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(i(r)){const t=e.length||0,n=r.length||0;e.length=t+n;for(let s=0;s<n;s++)e[t+s]=r[s]}else e.push(r)}}function p(e){return/^[\s\xa0]*$/.test(e)}function g(){var e=s.navigator;return e&&(e=e.userAgent)?e:""}function m(e){return m[" "](e),e}m[" "]=function(){};var y=!(-1==g().indexOf("Gecko")||-1!=g().toLowerCase().indexOf("webkit")&&-1==g().indexOf("Edge")||-1!=g().indexOf("Trident")||-1!=g().indexOf("MSIE")||-1!=g().indexOf("Edge"));function v(e,t,r){for(const n in e)t.call(r,e[n],n,e)}function w(e){const t={};for(const r in e)t[r]=e[r];return t}const _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t],n)e[r]=n[r];for(let t=0;t<_.length;t++)r=_[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}function E(e){var t=1;e=e.split(":");const r=[];for(;0<t&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}function T(e){s.setTimeout(()=>{throw e},0)}function S(){var e=O;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var I=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new k,e=>e.reset());class k{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let C,A=!1,O=new class{constructor(){this.h=this.g=null}add(e,t){const r=I.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},R=()=>{const e=s.Promise.resolve(void 0);C=()=>{e.then(P)}};var P=()=>{for(var e;e=S();){try{e.h.call(e.g)}catch(e){T(e)}var t=I;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}A=!1};function N(){this.s=this.s,this.C=this.C}function D(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}N.prototype.s=!1,N.prototype.ma=function(){this.s||(this.s=!0,this.N())},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},D.prototype.h=function(){this.defaultPrevented=!0};var x=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};s.addEventListener("test",e,t),s.removeEventListener("test",e,t)}catch(e){}return e}();function L(e,t){if(D.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(y){e:{try{m(t.nodeName);var s=!0;break e}catch(e){}s=!1}s||(t=null)}}else"mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement);this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:j[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&L.aa.h.call(this)}}h(L,D);var j={2:"touch",3:"pen",4:"mouse"};L.prototype.h=function(){L.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var U="closure_listenable_"+(1e6*Math.random()|0),M=0;function $(e,t,r,n,s){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=s,this.key=++M,this.da=this.fa=!1}function V(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function F(e){this.src=e,this.g={},this.h=0}function B(e,t){var r=t.type;if(r in e.g){var n,s=e.g[r],i=Array.prototype.indexOf.call(s,t,void 0);(n=0<=i)&&Array.prototype.splice.call(s,i,1),n&&(V(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function q(e,t,r,n){for(var s=0;s<e.length;++s){var i=e[s];if(!i.da&&i.listener==t&&i.capture==!!r&&i.ha==n)return s}return-1}F.prototype.add=function(e,t,r,n,s){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var o=q(e,t,n,s);return-1<o?(t=e[o],r||(t.fa=!1)):((t=new $(t,this.src,i,!!n,s)).fa=r,e.push(t)),t};var z="closure_lm_"+(1e6*Math.random()|0),H={};function K(e,t,r,n,s){if(n&&n.once)return G(e,t,r,n,s);if(Array.isArray(t)){for(var i=0;i<t.length;i++)K(e,t[i],r,n,s);return null}return r=te(r),e&&e[U]?e.K(t,r,o(n)?!!n.capture:!!n,s):W(e,t,r,!1,n,s)}function W(e,t,r,n,s,i){if(!t)throw Error("Invalid event type");var a=o(s)?!!s.capture:!!s,c=Z(e);if(c||(e[z]=c=new F(e)),(r=c.add(t,r,n,a,i)).proxy)return r;if(n=function(){const e=X;return function t(r){return e.call(t.src,t.listener,r)}}(),r.proxy=n,n.src=e,n.listener=r,e.addEventListener)x||(s=a),void 0===s&&(s=!1),e.addEventListener(t.toString(),n,s);else if(e.attachEvent)e.attachEvent(Y(t.toString()),n);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(n)}return r}function G(e,t,r,n,s){if(Array.isArray(t)){for(var i=0;i<t.length;i++)G(e,t[i],r,n,s);return null}return r=te(r),e&&e[U]?e.L(t,r,o(n)?!!n.capture:!!n,s):W(e,t,r,!0,n,s)}function J(e,t,r,n,s){if(Array.isArray(t))for(var i=0;i<t.length;i++)J(e,t[i],r,n,s);else n=o(n)?!!n.capture:!!n,r=te(r),e&&e[U]?(e=e.i,(t=String(t).toString())in e.g&&-1<(r=q(i=e.g[t],r,n,s))&&(V(i[r]),Array.prototype.splice.call(i,r,1),0==i.length&&(delete e.g[t],e.h--))):e&&(e=Z(e))&&(t=e.g[t.toString()],e=-1,t&&(e=q(t,r,n,s)),(r=-1<e?t[e]:null)&&Q(r))}function Q(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[U])B(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(Y(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=Z(t))?(B(r,e),0==r.h&&(r.src=null,t[z]=null)):V(e)}}}function Y(e){return e in H?H[e]:H[e]="on"+e}function X(e,t){if(e.da)e=!0;else{t=new L(t,this);var r=e.listener,n=e.ha||e.src;e.fa&&Q(e),e=r.call(n,t)}return e}function Z(e){return(e=e[z])instanceof F?e:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(e){return"function"==typeof e?e:(e[ee]||(e[ee]=function(t){return e.handleEvent(t)}),e[ee])}function re(){N.call(this),this.i=new F(this),this.M=this,this.F=null}function ne(e,t){var r,n=e.F;if(n)for(r=[];n;n=n.F)r.push(n);if(e=e.M,n=t.type||t,"string"==typeof t)t=new D(t,e);else if(t instanceof D)t.target=t.target||e;else{var s=t;b(t=new D(n,e),s)}if(s=!0,r)for(var i=r.length-1;0<=i;i--){var o=t.g=r[i];s=se(o,n,!0,t)&&s}if(s=se(o=t.g=e,n,!0,t)&&s,s=se(o,n,!1,t)&&s,r)for(i=0;i<r.length;i++)s=se(o=t.g=r[i],n,!1,t)&&s}function se(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.da&&o.capture==r){var a=o.listener,c=o.ha||o.src;o.fa&&B(e.i,o),s=!1!==a.call(c,n)&&s}}return s&&!n.defaultPrevented}function ie(e,t,r){if("function"==typeof e)r&&(e=l(e,r));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return 2147483647<Number(t)?-1:s.setTimeout(e,t||0)}function oe(e){e.g=ie(()=>{e.g=null,e.i&&(e.i=!1,oe(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}h(re,N),re.prototype[U]=!0,re.prototype.removeEventListener=function(e,t,r,n){J(this,e,t,r,n)},re.prototype.N=function(){if(re.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var r=t.g[e],n=0;n<r.length;n++)V(r[n]);delete t.g[e],t.h--}}this.F=null},re.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},re.prototype.L=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class ae extends N{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:oe(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ce(e){N.call(this),this.h=e,this.g={}}h(ce,N);var le=[];function ue(e){v(e.g,function(e,t){this.g.hasOwnProperty(t)&&Q(e)},e),e.g={}}ce.prototype.N=function(){ce.aa.N.call(this),ue(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var he=s.JSON.stringify,de=s.JSON.parse,fe=class{stringify(e){return s.JSON.stringify(e,void 0)}parse(e){return s.JSON.parse(e,void 0)}};function pe(){}function ge(e){return e.h||(e.h=e.i())}function me(){}pe.prototype.h=null;var ye={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ve(){D.call(this,"d")}function we(){D.call(this,"c")}h(ve,D),h(we,D);var _e={},be=null;function Ee(){return be=be||new re}function Te(e){D.call(this,_e.La,e)}function Se(e){const t=Ee();ne(t,new Te(t))}function Ie(e,t){D.call(this,_e.STAT_EVENT,e),this.stat=t}function ke(e){const t=Ee();ne(t,new Ie(t,e))}function Ce(e,t){D.call(this,_e.Ma,e),this.size=t}function Ae(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){e()},t)}function Oe(){this.g=!0}function Re(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var r=JSON.parse(t);if(r)for(e=0;e<r.length;e++)if(Array.isArray(r[e])){var n=r[e];if(!(2>n.length)){var s=n[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return he(r)}catch(e){return t}}(e,r)+(n?" "+n:"")})}_e.La="serverreachability",h(Te,D),_e.STAT_EVENT="statevent",h(Ie,D),_e.Ma="timingevent",h(Ce,D),Oe.prototype.xa=function(){this.g=!1},Oe.prototype.info=function(){};var Pe,Ne={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},De={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function xe(){}function Le(e,t,r,n){this.j=e,this.i=t,this.l=r,this.R=n||1,this.U=new ce(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new je}function je(){this.i=null,this.g="",this.h=!1}h(xe,pe),xe.prototype.g=function(){return new XMLHttpRequest},xe.prototype.i=function(){return{}},Pe=new xe;var Ue={},Me={};function $e(e,t,r){e.L=1,e.v=ht(ot(t)),e.m=r,e.P=!0,Ve(e,null)}function Ve(e,t){e.F=Date.now(),qe(e),e.A=ot(e.v);var r=e.A,n=e.R;Array.isArray(n)||(n=[String(n)]),It(r.i,"t",n),e.C=0,r=e.j.J,e.h=new je,e.g=dr(e.j,r?t:null,!e.m),0<e.O&&(e.M=new ae(l(e.Y,e,e.g),e.O)),t=e.U,r=e.g,n=e.ca;var s="readystatechange";Array.isArray(s)||(s&&(le[0]=s.toString()),s=le);for(var i=0;i<s.length;i++){var o=K(r,s[i],n||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?w(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Se(),function(e,t,r,n,s,i){e.info(function(){if(e.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var h=u.split("_");o=2<=h.length&&"type"==h[1]?o+(u+"=")+l+"&":o+(u+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+n+") [attempt "+s+"]: "+t+"\n"+r+"\n"+o})}(e.i,e.u,e.A,e.l,e.R,e.m)}function Fe(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function Be(e,t){var r=e.C,n=t.indexOf("\n",r);return-1==n?Me:(r=Number(t.substring(r,n)),isNaN(r)?Ue:(n+=1)+r>t.length?Me:(t=t.slice(n,n+r),e.C=n+r,t))}function qe(e){e.S=Date.now()+e.I,ze(e,e.I)}function ze(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ae(l(e.ba,e),t)}function He(e){e.B&&(s.clearTimeout(e.B),e.B=null)}function Ke(e){0==e.j.G||e.J||ar(e.j,e)}function We(e){He(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ue(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function Ge(e,t){try{var r=e.j;if(0!=r.G&&(r.g==e||Ze(r.h,e)))if(!e.K&&Ze(r.h,e)&&3==r.G){try{var n=r.Da.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var s=n;if(0==s[0]){e:if(!r.u){if(r.g){if(!(r.g.F+3e3<e.F))break e;or(r),Qt(r)}nr(r),ke(18)}}else r.za=s[1],0<r.za-r.T&&37500>s[2]&&r.F&&0==r.v&&!r.C&&(r.C=Ae(l(r.Za,r),6e3));if(1>=Xe(r.h)&&r.ca){try{r.ca()}catch(e){}r.ca=void 0}}else lr(r,11)}else if((e.K||r.g==e)&&or(r),!p(t))for(s=r.Da.g.parse(t),t=0;t<s.length;t++){let l=s[t];if(r.T=l[0],l=l[1],2==r.G)if("c"==l[0]){r.K=l[1],r.ia=l[2];const t=l[3];null!=t&&(r.la=t,r.j.info("VER="+r.la));const s=l[4];null!=s&&(r.Aa=s,r.j.info("SVER="+r.Aa));const u=l[5];null!=u&&"number"==typeof u&&0<u&&(n=1.5*u,r.L=n,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=n.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(et(i,i.h),i.h=null))}if(n.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.ya=e,ut(n.I,n.D,e))}}r.G=3,r.l&&r.l.ua(),r.ba&&(r.R=Date.now()-e.F,r.j.info("Handshake RTT: "+r.R+"ms"));var o=e;if((n=r).qa=hr(n,n.J?n.ia:null,n.W),o.K){tt(n.h,o);var a=o,c=n.L;c&&(a.I=c),a.B&&(He(a),qe(a)),n.g=o}else rr(n);0<r.i.length&&Xt(r)}else"stop"!=l[0]&&"close"!=l[0]||lr(r,7);else 3==r.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?lr(r,7):Jt(r):"noop"!=l[0]&&r.l&&r.l.ta(l),r.v=0)}Se()}catch(e){}}Le.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Ht(e)?t.j():this.Y(e)},Le.prototype.Y=function(e){try{if(e==this.g)e:{const d=Ht(this.g);var t=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||Kt(this.g)))){this.J||4!=d||7==t||Se(),He(this);var r=this.g.Z();this.X=r;t:if(Fe(this)){var n=Kt(this.g);e="";var i=n.length,o=4==Ht(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){We(this),Ke(this);var a="";break t}this.h.i=new s.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(n[t],{stream:!(o&&t==i-1)});n.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==r,function(e,t,r,n,s,i,o){e.info(function(){return"XMLHTTP RESP ("+n+") [ attempt "+s+"]: "+t+"\n"+r+"\n"+i+" "+o})}(this.i,this.u,this.A,this.l,this.R,d,r),this.o){if(this.T&&!this.K){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(c)){var u=c;break t}}u=null}if(!(r=u)){this.o=!1,this.s=3,ke(12),We(this),Ke(this);break e}Re(this.i,this.l,r,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ge(this,r)}if(this.P){let e;for(r=!0;!this.J&&this.C<a.length;){if(e=Be(this,a),e==Me){4==d&&(this.s=4,ke(14),r=!1),Re(this.i,this.l,null,"[Incomplete Response]");break}if(e==Ue){this.s=4,ke(15),Re(this.i,this.l,a,"[Invalid Chunk]"),r=!1;break}Re(this.i,this.l,e,null),Ge(this,e)}if(Fe(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,ke(16),r=!1),this.o=this.o&&r,r){if(0<a.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),sr(h),h.M=!0,ke(11))}}else Re(this.i,this.l,a,"[Invalid Chunked Response]"),We(this),Ke(this)}else Re(this.i,this.l,a,null),Ge(this,a);4==d&&We(this),this.o&&!this.J&&(4==d?ar(this.j,this):(this.o=!1,qe(this)))}else(function(e){const t={};e=(e.g&&2<=Ht(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(p(e[n]))continue;var r=E(e[n]);const s=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();const i=t[s]||[];t[s]=i,i.push(r)}!function(e,t){for(const r in e)t.call(void 0,e[r],r,e)}(t,function(e){return e.join(", ")})})(this.g),400==r&&0<a.indexOf("Unknown SID")?(this.s=3,ke(12)):(this.s=0,ke(13)),We(this),Ke(this)}}}catch(e){}},Le.prototype.cancel=function(){this.J=!0,We(this)},Le.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(Se(),ke(17)),We(this),this.s=2,Ke(this)):ze(this,this.S-e)};var Je=class{constructor(e,t){this.g=e,this.map=t}};function Qe(e){this.l=e||10,e=s.PerformanceNavigationTiming?0<(e=s.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ye(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Xe(e){return e.h?1:e.g?e.g.size:0}function Ze(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function et(e,t){e.g?e.g.add(t):e.h=t}function tt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function rt(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const r of e.g.values())t=t.concat(r.D);return t}return d(e.i)}function nt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(i(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var r=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(i(e)||"string"==typeof e){var t=[];e=e.length;for(var r=0;r<e;r++)t.push(r);return t}t=[],r=0;for(const n in e)t[r++]=n;return t}}}(e),n=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(i(e)){for(var t=[],r=e.length,n=0;n<r;n++)t.push(e[n]);return t}for(n in t=[],r=0,e)t[r++]=e[n];return t}(e),s=n.length,o=0;o<s;o++)t.call(void 0,n[o],r&&r[o],e)}Qe.prototype.cancel=function(){if(this.i=rt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var st=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function it(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof it){this.h=e.h,at(this,e.j),this.o=e.o,this.g=e.g,ct(this,e.s),this.l=e.l;var t=e.i,r=new bt;r.i=t.i,t.g&&(r.g=new Map(t.g),r.h=t.h),lt(this,r),this.m=e.m}else e&&(t=String(e).match(st))?(this.h=!1,at(this,t[1]||"",!0),this.o=dt(t[2]||""),this.g=dt(t[3]||"",!0),ct(this,t[4]),this.l=dt(t[5]||"",!0),lt(this,t[6]||"",!0),this.m=dt(t[7]||"")):(this.h=!1,this.i=new bt(null,this.h))}function ot(e){return new it(e)}function at(e,t,r){e.j=r?dt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ct(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function lt(e,t,r){t instanceof bt?(e.i=t,function(e,t){t&&!e.j&&(Et(e),e.i=null,e.g.forEach(function(e,t){var r=t.toLowerCase();t!=r&&(Tt(this,t),It(this,r,e))},e)),e.j=t}(e.i,e.h)):(r||(t=ft(t,wt)),e.i=new bt(t,e.h))}function ut(e,t,r){e.i.set(t,r)}function ht(e){return ut(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function dt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ft(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,pt),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function pt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}it.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ft(t,mt,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ft(t,mt,!0),"@"),e.push(encodeURIComponent(String(r)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.s)&&e.push(":",String(r))),(r=this.l)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(ft(r,"/"==r.charAt(0)?vt:yt,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",ft(r,_t)),e.join("")};var gt,mt=/[#\/\?@]/g,yt=/[#\?:]/g,vt=/[#\?]/g,wt=/[#\?@]/g,_t=/#/g;function bt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Et(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var r=0;r<e.length;r++){var n=e[r].indexOf("="),s=null;if(0<=n){var i=e[r].substring(0,n);s=e[r].substring(n+1)}else i=e[r];t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function Tt(e,t){Et(e),t=kt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function St(e,t){return Et(e),t=kt(e,t),e.g.has(t)}function It(e,t,r){Tt(e,t),0<r.length&&(e.i=null,e.g.set(kt(e,t),d(r)),e.h+=r.length)}function kt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Ct(e,t,r,n,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),n(r)}catch(e){}}function At(){this.g=new fe}function Ot(e,t,r){const n=r||"";try{nt(e,function(e,r){let s=e;o(e)&&(s=he(e)),t.push(n+r+"="+encodeURIComponent(s))})}catch(e){throw t.push(n+"type="+encodeURIComponent("_badmap")),e}}function Rt(e){this.l=e.Ub||null,this.j=e.eb||!1}function Pt(e,t){re.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Nt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Dt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,xt(e)}function xt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Lt(e){let t="";return v(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function jt(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=Lt(r),"string"==typeof e?null!=r&&encodeURIComponent(String(r)):ut(e,t,r))}function Ut(e){re.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=bt.prototype).add=function(e,t){Et(this),this.i=null,e=kt(this,e);var r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},e.forEach=function(e,t){Et(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},e.na=function(){Et(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),r=[];for(let n=0;n<t.length;n++){const s=e[n];for(let e=0;e<s.length;e++)r.push(t[n])}return r},e.V=function(e){Et(this);let t=[];if("string"==typeof e)St(this,e)&&(t=t.concat(this.g.get(kt(this,e))));else{e=Array.from(this.g.values());for(let r=0;r<e.length;r++)t=t.concat(e[r])}return t},e.set=function(e,t){return Et(this),this.i=null,St(this,e=kt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var r=0;r<t.length;r++){var n=t[r];const i=encodeURIComponent(String(n)),o=this.V(n);for(n=0;n<o.length;n++){var s=i;""!==o[n]&&(s+="="+encodeURIComponent(String(o[n]))),e.push(s)}}return this.i=e.join("&")},h(Rt,pe),Rt.prototype.g=function(){return new Pt(this.l,this.j)},Rt.prototype.i=(gt={},function(){return gt}),h(Pt,re),(e=Pt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,xt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||s).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Dt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,xt(this)),this.g&&(this.readyState=3,xt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==s.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Nt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Dt(this):xt(this),3==this.readyState&&Nt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Dt(this))},e.Qa=function(e){this.g&&(this.response=e,Dt(this))},e.ga=function(){this.g&&Dt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var r=t.next();!r.done;)r=r.value,e.push(r[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(Pt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),h(Ut,re);var Mt=/^https?$/i,$t=["POST","PUT"];function Vt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Ft(e),qt(e)}function Ft(e){e.A||(e.A=!0,ne(e,"complete"),ne(e,"error"))}function Bt(e){if(e.h&&void 0!==n&&(!e.v[1]||4!=Ht(e)||2!=e.Z()))if(e.u&&4==Ht(e))ie(e.Ea,0,e);else if(ne(e,"readystatechange"),4==Ht(e)){e.h=!1;try{const n=e.Z();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var r;if(!(r=t)){var i;if(i=0===n){var o=String(e.D).match(st)[1]||null;!o&&s.self&&s.self.location&&(o=s.self.location.protocol.slice(0,-1)),i=!Mt.test(o?o.toLowerCase():"")}r=i}if(r)ne(e,"complete"),ne(e,"success");else{e.m=6;try{var a=2<Ht(e)?e.g.statusText:""}catch(e){a=""}e.l=a+" ["+e.Z()+"]",Ft(e)}}finally{qt(e)}}}function qt(e,t){if(e.g){zt(e);const r=e.g,n=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||ne(e,"ready");try{r.onreadystatechange=n}catch(e){}}}function zt(e){e.I&&(s.clearTimeout(e.I),e.I=null)}function Ht(e){return e.g?e.g.readyState:0}function Kt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Wt(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function Gt(e){this.Aa=0,this.i=[],this.j=new Oe,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Wt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Wt("baseRetryDelayMs",5e3,e),this.cb=Wt("retryDelaySeedMs",1e4,e),this.Wa=Wt("forwardChannelMaxRetries",2,e),this.wa=Wt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Qe(e&&e.concurrentRequestLimit),this.Da=new At,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Jt(e){if(Yt(e),3==e.G){var t=e.U++,r=ot(e.I);if(ut(r,"SID",e.K),ut(r,"RID",t),ut(r,"TYPE","terminate"),er(e,r),(t=new Le(e,e.j,t)).L=2,t.v=ht(ot(r)),r=!1,s.navigator&&s.navigator.sendBeacon)try{r=s.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!r&&s.Image&&((new Image).src=t.v,r=!0),r||(t.g=dr(t.j,null),t.g.ea(t.v)),t.F=Date.now(),qe(t)}ur(e)}function Qt(e){e.g&&(sr(e),e.g.cancel(),e.g=null)}function Yt(e){Qt(e),e.u&&(s.clearTimeout(e.u),e.u=null),or(e),e.h.cancel(),e.s&&("number"==typeof e.s&&s.clearTimeout(e.s),e.s=null)}function Xt(e){if(!Ye(e.h)&&!e.s){e.s=!0;var t=e.Ga;C||R(),A||(C(),A=!0),O.add(t,e),e.B=0}}function Zt(e,t){var r;r=t?t.l:e.U++;const n=ot(e.I);ut(n,"SID",e.K),ut(n,"RID",r),ut(n,"AID",e.T),er(e,n),e.m&&e.o&&jt(n,e.m,e.o),r=new Le(e,e.j,r,e.B+1),null===e.m&&(r.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tr(e,r,1e3),r.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),et(e.h,r),$e(r,n,t)}function er(e,t){e.H&&v(e.H,function(e,r){ut(t,r,e)}),e.l&&nt({},function(e,r){ut(t,r,e)})}function tr(e,t,r){r=Math.min(e.i.length,r);var n=e.l?l(e.l.Na,e.l,e):null;e:{var s=e.i;let t=-1;for(;;){const e=["count="+r];-1==t?0<r?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let i=!0;for(let o=0;o<r;o++){let r=s[o].g;const a=s[o].map;if(r-=t,0>r)t=Math.max(0,s[o].g-100),i=!1;else try{Ot(a,e,"req"+r+"_")}catch(e){n&&n(a)}}if(i){n=e.join("&");break e}}}return e=e.i.splice(0,r),t.D=e,n}function rr(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;C||R(),A||(C(),A=!0),O.add(t,e),e.v=0}}function nr(e){return!(e.g||e.u||3<=e.v||(e.Y++,e.u=Ae(l(e.Fa,e),cr(e,e.v)),e.v++,0))}function sr(e){null!=e.A&&(s.clearTimeout(e.A),e.A=null)}function ir(e){e.g=new Le(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=ot(e.qa);ut(t,"RID","rpc"),ut(t,"SID",e.K),ut(t,"AID",e.T),ut(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&ut(t,"TO",e.ja),ut(t,"TYPE","xmlhttp"),er(e,t),e.m&&e.o&&jt(t,e.m,e.o),e.L&&(e.g.I=e.L);var r=e.g;e=e.ia,r.L=1,r.v=ht(ot(t)),r.m=null,r.P=!0,Ve(r,e)}function or(e){null!=e.C&&(s.clearTimeout(e.C),e.C=null)}function ar(e,t){var r=null;if(e.g==t){or(e),sr(e),e.g=null;var n=2}else{if(!Ze(e.h,t))return;r=t.D,tt(e.h,t),n=1}if(0!=e.G)if(t.o)if(1==n){r=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;ne(n=Ee(),new Ce(n,r)),Xt(e)}else rr(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==n&&function(e,t){return!(Xe(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=Ae(l(e.Ga,e,t),cr(e,e.B)),e.B++,0)))}(e,t)||2==n&&nr(e)))switch(r&&0<r.length&&(t=e.h,t.i=t.i.concat(r)),s){case 1:lr(e,5);break;case 4:lr(e,10);break;case 3:lr(e,6);break;default:lr(e,2)}}function cr(e,t){let r=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(r*=2),r*t}function lr(e,t){if(e.j.info("Error code "+t),2==t){var r=l(e.fb,e),n=e.Xa;const t=!n;n=new it(n||"//www.google.com/images/cleardot.gif"),s.location&&"http"==s.location.protocol||at(n,"https"),ht(n),t?function(e,t){const r=new Oe;if(s.Image){const n=new Image;n.onload=u(Ct,r,"TestLoadImage: loaded",!0,t,n),n.onerror=u(Ct,r,"TestLoadImage: error",!1,t,n),n.onabort=u(Ct,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=u(Ct,r,"TestLoadImage: timeout",!1,t,n),s.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(n.toString(),r):function(e,t){new Oe;const r=new AbortController,n=setTimeout(()=>{r.abort(),Ct(0,0,!1,t)},1e4);fetch(e,{signal:r.signal}).then(e=>{clearTimeout(n),e.ok?Ct(0,0,!0,t):Ct(0,0,!1,t)}).catch(()=>{clearTimeout(n),Ct(0,0,!1,t)})}(n.toString(),r)}else ke(2);e.G=0,e.l&&e.l.sa(t),ur(e),Yt(e)}function ur(e){if(e.G=0,e.ka=[],e.l){const t=rt(e.h);0==t.length&&0==e.i.length||(f(e.ka,t),f(e.ka,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.ra()}}function hr(e,t,r){var n=r instanceof it?ot(r):new it(r);if(""!=n.g)t&&(n.g=t+"."+n.g),ct(n,n.s);else{var i=s.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var o=new it(null);n&&at(o,n),t&&(o.g=t),i&&ct(o,i),r&&(o.l=r),n=o}return r=e.D,t=e.ya,r&&t&&ut(n,r,t),ut(n,"VER",e.la),er(e,n),n}function dr(e,t,r){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Ut(new Rt({eb:r})):new Ut(e.pa)).Ha(e.J),t}function fr(){}function pr(){}function gr(e,t){re.call(this),this.g=new Gt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!p(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!p(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new vr(this)}function mr(e){ve.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function yr(){we.call(this),this.status=1}function vr(e){this.g=e}(e=Ut.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,r,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Pe.g(),this.v=this.o?ge(this.o):ge(Pe),this.g.onreadystatechange=l(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void Vt(this,e)}if(e=r||"",r=new Map(this.headers),n)if(Object.getPrototypeOf(n)===Object.prototype)for(var i in n)r.set(i,n[i]);else{if("function"!=typeof n.keys||"function"!=typeof n.get)throw Error("Unknown input type for opt_headers: "+String(n));for(const e of n.keys())r.set(e,n.get(e))}n=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),i=s.FormData&&e instanceof s.FormData,!(0<=Array.prototype.indexOf.call($t,t,void 0))||n||i||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of r)this.g.setRequestHeader(e,t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{zt(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){Vt(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,ne(this,"complete"),ne(this,"abort"),qt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),qt(this,!0)),Ut.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Bt(this):this.bb())},e.bb=function(){Bt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Ht(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),de(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Gt.prototype).la=8,e.G=1,e.connect=function(e,t,r,n){ke(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.I=hr(this,null,this.W),Xt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const s=new Le(this,this.j,e);let i=this.o;if(this.S&&(i?(i=w(i),b(i,this.S)):i=this.S),null!==this.m||this.O||(s.H=i,i=null),this.P)e:{for(var t=0,r=0;r<this.i.length;r++){var n=this.i[r];if(void 0===(n="__data__"in n.map&&"string"==typeof(n=n.map.__data__)?n.length:void 0))break;if(4096<(t+=n)){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tr(this,s,t),ut(r=ot(this.I),"RID",e),ut(r,"CVER",22),this.D&&ut(r,"X-HTTP-Session-Id",this.D),er(this,r),i&&(this.O?t="headers="+encodeURIComponent(String(Lt(i)))+"&"+t:this.m&&jt(r,this.m,i)),et(this.h,s),this.Ua&&ut(r,"TYPE","init"),this.P?(ut(r,"$req",t),ut(r,"SID","null"),s.T=!0,$e(s,r,null)):$e(s,r,t),this.G=2}}else 3==this.G&&(e?Zt(this,e):0==this.i.length||Ye(this.h)||Zt(this))},e.Fa=function(){if(this.u=null,ir(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Ae(l(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ke(10),Qt(this),ir(this))},e.Za=function(){null!=this.C&&(this.C=null,Qt(this),nr(this),ke(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),ke(2)):(this.j.info("Failed to ping google.com"),ke(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=fr.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},pr.prototype.g=function(e,t){return new gr(e,t)},h(gr,re),gr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},gr.prototype.close=function(){Jt(this.g)},gr.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.u&&((r={}).__data__=he(e),e=r);t.i.push(new Je(t.Ya++,e)),3==t.G&&Xt(t)},gr.prototype.N=function(){this.g.l=null,delete this.j,Jt(this.g),delete this.g,gr.aa.N.call(this)},h(mr,ve),h(yr,we),h(vr,fr),vr.prototype.ua=function(){ne(this.g,"a")},vr.prototype.ta=function(e){ne(this.g,new mr(e))},vr.prototype.sa=function(e){ne(this.g,new yr)},vr.prototype.ra=function(){ne(this.g,"b")},pr.prototype.createWebChannel=pr.prototype.g,gr.prototype.send=gr.prototype.o,gr.prototype.open=gr.prototype.m,gr.prototype.close=gr.prototype.close,ys=ws.createWebChannelTransport=function(){return new pr},ms=ws.getStatEventTarget=function(){return Ee()},gs=ws.Event=_e,ps=ws.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ne.NO_ERROR=0,Ne.TIMEOUT=8,Ne.HTTP_ERROR=6,fs=ws.ErrorCode=Ne,De.COMPLETE="complete",ds=ws.EventType=De,me.EventType=ye,ye.OPEN="a",ye.CLOSE="b",ye.ERROR="c",ye.MESSAGE="d",re.prototype.listen=re.prototype.K,hs=ws.WebChannel=me,ws.FetchXmlHttpFactory=Rt,Ut.prototype.listenOnce=Ut.prototype.L,Ut.prototype.getLastError=Ut.prototype.Ka,Ut.prototype.getLastErrorCode=Ut.prototype.Ba,Ut.prototype.getStatus=Ut.prototype.Z,Ut.prototype.getResponseJson=Ut.prototype.Oa,Ut.prototype.getResponseText=Ut.prototype.oa,Ut.prototype.send=Ut.prototype.ea,Ut.prototype.setWithCredentials=Ut.prototype.Ha,us=ws.XhrIo=Ut}).apply(void 0!==vs?vs:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const _s="@firebase/firestore",bs="4.8.0";class Es{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Es.UNAUTHENTICATED=new Es(null),Es.GOOGLE_CREDENTIALS=new Es("google-credentials-uid"),Es.FIRST_PARTY=new Es("first-party-uid"),Es.MOCK_USER=new Es("mock-user");let Ts="11.10.0";const Ss=new $("@firebase/firestore");function Is(){return Ss.logLevel}function ks(e,...t){if(Ss.logLevel<=x.DEBUG){const r=t.map(Os);Ss.debug(`Firestore (${Ts}): ${e}`,...r)}}function Cs(e,...t){if(Ss.logLevel<=x.ERROR){const r=t.map(Os);Ss.error(`Firestore (${Ts}): ${e}`,...r)}}function As(e,...t){if(Ss.logLevel<=x.WARN){const r=t.map(Os);Ss.warn(`Firestore (${Ts}): ${e}`,...r)}}function Os(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function Rs(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,Ps(e,n,r)}function Ps(e,t,r){let n=`FIRESTORE (${Ts}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw Cs(n),new Error(n)}function Ns(e,t,r,n){let s="Unexpected state";"string"==typeof r?s=r:n=r,e||Ps(t,s,n)}function Ds(e,t){return e}const xs={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ls extends v{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class js{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Us{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ms{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Es.UNAUTHENTICATED))}shutdown(){}}class $s{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Vs{constructor(e){this.t=e,this.currentUser=Es.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Ns(void 0===this.o,42304);let r=this.i;const n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve();let s=new js;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new js,e.enqueueRetryable(()=>n(this.currentUser))};const i=()=>{const t=s;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},o=e=>{ks("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(ks("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new js)}},0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(ks("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Ns("string"==typeof t.accessToken,31837,{l:t}),new Us(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ns(null===e||"string"==typeof e,2055,{h:e}),new Es(e)}}class Fs{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Es.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Bs{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Fs(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Es.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class qs{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class zs{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ve(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Ns(void 0===this.o,3512);const r=e=>{null!=e.error&&ks("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const r=e.token!==this.m;return this.m=e.token,ks("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};const n=e=>{ks("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?n(e):ks("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new qs(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(Ns("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new qs(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Hs(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let t=0;t<e;t++)r[t]=Math.floor(256*Math.random());return r}function Ks(){return new TextEncoder}class Ws{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const r=Hs(40);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function Gs(e,t){return e<t?-1:e>t?1:0}function Js(e,t){let r=0;for(;r<e.length&&r<t.length;){const n=e.codePointAt(r),s=t.codePointAt(r);if(n!==s){if(n<128&&s<128)return Gs(n,s);{const i=Ks(),o=Ys(i.encode(Qs(e,r)),i.encode(Qs(t,r)));return 0!==o?o:Gs(n,s)}}r+=n>65535?2:1}return Gs(e.length,t.length)}function Qs(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function Ys(e,t){for(let r=0;r<e.length&&r<t.length;++r)if(e[r]!==t[r])return Gs(e[r],t[r]);return Gs(e.length,t.length)}function Xs(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}const Zs="__name__";class ei{constructor(e,t,r){void 0===t?t=0:t>e.length&&Rs(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&Rs(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===ei.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ei?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let n=0;n<r;n++){const r=ei.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return Gs(e.length,t.length)}static compareSegments(e,t){const r=ei.isNumericId(e),n=ei.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?ei.extractNumericId(e).compare(ei.extractNumericId(t)):Js(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return os.fromString(e.substring(4,e.length-2))}}class ti extends ei{construct(e,t,r){return new ti(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Ls(xs.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new ti(t)}static emptyPath(){return new ti([])}}const ri=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ni extends ei{construct(e,t,r){return new ni(e,t,r)}static isValidIdentifier(e){return ri.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ni.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Zs}static keyField(){return new ni([Zs])}static fromServerFormat(e){const t=[];let r="",n=0;const s=()=>{if(0===r.length)throw new Ls(xs.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let i=!1;for(;n<e.length;){const t=e[n];if("\\"===t){if(n+1===e.length)throw new Ls(xs.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Ls(xs.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?(i=!i,n++):"."!==t||i?(r+=t,n++):(s(),n++)}if(s(),i)throw new Ls(xs.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ni(t)}static emptyPath(){return new ni([])}}class si{constructor(e){this.path=e}static fromPath(e){return new si(ti.fromString(e))}static fromName(e){return new si(ti.fromString(e).popFirst(5))}static empty(){return new si(ti.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ti.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ti.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new si(new ti(e.slice()))}}function ii(e){if(!si.isDocumentKey(e))throw new Ls(xs.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function oi(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Ls(xs.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=function(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Rs(12329,{type:typeof e})}(e);throw new Ls(xs.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function ai(e,t){const r={typeString:e};return t&&(r.value=t),r}function ci(e,t){if(!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(e))throw new Ls(xs.INVALID_ARGUMENT,"JSON must be an object");let r;for(const n in t)if(t[n]){const s=t[n].typeString,i="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}const o=e[n];if(s&&typeof o!==s){r=`JSON field '${n}' must be a ${s}.`;break}if(void 0!==i&&o!==i.value){r=`Expected '${n}' field to equal '${i.value}'`;break}}if(r)throw new Ls(xs.INVALID_ARGUMENT,r);return!0}const li=-62135596800,ui=1e6;class hi{static now(){return hi.fromMillis(Date.now())}static fromDate(e){return hi.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*ui);return new hi(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ls(xs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ls(xs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<li)throw new Ls(xs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ls(xs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ui}_compareTo(e){return this.seconds===e.seconds?Gs(this.nanoseconds,e.nanoseconds):Gs(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:hi._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ci(e,hi._jsonSchema))return new hi(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-li;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}hi._jsonSchemaVersion="firestore/timestamp/1.0",hi._jsonSchema={type:ai("string",hi._jsonSchemaVersion),seconds:ai("number"),nanoseconds:ai("number")};class di{static fromTimestamp(e){return new di(e)}static min(){return new di(new hi(0,0))}static max(){return new di(new hi(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function fi(e){return new pi(e.readTime,e.key,-1)}class pi{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new pi(di.min(),si.empty(),-1)}static max(){return new pi(di.max(),si.empty(),-1)}}function gi(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r?r:(r=si.comparator(e.documentKey,t.documentKey),0!==r?r:Gs(e.largestBatchId,t.largestBatchId))}class mi{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function yi(e){if(e.code!==xs.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;ks("LocalStore","Unexpectedly lost primary lease")}class vi{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Rs(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new vi((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof vi?t:vi.resolve(t)}catch(e){return vi.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):vi.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):vi.reject(t)}static resolve(e){return new vi((t,r)=>{t(e)})}static reject(e){return new vi((t,r)=>{r(e)})}static waitFor(e){return new vi((t,r)=>{let n=0,s=0,i=!1;e.forEach(e=>{++n,e.next(()=>{++s,i&&s===n&&t()},e=>r(e))}),i=!0,s===n&&t()})}static or(e){let t=vi.resolve(!1);for(const r of e)t=t.next(e=>e?vi.resolve(e):r());return t}static forEach(e,t){const r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new vi((r,n)=>{const s=e.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;t(e[c]).next(e=>{i[c]=e,++o,o===s&&r(i)},e=>n(e))}})}static doWhile(e,t){return new vi((r,n)=>{const s=()=>{!0===e()?t().next(()=>{s()},n):r()};s()})}}function wi(e){return"IndexedDbTransactionError"===e.name}class _i{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this._e(e),this.ae=e=>t.writeSequenceNumber(e))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ae&&this.ae(e),e}}_i.ue=-1;function bi(e){return null==e}function Ei(e){return 0===e&&1/e==-1/0}function Ti(e,t){let r=t;const n=e.length;for(let t=0;t<n;t++){const n=e.charAt(t);switch(n){case"\0":r+="";break;case"":r+="";break;default:r+=n}}return r}function Si(e){return e+""}const Ii="owner",ki="mutationQueues",Ci="mutations",Ai="documentMutations",Oi="remoteDocumentGlobal",Ri="targets",Pi="targetDocuments",Ni="targetGlobal",Di="collectionParents",xi="clientMetadata",Li="bundles",ji="namedQueries";function Ui(e){let t=0;for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function Mi(e,t){for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}class $i{constructor(e,t){this.comparator=e,this.root=t||Fi.EMPTY}insert(e,t){return new $i(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Fi.BLACK,null,null))}remove(e){return new $i(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Fi.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Vi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Vi(this.root,e,this.comparator,!1)}getReverseIterator(){return new Vi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Vi(this.root,e,this.comparator,!0)}}class Vi{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&n&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Fi{constructor(e,t,r,n,s){this.key=e,this.value=t,this.color=null!=r?r:Fi.RED,this.left=null!=n?n:Fi.EMPTY,this.right=null!=s?s:Fi.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,s){return new Fi(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this;const s=r(e,n.key);return n=s<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===s?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r)),n.fixUp()}removeMin(){if(this.left.isEmpty())return Fi.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,n=this;if(t(e,n.key)<0)n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return Fi.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Fi.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Fi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Rs(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Rs(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Rs(27949);return e+(this.isRed()?0:1)}}Fi.EMPTY=null,Fi.RED=!0,Fi.BLACK=!1,Fi.EMPTY=new class{constructor(){this.size=0}get key(){throw Rs(57766)}get value(){throw Rs(16141)}get color(){throw Rs(16727)}get left(){throw Rs(29726)}get right(){throw Rs(36894)}copy(e,t,r,n,s){return this}insert(e,t,r){return new Fi(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Bi{constructor(e){this.comparator=e,this.data=new $i(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new qi(this.data.getIterator())}getIteratorFrom(e){return new qi(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Bi))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Bi(this.comparator);return t.data=e,t}}class qi{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class zi{constructor(e){this.fields=e,e.sort(ni.comparator)}static empty(){return new zi([])}unionWith(e){let t=new Bi(ni.comparator);for(const e of this.fields)t=t.add(e);for(const r of e)t=t.add(r);return new zi(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Xs(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Hi extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ki{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Hi("Invalid base64 string: "+e):e}}(e);return new Ki(t)}static fromUint8Array(e){const t=function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e);return new Ki(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Gs(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ki.EMPTY_BYTE_STRING=new Ki("");const Wi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Gi(e){if(Ns(!!e,39018),"string"==typeof e){let t=0;const r=Wi.exec(e);if(Ns(!!r,46558,{timestamp:e}),r[1]){let e=r[1];e=(e+"000000000").substr(0,9),t=Number(e)}const n=new Date(e);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:Ji(e.seconds),nanos:Ji(e.nanos)}}function Ji(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Qi(e){return"string"==typeof e?Ki.fromBase64String(e):Ki.fromUint8Array(e)}const Yi="server_timestamp",Xi="__type__",Zi="__previous_value__",eo="__local_write_time__";function to(e){var t,r;return(null===(r=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[Xi])||void 0===r?void 0:r.stringValue)===Yi}function ro(e){const t=e.mapValue.fields[Zi];return to(t)?ro(t):t}function no(e){const t=Gi(e.mapValue.fields[eo].timestampValue);return new hi(t.seconds,t.nanos)}class so{constructor(e,t,r,n,s,i,o,a,c,l){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=l}}const io="(default)";class oo{constructor(e,t){this.projectId=e,this.database=t||io}static empty(){return new oo("","")}get isDefaultDatabase(){return this.database===io}isEqual(e){return e instanceof oo&&e.projectId===this.projectId&&e.database===this.database}}const ao="__max__",co={fields:{__type__:{stringValue:ao}}},lo="value";function uo(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?to(e)?4:Co(e)?9007199254740991:Io(e)?10:11:Rs(28295,{value:e})}function ho(e,t){if(e===t)return!0;const r=uo(e);if(r!==uo(t))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return no(e).isEqual(no(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const r=Gi(e.timestampValue),n=Gi(t.timestampValue);return r.seconds===n.seconds&&r.nanos===n.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Qi(e.bytesValue).isEqual(Qi(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Ji(e.geoPointValue.latitude)===Ji(t.geoPointValue.latitude)&&Ji(e.geoPointValue.longitude)===Ji(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Ji(e.integerValue)===Ji(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const r=Ji(e.doubleValue),n=Ji(t.doubleValue);return r===n?Ei(r)===Ei(n):isNaN(r)&&isNaN(n)}return!1}(e,t);case 9:return Xs(e.arrayValue.values||[],t.arrayValue.values||[],ho);case 10:case 11:return function(e,t){const r=e.mapValue.fields||{},n=t.mapValue.fields||{};if(Ui(r)!==Ui(n))return!1;for(const e in r)if(r.hasOwnProperty(e)&&(void 0===n[e]||!ho(r[e],n[e])))return!1;return!0}(e,t);default:return Rs(52216,{left:e})}}function fo(e,t){return void 0!==(e.values||[]).find(e=>ho(e,t))}function po(e,t){if(e===t)return 0;const r=uo(e),n=uo(t);if(r!==n)return Gs(r,n);switch(r){case 0:case 9007199254740991:return 0;case 1:return Gs(e.booleanValue,t.booleanValue);case 2:return function(e,t){const r=Ji(e.integerValue||e.doubleValue),n=Ji(t.integerValue||t.doubleValue);return r<n?-1:r>n?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1}(e,t);case 3:return go(e.timestampValue,t.timestampValue);case 4:return go(no(e),no(t));case 5:return Js(e.stringValue,t.stringValue);case 6:return function(e,t){const r=Qi(e),n=Qi(t);return r.compareTo(n)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){const t=Gs(r[e],n[e]);if(0!==t)return t}return Gs(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const r=Gs(Ji(e.latitude),Ji(t.latitude));return 0!==r?r:Gs(Ji(e.longitude),Ji(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return mo(e.arrayValue,t.arrayValue);case 10:return function(e,t){var r,n,s,i;const o=e.fields||{},a=t.fields||{},c=null===(r=o[lo])||void 0===r?void 0:r.arrayValue,l=null===(n=a[lo])||void 0===n?void 0:n.arrayValue,u=Gs((null===(s=null==c?void 0:c.values)||void 0===s?void 0:s.length)||0,(null===(i=null==l?void 0:l.values)||void 0===i?void 0:i.length)||0);return 0!==u?u:mo(c,l)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===co&&t===co)return 0;if(e===co)return 1;if(t===co)return-1;const r=e.fields||{},n=Object.keys(r),s=t.fields||{},i=Object.keys(s);n.sort(),i.sort();for(let e=0;e<n.length&&e<i.length;++e){const t=Js(n[e],i[e]);if(0!==t)return t;const o=po(r[n[e]],s[i[e]]);if(0!==o)return o}return Gs(n.length,i.length)}(e.mapValue,t.mapValue);default:throw Rs(23264,{le:r})}}function go(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Gs(e,t);const r=Gi(e),n=Gi(t),s=Gs(r.seconds,n.seconds);return 0!==s?s:Gs(r.nanos,n.nanos)}function mo(e,t){const r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){const t=po(r[e],n[e]);if(t)return t}return Gs(r.length,n.length)}function yo(e){return vo(e)}function vo(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Gi(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Qi(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return si.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",r=!0;for(const n of e.values||[])r?r=!1:t+=",",t+=vo(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let r="{",n=!0;for(const s of t)n?n=!1:r+=",",r+=`${s}:${vo(e.fields[s])}`;return r+"}"}(e.mapValue):Rs(61005,{value:e})}function wo(e){switch(uo(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=ro(e);return t?16+wo(t):16;case 5:return 2*e.stringValue.length;case 6:return Qi(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce((e,t)=>e+wo(t),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return Mi(e.fields,(e,r)=>{t+=e.length+wo(r)}),t}(e.mapValue);default:throw Rs(13486,{value:e})}}function _o(e){return!!e&&"integerValue"in e}function bo(e){return!!e&&"arrayValue"in e}function Eo(e){return!!e&&"nullValue"in e}function To(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function So(e){return!!e&&"mapValue"in e}function Io(e){var t,r;return"__vector__"===(null===(r=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===r?void 0:r.stringValue)}function ko(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Mi(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=ko(r)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=ko(e.arrayValue.values[r]);return t}return Object.assign({},e)}function Co(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===ao}class Ao{constructor(e){this.value=e}static empty(){return new Ao({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!So(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ko(t)}setAll(e){let t=ni.emptyPath(),r={},n=[];e.forEach((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=s.popLast()}e?r[s.lastSegment()]=ko(e):n.push(s.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,n)}delete(e){const t=this.field(e.popLast());So(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ho(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];So(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){Mi(t,(t,r)=>e[t]=r);for(const t of r)delete e[t]}clone(){return new Ao(ko(this.value))}}class Oo{constructor(e,t,r,n,s,i,o){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(e){return new Oo(e,0,di.min(),di.min(),di.min(),Ao.empty(),0)}static newFoundDocument(e,t,r,n){return new Oo(e,1,t,di.min(),r,n,0)}static newNoDocument(e,t){return new Oo(e,2,t,di.min(),di.min(),Ao.empty(),0)}static newUnknownDocument(e,t){return new Oo(e,3,t,di.min(),di.min(),Ao.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(di.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ao.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ao.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=di.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Oo&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Oo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ro{constructor(e,t){this.position=e,this.inclusive=t}}function Po(e,t,r){let n=0;for(let s=0;s<e.position.length;s++){const i=t[s],o=e.position[s];if(n=i.field.isKeyField()?si.comparator(si.fromName(o.referenceValue),r.key):po(o,r.data.field(i.field)),"desc"===i.dir&&(n*=-1),0!==n)break}return n}function No(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!ho(e.position[r],t.position[r]))return!1;return!0}class Do{constructor(e,t="asc"){this.field=e,this.dir=t}}function xo(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Lo{}class jo extends Lo{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new qo(e,t,r):"array-contains"===t?new Wo(e,r):"in"===t?new Go(e,r):"not-in"===t?new Jo(e,r):"array-contains-any"===t?new Qo(e,r):new jo(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new zo(e,r):new Ho(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(po(t,this.value)):null!==t&&uo(this.value)===uo(t)&&this.matchesComparison(po(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Rs(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Uo extends Lo{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new Uo(e,t)}matches(e){return Mo(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.he||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function Mo(e){return"and"===e.op}function $o(e){return function(e){for(const t of e.filters)if(t instanceof Uo)return!1;return!0}(e)&&Mo(e)}function Vo(e){if(e instanceof jo)return e.field.canonicalString()+e.op.toString()+yo(e.value);if($o(e))return e.filters.map(e=>Vo(e)).join(",");{const t=e.filters.map(e=>Vo(e)).join(",");return`${e.op}(${t})`}}function Fo(e,t){return e instanceof jo?function(e,t){return t instanceof jo&&e.op===t.op&&e.field.isEqual(t.field)&&ho(e.value,t.value)}(e,t):e instanceof Uo?function(e,t){return t instanceof Uo&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,r,n)=>e&&Fo(r,t.filters[n]),!0)}(e,t):void Rs(19439)}function Bo(e){return e instanceof jo?function(e){return`${e.field.canonicalString()} ${e.op} ${yo(e.value)}`}(e):e instanceof Uo?function(e){return e.op.toString()+" {"+e.getFilters().map(Bo).join(" ,")+"}"}(e):"Filter"}class qo extends jo{constructor(e,t,r){super(e,t,r),this.key=si.fromName(r.referenceValue)}matches(e){const t=si.comparator(e.key,this.key);return this.matchesComparison(t)}}class zo extends jo{constructor(e,t){super(e,"in",t),this.keys=Ko(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Ho extends jo{constructor(e,t){super(e,"not-in",t),this.keys=Ko(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Ko(e,t){var r;return((null===(r=t.arrayValue)||void 0===r?void 0:r.values)||[]).map(e=>si.fromName(e.referenceValue))}class Wo extends jo{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return bo(t)&&fo(t.arrayValue,this.value)}}class Go extends jo{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&fo(this.value.arrayValue,t)}}class Jo extends jo{constructor(e,t){super(e,"not-in",t)}matches(e){if(fo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!fo(this.value.arrayValue,t)}}class Qo extends jo{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!bo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>fo(this.value.arrayValue,e))}}class Yo{constructor(e,t=null,r=[],n=[],s=null,i=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=s,this.startAt=i,this.endAt=o,this.Pe=null}}function Xo(e,t=null,r=[],n=[],s=null,i=null,o=null){return new Yo(e,t,r,n,s,i,o)}function Zo(e){const t=Ds(e);if(null===t.Pe){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Vo(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),bi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>yo(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>yo(e)).join(",")),t.Pe=e}return t.Pe}function ea(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++)if(!xo(e.orderBy[r],t.orderBy[r]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!Fo(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!No(e.startAt,t.startAt)&&No(e.endAt,t.endAt)}function ta(e){return si.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class ra{constructor(e,t=null,r=[],n=[],s=null,i="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function na(e){return new ra(e)}function sa(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function ia(e){const t=Ds(e);if(null===t.Te){t.Te=[];const e=new Set;for(const r of t.explicitOrderBy)t.Te.push(r),e.add(r.field.canonicalString());const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",n=function(e){let t=new Bi(ni.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);n.forEach(n=>{e.has(n.canonicalString())||n.isKeyField()||t.Te.push(new Do(n,r))}),e.has(ni.keyField().canonicalString())||t.Te.push(new Do(ni.keyField(),r))}return t.Te}function oa(e){const t=Ds(e);return t.Ie||(t.Ie=function(e,t){if("F"===e.limitType)return Xo(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new Do(e.field,t)});const r=e.endAt?new Ro(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new Ro(e.startAt.position,e.startAt.inclusive):null;return Xo(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}(t,ia(e))),t.Ie}function aa(e,t,r){return new ra(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function ca(e,t){return ea(oa(e),oa(t))&&e.limitType===t.limitType}function la(e){return`${Zo(oa(e))}|lt:${e.limitType}`}function ua(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>Bo(e)).join(", ")}]`),bi(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>yo(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>yo(e)).join(",")),`Target(${t})`}(oa(e))}; limitType=${e.limitType})`}function ha(e,t){return t.isFoundDocument()&&function(e,t){const r=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):si.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r)}(e,t)&&function(e,t){for(const r of ia(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(const r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,r){const n=Po(e,t,r);return e.inclusive?n<=0:n<0}(e.startAt,ia(e),t)||e.endAt&&!function(e,t,r){const n=Po(e,t,r);return e.inclusive?n>=0:n>0}(e.endAt,ia(e),t))}(e,t)}function da(e){return(t,r)=>{let n=!1;for(const s of ia(e)){const e=fa(s,t,r);if(0!==e)return e;n=n||s.field.isKeyField()}return 0}}function fa(e,t,r){const n=e.field.isKeyField()?si.comparator(t.key,r.key):function(e,t,r){const n=t.data.field(e),s=r.data.field(e);return null!==n&&null!==s?po(n,s):Rs(42886)}(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return Rs(19790,{direction:e.dir})}}class pa{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[t,n]of r)if(this.equalsFn(t,e))return n}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){Mi(this.inner,(t,r)=>{for(const[t,n]of r)e(t,n)})}isEmpty(){return function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(this.inner)}size(){return this.innerSize}}const ga=new $i(si.comparator);function ma(){return ga}const ya=new $i(si.comparator);function va(...e){let t=ya;for(const r of e)t=t.insert(r.key,r);return t}function wa(e){let t=ya;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function _a(){return Ea()}function ba(){return Ea()}function Ea(){return new pa(e=>e.toString(),(e,t)=>e.isEqual(t))}new $i(si.comparator);const Ta=new Bi(si.comparator);function Sa(...e){let t=Ta;for(const r of e)t=t.add(r);return t}const Ia=new Bi(Gs);class ka{constructor(){this._=void 0}}function Ca(e,t,r){return e instanceof Oa?function(e,t){const r={fields:{[Xi]:{stringValue:Yi},[eo]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&to(t)&&(t=ro(t)),t&&(r.fields[Zi]=t),{mapValue:r}}(r,t):e instanceof Ra?Pa(e,t):e instanceof Na?Da(e,t):function(e,t){const r=function(e,t){return e instanceof xa?function(e){return _o(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}(e,t),n=La(r)+La(e.Ee);return _o(r)&&_o(e.Ee)?function(e){return{integerValue:""+e}}(n):function(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ei(t)?"-0":t}}(e.serializer,n)}(e,t)}function Aa(e,t,r){return e instanceof Ra?Pa(e,t):e instanceof Na?Da(e,t):r}class Oa extends ka{}class Ra extends ka{constructor(e){super(),this.elements=e}}function Pa(e,t){const r=ja(t);for(const t of e.elements)r.some(e=>ho(e,t))||r.push(t);return{arrayValue:{values:r}}}class Na extends ka{constructor(e){super(),this.elements=e}}function Da(e,t){let r=ja(t);for(const t of e.elements)r=r.filter(e=>!ho(e,t));return{arrayValue:{values:r}}}class xa extends ka{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function La(e){return Ji(e.integerValue||e.doubleValue)}function ja(e){return bo(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Ua{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ua}static exists(e){return new Ua(void 0,e)}static updateTime(e){return new Ua(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ma(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class $a{}function Va(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Ja(e.key,Ua.none()):new za(e.key,e.data,Ua.none());{const r=e.data,n=Ao.empty();let s=new Bi(ni.comparator);for(let e of t.fields)if(!s.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),s=s.add(e)}return new Ha(e.key,n,new zi(s.toArray()),Ua.none())}}function Fa(e,t,r){e instanceof za?function(e,t,r){const n=e.value.clone(),s=Wa(e.fieldTransforms,t,r.transformResults);n.setAll(s),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()}(e,t,r):e instanceof Ha?function(e,t,r){if(!Ma(e.precondition,t))return void t.convertToUnknownDocument(r.version);const n=Wa(e.fieldTransforms,t,r.transformResults),s=t.data;s.setAll(Ka(e)),s.setAll(n),t.convertToFoundDocument(r.version,s).setHasCommittedMutations()}(e,t,r):function(e,t,r){t.convertToNoDocument(r.version).setHasCommittedMutations()}(0,t,r)}function Ba(e,t,r,n){return e instanceof za?function(e,t,r,n){if(!Ma(e.precondition,t))return r;const s=e.value.clone(),i=Ga(e.fieldTransforms,n,t);return s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,r,n):e instanceof Ha?function(e,t,r,n){if(!Ma(e.precondition,t))return r;const s=Ga(e.fieldTransforms,n,t),i=t.data;return i.setAll(Ka(e)),i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===r?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):function(e,t,r){return Ma(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}(e,t,r)}function qa(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Xs(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Ra&&t instanceof Ra||e instanceof Na&&t instanceof Na?Xs(e.elements,t.elements,ho):e instanceof xa&&t instanceof xa?ho(e.Ee,t.Ee):e instanceof Oa&&t instanceof Oa}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class za extends $a{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class Ha extends $a{constructor(e,t,r,n,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Ka(e){const t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const n=e.data.field(r);t.set(r,n)}}),t}function Wa(e,t,r){const n=new Map;Ns(e.length===r.length,32656,{Ae:r.length,Re:e.length});for(let s=0;s<r.length;s++){const i=e[s],o=i.transform,a=t.data.field(i.field);n.set(i.field,Aa(o,a,r[s]))}return n}function Ga(e,t,r){const n=new Map;for(const s of e){const e=s.transform,i=r.data.field(s.field);n.set(s.field,Ca(e,i,t))}return n}class Ja extends $a{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Qa{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const n=this.mutations[t];n.key.isEqual(e.key)&&Fa(n,e,r[t])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ba(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Ba(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=ba();return this.mutations.forEach(n=>{const s=e.get(n.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=t.has(n.key)?null:o;const a=Va(i,o);null!==a&&r.set(n.key,a),i.isValidDocument()||i.convertToNoDocument(di.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Sa())}isEqual(e){return this.batchId===e.batchId&&Xs(this.mutations,e.mutations,(e,t)=>qa(e,t))&&Xs(this.baseMutations,e.baseMutations,(e,t)=>qa(e,t))}}class Ya{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Xa{constructor(e,t){this.count=e,this.unchangedNames=t}}var Za,ec;function tc(e){if(void 0===e)return Cs("GRPC error has no .code"),xs.UNKNOWN;switch(e){case Za.OK:return xs.OK;case Za.CANCELLED:return xs.CANCELLED;case Za.UNKNOWN:return xs.UNKNOWN;case Za.DEADLINE_EXCEEDED:return xs.DEADLINE_EXCEEDED;case Za.RESOURCE_EXHAUSTED:return xs.RESOURCE_EXHAUSTED;case Za.INTERNAL:return xs.INTERNAL;case Za.UNAVAILABLE:return xs.UNAVAILABLE;case Za.UNAUTHENTICATED:return xs.UNAUTHENTICATED;case Za.INVALID_ARGUMENT:return xs.INVALID_ARGUMENT;case Za.NOT_FOUND:return xs.NOT_FOUND;case Za.ALREADY_EXISTS:return xs.ALREADY_EXISTS;case Za.PERMISSION_DENIED:return xs.PERMISSION_DENIED;case Za.FAILED_PRECONDITION:return xs.FAILED_PRECONDITION;case Za.ABORTED:return xs.ABORTED;case Za.OUT_OF_RANGE:return xs.OUT_OF_RANGE;case Za.UNIMPLEMENTED:return xs.UNIMPLEMENTED;case Za.DATA_LOSS:return xs.DATA_LOSS;default:return Rs(39323,{code:e})}}(ec=Za||(Za={}))[ec.OK=0]="OK",ec[ec.CANCELLED=1]="CANCELLED",ec[ec.UNKNOWN=2]="UNKNOWN",ec[ec.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ec[ec.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ec[ec.NOT_FOUND=5]="NOT_FOUND",ec[ec.ALREADY_EXISTS=6]="ALREADY_EXISTS",ec[ec.PERMISSION_DENIED=7]="PERMISSION_DENIED",ec[ec.UNAUTHENTICATED=16]="UNAUTHENTICATED",ec[ec.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ec[ec.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ec[ec.ABORTED=10]="ABORTED",ec[ec.OUT_OF_RANGE=11]="OUT_OF_RANGE",ec[ec.UNIMPLEMENTED=12]="UNIMPLEMENTED",ec[ec.INTERNAL=13]="INTERNAL",ec[ec.UNAVAILABLE=14]="UNAVAILABLE",ec[ec.DATA_LOSS=15]="DATA_LOSS";const rc=new os([4294967295,4294967295],0);function nc(e){const t=Ks().encode(e),r=new as;return r.update(t),new Uint8Array(r.digest())}function sc(e){const t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new os([r,n],0),new os([s,i],0)]}class ic{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new oc(`Invalid padding: ${t}`);if(r<0)throw new oc(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new oc(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new oc(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=os.fromNumber(this.fe)}pe(e,t,r){let n=e.add(t.multiply(os.fromNumber(r)));return 1===n.compare(rc)&&(n=new os([n.getBits(0),n.getBits(1)],0)),n.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.fe)return!1;const t=nc(e),[r,n]=sc(t);for(let e=0;e<this.hashCount;e++){const t=this.pe(r,n,e);if(!this.ye(t))return!1}return!0}static create(e,t,r){const n=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),i=new ic(s,n,t);return r.forEach(e=>i.insert(e)),i}insert(e){if(0===this.fe)return;const t=nc(e),[r,n]=sc(t);for(let e=0;e<this.hashCount;e++){const t=this.pe(r,n,e);this.we(t)}}we(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class oc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ac{constructor(e,t,r,n,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const n=new Map;return n.set(e,cc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new ac(di.min(),n,new $i(Gs),ma(),Sa())}}class cc{constructor(e,t,r,n,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new cc(r,t,Sa(),Sa(),Sa())}}class lc{constructor(e,t,r,n){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=n}}class uc{constructor(e,t){this.targetId=e,this.De=t}}class hc{constructor(e,t,r=Ki.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class dc{constructor(){this.ve=0,this.Ce=gc(),this.Fe=Ki.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return 0!==this.ve}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=Sa(),t=Sa(),r=Sa();return this.Ce.forEach((n,s)=>{switch(s){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:Rs(38017,{changeType:s})}}),new cc(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=gc()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,Ns(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class fc{constructor(e){this.We=e,this.Ge=new Map,this.ze=ma(),this.je=pc(),this.Je=pc(),this.He=new $i(Gs)}Ye(e){for(const t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(const t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{const r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:Rs(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((e,r)=>{this.nt(r)&&t(r)})}it(e){const t=e.targetId,r=e.De.count,n=this.st(t);if(n){const s=n.target;if(ta(s))if(0===r){const e=new si(s.path);this.Xe(t,e,Oo.newNoDocument(e,di.min()))}else Ns(1===r,20013,{expectedCount:r});else{const n=this.ot(t);if(n!==r){const r=this._t(e),s=r?this.ut(r,e,n):1;if(0!==s){this.rt(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,e)}}}}}_t(e){const t=e.De.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:n=0},hashCount:s=0}=t;let i,o;try{i=Qi(r).toUint8Array()}catch(e){if(e instanceof Hi)return As("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new ic(i,n,s)}catch(e){return As(e instanceof oc?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.fe?null:o}ut(e,t,r){return t.De.count===r-this.ht(e,t.targetId)?0:2}ht(e,t){const r=this.We.getRemoteKeysForTarget(t);let n=0;return r.forEach(r=>{const s=this.We.lt(),i=`projects/${s.projectId}/databases/${s.database}/documents/${r.path.canonicalString()}`;e.mightContain(i)||(this.Xe(t,r,null),n++)}),n}Pt(e){const t=new Map;this.Ge.forEach((r,n)=>{const s=this.st(n);if(s){if(r.current&&ta(s.target)){const t=new si(s.target.path);this.Tt(t).has(n)||this.It(n,t)||this.Xe(n,t,Oo.newNoDocument(t,e))}r.Ne&&(t.set(n,r.Le()),r.ke())}});let r=Sa();this.Je.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{const t=this.st(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.ze.forEach((t,r)=>r.setReadTime(e));const n=new ac(e,t,this.He,this.ze,r);return this.ze=ma(),this.je=pc(),this.Je=pc(),this.He=new $i(Gs),n}Ze(e,t){if(!this.nt(e))return;const r=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;const n=this.tt(e);this.It(e,t)?n.qe(t,1):n.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){const t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new dc,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new Bi(Gs),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new Bi(Gs),this.je=this.je.insert(e,t)),t}nt(e){const t=null!==this.st(e);return t||ks("WatchChangeAggregator","Detected inactive target",e),t}st(e){const t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new dc),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}}function pc(){return new $i(si.comparator)}function gc(){return new $i(si.comparator)}const mc={asc:"ASCENDING",desc:"DESCENDING"},yc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},vc={and:"AND",or:"OR"};class wc{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function _c(e,t){return e.useProto3Json||bi(t)?t:{value:t}}function bc(e){return Ns(!!e,49232),di.fromTimestamp(function(e){const t=Gi(e);return new hi(t.seconds,t.nanos)}(e))}function Ec(e,t){const r=function(e){return new ti(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?r:r.child(t)}function Tc(e){const t=ti.fromString(e);return Ns(Mc(t),10190,{key:t.toString()}),t}function Sc(e,t){const r=Tc(t);if(r.get(1)!==e.databaseId.projectId)throw new Ls(xs.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new Ls(xs.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new si(Cc(r))}function Ic(e,t){return function(e,t){return Ec(e,t).canonicalString()}(e.databaseId,t)}function kc(e){return new ti(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Cc(e){return Ns(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function Ac(e,t){return{documents:[Ic(e,t.path)]}}function Oc(e,t){const r={structuredQuery:{}},n=t.path;let s;null!==t.collectionGroup?(s=n,r.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=n.popLast(),r.structuredQuery.from=[{collectionId:n.lastSegment()}]),r.parent=Ic(e,s);const i=function(e){if(0!==e.length)return Uc(Uo.create(e,"and"))}(t.filters);i&&(r.structuredQuery.where=i);const o=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:Lc(e.field),direction:Nc(e.dir)}}(e))}(t.orderBy);o&&(r.structuredQuery.orderBy=o);const a=_c(e,t.limit);return null!==a&&(r.structuredQuery.limit=a),t.startAt&&(r.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(r.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{Vt:r,parent:s}}function Rc(e){let t=function(e){const t=Tc(e);return 4===t.length?ti.emptyPath():Cc(t)}(e.parent);const r=e.structuredQuery,n=r.from?r.from.length:0;let s=null;if(n>0){Ns(1===n,65062);const e=r.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let i=[];r.where&&(i=function(e){const t=Pc(e);return t instanceof Uo&&$o(t)?t.getFilters():[t]}(r.where));let o=[];r.orderBy&&(o=function(e){return e.map(e=>function(e){return new Do(jc(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(r.orderBy));let a=null;r.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,bi(t)?null:t}(r.limit));let c=null;r.startAt&&(c=function(e){const t=!!e.before,r=e.values||[];return new Ro(r,t)}(r.startAt));let l=null;return r.endAt&&(l=function(e){const t=!e.before,r=e.values||[];return new Ro(r,t)}(r.endAt)),function(e,t,r,n,s,i,o,a){return new ra(e,t,r,n,s,i,o,a)}(t,s,o,i,a,"F",c,l)}function Pc(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=jc(e.unaryFilter.field);return jo.create(t,"==",{doubleValue:NaN});case"IS_NULL":const r=jc(e.unaryFilter.field);return jo.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const n=jc(e.unaryFilter.field);return jo.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=jc(e.unaryFilter.field);return jo.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Rs(61313);default:return Rs(60726)}}(e):void 0!==e.fieldFilter?function(e){return jo.create(jc(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Rs(58110);default:return Rs(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Uo.create(e.compositeFilter.filters.map(e=>Pc(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Rs(1026)}}(e.compositeFilter.op))}(e):Rs(30097,{filter:e})}function Nc(e){return mc[e]}function Dc(e){return yc[e]}function xc(e){return vc[e]}function Lc(e){return{fieldPath:e.canonicalString()}}function jc(e){return ni.fromServerFormat(e.fieldPath)}function Uc(e){return e instanceof jo?function(e){if("=="===e.op){if(To(e.value))return{unaryFilter:{field:Lc(e.field),op:"IS_NAN"}};if(Eo(e.value))return{unaryFilter:{field:Lc(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(To(e.value))return{unaryFilter:{field:Lc(e.field),op:"IS_NOT_NAN"}};if(Eo(e.value))return{unaryFilter:{field:Lc(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Lc(e.field),op:Dc(e.op),value:e.value}}}(e):e instanceof Uo?function(e){const t=e.getFilters().map(e=>Uc(e));return 1===t.length?t[0]:{compositeFilter:{op:xc(e.op),filters:t}}}(e):Rs(54877,{filter:e})}function Mc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class $c{constructor(e,t,r,n,s=di.min(),i=di.min(),o=Ki.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new $c(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new $c(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new $c(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new $c(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Vc{constructor(e){this.gt=e}}function Fc(e){const t=Rc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?aa(t,t.limit,"L"):t}class Bc{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(Ji(e.integerValue));else if("doubleValue"in e){const r=Ji(e.doubleValue);isNaN(r)?this.Ct(t,13):(this.Ct(t,15),Ei(r)?t.Ft(0):t.Ft(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ct(t,20),"string"==typeof r&&(r=Gi(r)),t.Mt(`${r.seconds||""}`),t.Ft(r.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(Qi(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ct(t,45),t.Ft(r.latitude||0),t.Ft(r.longitude||0)}else"mapValue"in e?Co(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):Io(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):Rs(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){const r=e.fields||{};this.Ct(t,55);for(const e of Object.keys(r))this.xt(e,t),this.Dt(r[e],t)}Lt(e,t){var r,n;const s=e.fields||{};this.Ct(t,53);const i=lo,o=(null===(n=null===(r=s[i].arrayValue)||void 0===r?void 0:r.values)||void 0===n?void 0:n.length)||0;this.Ct(t,15),t.Ft(Ji(o)),this.xt(i,t),this.Dt(s[i],t)}qt(e,t){const r=e.values||[];this.Ct(t,50);for(const e of r)this.Dt(e,t)}Bt(e,t){this.Ct(t,37),si.fromName(e).path.forEach(e=>{this.Ct(t,60),this.$t(e,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}}Bc.Ut=new Bc;class qc{constructor(){this.Dn=new zc}addToCollectionParentIndex(e,t){return this.Dn.add(t),vi.resolve()}getCollectionParents(e,t){return vi.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return vi.resolve()}deleteFieldIndex(e,t){return vi.resolve()}deleteAllFieldIndexes(e){return vi.resolve()}createTargetIndexes(e,t){return vi.resolve()}getDocumentsMatchingTarget(e,t){return vi.resolve(null)}getIndexType(e,t){return vi.resolve(0)}getFieldIndexes(e,t){return vi.resolve([])}getNextCollectionGroupToUpdate(e){return vi.resolve(null)}getMinOffset(e,t){return vi.resolve(pi.min())}getMinOffsetFromCollectionGroup(e,t){return vi.resolve(pi.min())}updateCollectionGroup(e,t,r){return vi.resolve()}updateIndexEntries(e,t){return vi.resolve()}}class zc{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new Bi(ti.comparator),s=!n.has(r);return this.index[t]=n.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new Bi(ti.comparator)).toArray()}}new Uint8Array(0);const Hc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Kc=41943040;class Wc{static withCacheSize(e){return new Wc(e,Wc.DEFAULT_COLLECTION_PERCENTILE,Wc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}Wc.DEFAULT_COLLECTION_PERCENTILE=10,Wc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Wc.DEFAULT=new Wc(Kc,Wc.DEFAULT_COLLECTION_PERCENTILE,Wc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Wc.DISABLED=new Wc(-1,0,0);class Gc{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new Gc(0)}static ur(){return new Gc(-1)}}const Jc="LruGarbageCollector";function Qc([e,t],[r,n]){const s=Gs(e,r);return 0===s?Gs(t,n):s}class Yc{constructor(e){this.Tr=e,this.buffer=new Bi(Qc),this.Ir=0}dr(){return++this.Ir}Er(e){const t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Qc(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Xc{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return null!==this.Ar}Rr(e){ks(Jc,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){wi(e)?ks(Jc,"Ignoring IndexedDB error during garbage collection: ",e):await yi(e)}await this.Rr(3e5)})}}class Zc{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return vi.resolve(_i.ue);const r=new Yc(t);return this.Vr.forEachTarget(e,e=>r.Er(e.sequenceNumber)).next(()=>this.Vr.gr(e,e=>r.Er(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(ks("LruGarbageCollector","Garbage collection skipped; disabled"),vi.resolve(Hc)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(ks("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Hc):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,n,s,i,o,a,c;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(ks("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,i=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,o=Date.now(),this.removeTargets(e,r,t))).next(t=>(s=t,a=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(c=Date.now(),Is()<=x.DEBUG&&ks("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-l}ms\n\tDetermined least recently used ${n} in `+(o-i)+"ms\n"+`\tRemoved ${s} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-l}ms`),vi.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:s,documentsRemoved:e})))}}class el{constructor(){this.changes=new pa(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Oo.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?vi.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class tl{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class rl{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&Ba(r.mutation,e,zi.empty(),hi.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,Sa()).next(()=>t))}getLocalViewOfDocuments(e,t,r=Sa()){const n=_a();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=va();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const r=_a();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Sa()))}populateOverlays(e,t,r){const n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let s=ma();const i=Ea(),o=Ea();return t.forEach((e,t)=>{const o=r.get(t.key);n.has(t.key)&&(void 0===o||o.mutation instanceof Ha)?s=s.insert(t.key,t):void 0!==o?(i.set(t.key,o.mutation.getFieldMask()),Ba(o.mutation,t,o.mutation.getFieldMask(),hi.now())):i.set(t.key,zi.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>{var r;return o.set(e,new tl(t,null!==(r=i.get(e))&&void 0!==r?r:null))}),o))}recalculateAndSaveOverlays(e,t){const r=Ea();let n=new $i((e,t)=>e-t),s=Sa();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const s of e)s.keys().forEach(e=>{const i=t.get(e);if(null===i)return;let o=r.get(e)||zi.empty();o=s.applyToLocalView(i,o),r.set(e,o);const a=(n.get(s.batchId)||Sa()).add(e);n=n.insert(s.batchId,a)})}).next(()=>{const i=[],o=n.getReverseIterator();for(;o.hasNext();){const n=o.getNext(),a=n.key,c=n.value,l=ba();c.forEach(e=>{if(!s.has(e)){const n=Va(t.get(e),r.get(e));null!==n&&l.set(e,n),s=s.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,a,l))}return vi.waitFor(i)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return function(e){return si.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):function(e){return null!==e.collectionGroup}(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(s=>{const i=n-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-s.size):vi.resolve(_a());let o=-1,a=s;return i.next(t=>vi.forEach(t,(t,r)=>(o<r.largestBatchId&&(o=r.largestBatchId),s.get(t)?vi.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,s)).next(()=>this.computeViews(e,a,t,Sa())).next(e=>({batchId:o,changes:wa(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new si(t)).next(e=>{let t=va();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){const s=t.collectionGroup;let i=va();return this.indexManager.getCollectionParents(e,s).next(o=>vi.forEach(o,o=>{const a=function(e,t){return new ra(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(s));return this.getDocumentsMatchingCollectionQuery(e,a,r,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,r,n){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,n))).next(e=>{s.forEach((t,r)=>{const n=r.getKey();null===e.get(n)&&(e=e.insert(n,Oo.newInvalidDocument(n)))});let r=va();return e.forEach((e,n)=>{const i=s.get(e);void 0!==i&&Ba(i.mutation,n,zi.empty(),hi.now()),ha(t,n)&&(r=r.insert(e,n))}),r})}}class nl{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return vi.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,function(e){return{id:e.id,version:e.version,createTime:bc(e.createTime)}}(t)),vi.resolve()}getNamedQuery(e,t){return vi.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,function(e){return{name:e.name,query:Fc(e.bundledQuery),readTime:bc(e.readTime)}}(t)),vi.resolve()}}class sl{constructor(){this.overlays=new $i(si.comparator),this.kr=new Map}getOverlay(e,t){return vi.resolve(this.overlays.get(t))}getOverlays(e,t){const r=_a();return vi.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.wt(e,t,n)}),vi.resolve()}removeOverlaysForBatchId(e,t,r){const n=this.kr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.kr.delete(r)),vi.resolve()}getOverlaysForCollection(e,t,r){const n=_a(),s=t.length+1,i=new si(t.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const e=o.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===s&&e.largestBatchId>r&&n.set(e.getKey(),e)}return vi.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let s=new $i((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=s.get(e.largestBatchId);null===t&&(t=_a(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=_a(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=n)););return vi.resolve(o)}wt(e,t,r){const n=this.overlays.get(r.key);if(null!==n){const e=this.kr.get(n.largestBatchId).delete(r.key);this.kr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new Ya(t,r));let s=this.kr.get(t);void 0===s&&(s=Sa(),this.kr.set(t,s)),this.kr.set(t,s.add(r.key))}}class il{constructor(){this.sessionToken=Ki.EMPTY_BYTE_STRING}getSessionToken(e){return vi.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,vi.resolve()}}class ol{constructor(){this.qr=new Bi(al.Qr),this.$r=new Bi(al.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){const r=new al(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new al(e,t))}Gr(e,t){e.forEach(e=>this.removeReference(e,t))}zr(e){const t=new si(new ti([])),r=new al(t,e),n=new al(t,e+1),s=[];return this.$r.forEachInRange([r,n],e=>{this.Wr(e),s.push(e.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const t=new si(new ti([])),r=new al(t,e),n=new al(t,e+1);let s=Sa();return this.$r.forEachInRange([r,n],e=>{s=s.add(e.key)}),s}containsKey(e){const t=new al(e,0),r=this.qr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class al{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return si.comparator(e.key,t.key)||Gs(e.Hr,t.Hr)}static Ur(e,t){return Gs(e.Hr,t.Hr)||si.comparator(e.key,t.key)}}class cl{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new Bi(al.Qr)}checkEmpty(e){return vi.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){const s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Qa(s,t,r,n);this.mutationQueue.push(i);for(const t of n)this.Yr=this.Yr.add(new al(t.key,s)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return vi.resolve(i)}lookupMutationBatch(e,t){return vi.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=this.Xr(r),s=n<0?0:n;return vi.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return vi.resolve(0===this.mutationQueue.length?-1:this.er-1)}getAllMutationBatches(e){return vi.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new al(t,0),n=new al(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([r,n],e=>{const t=this.Zr(e.Hr);s.push(t)}),vi.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Bi(Gs);return t.forEach(e=>{const t=new al(e,0),n=new al(e,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([t,n],e=>{r=r.add(e.Hr)})}),vi.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,n=r.length+1;let s=r;si.isDocumentKey(s)||(s=s.child(""));const i=new al(new si(s),0);let o=new Bi(Gs);return this.Yr.forEachWhile(e=>{const t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(o=o.add(e.Hr)),!0)},i),vi.resolve(this.ei(o))}ei(e){const t=[];return e.forEach(e=>{const r=this.Zr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){Ns(0===this.ti(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Yr;return vi.forEach(t.mutations,n=>{const s=new al(n.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Yr=r})}rr(e){}containsKey(e,t){const r=new al(t,0),n=this.Yr.firstAfterOrEqual(r);return vi.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,vi.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ll{constructor(e){this.ni=e,this.docs=new $i(si.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,n=this.docs.get(r),s=n?n.size:0,i=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return vi.resolve(r?r.document.mutableCopy():Oo.newInvalidDocument(t))}getEntries(e,t){let r=ma();return t.forEach(e=>{const t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():Oo.newInvalidDocument(e))}),vi.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let s=ma();const i=t.path,o=new si(i.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||gi(fi(o),r)<=0||(n.has(o.key)||ha(t,o))&&(s=s.insert(o.key,o.mutableCopy()))}return vi.resolve(s)}getAllFromCollectionGroup(e,t,r,n){Rs(9500)}ri(e,t){return vi.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new ul(this)}getSize(e){return vi.resolve(this.size)}}class ul extends el{constructor(e){super(),this.Or=e}applyChanges(e){const t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Or.addEntry(e,n)):this.Or.removeEntry(r)}),vi.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}}class hl{constructor(e){this.persistence=e,this.ii=new pa(e=>Zo(e),ea),this.lastRemoteSnapshotVersion=di.min(),this.highestTargetId=0,this.si=0,this.oi=new ol,this.targetCount=0,this._i=Gc.ar()}forEachTarget(e,t){return this.ii.forEach((e,r)=>t(r)),vi.resolve()}getLastRemoteSnapshotVersion(e){return vi.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return vi.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),vi.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),vi.resolve()}hr(e){this.ii.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this._i=new Gc(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,vi.resolve()}updateTargetData(e,t){return this.hr(t),vi.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,vi.resolve()}removeTargets(e,t,r){let n=0;const s=[];return this.ii.forEach((i,o)=>{o.sequenceNumber<=t&&null===r.get(o.targetId)&&(this.ii.delete(i),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),n++)}),vi.waitFor(s).next(()=>n)}getTargetCount(e){return vi.resolve(this.targetCount)}getTargetData(e,t){const r=this.ii.get(t)||null;return vi.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),vi.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);const n=this.persistence.referenceDelegate,s=[];return n&&t.forEach(t=>{s.push(n.markPotentiallyOrphaned(e,t))}),vi.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),vi.resolve()}getMatchingKeysForTargetId(e,t){const r=this.oi.Jr(t);return vi.resolve(r)}containsKey(e,t){return vi.resolve(this.oi.containsKey(t))}}class dl{constructor(e,t){this.ai={},this.overlays={},this.ui=new _i(0),this.ci=!1,this.ci=!0,this.li=new il,this.referenceDelegate=e(this),this.hi=new hl(this),this.indexManager=new qc,this.remoteDocumentCache=function(e){return new ll(e)}(e=>this.referenceDelegate.Pi(e)),this.serializer=new Vc(t),this.Ti=new nl(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new sl,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new cl(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){ks("MemoryPersistence","Starting transaction:",e);const n=new fl(this.ui.next());return this.referenceDelegate.Ii(),r(n).next(e=>this.referenceDelegate.di(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ei(e,t){return vi.or(Object.values(this.ai).map(r=>()=>r.containsKey(e,t)))}}class fl extends mi{constructor(e){super(),this.currentSequenceNumber=e}}class pl{constructor(e){this.persistence=e,this.Ai=new ol,this.Ri=null}static Vi(e){return new pl(e)}get mi(){if(this.Ri)return this.Ri;throw Rs(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),vi.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),vi.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),vi.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(e=>this.mi.add(e.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.mi.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return vi.forEach(this.mi,r=>{const n=si.fromPath(r);return this.fi(e,n).next(e=>{e||t.removeEntry(n,di.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(e=>{e?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return vi.or([()=>vi.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class gl{constructor(e,t){this.persistence=e,this.gi=new pa(e=>function(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t=Si(t)),t=Ti(e.get(r),t);return Si(t)}(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=function(e,t){return new Zc(e,t)}(this,t)}static Vi(e,t){return new gl(e,t)}Ii(){}di(e){return vi.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){const t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}yr(e){let t=0;return this.gr(e,e=>{t++}).next(()=>t)}gr(e,t){return vi.forEach(this.gi,(r,n)=>this.Sr(e,r,n).next(e=>e?vi.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const n=this.persistence.getRemoteDocumentCache(),s=n.newChangeBuffer();return n.ri(e,n=>this.Sr(e,n,t).next(e=>{e||(r++,s.removeEntry(n,di.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),vi.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),vi.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),vi.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),vi.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=wo(e.data.value)),t}Sr(e,t,r){return vi.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.gi.get(t);return vi.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class ml{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=n}static Es(e,t){let r=Sa(),n=Sa();for(const e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new ml(e,t.fromCache,r,n)}}class yl{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class vl{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=y()?8:function(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}(m())>0?6:4}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,n){const s={result:null};return this.ps(e,t).next(e=>{s.result=e}).next(()=>{if(!s.result)return this.ys(e,t,n,r).next(e=>{s.result=e})}).next(()=>{if(s.result)return;const r=new yl;return this.ws(e,t,r).next(n=>{if(s.result=n,this.Rs)return this.Ss(e,t,r,n.size)})}).next(()=>s.result)}Ss(e,t,r,n){return r.documentReadCount<this.Vs?(Is()<=x.DEBUG&&ks("QueryEngine","SDK will not create cache indexes for query:",ua(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),vi.resolve()):(Is()<=x.DEBUG&&ks("QueryEngine","Query:",ua(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.fs*n?(Is()<=x.DEBUG&&ks("QueryEngine","The SDK decides to create cache indexes for query:",ua(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,oa(t))):vi.resolve())}ps(e,t){if(sa(t))return vi.resolve(null);let r=oa(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(t=aa(t,null,"F"),r=oa(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{const s=Sa(...n);return this.gs.getDocuments(e,s).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{const i=this.bs(t,n);return this.Ds(t,i,s,r.readTime)?this.ps(e,aa(t,null,"F")):this.vs(e,i,t,r)}))})))}ys(e,t,r,n){return sa(t)||n.isEqual(di.min())?vi.resolve(null):this.gs.getDocuments(e,r).next(s=>{const i=this.bs(t,s);return this.Ds(t,i,r,n)?vi.resolve(null):(Is()<=x.DEBUG&&ks("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),ua(t)),this.vs(e,i,t,function(e,t){const r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1,s=di.fromTimestamp(1e9===n?new hi(r+1,0):new hi(r,n));return new pi(s,si.empty(),t)}(n,-1)).next(e=>e))})}bs(e,t){let r=new Bi(da(e));return t.forEach((t,n)=>{ha(e,n)&&(r=r.add(n))}),r}Ds(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(n)>0)}ws(e,t,r){return Is()<=x.DEBUG&&ks("QueryEngine","Using full collection scan to execute query:",ua(t)),this.gs.getDocumentsMatchingQuery(e,t,pi.min(),r)}vs(e,t,r,n){return this.gs.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const wl="LocalStore";class _l{constructor(e,t,r,n){this.persistence=e,this.Cs=t,this.serializer=n,this.Fs=new $i(Gs),this.Ms=new pa(e=>Zo(e),ea),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new rl(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}}async function bl(e,t){const r=Ds(e);return await r.persistence.runTransaction("Handle user change","readonly",e=>{let n;return r.mutationQueue.getAllMutationBatches(e).next(s=>(n=s,r.Ns(t),r.mutationQueue.getAllMutationBatches(e))).next(t=>{const s=[],i=[];let o=Sa();for(const e of n){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return r.localDocuments.getDocuments(e,o).next(e=>({Bs:e,removedBatchIds:s,addedBatchIds:i}))})})}function El(e){const t=Ds(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.hi.getLastRemoteSnapshotVersion(e))}async function Tl(e,t,r){const n=Ds(e),s=n.Fs.get(t),i=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",i,e=>n.persistence.referenceDelegate.removeTarget(e,s))}catch(e){if(!wi(e))throw e;ks(wl,`Failed to update sequence numbers for target ${t}: ${e}`)}n.Fs=n.Fs.remove(t),n.Ms.delete(s.target)}function Sl(e,t,r){const n=Ds(e);let s=di.min(),i=Sa();return n.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,r){const n=Ds(e),s=n.Ms.get(r);return void 0!==s?vi.resolve(n.Fs.get(s)):n.hi.getTargetData(t,r)}(n,e,oa(t)).next(t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,n.hi.getMatchingKeysForTargetId(e,t.targetId).next(e=>{i=e})}).next(()=>n.Cs.getDocumentsMatchingQuery(e,t,r?s:di.min(),r?i:Sa())).next(e=>(function(e,t,r){let n=e.xs.get(t)||di.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.xs.set(t,n)}(n,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,qs:i})))}class Il{constructor(){this.activeTargetIds=Ia}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class kl{constructor(){this.Fo=new Il,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new Il,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Cl{xo(e){}shutdown(){}}const Al="ConnectivityMonitor";class Ol{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){ks(Al,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){ks(Al,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Rl=null;function Pl(){return null===Rl?Rl=268435456+Math.round(2147483648*Math.random()):Rl++,"0x"+Rl.toString(16)}const Nl="RestConnection",Dl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class xl{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${n}`,this.Ko=this.databaseId.database===io?`project_id=${r}`:`project_id=${r}&database_id=${n}`}Wo(e,t,r,n,s){const i=Pl(),o=this.Go(e,t.toUriEncodedString());ks(Nl,`Sending RPC '${e}' ${i}:`,o,r);const a={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(a,n,s);const{host:c}=new URL(o),l=h(c);return this.jo(e,o,a,r,l).then(t=>(ks(Nl,`Received RPC '${e}' ${i}: `,t),t),t=>{throw As(Nl,`RPC '${e}' ${i} failed with error: `,t,"url: ",o,"request:",r),t})}Jo(e,t,r,n,s,i){return this.Wo(e,t,r,n,s)}zo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+Ts,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}Go(e,t){const r=Dl[e];return`${this.$o}/v1/${t}:${r}`}terminate(){}}class Ll{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}const jl="WebChannelConnection";class Ul extends xl{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,n,s){const i=Pl();return new Promise((s,o)=>{const a=new us;a.setWithCredentials(!0),a.listenOnce(ds.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case fs.NO_ERROR:const t=a.getResponseJson();ks(jl,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case fs.TIMEOUT:ks(jl,`RPC '${e}' ${i} timed out`),o(new Ls(xs.DEADLINE_EXCEEDED,"Request time out"));break;case fs.HTTP_ERROR:const r=a.getStatus();if(ks(jl,`RPC '${e}' ${i} failed with status:`,r,"response text:",a.getResponseText()),r>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(xs).indexOf(t)>=0?t:xs.UNKNOWN}(t.status);o(new Ls(e,t.message))}else o(new Ls(xs.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Ls(xs.UNAVAILABLE,"Connection failed."));break;default:Rs(9055,{c_:e,streamId:i,l_:a.getLastErrorCode(),h_:a.getLastError()})}}finally{ks(jl,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(n);ks(jl,`RPC '${e}' ${i} sending request:`,n),a.send(t,"POST",c,r,15)})}P_(e,t,r){const n=Pl(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=ys(),o=ms(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.zo(a.initMessageHeaders,t,r),a.encodeInitMessageHeaders=!0;const l=s.join("");ks(jl,`Creating RPC '${e}' stream ${n}: ${l}`,a);const u=i.createWebChannel(l,a);this.T_(u);let h=!1,d=!1;const f=new Ll({Ho:t=>{d?ks(jl,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(h||(ks(jl,`Opening RPC '${e}' stream ${n} transport.`),u.open(),h=!0),ks(jl,`RPC '${e}' stream ${n} sending:`,t),u.send(t))},Yo:()=>u.close()}),p=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(u,hs.EventType.OPEN,()=>{d||(ks(jl,`RPC '${e}' stream ${n} transport opened.`),f.s_())}),p(u,hs.EventType.CLOSE,()=>{d||(d=!0,ks(jl,`RPC '${e}' stream ${n} transport closed`),f.__(),this.I_(u))}),p(u,hs.EventType.ERROR,t=>{d||(d=!0,As(jl,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),f.__(new Ls(xs.UNAVAILABLE,"The operation could not be completed")))}),p(u,hs.EventType.MESSAGE,t=>{var r;if(!d){const s=t.data[0];Ns(!!s,16349);const i=s,o=(null==i?void 0:i.error)||(null===(r=i[0])||void 0===r?void 0:r.error);if(o){ks(jl,`RPC '${e}' stream ${n} received error:`,o);const t=o.status;let r=function(e){const t=Za[e];if(void 0!==t)return tc(t)}(t),s=o.message;void 0===r&&(r=xs.INTERNAL,s="Unknown error status: "+t+" with message "+o.message),d=!0,f.__(new Ls(r,s)),u.close()}else ks(jl,`RPC '${e}' stream ${n} received:`,s),f.a_(s)}}),p(o,gs.STAT_EVENT,t=>{t.stat===ps.PROXY?ks(jl,`RPC '${e}' stream ${n} detected buffering proxy`):t.stat===ps.NOPROXY&&ks(jl,`RPC '${e}' stream ${n} detected no buffering proxy`)}),setTimeout(()=>{f.o_()},0),f}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}}function Ml(){return"undefined"!=typeof document?document:null}function $l(e){return new wc(e,!0)}class Vl{constructor(e,t,r=1e3,n=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=n,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),n=Math.max(0,t-r);n>0&&ks("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,n,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){null!==this.V_&&(this.V_.skipDelay(),this.V_=null)}cancel(){null!==this.V_&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}const Fl="PersistentStream";class Bl{constructor(e,t,r,n,s,i,o,a){this.Fi=e,this.w_=r,this.S_=n,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Vl(e,t)}M_(){return 1===this.state||5===this.state||this.x_()}x_(){return 2===this.state||3===this.state}start(){this.C_=0,4!==this.state?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&null===this.D_&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,4!==e?this.F_.reset():t&&t.code===xs.RESOURCE_EXHAUSTED?(Cs(t.toString()),Cs("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===xs.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(t)}U_(){}auth(){this.state=1;const e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.b_===t&&this.W_(e,r)},t=>{e(()=>{const e=new Ls(xs.UNKNOWN,"Fetching auth token failed: "+t.message);return this.G_(e)})})}W_(e,t){const r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(e=>{r(()=>this.G_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.C_?this.j_(e):this.onNext(e))})}O_(){this.state=5,this.F_.g_(async()=>{this.state=0,this.start()})}G_(e){return ks(Fl,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(ks(Fl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ql extends Bl{constructor(e,t,r,n,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,i),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();const t=function(e,t){let r;if("targetChange"in t){t.targetChange;const n=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Rs(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(e,t){return e.useProto3Json?(Ns(void 0===t||"string"==typeof t,58123),Ki.fromBase64String(t||"")):(Ns(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),Ki.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?xs.UNKNOWN:tc(e.code);return new Ls(t,e.message||"")}(o);r=new hc(n,s,i,a||null)}else if("documentChange"in t){t.documentChange;const n=t.documentChange;n.document,n.document.name,n.document.updateTime;const s=Sc(e,n.document.name),i=bc(n.document.updateTime),o=n.document.createTime?bc(n.document.createTime):di.min(),a=new Ao({mapValue:{fields:n.document.fields}}),c=Oo.newFoundDocument(s,i,o,a),l=n.targetIds||[],u=n.removedTargetIds||[];r=new lc(l,u,c.key,c)}else if("documentDelete"in t){t.documentDelete;const n=t.documentDelete;n.document;const s=Sc(e,n.document),i=n.readTime?bc(n.readTime):di.min(),o=Oo.newNoDocument(s,i),a=n.removedTargetIds||[];r=new lc([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const n=t.documentRemove;n.document;const s=Sc(e,n.document),i=n.removedTargetIds||[];r=new lc([],i,s,null)}else{if(!("filter"in t))return Rs(11601,{At:t});{t.filter;const e=t.filter;e.targetId;const{count:n=0,unchangedNames:s}=e,i=new Xa(n,s),o=e.targetId;r=new uc(o,i)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return di.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?di.min():t.readTime?bc(t.readTime):di.min()}(e);return this.listener.J_(t,r)}H_(e){const t={};t.database=kc(this.serializer),t.addTarget=function(e,t){let r;const n=t.target;if(r=ta(n)?{documents:Ac(e,n)}:{query:Oc(e,n).Vt},r.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=function(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}(e,t.resumeToken);const n=_c(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(di.min())>0){r.readTime=function(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}(e,t.snapshotVersion.toTimestamp());const n=_c(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);const r=function(e,t){const r=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Rs(28987,{purpose:e})}}(t.purpose);return null==r?null:{"goog-listen-tags":r}}(this.serializer,e);r&&(t.labels=r),this.k_(t)}Y_(e){const t={};t.database=kc(this.serializer),t.removeTarget=e,this.k_(t)}}class zl{}class Hl extends zl{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ra=!1}ia(){if(this.ra)throw new Ls(xs.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,n){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.connection.Wo(e,Ec(t,r),n,s,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===xs.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Ls(xs.UNKNOWN,e.toString())})}Jo(e,t,r,n,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Jo(e,Ec(t,r),n,i,o,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===xs.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Ls(xs.UNKNOWN,e.toString())})}terminate(){this.ra=!0,this.connection.terminate()}}class Kl{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){0===this.sa&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){"Online"===this.state?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,"Online"===e&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(Cs(t),this._a=!1):ks("OnlineStateTracker",t)}ha(){null!==this.oa&&(this.oa.cancel(),this.oa=null)}}const Wl="RemoteStore";class Gl{constructor(e,t,r,n,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(e=>{r.enqueueAndForget(async()=>{nu(this)&&(ks(Wl,"Restarting streams for network reachability change."),await async function(e){const t=Ds(e);t.Ia.add(4),await Ql(t),t.Aa.set("Unknown"),t.Ia.delete(4),await Jl(t)}(this))})}),this.Aa=new Kl(r,n)}}async function Jl(e){if(nu(e))for(const t of e.da)await t(!0)}async function Ql(e){for(const t of e.da)await t(!1)}function Yl(e,t){const r=Ds(e);r.Ta.has(t.targetId)||(r.Ta.set(t.targetId,t),ru(r)?tu(r):hu(r).x_()&&Zl(r,t))}function Xl(e,t){const r=Ds(e),n=hu(r);r.Ta.delete(t),n.x_()&&eu(r,t),0===r.Ta.size&&(n.x_()?n.B_():nu(r)&&r.Aa.set("Unknown"))}function Zl(e,t){if(e.Ra.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(di.min())>0){const r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}hu(e).H_(t)}function eu(e,t){e.Ra.$e(t),hu(e).Y_(t)}function tu(e){e.Ra=new fc({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.Ta.get(t)||null,lt:()=>e.datastore.serializer.databaseId}),hu(e).start(),e.Aa.aa()}function ru(e){return nu(e)&&!hu(e).M_()&&e.Ta.size>0}function nu(e){return 0===Ds(e).Ia.size}function su(e){e.Ra=void 0}async function iu(e){e.Aa.set("Online")}async function ou(e){e.Ta.forEach((t,r)=>{Zl(e,t)})}async function au(e,t){su(e),ru(e)?(e.Aa.la(t),tu(e)):e.Aa.set("Unknown")}async function cu(e,t,r){if(e.Aa.set("Online"),t instanceof hc&&2===t.state&&t.cause)try{await async function(e,t){const r=t.cause;for(const n of t.targetIds)e.Ta.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ta.delete(n),e.Ra.removeTarget(n))}(e,t)}catch(r){ks(Wl,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await lu(e,r)}else if(t instanceof lc?e.Ra.Ye(t):t instanceof uc?e.Ra.it(t):e.Ra.et(t),!r.isEqual(di.min()))try{const t=await El(e.localStore);r.compareTo(t)>=0&&await function(e,t){const r=e.Ra.Pt(t);return r.targetChanges.forEach((r,n)=>{if(r.resumeToken.approximateByteSize()>0){const s=e.Ta.get(n);s&&e.Ta.set(n,s.withResumeToken(r.resumeToken,t))}}),r.targetMismatches.forEach((t,r)=>{const n=e.Ta.get(t);if(!n)return;e.Ta.set(t,n.withResumeToken(Ki.EMPTY_BYTE_STRING,n.snapshotVersion)),eu(e,t);const s=new $c(n.target,t,r,n.sequenceNumber);Zl(e,s)}),e.remoteSyncer.applyRemoteEvent(r)}(e,r)}catch(t){ks(Wl,"Failed to raise snapshot:",t),await lu(e,t)}}async function lu(e,t,r){if(!wi(t))throw t;e.Ia.add(1),await Ql(e),e.Aa.set("Offline"),r||(r=()=>El(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{ks(Wl,"Retrying IndexedDB access"),await r(),e.Ia.delete(1),await Jl(e)})}async function uu(e,t){const r=Ds(e);r.asyncQueue.verifyOperationInProgress(),ks(Wl,"RemoteStore received new credentials");const n=nu(r);r.Ia.add(3),await Ql(r),n&&r.Aa.set("Unknown"),await r.remoteSyncer.handleCredentialChange(t),r.Ia.delete(3),await Jl(r)}function hu(e){return e.Va||(e.Va=function(e,t,r){const n=Ds(e);return n.ia(),new ql(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}(e.datastore,e.asyncQueue,{Zo:iu.bind(null,e),e_:ou.bind(null,e),n_:au.bind(null,e),J_:cu.bind(null,e)}),e.da.push(async t=>{t?(e.Va.N_(),ru(e)?tu(e):e.Aa.set("Unknown")):(await e.Va.stop(),su(e))})),e.Va}class du{constructor(e,t,r,n,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=s,this.deferred=new js,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,s){const i=Date.now()+r,o=new du(e,t,i,n,s);return o.start(r),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ls(xs.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function fu(e,t){if(Cs("AsyncQueue",`${t}: ${e}`),wi(e))return new Ls(xs.UNAVAILABLE,`${t}: ${e}`);throw e}class pu{static emptySet(e){return new pu(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||si.comparator(t.key,r.key):(e,t)=>si.comparator(e.key,t.key),this.keyedMap=va(),this.sortedSet=new $i(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof pu))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new pu;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class gu{constructor(){this.fa=new $i(si.comparator)}track(e){const t=e.doc.key,r=this.fa.get(t);r?0!==e.type&&3===r.type?this.fa=this.fa.insert(t,e):3===e.type&&1!==r.type?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.fa=this.fa.remove(t):1===e.type&&2===r.type?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):Rs(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){const e=[];return this.fa.inorderTraversal((t,r)=>{e.push(r)}),e}}class mu{constructor(e,t,r,n,s,i,o,a,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,n,s){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new mu(e,t,pu.emptySet(t),i,r,n,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ca(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class yu{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}}class vu{constructor(){this.queries=wu(),this.onlineState="Unknown",this.Da=new Set}terminate(){!function(e,t){const r=Ds(e),n=r.queries;r.queries=wu(),n.forEach((e,r)=>{for(const e of r.wa)e.onError(t)})}(this,new Ls(xs.ABORTED,"Firestore shutting down"))}}function wu(){return new pa(e=>la(e),ca)}function _u(e,t){const r=Ds(e);let n=!1;for(const e of t){const t=e.query,s=r.queries.get(t);if(s){for(const t of s.wa)t.Ca(e)&&(n=!0);s.ya=e}}n&&Eu(r)}function bu(e,t,r){const n=Ds(e),s=n.queries.get(t);if(s)for(const e of s.wa)e.onError(r);n.queries.delete(t)}function Eu(e){e.Da.forEach(e=>{e.next()})}var Tu,Su;(Su=Tu||(Tu={})).Fa="default",Su.Cache="cache";class Iu{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){const t=[];for(const r of e.docChanges)3!==r.type&&t.push(r);e=new mu(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache)return!0;if(!this.ba())return!0;const r="Offline"!==t;return(!this.options.ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Na(e){if(e.docChanges.length>0)return!0;const t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}La(e){e=mu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==Tu.Cache}}class ku{constructor(e){this.key=e}}class Cu{constructor(e){this.key=e}}class Au{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=Sa(),this.mutatedKeys=Sa(),this.Xa=da(e),this.eu=new pu(this.Xa)}get tu(){return this.Ha}nu(e,t){const r=t?t.ru:new gu,n=t?t.eu:this.eu;let s=t?t.mutatedKeys:this.mutatedKeys,i=n,o=!1;const a="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,c="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{const l=n.get(e),u=ha(this.query,t)?t:null,h=!!l&&this.mutatedKeys.has(l.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;l&&u?l.data.isEqual(u.data)?h!==d&&(r.track({type:3,doc:u}),f=!0):this.iu(l,u)||(r.track({type:2,doc:u}),f=!0,(a&&this.Xa(u,a)>0||c&&this.Xa(u,c)<0)&&(o=!0)):!l&&u?(r.track({type:0,doc:u}),f=!0):l&&!u&&(r.track({type:1,doc:l}),f=!0,(a||c)&&(o=!0)),f&&(u?(i=i.add(u),s=d?s.add(e):s.delete(e)):(i=i.delete(e),s=s.delete(e)))}),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),s=s.delete(e.key),r.track({type:1,doc:e})}return{eu:i,ru:r,Ds:o,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){const s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;const i=e.ru.pa();i.sort((e,t)=>function(e,t){const r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Rs(20277,{At:e})}};return r(e)-r(t)}(e.type,t.type)||this.Xa(e.doc,t.doc)),this.su(r),n=null!=n&&n;const o=t&&!n?this.ou():[],a=0===this.Za.size&&this.current&&!n?1:0,c=a!==this.Ya;return this.Ya=a,0!==i.length||c?{snapshot:new mu(this.query,e.eu,s,i,e.mutatedKeys,0===a,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:o}:{_u:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({eu:this.eu,ru:new gu,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=e.current)}ou(){if(!this.current)return[];const e=this.Za;this.Za=Sa(),this.eu.forEach(e=>{this.au(e.key)&&(this.Za=this.Za.add(e.key))});const t=[];return e.forEach(e=>{this.Za.has(e)||t.push(new Cu(e))}),this.Za.forEach(r=>{e.has(r)||t.push(new ku(r))}),t}uu(e){this.Ha=e.qs,this.Za=Sa();const t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return mu.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,0===this.Ya,this.hasCachedResults)}}const Ou="SyncEngine";class Ru{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Pu{constructor(e){this.key=e,this.lu=!1}}class Nu{constructor(e,t,r,n,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.hu={},this.Pu=new pa(e=>la(e),ca),this.Tu=new Map,this.Iu=new Set,this.du=new $i(si.comparator),this.Eu=new Map,this.Au=new ol,this.Ru={},this.Vu=new Map,this.mu=Gc.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return!0===this.fu}}async function Du(e,t,r=!0){const n=Ju(e);let s;const i=n.Pu.get(t);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.cu()):s=await Lu(n,t,r,!0),s}async function xu(e,t){const r=Ju(e);await Lu(r,t,!0,!1)}async function Lu(e,t,r,n){const s=await function(e,t){const r=Ds(e);return r.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return r.hi.getTargetData(e,t).next(s=>s?(n=s,vi.resolve(n)):r.hi.allocateTargetId(e).next(s=>(n=new $c(t,s,"TargetPurposeListen",e.currentSequenceNumber),r.hi.addTargetData(e,n).next(()=>n))))}).then(e=>{const n=r.Fs.get(e.targetId);return(null===n||e.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(r.Fs=r.Fs.insert(e.targetId,e),r.Ms.set(t,e.targetId)),e})}(e.localStore,oa(t)),i=s.targetId,o=e.sharedClientState.addLocalQueryTarget(i,r);let a;return n&&(a=await async function(e,t,r,n,s){e.gu=(t,r,n)=>async function(e,t,r,n){let s=t.view.nu(r);s.Ds&&(s=await Sl(e.localStore,t.query,!1).then(({documents:e})=>t.view.nu(e,s)));const i=n&&n.targetChanges.get(t.targetId),o=n&&null!=n.targetMismatches.get(t.targetId),a=t.view.applyChanges(s,e.isPrimaryClient,i,o);return qu(e,t.targetId,a._u),a.snapshot}(e,t,r,n);const i=await Sl(e.localStore,t,!0),o=new Au(t,i.qs),a=o.nu(i.documents),c=cc.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,s),l=o.applyChanges(a,e.isPrimaryClient,c);qu(e,r,l._u);const u=new Ru(t,r,o);return e.Pu.set(t,u),e.Tu.has(r)?e.Tu.get(r).push(t):e.Tu.set(r,[t]),l.snapshot}(e,t,i,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&Yl(e.remoteStore,s),a}async function ju(e,t,r){const n=Ds(e),s=n.Pu.get(t),i=n.Tu.get(s.targetId);if(i.length>1)return n.Tu.set(s.targetId,i.filter(e=>!ca(e,t))),void n.Pu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Tl(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),r&&Xl(n.remoteStore,s.targetId),Fu(n,s.targetId)}).catch(yi)):(Fu(n,s.targetId),await Tl(n.localStore,s.targetId,!0))}async function Uu(e,t){const r=Ds(e),n=r.Pu.get(t),s=r.Tu.get(n.targetId);r.isPrimaryClient&&1===s.length&&(r.sharedClientState.removeLocalQueryTarget(n.targetId),Xl(r.remoteStore,n.targetId))}async function Mu(e,t){const r=Ds(e);try{const e=await function(e,t){const r=Ds(e),n=t.snapshotVersion;let s=r.Fs;return r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const i=r.Os.newChangeBuffer({trackRemovals:!0});s=r.Fs;const o=[];t.targetChanges.forEach((i,a)=>{const c=s.get(a);if(!c)return;o.push(r.hi.removeMatchingKeys(e,i.removedDocuments,a).next(()=>r.hi.addMatchingKeys(e,i.addedDocuments,a)));let l=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?l=l.withResumeToken(Ki.EMPTY_BYTE_STRING,di.min()).withLastLimboFreeSnapshotVersion(di.min()):i.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(i.resumeToken,n)),s=s.insert(a,l),function(e,t,r){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size>0}(c,l,i)&&o.push(r.hi.updateTargetData(e,l))});let a=ma(),c=Sa();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&o.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),o.push(function(e,t,r){let n=Sa(),s=Sa();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=ma();return r.forEach((r,i)=>{const o=e.get(r);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(r)),i.isNoDocument()&&i.version.isEqual(di.min())?(t.removeEntry(r,i.readTime),n=n.insert(r,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(i),n=n.insert(r,i)):ks(wl,"Ignoring outdated watch update for ",r,". Current version:",o.version," Watch version:",i.version)}),{Ls:n,ks:s}})}(e,i,t.documentUpdates).next(e=>{a=e.Ls,c=e.ks})),!n.isEqual(di.min())){const t=r.hi.getLastRemoteSnapshotVersion(e).next(t=>r.hi.setTargetsMetadata(e,e.currentSequenceNumber,n));o.push(t)}return vi.waitFor(o).next(()=>i.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,a,c)).next(()=>a)}).then(e=>(r.Fs=s,e))}(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.Eu.get(t);n&&(Ns(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?n.lu=!0:e.modifiedDocuments.size>0?Ns(n.lu,14607):e.removedDocuments.size>0&&(Ns(n.lu,42227),n.lu=!1))}),await Ku(r,e,t)}catch(e){await yi(e)}}function $u(e,t,r){const n=Ds(e);if(n.isPrimaryClient&&0===r||!n.isPrimaryClient&&1===r){const e=[];n.Pu.forEach((r,n)=>{const s=n.view.va(t);s.snapshot&&e.push(s.snapshot)}),function(e,t){const r=Ds(e);r.onlineState=t;let n=!1;r.queries.forEach((e,r)=>{for(const e of r.wa)e.va(t)&&(n=!0)}),n&&Eu(r)}(n.eventManager,t),e.length&&n.hu.J_(e),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function Vu(e,t,r){const n=Ds(e);n.sharedClientState.updateQueryState(t,"rejected",r);const s=n.Eu.get(t),i=s&&s.key;if(i){let e=new $i(si.comparator);e=e.insert(i,Oo.newNoDocument(i,di.min()));const r=Sa().add(i),s=new ac(di.min(),new Map,new $i(Gs),e,r);await Mu(n,s),n.du=n.du.remove(i),n.Eu.delete(t),Hu(n)}else await Tl(n.localStore,t,!1).then(()=>Fu(n,t,r)).catch(yi)}function Fu(e,t,r=null){e.sharedClientState.removeLocalQueryTarget(t);for(const n of e.Tu.get(t))e.Pu.delete(n),r&&e.hu.pu(n,r);e.Tu.delete(t),e.isPrimaryClient&&e.Au.zr(t).forEach(t=>{e.Au.containsKey(t)||Bu(e,t)})}function Bu(e,t){e.Iu.delete(t.path.canonicalString());const r=e.du.get(t);null!==r&&(Xl(e.remoteStore,r),e.du=e.du.remove(t),e.Eu.delete(r),Hu(e))}function qu(e,t,r){for(const n of r)n instanceof ku?(e.Au.addReference(n.key,t),zu(e,n)):n instanceof Cu?(ks(Ou,"Document no longer in limbo: "+n.key),e.Au.removeReference(n.key,t),e.Au.containsKey(n.key)||Bu(e,n.key)):Rs(19791,{yu:n})}function zu(e,t){const r=t.key,n=r.path.canonicalString();e.du.get(r)||e.Iu.has(n)||(ks(Ou,"New document in limbo: "+r),e.Iu.add(n),Hu(e))}function Hu(e){for(;e.Iu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Iu.values().next().value;e.Iu.delete(t);const r=new si(ti.fromString(t)),n=e.mu.next();e.Eu.set(n,new Pu(r)),e.du=e.du.insert(r,n),Yl(e.remoteStore,new $c(oa(na(r.path)),n,"TargetPurposeLimboResolution",_i.ue))}}async function Ku(e,t,r){const n=Ds(e),s=[],i=[],o=[];n.Pu.isEmpty()||(n.Pu.forEach((e,a)=>{o.push(n.gu(a,t,r).then(e=>{var t;if((e||r)&&n.isPrimaryClient){const s=e?!e.fromCache:null===(t=null==r?void 0:r.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;n.sharedClientState.updateQueryState(a.targetId,s?"current":"not-current")}if(e){s.push(e);const t=ml.Es(a.targetId,e);i.push(t)}}))}),await Promise.all(o),n.hu.J_(s),await async function(e,t){const r=Ds(e);try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>vi.forEach(t,t=>vi.forEach(t.Is,n=>r.persistence.referenceDelegate.addReference(e,t.targetId,n)).next(()=>vi.forEach(t.ds,n=>r.persistence.referenceDelegate.removeReference(e,t.targetId,n)))))}catch(e){if(!wi(e))throw e;ks(wl,"Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.Fs.get(t),n=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(n);r.Fs=r.Fs.insert(t,s)}}}(n.localStore,i))}async function Wu(e,t){const r=Ds(e);if(!r.currentUser.isEqual(t)){ks(Ou,"User change. New user:",t.toKey());const e=await bl(r.localStore,t);r.currentUser=t,function(e){e.Vu.forEach(e=>{e.forEach(e=>{e.reject(new Ls(xs.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Vu.clear()}(r),r.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Ku(r,e.Bs)}}function Gu(e,t){const r=Ds(e),n=r.Eu.get(t);if(n&&n.lu)return Sa().add(n.key);{let e=Sa();const n=r.Tu.get(t);if(!n)return e;for(const t of n){const n=r.Pu.get(t);e=e.unionWith(n.view.tu)}return e}}function Ju(e){const t=Ds(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Mu.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Gu.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Vu.bind(null,t),t.hu.J_=_u.bind(null,t.eventManager),t.hu.pu=bu.bind(null,t.eventManager),t}class Qu{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=$l(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,t){return null}Fu(e,t){return null}vu(e){return function(e,t,r,n){return new _l(e,t,r,n)}(this.persistence,new vl,e.initialUser,this.serializer)}Du(e){return new dl(pl.Vi,this.serializer)}bu(e){return new kl}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Qu.provider={build:()=>new Qu};class Yu extends Qu{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){Ns(this.persistence.referenceDelegate instanceof gl,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Xc(r,e.asyncQueue,t)}Du(e){const t=void 0!==this.cacheSizeBytes?Wc.withCacheSize(this.cacheSizeBytes):Wc.DEFAULT;return new dl(e=>gl.Vi(e,t),this.serializer)}}class Xu{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>$u(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Wu.bind(null,this.syncEngine),await async function(e,t){const r=Ds(e);t?(r.Ia.delete(2),await Jl(r)):t||(r.Ia.add(2),await Ql(r),r.Aa.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new vu}createDatastore(e){const t=$l(e.databaseInfo.databaseId),r=function(e){return new Ul(e)}(e.databaseInfo);return function(e,t,r,n){return new Hl(e,t,r,n)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(e,t,r,n,s){return new Gl(e,t,r,n,s)}(this.localStore,this.datastore,e.asyncQueue,e=>$u(this.syncEngine,e,0),Ol.C()?new Ol:new Cl)}createSyncEngine(e,t){return function(e,t,r,n,s,i,o){const a=new Nu(e,t,r,n,s,i);return o&&(a.fu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=Ds(e);ks(Wl,"RemoteStore shutting down."),t.Ia.add(5),await Ql(t),t.Ea.shutdown(),t.Aa.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}Xu.provider={build:()=>new Xu};class Zu{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):Cs("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const eh="FirestoreClient";class th{constructor(e,t,r,n,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=Es.UNAUTHENTICATED,this.clientId=Ws.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async e=>{ks(eh,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(ks(eh,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new js;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=fu(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function rh(e,t){e.asyncQueue.verifyOperationInProgress(),ks(eh,"Initializing OfflineComponentProvider");const r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await bl(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>{As("Terminating Firestore due to IndexedDb database deletion"),e.terminate().then(()=>{ks("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(e=>{As("Terminating Firestore due to IndexedDb database deletion failed",e)})}),e._offlineComponents=t}async function nh(e,t){e.asyncQueue.verifyOperationInProgress();const r=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){ks(eh,"Using user provided OfflineComponentProvider");try{await rh(e,e._uninitializedComponentsProvider._offline)}catch(t){const r=t;if(!function(e){return"FirebaseError"===e.name?e.code===xs.FAILED_PRECONDITION||e.code===xs.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(r))throw r;As("Error using user provided cache. Falling back to memory cache: "+r),await rh(e,new Qu)}}else ks(eh,"Using default OfflineComponentProvider"),await rh(e,new Yu(void 0));return e._offlineComponents}(e);ks(eh,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>uu(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>uu(t.remoteStore,r)),e._onlineComponents=t}async function sh(e){const t=await async function(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(ks(eh,"Using user provided OnlineComponentProvider"),await nh(e,e._uninitializedComponentsProvider._online)):(ks(eh,"Using default OnlineComponentProvider"),await nh(e,new Xu))),e._onlineComponents}(e),r=t.eventManager;return r.onListen=Du.bind(null,t.syncEngine),r.onUnlisten=ju.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=xu.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=Uu.bind(null,t.syncEngine),r}function ih(e,t,r={}){const n=new js;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,r,n,s){const i=new Zu({next:a=>{i.Ou(),t.enqueueAndForget(()=>async function(e,t){const r=Ds(e),n=t.query;let s=3;const i=r.queries.get(n);if(i){const e=i.wa.indexOf(t);e>=0&&(i.wa.splice(e,1),0===i.wa.length?s=t.ba()?0:1:!i.Sa()&&t.ba()&&(s=2))}switch(s){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}(e,o));const c=a.docs.has(r);!c&&a.fromCache?s.reject(new Ls(xs.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&n&&"server"===n.source?s.reject(new Ls(xs.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(a)},error:e=>s.reject(e)}),o=new Iu(na(r.path),i,{includeMetadataChanges:!0,ka:!0});return async function(e,t){const r=Ds(e);let n=3;const s=t.query;let i=r.queries.get(s);i?!i.Sa()&&t.ba()&&(n=2):(i=new yu,n=t.ba()?0:1);try{switch(n){case 0:i.ya=await r.onListen(s,!0);break;case 1:i.ya=await r.onListen(s,!1);break;case 2:await r.onFirstRemoteStoreListen(s)}}catch(e){const r=fu(e,`Initialization of query '${ua(t.query)}' failed`);return void t.onError(r)}r.queries.set(s,i),i.wa.push(t),t.va(r.onlineState),i.ya&&t.Ca(i.ya)&&Eu(r)}(e,o)}(await sh(e),e.asyncQueue,t,r,n)),n.promise}function oh(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const ah=new Map,ch="firestore.googleapis.com",lh=!0;class uh{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new Ls(xs.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ch,this.ssl=lh}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:lh;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=Kc;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Ls(xs.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,r,n){if(!0===t&&!0===n)throw new Ls(xs.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=oh(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new Ls(xs.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new Ls(xs.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new Ls(xs.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class hh{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new uh({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ls(xs.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Ls(xs.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new uh(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Ms;switch(e.type){case"firstParty":return new Bs(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Ls(xs.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=ah.get(e);t&&(ks("ComponentProvider","Removing Datastore"),ah.delete(e),t.terminate())}(this),Promise.resolve()}}class dh{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new dh(this.firestore,e,this._query)}}class fh{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ph(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new fh(this.firestore,e,this._key)}toJSON(){return{type:fh._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(ci(t,fh._jsonSchema))return new fh(e,r||null,new si(ti.fromString(t.referencePath)))}}fh._jsonSchemaVersion="firestore/documentReference/1.0",fh._jsonSchema={type:ai("string",fh._jsonSchemaVersion),referencePath:ai("string")};class ph extends dh{constructor(e,t,r){super(e,t,na(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new fh(this.firestore,null,new si(e))}withConverter(e){return new ph(this.firestore,e,this._path)}}function gh(e,t,...r){if(e=A(e),1===arguments.length&&(t=Ws.newId()),function(e,t,r){if(!r)throw new Ls(xs.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}("doc","path",t),e instanceof hh){const n=ti.fromString(t,...r);return ii(n),new fh(e,null,new si(n))}{if(!(e instanceof fh||e instanceof ph))throw new Ls(xs.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(ti.fromString(t,...r));return ii(n),new fh(e.firestore,e instanceof ph?e.converter:null,new si(n))}}const mh="AsyncQueue";class yh{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Vl(this,"async_queue_retry"),this.oc=()=>{const e=Ml();e&&ks(mh,"Visibility state changed to "+e.visibilityState),this.F_.y_()},this._c=e;const t=Ml();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const t=Ml();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});const t=new js;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}async cc(){if(0!==this.Zu.length){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!wi(e))throw e;ks(mh,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}}uc(e){const t=this._c.then(()=>(this.nc=!0,e().catch(e=>{throw this.tc=e,this.nc=!1,Cs("INTERNAL UNHANDLED ERROR: ",vh(e)),e}).then(e=>(this.nc=!1,e))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);const n=du.createAndSchedule(this,e,t,r,e=>this.lc(e));return this.ec.push(n),n}ac(){this.tc&&Rs(47125,{hc:vh(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do{e=this._c,await e}while(e!==this._c)}Tc(e){for(const t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.ec)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){const t=this.ec.indexOf(e);this.ec.splice(t,1)}}function vh(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class wh extends hh{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new yh,this._persistenceKey=(null==n?void 0:n.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new yh(e),this._firestoreClient=void 0,await e}}}function _h(e){if(e._terminated)throw new Ls(xs.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,r,n;const s=e._freezeSettings(),i=function(e,t,r,n){return new so(e,t,r,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling,oh(n.experimentalLongPollingOptions),n.useFetchStreams,n.isUsingEmulator)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,s);e._componentsProvider||(null===(r=s.localCache)||void 0===r?void 0:r._offlineComponentProvider)&&(null===(n=s.localCache)||void 0===n?void 0:n._onlineComponentProvider)&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new th(e._authCredentials,e._appCheckCredentials,e._queue,i,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class bh{constructor(e){this._byteString=e}static fromBase64String(e){try{return new bh(Ki.fromBase64String(e))}catch(e){throw new Ls(xs.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new bh(Ki.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:bh._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ci(e,bh._jsonSchema))return bh.fromBase64String(e.bytes)}}bh._jsonSchemaVersion="firestore/bytes/1.0",bh._jsonSchema={type:ai("string",bh._jsonSchemaVersion),bytes:ai("string")};class Eh{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Ls(xs.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ni(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Th{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ls(xs.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ls(xs.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Gs(this._lat,e._lat)||Gs(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Th._jsonSchemaVersion}}static fromJSON(e){if(ci(e,Th._jsonSchema))return new Th(e.latitude,e.longitude)}}Th._jsonSchemaVersion="firestore/geoPoint/1.0",Th._jsonSchema={type:ai("string",Th._jsonSchemaVersion),latitude:ai("number"),longitude:ai("number")};class Sh{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Sh._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ci(e,Sh._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new Sh(e.vectorValues);throw new Ls(xs.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Sh._jsonSchemaVersion="firestore/vectorValue/1.0",Sh._jsonSchema={type:ai("string",Sh._jsonSchemaVersion),vectorValues:ai("object")};const Ih=new RegExp("[~\\*/\\[\\]]");function kh(e,t,r,n,s){const i=n&&!n.isEmpty(),o=void 0!==s;let a=`Function ${t}() called with invalid data`;r&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${n}`),o&&(c+=` in document ${s}`),c+=")"),new Ls(xs.INVALID_ARGUMENT,a+e+c)}class Ch{constructor(e,t,r,n,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new fh(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Ah(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Oh("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Ah extends Ch{data(){return super.data()}}function Oh(e,t){return"string"==typeof t?function(e,t,r){if(t.search(Ih)>=0)throw kh(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new Eh(...t.split("."))._internalPath}catch(n){throw kh(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}(e,t):t instanceof Eh?t._internalPath:t._delegate._internalPath}class Rh{convertValue(e,t="none"){switch(uo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ji(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Qi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Rs(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Mi(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){var t,r,n;const s=null===(n=null===(r=null===(t=e.fields)||void 0===t?void 0:t[lo].arrayValue)||void 0===r?void 0:r.values)||void 0===n?void 0:n.map(e=>Ji(e.doubleValue));return new Sh(s)}convertGeoPoint(e){return new Th(Ji(e.latitude),Ji(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=ro(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(no(e));default:return null}}convertTimestamp(e){const t=Gi(e);return new hi(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ti.fromString(e);Ns(Mc(r),9688,{name:e});const n=new oo(r.get(1),r.get(3)),s=new si(r.popFirst(5));return n.isEqual(t)||Cs(`Document ${s} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}class Ph{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Nh extends Ch{constructor(e,t,r,n,s,i){super(e,t,r,n,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Dh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Oh("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Ls(xs.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Nh._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}Nh._jsonSchemaVersion="firestore/documentSnapshot/1.0",Nh._jsonSchema={type:ai("string",Nh._jsonSchemaVersion),bundleSource:ai("string","DocumentSnapshot"),bundleName:ai("string"),bundle:ai("string")};class Dh extends Nh{data(e={}){return super.data(e)}}class xh{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new Ph(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Dh(this._firestore,this._userDataWriter,r.key,r,new Ph(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Ls(xs.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{const n=new Dh(e._firestore,e._userDataWriter,r.doc.key,r.doc,new Ph(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const n=new Dh(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Ph(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,i=-1;return 0!==t.type&&(s=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(r=r.add(t.doc),i=r.indexOf(t.doc.key)),{type:Lh(t.type),doc:n,oldIndex:s,newIndex:i}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Ls(xs.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=xh._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ws.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Lh(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Rs(61501,{type:e})}}function jh(e){e=oi(e,fh);const t=oi(e.firestore,wh);return ih(_h(t),e._key).then(r=>function(e,t,r){const n=r.docs.get(t._key),s=new Uh(e);return new Nh(e,s,t._key,n,new Ph(r.hasPendingWrites,r.fromCache),t.converter)}(t,e,r))}xh._jsonSchemaVersion="firestore/querySnapshot/1.0",xh._jsonSchema={type:ai("string",xh._jsonSchemaVersion),bundleSource:ai("string","QuerySnapshot"),bundleName:ai("string"),bundle:ai("string")};class Uh extends Rh{constructor(e){super(),this.firestore=e}convertBytes(e){return new bh(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new fh(this.firestore,null,t)}}new WeakMap,function(e,t=!0){!function(e){Ts=e}(qe),Me(new O("firestore",(e,{instanceIdentifier:r,options:n})=>{const s=e.getProvider("app").getImmediate(),i=new wh(new Vs(e.getProvider("auth-internal")),new zs(s,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Ls(xs.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new oo(e.options.projectId,t)}(s,r),s);return n=Object.assign({useFetchStreams:t},n),i._setSettings(n),i},"PUBLIC").setMultipleInstances(!0)),Ke(_s,bs,e),Ke(_s,bs,"esm2017")}();class Mh extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class $h extends Mh{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Vh extends Mh{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Fh extends Mh{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Bh;!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(Bh||(Bh={}));class qh{constructor(e,{headers:t={},customFetch:r,region:n=Bh.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=(e=>e?(...t)=>e(...t):(...e)=>fetch(...e))(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return t=this,r=arguments,s=function*(e,t={}){var r;let n,s;try{const{headers:i,method:o,body:a,signal:c,timeout:l}=t;let u={},{region:h}=t;h||(h=this.region);const d=new URL(`${this.url}/${e}`);let f;h&&"any"!==h&&(u["x-region"]=h,d.searchParams.set("forceFunctionRegion",h)),a&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?"undefined"!=typeof Blob&&a instanceof Blob||a instanceof ArrayBuffer?(u["Content-Type"]="application/octet-stream",f=a):"string"==typeof a?(u["Content-Type"]="text/plain",f=a):"undefined"!=typeof FormData&&a instanceof FormData?f=a:(u["Content-Type"]="application/json",f=JSON.stringify(a)):f=a;let p=c;l&&(s=new AbortController,n=setTimeout(()=>s.abort(),l),c?(p=s.signal,c.addEventListener("abort",()=>s.abort())):p=s.signal);const g=yield this.fetch(d.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},u),this.headers),i),body:f,signal:p}).catch(e=>{throw new $h(e)}),m=g.headers.get("x-relay-error");if(m&&"true"===m)throw new Vh(g);if(!g.ok)throw new Fh(g);let y,v=(null!==(r=g.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return y="application/json"===v?yield g.json():"application/octet-stream"===v||"application/pdf"===v?yield g.blob():"text/event-stream"===v?g:"multipart/form-data"===v?yield g.formData():yield g.text(),{data:y,error:null,response:g}}catch(e){return{data:null,error:e,response:e instanceof Fh||e instanceof Vh?e.context:void 0}}finally{n&&clearTimeout(n)}},new((n=void 0)||(n=Promise))(function(e,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n(function(e){e(r)})).then(o,a)}c((s=s.apply(t,r||[])).next())});var t,r,n,s}}var zh=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},Hh=class{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(r=e.isMaybeSingle)&&void 0!==r&&r,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var r=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let n=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{let t=null,n=null,s=null,i=e.status,o=e.statusText;if(e.ok){var a,c;if("HEAD"!==r.method){var l;const t=await e.text();""===t||(n="text/csv"===r.headers.get("Accept")||r.headers.get("Accept")&&(null===(l=r.headers.get("Accept"))||void 0===l?void 0:l.includes("application/vnd.pgrst.plan+text"))?t:JSON.parse(t))}const u=null===(a=r.headers.get("Prefer"))||void 0===a?void 0:a.match(/count=(exact|planned|estimated)/),h=null===(c=e.headers.get("content-range"))||void 0===c?void 0:c.split("/");u&&h&&h.length>1&&(s=parseInt(h[1])),r.isMaybeSingle&&"GET"===r.method&&Array.isArray(n)&&(n.length>1?(t={code:"PGRST116",details:`Results contain ${n.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},n=null,s=null,i=406,o="Not Acceptable"):n=1===n.length?n[0]:null)}else{var u;const s=await e.text();try{t=JSON.parse(s),Array.isArray(t)&&404===e.status&&(n=[],t=null,i=200,o="OK")}catch(r){404===e.status&&""===s?(i=204,o="No Content"):t={message:s}}if(t&&r.isMaybeSingle&&(null==t||null===(u=t.details)||void 0===u?void 0:u.includes("0 rows"))&&(t=null,i=200,o="OK"),t&&r.shouldThrowOnError)throw new zh(t)}return{error:t,data:n,count:s,status:i,statusText:o}});return this.shouldThrowOnError||(n=n.catch(e=>{var t;let r="";const n=null==e?void 0:e.cause;if(n){var s,i,o,a;const t=null!==(s=null==n?void 0:n.message)&&void 0!==s?s:"",c=null!==(i=null==n?void 0:n.code)&&void 0!==i?i:"";r=`${null!==(o=null==e?void 0:e.name)&&void 0!==o?o:"FetchError"}: ${null==e?void 0:e.message}`,r+=`\n\nCaused by: ${null!==(a=null==n?void 0:n.name)&&void 0!==a?a:"Error"}: ${t}`,c&&(r+=` (${c})`),(null==n?void 0:n.stack)&&(r+=`\n${n.stack}`)}else{var c;r=null!==(c=null==e?void 0:e.stack)&&void 0!==c?c:""}return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:r,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}},Kh=class extends Hh{select(e){let t=!1;const r=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:n,referencedTable:s=n}={}){const i=s?`${s}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const n=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:n=r}={}){const s=void 0===n?"offset":`${n}.offset`,i=void 0===n?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:s=!1,format:i="text"}={}){var o;const a=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,s?"wal":null].filter(Boolean).join("|"),c=null!==(o=this.headers.get("Accept"))&&void 0!==o?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${c}"; options=${a};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};const Wh=new RegExp("[,()]");var Gh=class extends Kh{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(e=>"string"==typeof e&&Wh.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}notIn(e,t){const r=Array.from(new Set(t)).map(e=>"string"==typeof e&&Wh.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`not.in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:n}={}){let s="";"plain"===n?s="pl":"phrase"===n?s="ph":"websearch"===n&&(s="w");const i=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${s}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}},Jh=class{constructor(e,{headers:t={},schema:r,fetch:n}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=n}select(e,t){const{head:r=!1,count:n}=null!=t?t:{},s=r?"HEAD":"GET";let i=!1;const o=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!i?"":('"'===e&&(i=!i),e)).join("");return this.url.searchParams.set("select",o),n&&this.headers.append("Prefer",`count=${n}`),new Gh({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:r=!0}={}){var n;if(t&&this.headers.append("Prefer",`count=${t}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new Gh({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:s=!0}={}){var i;if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),void 0!==t&&this.url.searchParams.set("on_conflict",t),n&&this.headers.append("Prefer",`count=${n}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new Gh({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}update(e,{count:t}={}){var r;return t&&this.headers.append("Prefer",`count=${t}`),new Gh({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}delete({count:e}={}){var t;return e&&this.headers.append("Prefer",`count=${e}`),new Gh({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}},Qh=class e{constructor(e,{headers:t={},schema:r,fetch:n}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.fetch=n}from(e){if(!e||"string"!=typeof e||""===e.trim())throw new Error("Invalid relation name: relation must be a non-empty string.");return new Jh(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:n=!1,count:s}={}){var i;let o;const a=new URL(`${this.url}/rpc/${e}`);let c;r||n?(o=r?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{a.searchParams.append(e,t)})):(o="POST",c=t);const l=new Headers(this.headers);return s&&l.set("Prefer",`count=${s}`),new Gh({method:o,url:a,headers:l,schema:this.schemaName,body:c,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}};const Yh=class{constructor(){}static detectEnvironment(){var t;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if(void 0!==e.g&&void 0!==e.g.WebSocket)return{type:"native",constructor:e.g.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(t=navigator.userAgent)||void 0===t?void 0:t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process){const e=process.versions;if(e&&e.node){const t=e.node,r=parseInt(t.replace(/^v/,"").split(".")[0]);return r>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`\n\nSuggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}},Xh="1.0.0",Zh=Xh;var ed,td,rd,nd,sd,id,od;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(ed||(ed={})),(od=td||(td={})).closed="closed",od.errored="errored",od.joined="joined",od.joining="joining",od.leaving="leaving",function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(rd||(rd={})),function(e){e.websocket="websocket"}(nd||(nd={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(sd||(sd={}));class ad{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=null!=e?e:[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&"string"==typeof e.payload.event)return t(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer(null===(t=e.payload)||void 0===t?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,r;const n=null!==(r=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==r?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,n)}_encodeJsonUserBroadcastPush(e){var t,r;const n=null!==(r=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==r?r:{},s=(new TextEncoder).encode(JSON.stringify(n)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,s)}_encodeUserBroadcastPush(e,t,r){var n,s;const i=e.topic,o=null!==(n=e.ref)&&void 0!==n?n:"",a=null!==(s=e.join_ref)&&void 0!==s?s:"",c=e.payload.event,l=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},u=0===Object.keys(l).length?"":JSON.stringify(l);if(a.length>255)throw new Error(`joinRef length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`ref length ${o.length} exceeds maximum of 255`);if(i.length>255)throw new Error(`topic length ${i.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`userEvent length ${c.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`metadata length ${u.length} exceeds maximum of 255`);const h=this.USER_BROADCAST_PUSH_META_LENGTH+a.length+o.length+i.length+c.length+u.length,d=new ArrayBuffer(this.HEADER_LENGTH+h);let f=new DataView(d),p=0;f.setUint8(p++,this.KINDS.userBroadcastPush),f.setUint8(p++,a.length),f.setUint8(p++,o.length),f.setUint8(p++,i.length),f.setUint8(p++,c.length),f.setUint8(p++,u.length),f.setUint8(p++,t),Array.from(a,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(o,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(i,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(c,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(u,e=>f.setUint8(p++,e.charCodeAt(0)));var g=new Uint8Array(d.byteLength+r.byteLength);return g.set(new Uint8Array(d),0),g.set(new Uint8Array(r),d.byteLength),g.buffer}decode(e,t){if(this._isArrayBuffer(e))return t(this._binaryDecode(e));if("string"==typeof e){const r=JSON.parse(e),[n,s,i,o,a]=r;return t({join_ref:n,ref:s,topic:i,event:o,payload:a})}return t({})}_binaryDecode(e){const t=new DataView(e),r=t.getUint8(0),n=new TextDecoder;if(r===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,t,n)}_decodeUserBroadcast(e,t,r){const n=t.getUint8(1),s=t.getUint8(2),i=t.getUint8(3),o=t.getUint8(4);let a=this.HEADER_LENGTH+4;const c=r.decode(e.slice(a,a+n));a+=n;const l=r.decode(e.slice(a,a+s));a+=s;const u=r.decode(e.slice(a,a+i));a+=i;const h=e.slice(a,e.byteLength),d=o===this.JSON_ENCODING?JSON.parse(r.decode(h)):h,f={type:this.BROADCAST_EVENT,event:l,payload:d};return i>0&&(f.meta=JSON.parse(u)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:f}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||"ArrayBuffer"===(null===(t=null==e?void 0:e.constructor)||void 0===t?void 0:t.name)}_pick(e,t){return e&&"object"==typeof e?Object.fromEntries(Object.entries(e).filter(([e])=>t.includes(e))):{}}}class cd{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(id||(id={}));const ld=(e,t,r={})=>{var n;const s=null!==(n=r.skipTypes)&&void 0!==n?n:[];return t?Object.keys(t).reduce((r,n)=>(r[n]=ud(n,e,t,s),r),{}):{}},ud=(e,t,r,n)=>{const s=t.find(t=>t.name===e),i=null==s?void 0:s.type,o=r[e];return i&&!n.includes(i)?hd(i,o):dd(o)},hd=(e,t)=>{if("_"===e.charAt(0)){const r=e.slice(1,e.length);return md(t,r)}switch(e){case id.bool:return fd(t);case id.float4:case id.float8:case id.int2:case id.int4:case id.int8:case id.numeric:case id.oid:return pd(t);case id.json:case id.jsonb:return gd(t);case id.timestamp:return yd(t);case id.abstime:case id.date:case id.daterange:case id.int4range:case id.int8range:case id.money:case id.reltime:case id.text:case id.time:case id.timestamptz:case id.timetz:case id.tsrange:case id.tstzrange:default:return dd(t)}},dd=e=>e,fd=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},pd=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},gd=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}return e},md=(e,t)=>{if("string"!=typeof e)return e;const r=e.length-1,n=e[r];if("{"===e[0]&&"}"===n){let n;const s=e.slice(1,r);try{n=JSON.parse("["+s+"]")}catch(e){n=s?s.split(","):[]}return n.map(e=>hd(t,e))}return e},yd=e=>"string"==typeof e?e.replace(" ","T"):e,vd=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===t.pathname||"/"===t.pathname?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class wd{constructor(e,t,r={},n=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var _d,bd,Ed,Td;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(_d||(_d={}));class Sd{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{const{onJoin:t,onLeave:r,onSync:n}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Sd.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=Sd.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],n()}),this.channel._on(r.diff,{},e=>{const{onJoin:t,onLeave:r,onSync:n}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=Sd.syncDiff(this.state,e,t,r),n())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const s=this.cloneDeep(e),i=this.transformState(t),o={},a={};return this.map(s,(e,t)=>{i[e]||(a[e]=t)}),this.map(i,(e,t)=>{const r=s[e];if(r){const n=t.map(e=>e.presence_ref),s=r.map(e=>e.presence_ref),i=t.filter(e=>s.indexOf(e.presence_ref)<0),c=r.filter(e=>n.indexOf(e.presence_ref)<0);i.length>0&&(o[e]=i),c.length>0&&(a[e]=c)}else o[e]=t}),this.syncDiff(s,{joins:o,leaves:a},r,n)}static syncDiff(e,t,r,n){const{joins:s,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(s,(t,n)=>{var s;const i=null!==(s=e[t])&&void 0!==s?s:[];if(e[t]=this.cloneDeep(n),i.length>0){const r=e[t].map(e=>e.presence_ref),n=i.filter(e=>r.indexOf(e.presence_ref)<0);e[t].unshift(...n)}r(t,i,n)}),this.map(i,(t,r)=>{let s=e[t];if(!s)return;const i=r.map(e=>e.presence_ref);s=s.filter(e=>i.indexOf(e.presence_ref)<0),e[t]=s,n(t,s,r),0===s.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return t[r]="metas"in n?n.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(bd||(bd={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(Ed||(Ed={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(Td||(Td={}));class Id{constructor(e,t={config:{}},r){var n,s;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=td.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new wd(this,rd.join,this.params,this.timeout),this.rejoinTimer=new cd(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=td.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=td.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=td.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=td.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=td.errored,this.rejoinTimer.scheduleTimeout())}),this._on(rd.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new Sd(this),this.broadcastEndpointURL=vd(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(s=null===(n=this.params.config)||void 0===n?void 0:n.broadcast)||void 0===s?void 0:s.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,n,s;if(this.socket.isConnected()||this.socket.connect(),this.state==td.closed){const{config:{broadcast:i,presence:o,private:a}}=this.params,c=null!==(n=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(e=>e.filter))&&void 0!==n?n:[],l=!!this.bindings[Ed.PRESENCE]&&this.bindings[Ed.PRESENCE].length>0||!0===(null===(s=this.params.config.presence)||void 0===s?void 0:s.enabled),u={},h={broadcast:i,presence:Object.assign(Object.assign({},o),{enabled:l}),postgres_changes:c,private:a};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(Td.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(Td.CLOSED)),this.updateJoinPayload(Object.assign({config:h},u)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var r;if(this.socket._isManualToken()||this.socket.setAuth(),void 0!==t){const n=this.bindings.postgres_changes,s=null!==(r=null==n?void 0:n.length)&&void 0!==r?r:0,i=[];for(let r=0;r<s;r++){const s=n[r],{filter:{event:o,schema:a,table:c,filter:l}}=s,u=t&&t[r];if(!(u&&u.event===o&&Id.isFilterValueEqual(u.schema,a)&&Id.isFilterValueEqual(u.table,c)&&Id.isFilterValueEqual(u.filter,l)))return this.unsubscribe(),this.state=td.errored,void(null==e||e(Td.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));i.push(Object.assign(Object.assign({},s),{id:u.id}))}return this.bindings.postgres_changes=i,void(e&&e(Td.SUBSCRIBED))}null==e||e(Td.SUBSCRIBED)}).receive("error",t=>{this.state=td.errored,null==e||e(Td.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(Td.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===td.joined&&e===Ed.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,r)}async httpSend(e,t,r={}){var n;if(null==t)return Promise.reject("Payload is required for httpSend()");const s={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(s.Authorization=`Bearer ${this.socket.accessTokenValue}`);const i={method:"POST",headers:s,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,i,null!==(n=r.timeout)&&void 0!==n?n:this.timeout);if(202===o.status)return{success:!0};let a=o.statusText;try{const e=await o.json();a=e.error||e.message||a}catch(e){}return Promise.reject(new Error(a))}async send(e,t={}){var r,n;if(this._canPush()||"broadcast"!==e.type)return new Promise(r=>{var n,s,i;const o=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(i=null===(s=null===(n=this.params)||void 0===n?void 0:n.config)||void 0===s?void 0:s.broadcast)||void 0===i?void 0:i.ack)||r("ok"),o.receive("ok",()=>r("ok")),o.receive("error",()=>r("error")),o.receive("timeout",()=>r("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:s,payload:i}=e,o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization=`Bearer ${this.socket.accessTokenValue}`);const a={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:i,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,a,null!==(r=t.timeout)&&void 0!==r?r:this.timeout);return await(null===(n=e.body)||void 0===n?void 0:n.cancel()),e.ok?"ok":"error"}catch(e){return"AbortError"===e.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=td.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(rd.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new wd(this,rd.leave,{},e),r.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{null==r||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=td.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const n=new AbortController,s=setTimeout(()=>n.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(s),i}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new wd(this,e,t,r);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,s;const i=e.toLocaleLowerCase(),{close:o,error:a,leave:c,join:l}=rd;if(r&&[o,a,c,l].indexOf(i)>=0&&r!==this._joinRef())return;let u=this._onMessage(i,t,r);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null===(n=this.bindings.postgres_changes)||void 0===n||n.filter(e=>{var t,r,n;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(n=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===n?void 0:n.toLocaleLowerCase())===i}).map(e=>e.callback(u,r)):null===(s=this.bindings[i])||void 0===s||s.filter(e=>{var r,n,s,o,a,c;if(["broadcast","presence","postgres_changes"].includes(i)){if("id"in e){const i=e.id,o=null===(r=e.filter)||void 0===r?void 0:r.event;return i&&(null===(n=t.ids)||void 0===n?void 0:n.includes(i))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(s=t.data)||void 0===s?void 0:s.type.toLocaleLowerCase()))}{const r=null===(a=null===(o=null==e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===r||r===(null===(c=null==t?void 0:t.event)||void 0===c?void 0:c.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===i}).map(e=>{if("object"==typeof u&&"ids"in u){const e=u.data,{schema:t,table:r,commit_timestamp:n,type:s,errors:i}=e,o={schema:t,table:r,commit_timestamp:n,eventType:s,new:{},old:{},errors:i};u=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(u,r)})}_isClosed(){return this.state===td.closed}_isJoined(){return this.state===td.joined}_isJoining(){return this.state===td.joining}_isLeaving(){return this.state===td.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const n=e.toLocaleLowerCase(),s={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(s):this.bindings[n]=[s],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(e=>{var n;return!((null===(n=e.type)||void 0===n?void 0:n.toLocaleLowerCase())===r&&Id.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}static isFilterValueEqual(e,t){return(null!=e?e:void 0)===(null!=t?t:void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(rd.close,{},e)}_onError(e){this._on(rd.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=td.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=ld(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=ld(e.columns,e.old_record)),t}}const kd=()=>{},Cd=[1e3,2e3,5e3,1e4];class Ad{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.transport=null,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=kd,this.ref=0,this.reconnectTimer=null,this.vsn=Zh,this.logger=kd,this.conn=null,this.sendBuffer=[],this.serializer=new ad,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),!(null===(r=null==t?void 0:t.params)||void 0===r?void 0:r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${nd.websocket}`,this.httpEndpoint=vd(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Yh.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error(`${t}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},"function"==typeof this.conn.close&&(e?this.conn.close(e,null!=t?t:""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case ed.connecting:return sd.Connecting;case ed.open:return sd.Open;case ed.closing:return sd.Closing;default:return sd.Closed}}isConnected(){return this.connectionState()===sd.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){const r=`realtime:${e}`,n=this.getChannels().find(e=>e.topic===r);if(n)return n;{const r=new Id(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){const{topic:t,event:r,payload:n,ref:s}=e,i=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${r} (${s})`,n),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},100)}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event)try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error")}catch(e){this.log("error","error in heartbeat callback",e)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:r,payload:n,ref:s}=e,i=s?`(${s})`:"",o=n.status||"";this.log("receive",`${o} ${t} ${r} ${i}`.trim(),n),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,n,s)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===ed.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===ed.open||this.conn.readyState===ed.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this._terminateWorker()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(rd.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const r=e.match(/\?/)?"&":"?";return`${e}${r}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,r=!1;if(e)t=e,r=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(e){this.log("error","Error fetching access token from callback",e),t=this.accessTokenValue}else t=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const r={access_token:t,version:"realtime-js/2.89.0"};t&&e.updateJoinPayload(r),e.joinedOnce&&e._isJoined()&&e._push(rd.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(t){this.log("error",`error in ${e} callback`,t)}})}catch(t){this.log("error",`error triggering ${e} callbacks`,t)}}_setupReconnectionTimer(){this.reconnectTimer=new cd(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},10)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,n,s,i,o,a,c,l,u,h,d;switch(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(r=null==e?void 0:e.timeout)&&void 0!==r?r:1e4,this.heartbeatIntervalMs=null!==(n=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==n?n:25e3,this.worker=null!==(s=null==e?void 0:e.worker)&&void 0!==s&&s,this.accessToken=null!==(i=null==e?void 0:e.accessToken)&&void 0!==i?i:null,this.heartbeatCallback=null!==(o=null==e?void 0:e.heartbeatCallback)&&void 0!==o?o:kd,this.vsn=null!==(a=null==e?void 0:e.vsn)&&void 0!==a?a:Zh,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(c=null==e?void 0:e.reconnectAfterMs)&&void 0!==c?c:e=>Cd[e-1]||1e4,this.vsn){case Xh:this.encode=null!==(l=null==e?void 0:e.encode)&&void 0!==l?l:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(u=null==e?void 0:e.decode)&&void 0!==u?u:(e,t)=>t(JSON.parse(e));break;case"2.0.0":this.encode=null!==(h=null==e?void 0:e.encode)&&void 0!==h?h:this.serializer.encode.bind(this.serializer),this.decode=null!==(d=null==e?void 0:e.decode)&&void 0!==d?d:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}var Od=class extends Error{constructor(e,t){super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown="CommitStateUnknownException"===t.icebergType||[500,502,504].includes(t.status)&&!0===t.icebergType?.includes("CommitState")}isNotFound(){return 404===this.status}isConflict(){return 409===this.status}isAuthenticationTimeout(){return 419===this.status}};function Rd(e){return e.join("")}var Pd=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:Rd(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(e=>({namespace:e}))}async createNamespace(e,t){const r={namespace:e.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Rd(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Rd(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Rd(e.namespace)}`}),!0}catch(e){if(e instanceof Od&&404===e.status)return!1;throw e}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(e){if(e instanceof Od&&409===e.status)return;throw e}}};function Nd(e){return e.join("")}var Dd=class{constructor(e,t="",r){this.client=e,this.prefix=t,this.accessDelegation=r}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Nd(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Nd(e.namespace)}/tables`,body:t,headers:r})).data.metadata}async updateTable(e,t){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Nd(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Nd(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Nd(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Nd(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(e){if(e instanceof Od&&404===e.status)return!1;throw e}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(r){if(r instanceof Od&&409===r.status)return await this.loadTable({namespace:e.namespace,name:t.name});throw r}}},xd=class{constructor(e){let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const r=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=function(e){const t=e.fetchImpl??globalThis.fetch;return{async request({method:r,path:n,query:s,body:i,headers:o}){const a=function(e,t,r){const n=new URL(t,e);if(r)for(const[e,t]of Object.entries(r))void 0!==t&&n.searchParams.set(e,t);return n.toString()}(e.baseUrl,n,s),c=await async function(e){return e&&"none"!==e.type?"bearer"===e.type?{Authorization:`Bearer ${e.token}`}:"header"===e.type?{[e.name]:e.value}:"custom"===e.type?await e.getHeaders():{}:{}}(e.auth),l=await t(a,{method:r,headers:{...i?{"Content-Type":"application/json"}:{},...c,...o},body:i?JSON.stringify(i):void 0}),u=await l.text(),h=(l.headers.get("content-type")||"").includes("application/json"),d=h&&u?JSON.parse(u):u;if(!l.ok){const e=h?d:void 0,t=e?.error;throw new Od(t?.message??`Request failed with status ${l.status}`,{status:l.status,icebergType:t?.type,icebergCode:t?.code,details:e})}return{status:l.status,headers:l.headers,data:d}}}}({baseUrl:r,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=e.accessDelegation?.join(","),this.namespaceOps=new Pd(this.client,t),this.tableOps=new Dd(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},Ld=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function jd(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}var Ud=class extends Ld{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Md=class extends Ld{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};const $d=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),Vd=e=>{if(Array.isArray(e))return e.map(e=>Vd(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,r])=>{const n=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[n]=Vd(r)}),t};function Fd(e){return(Fd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bd(e,t,r){return(t=function(e){var t=function(e){if("object"!=Fd(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Fd(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Fd(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qd(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function zd(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?qd(Object(r),!0).forEach(function(t){Bd(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qd(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const Hd=e=>{var t;return e.msg||e.message||e.error_description||("string"==typeof e.error?e.error:null===(t=e.error)||void 0===t?void 0:t.message)||JSON.stringify(e)};async function Kd(e,t,r,n,s,i){return new Promise((o,a)=>{e(r,((e,t,r,n)=>{const s={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&n?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(n)?(s.headers=zd({"Content-Type":"application/json"},null==t?void 0:t.headers),s.body=JSON.stringify(n)):s.body=n,(null==t?void 0:t.duplex)&&(s.duplex=t.duplex),zd(zd({},s),r)):s})(t,n,s,i)).then(e=>{if(!e.ok)throw e;return(null==n?void 0:n.noResolveJson)?e:e.json()}).then(e=>o(e)).catch(e=>(async(e,t,r)=>{e instanceof await Response&&!(null==r?void 0:r.noResolveJson)?e.json().then(r=>{const n=e.status||500,s=(null==r?void 0:r.statusCode)||n+"";t(new Ud(Hd(r),n,s))}).catch(e=>{t(new Md(Hd(e),e))}):t(new Md(Hd(e),e))})(e,a,n))})}async function Wd(e,t,r,n){return Kd(e,"GET",t,r,n)}async function Gd(e,t,r,n,s){return Kd(e,"POST",t,n,s,r)}async function Jd(e,t,r,n,s){return Kd(e,"PUT",t,n,s,r)}async function Qd(e,t,r,n,s){return Kd(e,"DELETE",t,n,s,r)}var Yd=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){try{return{data:(await this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}};let Xd;Xd=Symbol.toStringTag;var Zd=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[Xd]="BlobDownloadBuilder",this.promise=null}asStream(){return new Yd(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){try{return{data:await(await this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}};const ef={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},tf={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var rf=class{constructor(e,t={},r,n){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=$d(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(e,t,r,n){var s=this;try{let i;const o=zd(zd({},tf),n);let a=zd(zd({},s.headers),"POST"===e&&{"x-upsert":String(o.upsert)});const c=o.metadata;"undefined"!=typeof Blob&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",s.encodeMetadata(c)),i.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(i=r,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),c&&!i.has("metadata")&&i.append("metadata",s.encodeMetadata(c))):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,c&&(a["x-metadata"]=s.toBase64(s.encodeMetadata(c))),("undefined"!=typeof ReadableStream&&i instanceof ReadableStream||i&&"object"==typeof i&&"pipe"in i&&"function"==typeof i.pipe)&&!o.duplex&&(o.duplex="half")),(null==n?void 0:n.headers)&&(a=zd(zd({},a),n.headers));const l=s._removeEmptyFolders(t),u=s._getFinalPath(l),h=await("PUT"==e?Jd:Gd)(s.fetch,`${s.url}/object/${u}`,i,zd({headers:a},(null==o?void 0:o.duplex)?{duplex:o.duplex}:{}));return{data:{path:l,id:h.Id,fullPath:h.Key},error:null}}catch(e){if(s.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}async upload(e,t,r){return this.uploadOrUpdate("POST",e,t,r)}async uploadToSignedUrl(e,t,r,n){var s=this;const i=s._removeEmptyFolders(e),o=s._getFinalPath(i),a=new URL(s.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let e;const t=zd({upsert:tf.upsert},n),o=zd(zd({},s.headers),{"x-upsert":String(t.upsert)});return"undefined"!=typeof Blob&&r instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r,e.append("cacheControl",t.cacheControl)):(e=r,o["cache-control"]=`max-age=${t.cacheControl}`,o["content-type"]=t.contentType),{data:{path:i,fullPath:(await Jd(s.fetch,a.toString(),e,{headers:o})).Key},error:null}}catch(e){if(s.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}async createSignedUploadUrl(e,t){var r=this;try{let n=r._getFinalPath(e);const s=zd({},r.headers);(null==t?void 0:t.upsert)&&(s["x-upsert"]="true");const i=await Gd(r.fetch,`${r.url}/object/upload/sign/${n}`,{},{headers:s}),o=new URL(r.url+i.url),a=o.searchParams.get("token");if(!a)throw new Ld("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}async update(e,t,r){return this.uploadOrUpdate("PUT",e,t,r)}async move(e,t,r){var n=this;try{return{data:await Gd(n.fetch,`${n.url}/object/move`,{bucketId:n.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:n.headers}),error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}async copy(e,t,r){var n=this;try{return{data:{path:(await Gd(n.fetch,`${n.url}/object/copy`,{bucketId:n.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:n.headers})).Key},error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}async createSignedUrl(e,t,r){var n=this;try{let s=n._getFinalPath(e),i=await Gd(n.fetch,`${n.url}/object/sign/${s}`,zd({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:n.headers});const o=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return i={signedUrl:encodeURI(`${n.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}async createSignedUrls(e,t,r){var n=this;try{const s=await Gd(n.fetch,`${n.url}/object/sign/${n.bucketId}`,{expiresIn:t,paths:e},{headers:n.headers}),i=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:s.map(e=>zd(zd({},e),{},{signedUrl:e.signedURL?encodeURI(`${n.url}${e.signedURL}${i}`):null})),error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}download(e,t){const r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",n=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),s=n?`?${n}`:"",i=this._getFinalPath(e);return new Zd(()=>Wd(this.fetch,`${this.url}/${r}/${i}${s}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}async info(e){var t=this;const r=t._getFinalPath(e);try{return{data:Vd(await Wd(t.fetch,`${t.url}/object/info/${r}`,{headers:t.headers})),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}async exists(e){var t=this;const r=t._getFinalPath(e);try{return await async function(e,t,r){return Kd(e,"HEAD",t,zd(zd({},r),{},{noResolveJson:!0}),void 0)}(t.fetch,`${t.url}/object/${r}`,{headers:t.headers}),{data:!0,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(jd(e)&&e instanceof Md){const t=e.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:e}}throw e}}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],s=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==s&&n.push(s);const i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==o&&n.push(o);let a=n.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${r}${a}`)}}}async remove(e){var t=this;try{return{data:await Qd(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:e},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}async list(e,t,r){var n=this;try{const s=zd(zd(zd({},ef),t),{},{prefix:e||""});return{data:await Gd(n.fetch,`${n.url}/object/list/${n.bucketId}`,s,{headers:n.headers},r),error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}async listV2(e,t){var r=this;try{const n=zd({},e);return{data:await Gd(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,n,{headers:r.headers},t),error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};const nf="2.89.0",sf={"X-Client-Info":`storage-js/${nf}`};var of=class{constructor(e,t={},r,n){this.shouldThrowOnError=!1;const s=new URL(e);(null==n?void 0:n.useNewHostname)&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href.replace(/\/$/,""),this.headers=zd(zd({},sf),t),this.fetch=$d(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(e){var t=this;try{const r=t.listBucketOptionsToQueryString(e);return{data:await Wd(t.fetch,`${t.url}/bucket${r}`,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}async getBucket(e){var t=this;try{return{data:await Wd(t.fetch,`${t.url}/bucket/${e}`,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}async createBucket(e,t={public:!1}){var r=this;try{return{data:await Gd(r.fetch,`${r.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}),error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}async updateBucket(e,t){var r=this;try{return{data:await Jd(r.fetch,`${r.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}),error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}async emptyBucket(e){var t=this;try{return{data:await Gd(t.fetch,`${t.url}/bucket/${e}/empty`,{},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}async deleteBucket(e){var t=this;try{return{data:await Qd(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},af=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=zd(zd({},sf),t),this.fetch=$d(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await Gd(t.fetch,`${t.url}/bucket`,{name:e},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}async listBuckets(e){var t=this;try{const r=new URLSearchParams;void 0!==(null==e?void 0:e.limit)&&r.set("limit",e.limit.toString()),void 0!==(null==e?void 0:e.offset)&&r.set("offset",e.offset.toString()),(null==e?void 0:e.sortColumn)&&r.set("sortColumn",e.sortColumn),(null==e?void 0:e.sortOrder)&&r.set("sortOrder",e.sortOrder),(null==e?void 0:e.search)&&r.set("search",e.search);const n=r.toString(),s=n?`${t.url}/bucket?${n}`:`${t.url}/bucket`;return{data:await Wd(t.fetch,s,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}async deleteBucket(e){var t=this;try{return{data:await Qd(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(jd(e))return{data:null,error:e};throw e}}from(e){var t=this;if(!(e=>!(!e||"string"!=typeof e)&&!(0===e.length||e.length>100)&&e.trim()===e&&!e.includes("/")&&!e.includes("\\")&&/^[\w!.\*'() &$@=;:+,?-]+$/.test(e))(e))throw new Ld("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new xd({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(r,{get(e,t){const r=e[t];return"function"!=typeof r?r:async(...t)=>{try{return{data:await r.apply(e,t),error:null}}catch(e){if(n)throw e;return{data:null,error:e}}}}})}};const cf={"X-Client-Info":`storage-js/${nf}`,"Content-Type":"application/json"};var lf=class extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function uf(e){return"object"==typeof e&&null!==e&&"__isStorageVectorsError"in e}var hf=class extends lf{constructor(e,t,r){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},df=class extends lf{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}};const ff=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),pf=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e);async function gf(e,t,r,n,s,i){return new Promise((o,a)=>{e(r,((e,t,r,n)=>{const s={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&n?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(n)?(s.headers=zd({"Content-Type":"application/json"},null==t?void 0:t.headers),s.body=JSON.stringify(n)):s.body=n,zd(zd({},s),r)):s})(t,n,s,i)).then(e=>{if(!e.ok)throw e;if(null==n?void 0:n.noResolveJson)return e;const t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():{}}).then(e=>o(e)).catch(e=>(async(e,t,r)=>{if(e&&"object"==typeof e&&"status"in e&&"ok"in e&&"number"==typeof e.status&&!(null==r?void 0:r.noResolveJson)){const r=e.status||500,n=e;if("function"==typeof n.json)n.json().then(e=>{const n=(null==e?void 0:e.statusCode)||(null==e?void 0:e.code)||r+"";t(new hf(pf(e),r,n))}).catch(()=>{const e=r+"";t(new hf(n.statusText||`HTTP ${r} error`,r,e))});else{const e=r+"";t(new hf(n.statusText||`HTTP ${r} error`,r,e))}}else t(new df(pf(e),e))})(e,a,n))})}async function mf(e,t,r,n,s){return gf(e,"POST",t,n,s,r)}var yf=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=zd(zd({},cf),t),this.fetch=ff(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(e){var t=this;try{return{data:await mf(t.fetch,`${t.url}/CreateIndex`,e,{headers:t.headers})||{},error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(uf(e))return{data:null,error:e};throw e}}async getIndex(e,t){var r=this;try{return{data:await mf(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers}),error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(uf(e))return{data:null,error:e};throw e}}async listIndexes(e){var t=this;try{return{data:await mf(t.fetch,`${t.url}/ListIndexes`,e,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(uf(e))return{data:null,error:e};throw e}}async deleteIndex(e,t){var r=this;try{return{data:await mf(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers})||{},error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(uf(e))return{data:null,error:e};throw e}}},vf=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=zd(zd({},cf),t),this.fetch=ff(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(e){var t=this;try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await mf(t.fetch,`${t.url}/PutVectors`,e,{headers:t.headers})||{},error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(uf(e))return{data:null,error:e};throw e}}async getVectors(e){var t=this;try{return{data:await mf(t.fetch,`${t.url}/GetVectors`,e,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(uf(e))return{data:null,error:e};throw e}}async listVectors(e){var t=this;try{if(void 0!==e.segmentCount){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(void 0!==e.segmentIndex&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error("segmentIndex must be between 0 and "+(e.segmentCount-1))}return{data:await mf(t.fetch,`${t.url}/ListVectors`,e,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(uf(e))return{data:null,error:e};throw e}}async queryVectors(e){var t=this;try{return{data:await mf(t.fetch,`${t.url}/QueryVectors`,e,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(uf(e))return{data:null,error:e};throw e}}async deleteVectors(e){var t=this;try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await mf(t.fetch,`${t.url}/DeleteVectors`,e,{headers:t.headers})||{},error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(uf(e))return{data:null,error:e};throw e}}},wf=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=zd(zd({},cf),t),this.fetch=ff(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await mf(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(uf(e))return{data:null,error:e};throw e}}async getBucket(e){var t=this;try{return{data:await mf(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:e},{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(uf(e))return{data:null,error:e};throw e}}async listBuckets(e={}){var t=this;try{return{data:await mf(t.fetch,`${t.url}/ListVectorBuckets`,e,{headers:t.headers}),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(uf(e))return{data:null,error:e};throw e}}async deleteBucket(e){var t=this;try{return{data:await mf(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(uf(e))return{data:null,error:e};throw e}}},_f=class extends wf{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new bf(this.url,this.headers,e,this.fetch)}async createBucket(e){return(()=>super.createBucket)().call(this,e)}async getBucket(e){return(()=>super.getBucket)().call(this,e)}async listBuckets(e={}){return(()=>super.listBuckets)().call(this,e)}async deleteBucket(e){return(()=>super.deleteBucket)().call(this,e)}},bf=class extends yf{constructor(e,t,r,n){super(e,t,n),this.vectorBucketName=r}async createIndex(e){return(()=>super.createIndex)().call(this,zd(zd({},e),{},{vectorBucketName:this.vectorBucketName}))}async listIndexes(e={}){return(()=>super.listIndexes)().call(this,zd(zd({},e),{},{vectorBucketName:this.vectorBucketName}))}async getIndex(e){return(()=>super.getIndex)().call(this,this.vectorBucketName,e)}async deleteIndex(e){return(()=>super.deleteIndex)().call(this,this.vectorBucketName,e)}index(e){return new Ef(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},Ef=class extends vf{constructor(e,t,r,n,s){super(e,t,s),this.vectorBucketName=r,this.indexName=n}async putVectors(e){var t=this;return(()=>super.putVectors)().call(t,zd(zd({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async getVectors(e){var t=this;return(()=>super.getVectors)().call(t,zd(zd({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async listVectors(e={}){var t=this;return(()=>super.listVectors)().call(t,zd(zd({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async queryVectors(e){var t=this;return(()=>super.queryVectors)().call(t,zd(zd({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async deleteVectors(e){var t=this;return(()=>super.deleteVectors)().call(t,zd(zd({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}},Tf=class extends of{constructor(e,t={},r,n){super(e,t,r,n)}from(e){return new rf(this.url,this.headers,e,this.fetch)}get vectors(){return new _f(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new af(this.url+"/iceberg",this.headers,this.fetch)}};const Sf="2.89.0",If=3e4,kf={"X-Client-Info":`gotrue-js/${Sf}`},Cf="X-Supabase-Api-Version",Af=Date.parse("2024-01-01T00:00:00.0Z"),Of="2024-01-01",Rf=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class Pf extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function Nf(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Df extends Pf{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}class xf extends Pf{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Lf extends Pf{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class jf extends Lf{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Uf extends Lf{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Mf extends Lf{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class $f extends Lf{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Vf extends Lf{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ff extends Lf{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Bf extends Lf{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function qf(e){return Nf(e)&&"AuthRetryableFetchError"===e.name}class zf extends Lf{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Hf extends Lf{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Kf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Wf=" \t\n\r=".split(""),Gf=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Wf.length;t+=1)e[Wf[t].charCodeAt(0)]=-2;for(let t=0;t<Kf.length;t+=1)e[Kf[t].charCodeAt(0)]=t;return e})();function Jf(e,t,r){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(Kf[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(Kf[e]),t.queuedBits-=6}}function Qf(e,t,r){const n=Gf[e];if(!(n>-1)){if(-2===n)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function Yf(e){const t=[],r=e=>{t.push(String.fromCodePoint(e))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=e=>{!function(e,t,r){if(0===t.utf8seq){if(e<=127)return void r(e);for(let r=1;r<6;r+=1)if(!(e>>7-r&1)){t.utf8seq=r;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&r(t.codepoint)}}(e,n,r)};for(let t=0;t<e.length;t+=1)Qf(e.charCodeAt(t),s,i);return t.join("")}function Xf(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function Zf(e){const t=[],r={queue:0,queuedBits:0},n=e=>{t.push(e)};for(let t=0;t<e.length;t+=1)Qf(e.charCodeAt(t),r,n);return new Uint8Array(t)}function ep(e){const t=[],r={queue:0,queuedBits:0},n=e=>{t.push(e)};return e.forEach(e=>Jf(e,r,n)),Jf(null,r,n),t.join("")}const tp=()=>"undefined"!=typeof window&&"undefined"!=typeof document,rp={tested:!1,writable:!1},np=()=>{if(!tp())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(rp.tested)return rp.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),rp.tested=!0,rp.writable=!0}catch(e){rp.tested=!0,rp.writable=!1}return rp.writable},sp=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),ip=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},op=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(e){return r}},ap=async(e,t)=>{await e.removeItem(t)};class cp{constructor(){this.promise=new cp.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function lp(e){const t=e.split(".");if(3!==t.length)throw new Hf("Invalid JWT structure");for(let e=0;e<t.length;e++)if(!Rf.test(t[e]))throw new Hf("JWT not in base64url format");return{header:JSON.parse(Yf(t[0])),payload:JSON.parse(Yf(t[1])),signature:Zf(t[2]),raw:{header:t[0],payload:t[1]}}}function up(e){return("0"+e.toString(16)).substr(-2)}async function hp(e,t,r=!1){const n=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let r="";for(let n=0;n<56;n++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,up).join("")}();let s=n;r&&(s+="/PASSWORD_RECOVERY"),await ip(e,`${t}-code-verifier`,s);const i=await async function(e){if("undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder)return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(n);return[i,n===i?"plain":"s256"]}cp.promiseConstructor=Promise;const dp=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,fp=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function pp(e){if(!fp.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function gp(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function mp(e){return JSON.parse(JSON.stringify(e))}const yp=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),vp=[502,503,504];async function wp(e){var t,r;if(!("object"==typeof(r=e)&&null!==r&&"status"in r&&"ok"in r&&"json"in r&&"function"==typeof r.json))throw new Bf(yp(e),0);if(vp.includes(e.status))throw new Bf(yp(e),e.status);let n,s;try{n=await e.json()}catch(e){throw new xf(yp(e),e)}const i=function(e){const t=e.headers.get(Cf);if(!t)return null;if(!t.match(dp))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(e){return null}}(e);if(i&&i.getTime()>=Af&&"object"==typeof n&&n&&"string"==typeof n.code?s=n.code:"object"==typeof n&&n&&"string"==typeof n.error_code&&(s=n.error_code),s){if("weak_password"===s)throw new zf(yp(n),e.status,(null===(t=n.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===s)throw new jf}else if("object"==typeof n&&n&&"object"==typeof n.weak_password&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new zf(yp(n),e.status,n.weak_password.reasons);throw new Df(yp(n),e.status||500,s)}async function _p(e,t,r,n){var s;const i=Object.assign({},null==n?void 0:n.headers);i[Cf]||(i[Cf]=Of),(null==n?void 0:n.jwt)&&(i.Authorization=`Bearer ${n.jwt}`);const o=null!==(s=null==n?void 0:n.query)&&void 0!==s?s:{};(null==n?void 0:n.redirectTo)&&(o.redirect_to=n.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await async function(e,t,r,n,s,i){const o=((e,t,r,n)=>{const s={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))})(t,n,{},i);let a;try{a=await e(r,Object.assign({},o))}catch(e){throw console.error(e),new Bf(yp(e),0)}if(a.ok||await wp(a),null==n?void 0:n.noResolveJson)return a;try{return await a.json()}catch(e){await wp(e)}}(e,t,r+a,{headers:i,noResolveJson:null==n?void 0:n.noResolveJson},0,null==n?void 0:n.body);return(null==n?void 0:n.xform)?null==n?void 0:n.xform(c):{data:Object.assign({},c),error:null}}function bp(e){var t;let r=null;var n;return function(e){return e.access_token&&e.refresh_token&&e.expires_in}(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=(n=e.expires_in,Math.round(Date.now()/1e3)+n))),{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Ep(e){const t=bp(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function Tp(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Sp(e){return{data:e,error:null}}function Ip(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:i}=e,o=rt(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:i},user:Object.assign({},o)},error:null}}function kp(e){return e}const Cp=["global","local","others"];class Ap{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=sp(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Cp[0]){if(Cp.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Cp.join(", ")}`);try{return await _p(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(e){if(Nf(e))return{data:null,error:e};throw e}}async inviteUserByEmail(e,t={}){try{return await _p(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Tp})}catch(e){if(Nf(e))return{data:{user:null},error:e};throw e}}async generateLink(e){try{const{options:t}=e,r=rt(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=null==r?void 0:r.newEmail,delete n.newEmail),await _p(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Ip,redirectTo:null==t?void 0:t.redirectTo})}catch(e){if(Nf(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(e){try{return await _p(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Tp})}catch(e){if(Nf(e))return{data:{user:null},error:e};throw e}}async listUsers(e){var t,r,n,s,i,o,a;try{const c={nextPage:null,lastPage:0,total:0},l=await _p(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(s=null===(n=null==e?void 0:e.perPage)||void 0===n?void 0:n.toString())&&void 0!==s?s:""},xform:kp});if(l.error)throw l.error;const u=await l.json(),h=null!==(i=l.headers.get("x-total-count"))&&void 0!==i?i:0,d=null!==(a=null===(o=l.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);c[`${r}Page`]=t}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(e){if(Nf(e))return{data:{users:[]},error:e};throw e}}async getUserById(e){pp(e);try{return await _p(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Tp})}catch(e){if(Nf(e))return{data:{user:null},error:e};throw e}}async updateUserById(e,t){pp(e);try{return await _p(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Tp})}catch(e){if(Nf(e))return{data:{user:null},error:e};throw e}}async deleteUser(e,t=!1){pp(e);try{return await _p(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Tp})}catch(e){if(Nf(e))return{data:{user:null},error:e};throw e}}async _listFactors(e){pp(e.userId);try{const{data:t,error:r}=await _p(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(e){if(Nf(e))return{data:null,error:e};throw e}}async _deleteFactor(e){pp(e.userId),pp(e.id);try{return{data:await _p(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(e){if(Nf(e))return{data:null,error:e};throw e}}async _listOAuthClients(e){var t,r,n,s,i,o,a;try{const c={nextPage:null,lastPage:0,total:0},l=await _p(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(s=null===(n=null==e?void 0:e.perPage)||void 0===n?void 0:n.toString())&&void 0!==s?s:""},xform:kp});if(l.error)throw l.error;const u=await l.json(),h=null!==(i=l.headers.get("x-total-count"))&&void 0!==i?i:0,d=null!==(a=null===(o=l.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);c[`${r}Page`]=t}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(e){if(Nf(e))return{data:{clients:[]},error:e};throw e}}async _createOAuthClient(e){try{return await _p(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(Nf(e))return{data:null,error:e};throw e}}async _getOAuthClient(e){try{return await _p(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(Nf(e))return{data:null,error:e};throw e}}async _updateOAuthClient(e,t){try{return await _p(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(Nf(e))return{data:null,error:e};throw e}}async _deleteOAuthClient(e){try{return await _p(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(Nf(e))return{data:null,error:e};throw e}}async _regenerateOAuthClientSecret(e){try{return await _p(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(Nf(e))return{data:null,error:e};throw e}}}function Op(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const Rp=!!(globalThis&&np()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Pp extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Np extends Pp{}async function Dp(e,t,r){Rp&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),Rp&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async n=>{if(!n){if(0===t)throw Rp&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Np(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Rp)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(e){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",e)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}Rp&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,n.name);try{return await r()}finally{Rp&&console.log("@supabase/gotrue-js: navigatorLock: released",e,n.name)}}))}function xp(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function Lp(e){const t=(new TextEncoder).encode(e);return"0x"+Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}class jp extends Error{constructor({message:e,code:t,cause:r,name:n}){var s;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=null!==(s=null!=n?n:r instanceof Error?r.name:void 0)&&void 0!==s?s:"Unknown Error",this.code=t}}class Up extends jp{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Mp({error:e,options:t}){var r,n,s;const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new jp({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("ConstraintError"===e.name){if(!0===(null===(r=i.authenticatorSelection)||void 0===r?void 0:r.requireResidentKey))return new jp({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if("conditional"===t.mediation&&"required"===(null===(n=i.authenticatorSelection)||void 0===n?void 0:n.userVerification))return new jp({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if("required"===(null===(s=i.authenticatorSelection)||void 0===s?void 0:s.userVerification))return new jp({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if("InvalidStateError"===e.name)return new jp({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if("NotAllowedError"===e.name)return new jp({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("NotSupportedError"===e.name)return 0===i.pubKeyCredParams.filter(e=>"public-key"===e.type).length?new jp({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new jp({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if("SecurityError"===e.name){const t=window.location.hostname;if(!Hp(t))return new jp({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(i.rp.id!==t)return new jp({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("TypeError"===e.name){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new jp({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if("UnknownError"===e.name)return new jp({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new jp({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function $p({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new jp({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if("NotAllowedError"===e.name)return new jp({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("SecurityError"===e.name){const t=window.location.hostname;if(!Hp(t))return new jp({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(r.rpId!==t)return new jp({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("UnknownError"===e.name)return new jp({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new jp({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}const Vp=new class{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};function Fp(e){if(!e)throw new Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:n}=e,s=rt(e,["challenge","user","excludeCredentials"]),i=Zf(t).buffer,o=Object.assign(Object.assign({},r),{id:Zf(r.id).buffer}),a=Object.assign(Object.assign({},s),{challenge:i,user:o});if(n&&n.length>0){a.excludeCredentials=new Array(n.length);for(let e=0;e<n.length;e++){const t=n[e];a.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:Zf(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return a}function Bp(e){if(!e)throw new Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,n=rt(e,["challenge","allowCredentials"]),s=Zf(t).buffer,i=Object.assign(Object.assign({},n),{challenge:s});if(r&&r.length>0){i.allowCredentials=new Array(r.length);for(let e=0;e<r.length;e++){const t=r[e];i.allowCredentials[e]=Object.assign(Object.assign({},t),{id:Zf(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return i}function qp(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:ep(new Uint8Array(e.response.attestationObject)),clientDataJSON:ep(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:null!==(t=r.authenticatorAttachment)&&void 0!==t?t:void 0}}function zp(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const r=e,n=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:ep(new Uint8Array(s.authenticatorData)),clientDataJSON:ep(new Uint8Array(s.clientDataJSON)),signature:ep(new Uint8Array(s.signature)),userHandle:s.userHandle?ep(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:null!==(t=r.authenticatorAttachment)&&void 0!==t?t:void 0}}function Hp(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function Kp(){var e,t;return!!(tp()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.create)&&"function"==typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.get))}const Wp={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},Gp={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Jp(...e){const t=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),r=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),n={};for(const s of e)if(s)for(const e in s){const i=s[e];if(void 0!==i)if(Array.isArray(i))n[e]=i;else if(r(i))n[e]=i;else if(t(i)){const r=n[e];t(r)?n[e]=Jp(r,i):n[e]=Jp(i)}else n[e]=i}return n}class Qp{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:r,signal:n},s){try{const{data:i,error:o}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!i)return{data:null,error:o};const a=null!=n?n:Vp.createNewAbortSignal();if("create"===i.webauthn.type){const{user:e}=i.webauthn.credential_options.publicKey;e.name||(e.name=`${e.id}:${r}`),e.displayName||(e.displayName=e.name)}switch(i.webauthn.type){case"create":{const t=function(e,t){return Jp(Wp,e,t||{})}(i.webauthn.credential_options.publicKey,null==s?void 0:s.create),{data:r,error:n}=await async function(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Up("Browser returned unexpected credential type",t)}:{data:null,error:new Up("Empty credential response",t)}}catch(t){return{data:null,error:Mp({error:t,options:e})}}}({publicKey:t,signal:a});return r?{data:{factorId:e,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:r}},error:null}:{data:null,error:n}}case"request":{const t=function(e,t){return Jp(Gp,e,t||{})}(i.webauthn.credential_options.publicKey,null==s?void 0:s.request),{data:r,error:n}=await async function(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Up("Browser returned unexpected credential type",t)}:{data:null,error:new Up("Empty credential response",t)}}catch(t){return{data:null,error:$p({error:t,options:e})}}}(Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:t,signal:a}));return r?{data:{factorId:e,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:r}},error:null}:{data:null,error:n}}}}catch(e){return Nf(e)?{data:null,error:e}:{data:null,error:new xf("Unexpected error in challenge",e)}}}async _verify({challengeId:e,factorId:t,webauthn:r}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:r=("undefined"!=typeof window?[window.location.origin]:void 0),signal:n}={}},s){if(!t)return{data:null,error:new Pf("rpId is required for WebAuthn authentication")};try{if(!Kp())return{data:null,error:new xf("Browser does not support WebAuthn",null)};const{data:i,error:o}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:r},signal:n},{request:s});if(!i)return{data:null,error:o};const{webauthn:a}=i;return this._verify({factorId:e,challengeId:i.challengeId,webauthn:{type:a.type,rpId:t,rpOrigins:r,credential_response:a.credential_response}})}catch(e){return Nf(e)?{data:null,error:e}:{data:null,error:new xf("Unexpected error in authenticate",e)}}}async _register({friendlyName:e,webauthn:{rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:r=("undefined"!=typeof window?[window.location.origin]:void 0),signal:n}={}},s){if(!t)return{data:null,error:new Pf("rpId is required for WebAuthn registration")};try{if(!Kp())return{data:null,error:new xf("Browser does not support WebAuthn",null)};const{data:i,error:o}=await this._enroll({friendlyName:e});if(!i)return await this.client.mfa.listFactors().then(t=>{var r;return null===(r=t.data)||void 0===r?void 0:r.all.find(t=>"webauthn"===t.factor_type&&t.friendly_name===e&&"unverified"!==t.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null==e?void 0:e.id}):void 0),{data:null,error:o};const{data:a,error:c}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:t,rpOrigins:r},signal:n},{create:s});return a?this._verify({factorId:i.id,challengeId:a.challengeId,webauthn:{rpId:t,rpOrigins:r,type:a.webauthn.type,credential_response:a.webauthn.credential_response}}):{data:null,error:c}}catch(e){return Nf(e)?{data:null,error:e}:{data:null,error:new xf("Unexpected error in register",e)}}}}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const Yp={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:kf,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function Xp(e,t,r){return await r()}const Zp={};class eg{get jwks(){var e,t;return null!==(t=null===(e=Zp[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){Zp[this.storageKey]=Object.assign(Object.assign({},Zp[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=Zp[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Zp[this.storageKey]=Object.assign(Object.assign({},Zp[this.storageKey]),{cachedAt:e})}constructor(e){var t,r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const s=Object.assign(Object.assign({},Yp),e);if(this.storageKey=s.storageKey,this.instanceID=null!==(t=eg.nextInstanceID[this.storageKey])&&void 0!==t?t:0,eg.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.instanceID>0&&tp()){const e=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(e),this.logDebugMessages&&console.trace(e)}if(this.persistSession=s.persistSession,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Ap({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=sp(s.fetch),this.lock=s.lock||Xp,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,this.throwOnError=s.throwOnError,s.lock?this.lock=s.lock:this.persistSession&&tp()&&(null===(r=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===r?void 0:r.locks)?this.lock=Dp:this.lock=Xp,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Qp(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:np()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Op(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=Op(this.memoryStorage)),tp()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(e){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",e)}null===(n=this.broadcastChannel)||void 0===n||n.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Sf}) ${(new Date).toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t={},r="none";if(tp()&&(t=function(e){const t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((e,r)=>{t[r]=e})}catch(e){}return r.searchParams.forEach((e,r)=>{t[r]=e}),t}(window.location.href),this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce")),tp()&&this.detectSessionInUrl&&"none"!==r){const{data:n,error:s}=await this._getSessionFromURL(t,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),function(e){return Nf(e)&&"AuthImplicitGrantRedirectError"===e.name}(s)){const t=null===(e=s.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:s}}return await this._removeSession(),{error:s}}const{session:i,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",i,"redirect type",o),await this._saveSession(i),setTimeout(async()=>{"recovery"===o?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return Nf(e)?this._returnResult({error:e}):this._returnResult({error:new xf("Unexpected error during initialization",e)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,n;try{const s=await _p(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(r=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==r?r:{},gotrue_meta_security:{captcha_token:null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.captchaToken}},xform:bp}),{data:i,error:o}=s;if(o||!i)return this._returnResult({data:{user:null,session:null},error:o});const a=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),this._returnResult({data:{user:c,session:a},error:null})}catch(e){if(Nf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signUp(e){var t,r,n;try{let s;if("email"in e){const{email:r,password:n,options:i}=e;let o=null,a=null;"pkce"===this.flowType&&([o,a]=await hp(this.storage,this.storageKey)),s=await _p(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:r,password:n,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:o,code_challenge_method:a},xform:bp})}else{if(!("phone"in e))throw new Mf("You must provide either an email or phone number and a password");{const{phone:t,password:i,options:o}=e;s=await _p(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!==(r=null==o?void 0:o.data)&&void 0!==r?r:{},channel:null!==(n=null==o?void 0:o.channel)&&void 0!==n?n:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:bp})}}const{data:i,error:o}=s;if(o||!i)return await ap(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:o});const a=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),this._returnResult({data:{user:c,session:a},error:null})}catch(e){if(await ap(this.storage,`${this.storageKey}-code-verifier`),Nf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:n,options:s}=e;t=await _p(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},xform:Ep})}else{if(!("phone"in e))throw new Mf("You must provide either an email or phone number and a password");{const{phone:r,password:n,options:s}=e;t=await _p(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},xform:Ep})}}const{data:r,error:n}=t;if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!r||!r.session||!r.user){const e=new Uf;return this._returnResult({data:{user:null,session:null},error:e})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(e){if(Nf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOAuth(e){var t,r,n,s;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:null===(s=e.options)||void 0===s?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,r,n,s,i,o,a,c,l,u,h;let d,f;if("message"in e)d=e.message,f=e.signature;else{const{chain:u,wallet:h,statement:p,options:g}=e;let m;if(tp())if("object"==typeof h)m=h;else{const e=window;if(!("ethereum"in e)||"object"!=typeof e.ethereum||!("request"in e.ethereum)||"function"!=typeof e.ethereum.request)throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.");m=e.ethereum}else{if("object"!=typeof h||!(null==g?void 0:g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");m=h}const y=new URL(null!==(t=null==g?void 0:g.url)&&void 0!==t?t:window.location.href),v=await m.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!v||0===v.length)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const w=xp(v[0]);let _=null===(r=null==g?void 0:g.signInWithEthereum)||void 0===r?void 0:r.chainId;if(!_){const e=await m.request({method:"eth_chainId"});_=parseInt(e,16)}d=function(e){var t;const{chainId:r,domain:n,expirationTime:s,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:c,resources:l,scheme:u,uri:h,version:d}=e;if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==d)throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${d}`);if(null===(t=e.statement)||void 0===t?void 0:t.includes("\n"))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`);const f=`${u?`${u}://${n}`:n} wants you to sign in with your Ethereum account:\n${xp(e.address)}\n\n${e.statement?`${e.statement}\n`:""}`;let p=`URI: ${h}\nVersion: ${d}\nChain ID: ${r}${o?`\nNonce: ${o}`:""}\nIssued At: ${i.toISOString()}`;if(s&&(p+=`\nExpiration Time: ${s.toISOString()}`),a&&(p+=`\nNot Before: ${a.toISOString()}`),c&&(p+=`\nRequest ID: ${c}`),l){let e="\nResources:";for(const t of l){if(!t||"string"!=typeof t)throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${t}`);e+=`\n- ${t}`}p+=e}return`${f}\n${p}`}({domain:y.host,address:w,statement:p,uri:y.href,version:"1",chainId:_,nonce:null===(n=null==g?void 0:g.signInWithEthereum)||void 0===n?void 0:n.nonce,issuedAt:null!==(i=null===(s=null==g?void 0:g.signInWithEthereum)||void 0===s?void 0:s.issuedAt)&&void 0!==i?i:new Date,expirationTime:null===(o=null==g?void 0:g.signInWithEthereum)||void 0===o?void 0:o.expirationTime,notBefore:null===(a=null==g?void 0:g.signInWithEthereum)||void 0===a?void 0:a.notBefore,requestId:null===(c=null==g?void 0:g.signInWithEthereum)||void 0===c?void 0:c.requestId,resources:null===(l=null==g?void 0:g.signInWithEthereum)||void 0===l?void 0:l.resources}),f=await m.request({method:"personal_sign",params:[Lp(d),w]})}try{const{data:t,error:r}=await _p(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:d,signature:f},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:bp});if(r)throw r;if(!t||!t.session||!t.user){const e=new Uf;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:r})}catch(e){if(Nf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithSolana(e){var t,r,n,s,i,o,a,c,l,u,h,d;let f,p;if("message"in e)f=e.message,p=e.signature;else{const{chain:h,wallet:d,statement:g,options:m}=e;let y;if(tp())if("object"==typeof d)y=d;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");y=e.solana}else{if("object"!=typeof d||!(null==m?void 0:m.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=d}const v=new URL(null!==(t=null==m?void 0:m.url)&&void 0!==t?t:window.location.href);if("signIn"in y&&y.signIn){const e=await y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==m?void 0:m.signInWithSolana),{version:"1",domain:v.host,uri:v.href}),g?{statement:g}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");f="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in y&&"function"==typeof y.signMessage&&"publicKey"in y&&"object"==typeof y&&y.publicKey&&"toBase58"in y.publicKey&&"function"==typeof y.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${v.host} wants you to sign in with your Solana account:`,y.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${v.href}`,`Issued At: ${null!==(n=null===(r=null==m?void 0:m.signInWithSolana)||void 0===r?void 0:r.issuedAt)&&void 0!==n?n:(new Date).toISOString()}`,...(null===(s=null==m?void 0:m.signInWithSolana)||void 0===s?void 0:s.notBefore)?[`Not Before: ${m.signInWithSolana.notBefore}`]:[],...(null===(i=null==m?void 0:m.signInWithSolana)||void 0===i?void 0:i.expirationTime)?[`Expiration Time: ${m.signInWithSolana.expirationTime}`]:[],...(null===(o=null==m?void 0:m.signInWithSolana)||void 0===o?void 0:o.chainId)?[`Chain ID: ${m.signInWithSolana.chainId}`]:[],...(null===(a=null==m?void 0:m.signInWithSolana)||void 0===a?void 0:a.nonce)?[`Nonce: ${m.signInWithSolana.nonce}`]:[],...(null===(c=null==m?void 0:m.signInWithSolana)||void 0===c?void 0:c.requestId)?[`Request ID: ${m.signInWithSolana.requestId}`]:[],...(null===(u=null===(l=null==m?void 0:m.signInWithSolana)||void 0===l?void 0:l.resources)||void 0===u?void 0:u.length)?["Resources",...m.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=await y.signMessage((new TextEncoder).encode(f),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:r}=await _p(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:ep(p)},(null===(h=e.options)||void 0===h?void 0:h.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=e.options)||void 0===d?void 0:d.captchaToken}}:null),xform:bp});if(r)throw r;if(!t||!t.session||!t.user){const e=new Uf;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:r})}catch(e){if(Nf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _exchangeCodeForSession(e){const t=await op(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(null!=t?t:"").split("/");try{if(!r&&"pkce"===this.flowType)throw new Ff;const{data:t,error:s}=await _p(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:bp});if(await ap(this.storage,`${this.storageKey}-code-verifier`),s)throw s;if(!t||!t.session||!t.user){const e=new Uf;return this._returnResult({data:{user:null,session:null,redirectType:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign(Object.assign({},t),{redirectType:null!=n?n:null}),error:s})}catch(e){if(await ap(this.storage,`${this.storageKey}-code-verifier`),Nf(e))return this._returnResult({data:{user:null,session:null,redirectType:null},error:e});throw e}}async signInWithIdToken(e){try{const{options:t,provider:r,token:n,access_token:s,nonce:i}=e,o=await _p(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:s,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:bp}),{data:a,error:c}=o;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!a||!a.session||!a.user){const e=new Uf;return this._returnResult({data:{user:null,session:null},error:e})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:a,error:c})}catch(e){if(Nf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOtp(e){var t,r,n,s,i;try{if("email"in e){const{email:n,options:s}=e;let i=null,o=null;"pkce"===this.flowType&&([i,o]=await hp(this.storage,this.storageKey));const{error:a}=await _p(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:n,data:null!==(t=null==s?void 0:s.data)&&void 0!==t?t:{},create_user:null===(r=null==s?void 0:s.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},code_challenge:i,code_challenge_method:o},redirectTo:null==s?void 0:s.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:a})}if("phone"in e){const{phone:t,options:r}=e,{data:o,error:a}=await _p(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(n=null==r?void 0:r.data)&&void 0!==n?n:{},create_user:null===(s=null==r?void 0:r.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(i=null==r?void 0:r.channel)&&void 0!==i?i:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a})}throw new Mf("You must provide either an email or phone number.")}catch(e){if(await ap(this.storage,`${this.storageKey}-code-verifier`),Nf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async verifyOtp(e){var t,r;try{let n,s;"options"in e&&(n=null===(t=e.options)||void 0===t?void 0:t.redirectTo,s=null===(r=e.options)||void 0===r?void 0:r.captchaToken);const{data:i,error:o}=await _p(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:n,xform:bp});if(o)throw o;if(!i)throw new Error("An error occurred on token verification.");const a=i.session,c=i.user;return(null==a?void 0:a.access_token)&&(await this._saveSession(a),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),this._returnResult({data:{user:c,session:a},error:null})}catch(e){if(Nf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithSSO(e){var t,r,n,s,i;try{let o=null,a=null;"pkce"===this.flowType&&([o,a]=await hp(this.storage,this.storageKey));const c=await _p(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:a}),headers:this.headers,xform:Sp});return(null===(s=c.data)||void 0===s?void 0:s.url)&&tp()&&!(null===(i=e.options)||void 0===i?void 0:i.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(e){if(await ap(this.storage,`${this.storageKey}-code-verifier`),Nf(e))return this._returnResult({data:null,error:e});throw e}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new jf;const{error:n}=await _p(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:n})})}catch(e){if(Nf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:s}=e,{error:i}=await _p(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},redirectTo:null==s?void 0:s.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:i})}if("phone"in e){const{phone:r,type:n,options:s}=e,{data:i,error:o}=await _p(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o})}throw new Mf("You must provide either an email or phone number and a type")}catch(e){if(Nf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(e){}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(e){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await op(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=!!e.expires_at&&1e3*e.expires_at-Date.now()<9e4;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const t=await op(this.userStorage,this.storageKey+"-user");(null==t?void 0:t.user)?e.user=t.user:e.user=gp()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const t={value:this.suppressGetSessionWarning};e.user=function(e,t){return new Proxy(e,{get:(e,r,n)=>{if("__isInsecureUserWarningProxy"===r)return!0;if("symbol"==typeof r){const t=r.toString();if("Symbol(Symbol.toPrimitive)"===t||"Symbol(Symbol.toStringTag)"===t||"Symbol(util.inspect.custom)"===t||"Symbol(nodejs.util.inspect.custom)"===t)return Reflect.get(e,r,n)}return t.value||"string"!=typeof r||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(e,r,n)}})}(e.user,t),t.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:n,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{session:null},error:s}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(-1,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await _p(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Tp}):await this._useSession(async e=>{var t,r,n;const{data:s,error:i}=e;if(i)throw i;return(null===(t=s.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await _p(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(n=null===(r=s.session)||void 0===r?void 0:r.access_token)&&void 0!==n?n:void 0,xform:Tp}):{data:{user:null},error:new jf}})}catch(e){if(Nf(e))return function(e){return Nf(e)&&"AuthSessionMissingError"===e.name}(e)&&(await this._removeSession(),await ap(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:e});throw e}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:n,error:s}=r;if(s)throw s;if(!n.session)throw new jf;const i=n.session;let o=null,a=null;"pkce"===this.flowType&&null!=e.email&&([o,a]=await hp(this.storage,this.storageKey));const{data:c,error:l}=await _p(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:a}),jwt:i.access_token,xform:Tp});if(l)throw l;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),this._returnResult({data:{user:i.user},error:null})})}catch(e){if(await ap(this.storage,`${this.storageKey}-code-verifier`),Nf(e))return this._returnResult({data:{user:null},error:e});throw e}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new jf;const t=Date.now()/1e3;let r=t,n=!0,s=null;const{payload:i}=lp(e.access_token);if(i.exp&&(r=i.exp,n=r<=t),n){const{data:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!t)return{data:{user:null,session:null},error:null};s=t}else{const{data:n,error:i}=await this._getUser(e.access_token);if(i)throw i;s={access_token:e.access_token,refresh_token:e.refresh_token,user:n.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return this._returnResult({data:{user:s.user,session:s},error:null})}catch(e){if(Nf(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:n,error:s}=t;if(s)throw s;e=null!==(r=n.session)&&void 0!==r?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new jf;const{data:n,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{user:null,session:null},error:s}):n?this._returnResult({data:{user:n.user,session:n},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(e){if(Nf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _getSessionFromURL(e,t){try{if(!tp())throw new $f("No browser detected.");if(e.error||e.error_description||e.error_code)throw new $f(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Vf("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new $f("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Vf("No code detected.");const{data:t,error:r}=await this._exchangeCodeForSession(e.code);if(r)throw r;const n=new URL(window.location.href);return n.searchParams.delete("code"),window.history.replaceState(window.history.state,"",n.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:s,refresh_token:i,expires_in:o,expires_at:a,token_type:c}=e;if(!(s&&o&&i&&c))throw new $f("No session defined in URL");const l=Math.round(Date.now()/1e3),u=parseInt(o);let h=l+u;a&&(h=parseInt(a));const d=h-l;1e3*d<=If&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${u}s`);const f=h-u;l-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,h,l):l-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,h,l);const{data:p,error:g}=await this._getUser(s);if(g)throw g;const m={provider_token:r,provider_refresh_token:n,access_token:s,expires_in:u,expires_at:h,refresh_token:i,token_type:c,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:m,redirectType:e.type},error:null})}catch(e){if(Nf(e))return this._returnResult({data:{session:null,redirectType:null},error:e});throw e}}_isImplicitGrantCallback(e){return"function"==typeof this.detectSessionInUrl?this.detectSessionInUrl(new URL(window.location.href),e):Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await op(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:n,error:s}=t;if(s)return this._returnResult({error:s});const i=null===(r=n.session)||void 0===r?void 0:r.access_token;if(i){const{error:t}=await this.admin.signOut(i,e);if(t&&(!function(e){return Nf(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return this._returnResult({error:t})}return"others"!==e&&(await this._removeSession(),await ap(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=Symbol("auth-callback"),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,n;try{const{data:{session:n},error:s}=t;if(s)throw s;await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(t){await(null===(n=this.stateChangeEmitters.get(e))||void 0===n?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",t),console.error(t)}})}async resetPasswordForEmail(e,t={}){let r=null,n=null;"pkce"===this.flowType&&([r,n]=await hp(this.storage,this.storageKey,!0));try{return await _p(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(e){if(await ap(this.storage,`${this.storageKey}-code-verifier`),Nf(e))return this._returnResult({data:null,error:e});throw e}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null})}catch(e){if(Nf(e))return this._returnResult({data:null,error:e});throw e}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:r,error:n}=await this._useSession(async t=>{var r,n,s,i,o;const{data:a,error:c}=t;if(c)throw c;const l=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(r=e.options)||void 0===r?void 0:r.redirectTo,scopes:null===(n=e.options)||void 0===n?void 0:n.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:!0});return await _p(this.fetch,"GET",l,{headers:this.headers,jwt:null!==(o=null===(i=a.session)||void 0===i?void 0:i.access_token)&&void 0!==o?o:void 0})});if(n)throw n;return tp()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==r?void 0:r.url),this._returnResult({data:{provider:e.provider,url:null==r?void 0:r.url},error:null})}catch(t){if(Nf(t))return this._returnResult({data:{provider:e.provider,url:null},error:t});throw t}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var r;try{const{error:n,data:{session:s}}=t;if(n)throw n;const{options:i,provider:o,token:a,access_token:c,nonce:l}=e,u=await _p(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!==(r=null==s?void 0:s.access_token)&&void 0!==r?r:void 0,body:{provider:o,id_token:a,access_token:c,nonce:l,link_identity:!0,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:bp}),{data:h,error:d}=u;return d?this._returnResult({data:{user:null,session:null},error:d}):h&&h.session&&h.user?(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:d})):this._returnResult({data:{user:null,session:null},error:new Uf})}catch(e){if(await ap(this.storage,`${this.storageKey}-code-verifier`),Nf(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,n;const{data:s,error:i}=t;if(i)throw i;return await _p(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(n=null===(r=s.session)||void 0===r?void 0:r.access_token)&&void 0!==n?n:void 0})})}catch(e){if(Nf(e))return this._returnResult({data:null,error:e});throw e}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await(r=async r=>(r>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await _p(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:bp})),n=(e,t)=>{const r=200*Math.pow(2,e);return t&&qf(t)&&Date.now()+r-s<If},new Promise((e,t)=>{(async()=>{for(let s=0;s<1/0;s++)try{const t=await r(s);if(!n(s,null))return void e(t)}catch(e){if(!n(s,e))return void t(e)}})()}))}catch(e){if(this._debug(t,"error",e),Nf(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}finally{this._debug(t,"end")}var r,n}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),tp()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=await op(this.storage,this.storageKey);if(n&&this.userStorage){let t=await op(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:n.user},await ip(this.userStorage,this.storageKey+"-user",t)),n.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:gp()}else if(n&&!n.user&&!n.user){const e=await op(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(n.user=e.user,await ap(this.storage,this.storageKey+"-user"),await ip(this.storage,this.storageKey,n)):n.user=gp()}if(this._debug(r,"session from storage",n),!this._isValidSession(n))return this._debug(r,"session is not valid"),void(null!==n&&await this._removeSession());const s=1e3*(null!==(t=n.expires_at)&&void 0!==t?t:1/0)-Date.now()<9e4;if(this._debug(r,`session has${s?"":" not"} expired with margin of 90000s`),s){if(this.autoRefreshToken&&n.refresh_token){const{error:e}=await this._callRefreshToken(n.refresh_token);e&&(console.error(e),qf(e)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(n.user&&!0===n.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(n.access_token);!t&&(null==e?void 0:e.user)?(n.user=e.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(e){console.error("Error getting user data:",e),this._debug(r,"error getting user data, skipping SIGNED_IN notification",e)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(e){return this._debug(r,"error",e),void console.error(e)}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new jf;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new cp;const{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new jf;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const n={data:t.session,error:null};return this.refreshingDeferred.resolve(n),n}catch(e){if(this._debug(n,"error",e),Nf(e)){const r={data:null,error:e};return qf(e)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(r),r}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(e),e}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,r=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],s=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(e){n.push(e)}});if(await Promise.all(s),n.length>0){for(let e=0;e<n.length;e+=1)console.error(n[e]);throw n[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await ap(this.storage,`${this.storageKey}-code-verifier`);const t=Object.assign({},e),r=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!r&&t.user&&await ip(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const n=mp(e);await ip(this.storage,this.storageKey,n)}else{const e=mp(t);await ip(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await ap(this.storage,this.storageKey),await ap(this.storage,this.storageKey+"-code-verifier"),await ap(this.storage,this.storageKey+"-user"),this.userStorage&&await ap(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&tp()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),If);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const n=Math.floor((1e3*r.expires_at-e)/If);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),n<=3&&await this._callRefreshToken(r.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(!(e.isAcquireTimeout||e instanceof Pp))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!tp()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const n=[`provider=${encodeURIComponent(t)}`];if((null==r?void 0:r.redirectTo)&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),(null==r?void 0:r.scopes)&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),"pkce"===this.flowType){const[e,t]=await hp(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});n.push(r.toString())}if(null==r?void 0:r.queryParams){const e=new URLSearchParams(r.queryParams);n.push(e.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:n,error:s}=t;return s?this._returnResult({data:null,error:s}):await _p(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token})})}catch(e){if(Nf(e))return this._returnResult({data:null,error:e});throw e}}async _enroll(e){try{return await this._useSession(async t=>{var r,n;const{data:s,error:i}=t;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:a,error:c}=await _p(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});return c?this._returnResult({data:null,error:c}):("totp"===e.factorType&&"totp"===a.type&&(null===(n=null==a?void 0:a.totp)||void 0===n?void 0:n.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),this._returnResult({data:a,error:null}))})}catch(e){if(Nf(e))return this._returnResult({data:null,error:e});throw e}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:s}=t;if(s)return this._returnResult({data:null,error:s});const i=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?qp(e.webauthn.credential_response):zp(e.webauthn.credential_response)})}:{code:e.code}),{data:o,error:a}=await _p(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:i,headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});return a?this._returnResult({data:null,error:a}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),this._returnResult({data:o,error:a}))})}catch(e){if(Nf(e))return this._returnResult({data:null,error:e});throw e}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:s}=t;if(s)return this._returnResult({data:null,error:s});const i=await _p(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});if(i.error)return i;const{data:o}=i;if("webauthn"!==o.type)return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Fp(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Bp(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(Nf(e))return this._returnResult({data:null,error:e});throw e}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};const n={all:[],phone:[],totp:[],webauthn:[]};for(const r of null!==(e=null==t?void 0:t.factors)&&void 0!==e?e:[])n.all.push(r),"verified"===r.status&&n[r.factor_type].push(r);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:r},error:n}=await this.getSession();if(n)return this._returnResult({data:null,error:n});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:s}=lp(r.access_token);let i=null;s.aal&&(i=s.aal);let o=i;return(null!==(t=null===(e=r.user.factors)||void 0===e?void 0:e.filter(e=>"verified"===e.status))&&void 0!==t?t:[]).length>0&&(o="aal2"),{data:{currentLevel:i,nextLevel:o,currentAuthenticationMethods:s.amr||[]},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;return n?this._returnResult({data:null,error:n}):r?await _p(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new jf})})}catch(e){if(Nf(e))return this._returnResult({data:null,error:e});throw e}}async _approveAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;if(s)return this._returnResult({data:null,error:s});if(!n)return this._returnResult({data:null,error:new jf});const i=await _p(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"approve"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&tp()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(e){if(Nf(e))return this._returnResult({data:null,error:e});throw e}}async _denyAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;if(s)return this._returnResult({data:null,error:s});if(!n)return this._returnResult({data:null,error:new jf});const i=await _p(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"deny"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&tp()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(e){if(Nf(e))return this._returnResult({data:null,error:e});throw e}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;return r?this._returnResult({data:null,error:r}):t?await _p(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new jf})})}catch(e){if(Nf(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;return n?this._returnResult({data:null,error:n}):r?(await _p(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new jf})})}catch(e){if(Nf(e))return this._returnResult({data:null,error:e});throw e}}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(t=>t.kid===e);if(r)return r;const n=Date.now();if(r=this.jwks.keys.find(t=>t.kid===e),r&&this.jwks_cached_at+6e5>n)return r;const{data:s,error:i}=await _p(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return s.keys&&0!==s.keys.length?(this.jwks=s,this.jwks_cached_at=n,r=s.keys.find(t=>t.kid===e),r||null):null}async getClaims(e,t={}){try{let r=e;if(!r){const{data:e,error:t}=await this.getSession();if(t||!e.session)return this._returnResult({data:null,error:t});r=e.session.access_token}const{header:n,payload:s,signature:i,raw:{header:o,payload:a}}=lp(r);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(s.exp);const c=n.alg&&!n.alg.startsWith("HS")&&n.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(n.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks):null;if(!c){const{error:e}=await this.getUser(r);if(e)throw e;return{data:{claims:s,header:n,signature:i},error:null}}const l=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(n.alg),u=await crypto.subtle.importKey("jwk",c,l,!0,["verify"]);if(!await crypto.subtle.verify(l,u,i,function(e){const t=[];return function(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const t=1024*(n-55296)&65535;n=65536+(e.charCodeAt(r+1)-56320&65535|t),r+=1}Xf(n,t)}}(e,e=>t.push(e)),new Uint8Array(t)}(`${o}.${a}`)))throw new Hf("Invalid JWT signature");return{data:{claims:s,header:n,signature:i},error:null}}catch(e){if(Nf(e))return this._returnResult({data:null,error:e});throw e}}}eg.nextInstanceID={};const tg=eg;let rg="";rg="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const ng={headers:{"X-Client-Info":`supabase-js-${rg}/2.89.0`}},sg={schema:"public"},ig={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},og={};function ag(e){return(ag="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function cg(e,t,r){return(t=function(e){var t=function(e){if("object"!=ag(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=ag(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ag(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lg(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ug(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?lg(Object(r),!0).forEach(function(t){cg(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lg(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var hg=class extends tg{constructor(e){super(e)}},dg=class{constructor(e,t,r){var n,s;this.supabaseUrl=e,this.supabaseKey=t;const i=function(e){const t=null==e?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((r=t).endsWith("/")?r:r+"/")}catch(e){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var r}(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,a=function(e,t){var r,n;const{db:s,auth:i,realtime:o,global:a}=e,{db:c,auth:l,realtime:u,global:h}=t,d={db:ug(ug({},c),s),auth:ug(ug({},l),i),realtime:ug(ug({},u),o),storage:{},global:ug(ug(ug({},h),a),{},{headers:ug(ug({},null!==(r=null==h?void 0:h.headers)&&void 0!==r?r:{}),null!==(n=null==a?void 0:a.headers)&&void 0!==n?n:{})}),accessToken:async()=>""};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}(null!=r?r:{},{db:sg,realtime:og,auth:ug(ug({},ig),{},{storageKey:o}),global:ng});var c;this.storageKey=null!==(n=a.auth.storageKey)&&void 0!==n?n:"",this.headers=null!==(s=a.global.headers)&&void 0!==s?s:{},a.accessToken?(this.accessToken=a.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(c=a.auth)&&void 0!==c?c:{},this.headers,a.global.fetch),this.fetch=((e,t,r)=>{const n=(e=>e?(...t)=>e(...t):(...e)=>fetch(...e))(r),s=Headers;return async(r,i)=>{var o;const a=null!==(o=await t())&&void 0!==o?o:e;let c=new s(null==i?void 0:i.headers);return c.has("apikey")||c.set("apikey",e),c.has("Authorization")||c.set("Authorization",`Bearer ${a}`),n(r,ug(ug({},i),{},{headers:c}))}})(t,this._getAccessToken.bind(this),a.global.fetch),this.realtime=this._initRealtimeClient(ug({headers:this.headers,accessToken:this._getAccessToken.bind(this)},a.realtime)),this.accessToken&&this.accessToken().then(e=>this.realtime.setAuth(e)).catch(e=>console.warn("Failed to set initial Realtime auth token:",e)),this.rest=new Qh(new URL("rest/v1",i).href,{headers:this.headers,schema:a.db.schema,fetch:this.fetch}),this.storage=new Tf(this.storageUrl.href,this.headers,this.fetch,null==r?void 0:r.storage),a.accessToken||this._listenForAuthEvents()}get functions(){return new qh(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t,r=this;if(r.accessToken)return await r.accessToken();const{data:n}=await r.auth.getSession();return null!==(e=null===(t=n.session)||void 0===t?void 0:t.access_token)&&void 0!==e?e:r.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:s,storageKey:i,flowType:o,lock:a,debug:c,throwOnError:l},u,h){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new hg({url:this.authUrl.href,headers:ug(ug({},d),u),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:s,flowType:o,lock:a,debug:c,throwOnError:l,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new Ad(this.realtimeUrl.href,ug(ug({},e),{},{params:ug(ug({},{apikey:this.supabaseKey}),null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===r?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=r,this.realtime.setAuth(r))}};function fg(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",s=r.toStringTag||"@@toStringTag";function i(r,n,s,i){var c=n&&n.prototype instanceof a?n:a,l=Object.create(c.prototype);return pg(l,"_invoke",function(r,n,s){var i,a,c,l=0,u=s||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return i=t,a=0,c=e,d.n=r,o}};function f(r,n){for(a=r,c=n,t=0;!h&&l&&!s&&t<u.length;t++){var s,i=u[t],f=d.p,p=i[2];r>3?(s=p===n)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=f&&((s=r<2&&f<i[1])?(a=0,d.v=n,d.n=i[1]):f<p&&(s=r<3||i[0]>n||n>p)&&(i[4]=r,i[5]=n,d.n=p,a=0))}if(s||r>1)return o;throw h=!0,n}return function(s,u,p){if(l>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),a=u,c=p;(t=a<2?e:c)||!h;){i||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(l=2,i){if(a||(s="next"),t=i[s]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+s+"' method"),a=1);i=e}else if((t=(h=d.n<0)?c:r.call(n,d))!==o)break}catch(t){i=e,a=1,c=t}finally{l=1}}return{value:t,done:h}}}(r,s,i),!0),l}var o={};function a(){}function c(){}function l(){}t=Object.getPrototypeOf;var u=[][n]?t(t([][n]())):(pg(t={},n,function(){return this}),t),h=l.prototype=a.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,pg(e,s,"GeneratorFunction")),e.prototype=Object.create(h),e}return c.prototype=l,pg(h,"constructor",l),pg(l,"constructor",c),c.displayName="GeneratorFunction",pg(l,s,"GeneratorFunction"),pg(h),pg(h,s,"Generator"),pg(h,n,function(){return this}),pg(h,"toString",function(){return"[object Generator]"}),(fg=function(){return{w:i,m:d}})()}function pg(e,t,r,n){var s=Object.defineProperty;try{s({},"",{})}catch(e){s=0}pg=function(e,t,r,n){function i(t,r){pg(e,t,function(e){return this._invoke(t,r,e)})}t?s?s(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},pg(e,t,r,n)}function gg(e,t,r,n,s,i,o){try{var a=e[i](o),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,s)}(function(){if("undefined"!=typeof window)return!1;if("undefined"==typeof process)return!1;const e=process.version;if(null==e)return!1;const t=e.match(/^v(\d+)\./);return!!t&&parseInt(t[1],10)<=18})()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");var mg=function(){var e,t=(e=fg().m(function e(t,r,n){var s,i,o,a,c;return fg().w(function(e){for(;;)switch(e.n){case 0:return i=gh(r,"users",t),e.n=1,jh(i);case 1:if((o=e.v).exists()||alert("Kullanc bilgileri bulunamad!"),a=o.data(),c=null!==(s=a.expireDate)&&void 0!==s&&s.toDate?a.expireDate.toDate():new Date(a.expireDate),!(new Date>c)){e.n=2;break}return alert("Hesabnzn sresi dolmu. Ltfen ynetici ile iletiime gein."),e.n=2,Gr(n);case 2:return e.a(2)}},e)}),function(){var t=this,r=arguments;return new Promise(function(n,s){var i=e.apply(t,r);function o(e){gg(i,n,s,o,a,"next",e)}function a(e){gg(i,n,s,o,a,"throw",e)}o(void 0)})});return function(e,r,n){return t.apply(this,arguments)}}();function yg(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",s=r.toStringTag||"@@toStringTag";function i(r,n,s,i){var c=n&&n.prototype instanceof a?n:a,l=Object.create(c.prototype);return vg(l,"_invoke",function(r,n,s){var i,a,c,l=0,u=s||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return i=t,a=0,c=e,d.n=r,o}};function f(r,n){for(a=r,c=n,t=0;!h&&l&&!s&&t<u.length;t++){var s,i=u[t],f=d.p,p=i[2];r>3?(s=p===n)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=f&&((s=r<2&&f<i[1])?(a=0,d.v=n,d.n=i[1]):f<p&&(s=r<3||i[0]>n||n>p)&&(i[4]=r,i[5]=n,d.n=p,a=0))}if(s||r>1)return o;throw h=!0,n}return function(s,u,p){if(l>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),a=u,c=p;(t=a<2?e:c)||!h;){i||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(l=2,i){if(a||(s="next"),t=i[s]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+s+"' method"),a=1);i=e}else if((t=(h=d.n<0)?c:r.call(n,d))!==o)break}catch(t){i=e,a=1,c=t}finally{l=1}}return{value:t,done:h}}}(r,s,i),!0),l}var o={};function a(){}function c(){}function l(){}t=Object.getPrototypeOf;var u=[][n]?t(t([][n]())):(vg(t={},n,function(){return this}),t),h=l.prototype=a.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,vg(e,s,"GeneratorFunction")),e.prototype=Object.create(h),e}return c.prototype=l,vg(h,"constructor",l),vg(l,"constructor",c),c.displayName="GeneratorFunction",vg(l,s,"GeneratorFunction"),vg(h),vg(h,s,"Generator"),vg(h,n,function(){return this}),vg(h,"toString",function(){return"[object Generator]"}),(yg=function(){return{w:i,m:d}})()}function vg(e,t,r,n){var s=Object.defineProperty;try{s({},"",{})}catch(e){s=0}vg=function(e,t,r,n){function i(t,r){vg(e,t,function(e){return this._invoke(t,r,e)})}t?s?s(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},vg(e,t,r,n)}function wg(e,t,r,n,s,i,o){try{var a=e[i](o),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,s)}function _g(e){return function(){var t=this,r=arguments;return new Promise(function(n,s){var i=e.apply(t,r);function o(e){wg(i,n,s,o,a,"next",e)}function a(e){wg(i,n,s,o,a,"throw",e)}o(void 0)})}}var bg=new dg("https://oybvsqonvawnkztnhwec.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im95YnZzcW9udmF3bmt6dG5od2VjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMjMwMDIsImV4cCI6MjA3NzY5OTAwMn0.OPa9rGvmFVAocrzlNPLx-8AJ7IF-Wcm58jlS4zXEYW0",void 0),Eg=ze({apiKey:"AIzaSyDIGME8_6gN9bI1SCadrsx93QhQRCfC-dM",authDomain:"canli-altin-app.firebaseapp.com",databaseURL:"https://canli-altin-app-default-rtdb.europe-west1.firebasedatabase.app",projectId:"canli-altin-app",storageBucket:"canli-altin-app.firebasestorage.app",messagingSenderId:"675863034125",appId:"1:675863034125:web:301006180c35a5f0549844",measurementId:"G-V3YHGPSB8M"}),Tg=function(e=He()){const t=$e(e,"auth");if(t.isInitialized())return t.getImmediate();const r=function(e,t){const r=$e(e,"auth");if(r.isInitialized()){const e=r.getImmediate();if(b(r.getOptions(),null!=t?t:{}))return e;at(e,"already-initialized")}return r.initialize({options:t})}(e,{popupRedirectResolver:Zn,persistence:[yn,Zr,tn]}),n=l("authTokenSyncURL");if(n&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(n,location.origin);if(location.origin===e.origin){const t=(s=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),r=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>ns)return;const n=null==t?void 0:t.token;ss!==n&&(ss=n,await fetch(s,{method:n?"POST":"DELETE",headers:n?{Authorization:`Bearer ${n}`}:{}}))});!function(e,t,r){A(e).beforeAuthStateChanged(t,r)}(r,t,()=>t(r.currentUser)),function(e){A(e).onIdTokenChanged(e=>t(e),void 0,void 0)}(r)}}var s;const i=a("auth");return i&&function(e,t,r){const n=pr(e);dt(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const s=!!(null==r?void 0:r.disableWarnings),i=Ir(t),{host:o,port:a}=function(e){const t=Ir(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};const n=r[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(n);if(s){const e=s[1];return{host:e,port:kr(n.substr(e.length+1))}}{const[e,t]=n.split(":");return{host:e,port:kr(t)}}}(t),c=null===a?"":`:${a}`,l={url:`${i}//${o}${c}/`},u=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!n._canInitEmulator)return dt(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),void dt(b(l,n.config.emulator)&&b(u,n.emulatorConfig),n,"emulator-config-failed");n.config.emulator=l,n.emulatorConfig=u,n.settings.appVerificationDisabledForTesting=!0,h(o)?(d(`${i}//${o}${c}`),g("Auth",!0)):s||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(r,`http://${i}`),r}(Eg),Sg=function(e){const t="object"==typeof e?e:He(),r="string"==typeof e?e:io,n=$e(t,"firestore").getImmediate({identifier:r});if(!n._initialized){const e=(()=>{const e=a("firestore");if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return"["===e[0]?[e.substring(1,t-1),r]:[e.substring(0,t),r]})();e&&function(e,t,r,n={}){var i;e=oi(e,hh);const o=h(t),a=e._getSettings(),c=Object.assign(Object.assign({},a),{emulatorOptions:e._getEmulatorOptions()}),l=`${t}:${r}`;o&&(d(`https://${l}`),g("Firestore",!0)),a.host!==ch&&a.host!==l&&As("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u=Object.assign(Object.assign({},a),{host:l,ssl:o,emulatorOptions:n});if(!b(u,c)&&(e._setSettings(u),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=Es.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}(n.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const o=n.mockUserToken.sub||n.mockUserToken.user_id;if(!o)throw new Ls(xs.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new Es(o)}e._authCredentials=new $s(new Us(t,r))}}(n,...e)}return n}(Eg),Ig=document.getElementById("logoInput"),kg=document.getElementById("adInput"),Cg=document.getElementById("uploadBtn"),Ag=null,Og=!1;!function(e,t){A(e).onAuthStateChanged(t,void 0,void 0)}(Tg,function(){var e=_g(yg().m(function e(t){var r,n;return yg().w(function(e){for(;;)switch(e.n){case 0:if(!t){e.n=3;break}return e.n=1,mg(t.uid,Sg,Tg);case 1:return Ag=t,r=document.getElementById("topButtons"),n=gh(Sg,"admins",t.uid),e.n=2,jh(n);case 2:e.v.exists()?(Og=!0,r.innerHTML='\n            <button id="adminPanelBtn" class="newUserBtn backgroundColor">\n              Admin Paneli\n            </button>\n            <button id="homeBtn" class="homeBtn backgroundColor">\n               Ana Sayfa\n            </button>\n            <button id="logoutBtn" class="logoutBtn backgroundColor">\n               k Yap\n            </button>\n          '):(document.getElementById("ad-container").style.display="none",r.innerHTML='\n            <button id="homeBtn" class="homeBtn backgroundColor">\n               Ana Sayfa\n            </button>\n            <button id="logoutBtn" class="logoutBtn backgroundColor">\n               k Yap\n            </button>\n          '),document.getElementById("adminPanelBtn")&&document.getElementById("adminPanelBtn").addEventListener("click",function(){window.location.href="../adminPanel/adminPanel.html"}),document.getElementById("homeBtn").addEventListener("click",function(){window.location.href="../livePrices/livePrices.html"}),document.getElementById("logoutBtn").addEventListener("click",function(){Gr(Tg).then(function(){window.location.href="../index.html"}).catch(function(e){console.error("k yaplamad:",e),alert("k srasnda bir hata olutu!")})}),e.n=4;break;case 3:window.location.href="../index.html";case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());var Rg=function(){var e=_g(yg().m(function e(t,r,n){var s,i,o,a,c,l;return yg().w(function(e){for(;;)switch(e.n){case 0:return s=n.name.replace(/[^a-zA-Z0-9.]/g,"_"),i="users/".concat(Ag.uid,"/").concat(t,"_").concat(Date.now(),"_").concat(s),e.n=1,bg.storage.from(r).upload(i,n,{upsert:!0});case 1:if((o=e.v).data,!(a=o.error)){e.n=2;break}return console.error("Ykleme hatas:",a),alert("Ykleme hatas: "+a.message),e.a(2,null);case 2:return c=bg.storage.from(r).getPublicUrl(i),l=c.data,e.a(2,l.publicUrl)}},e)}));return function(t,r,n){return e.apply(this,arguments)}}();Cg.addEventListener("click",_g(yg().m(function e(){var t,r,n,s;return yg().w(function(e){for(;;)switch(e.n){case 0:if(t=Ig.files[0],r=kg.files[0],t&&(!Og||r)){e.n=1;break}return alert("Ltfen bir dosya sein."),e.a(2);case 1:return e.n=2,Rg("logo","logos",t);case 2:if(n=e.v,s=null,!Og){e.n=4;break}return e.n=3,Rg("ad","ads",r);case 3:s=e.v;case 4:if(n&&(!Og||s)){e.n=5;break}return e.a(2);case 5:return e.n=6,bg.from("profiles").upsert({id:Ag.uid,logo_url:n,updated_at:(new Date).toISOString()});case 6:if(!Og){e.n=7;break}return e.n=7,bg.from("ads").upsert({id:Ag.uid,ad_url:s,updated_at:(new Date).toISOString()});case 7:alert("Ykleme baarl!");case 8:return e.a(2)}},e)})))})();